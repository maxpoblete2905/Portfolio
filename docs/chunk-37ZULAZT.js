import{a as Xm,b as kl,c as Vl,d as Ia,e as ys,f as Nl,g as Ta,h as Aa,i as Jm,j as Ml,k as ee,l as nn,m as Ft,n as Ca,o as er,p as Sa,q as ba,r as _s,s as Ra,t as Ke,u as rt}from"./chunk-XXZQEKK6.js";import{$ as N,$a as At,A as Et,Aa as cs,Ab as va,B as Fr,Ba as wm,Bb as Lm,C as _l,Ca as ls,Cb as xl,D as Lr,Da as Ee,Db as ps,E as um,Ea as Q,Eb as Um,F as cm,Fa as Em,Fb as jm,G as ha,Gb as Gr,H as Mt,Ha as Im,Hb as Bm,I as vl,Ia as zr,Ib as Jn,J as lm,Jb as qm,K as da,Ka as le,Kb as $m,L as Ur,La as Tm,Lb as Ct,M as wl,Ma as Am,Mb as zm,N as jr,Na as Tn,Nb as gs,O as me,Oa as Cm,Ob as Gm,P as El,Pa as Sm,Pb as Hm,Q as hm,Qa as Cl,Qb as ms,R as De,Ra as bm,Rb as Wm,S as ce,Sa as hs,Sb as wa,T as wn,Ta as pa,U as os,Ua as ot,Ub as Ea,V as $,Va as Sl,Vb as Km,W as Be,Wb as Zn,X as dm,Xa as re,Xb as Qm,Y as q,Ya as se,Yb as Ym,Z as Il,Za as tt,_ as R,_a as Rm,a as em,aa as Ot,ab as Dm,b as tm,ba as fm,c as yn,ca as as,cb as bl,d as gl,da as en,db as Pm,e as ml,ea as we,eb as xm,f as Nt,fa as qe,fb as km,g as ft,ga as We,gb as nt,h as ca,hb as Vm,i as nm,ia as pm,ib as tn,j as _n,ja as us,k as vn,ka as En,kb as ds,l as Xn,la as In,lb as Nm,m as Z,ma as gm,n as x,na as mm,o as is,oa as Br,p as rm,pa as ym,pb as fs,q as im,qa as qr,qb as Mm,r as F,ra as Tl,rb as ga,s as la,sa as $r,sb as Om,t as st,ta as It,tb as ma,u as ss,ua as _m,ub as ya,v as sm,va as fa,vb as Rl,w as yl,wa as vm,wb as _a,x as om,xa as Tt,xb as Dl,y as am,yb as Fm,z as pt,za as Al,zb as Pl}from"./chunk-DQPNDR3U.js";import{a as b,b as te,e as pl,f as g}from"./chunk-CQCHLVVT.js";var Ll=class extends $m{constructor(){super(...arguments),this.supportsDOMEvents=!0}},Ul=class n extends Ll{static makeCurrent(){qm(new n)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=b0();return t==null?null:R0(t)}resetBaseElement(){vs=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Wm(document.cookie,e)}},vs=null;function b0(){return vs=vs||document.querySelector("base"),vs?vs.getAttribute("href"):null}function R0(n){return new URL(n,document.baseURI).pathname}var jl=class{addToWindow(e){wn.getAngularTestability=(r,i=!0)=>{let s=e.findTestabilityInTree(r,i);if(s==null)throw new ce(5103,!1);return s},wn.getAllAngularTestabilities=()=>e.getAllTestabilities(),wn.getAllAngularRootElements=()=>e.getAllRootElements();let t=r=>{let i=wn.getAllAngularTestabilities(),s=i.length,o=function(){s--,s==0&&r()};i.forEach(a=>{a.whenStable(o)})};wn.frameworkStabilizers||(wn.frameworkStabilizers=[]),wn.frameworkStabilizers.push(t)}findTestabilityInTree(e,t,r){if(t==null)return null;let i=e.getTestability(t);return i??(r?Jn().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},D0=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),Bl=new q(""),ny=(()=>{let e=class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new ce(5101,!1);return this._eventNameToPlugin.set(r,i),i}};e.\u0275fac=function(i){return new(i||e)(R(Bl),R(le))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),Da=class{constructor(e){this._doc=e}},Ol="ng-app-id",ry=(()=>{let e=class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Zn(o),this.resetHostNodes()}addStyles(r){for(let i of r)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(r){for(let i of r)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let i of this.hostNodes)this.addStyleToHost(i,r)}onStyleRemoved(r){let i=this.styleRef;i.get(r)?.elements?.forEach(s=>s.remove()),i.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${Ol}="${this.appId}"]`);if(r?.length){let i=new Map;return r.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){let s=this.styleRef;if(s.has(r)){let o=s.get(r);return o.usage+=i,o.usage}return s.set(r,{usage:i,elements:[]}),i}getStyleElement(r,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(Ol),o;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(Ol,this.appId),r.appendChild(a),a}}addStyleToHost(r,i){let s=this.getStyleElement(r,i),o=this.styleRef,a=o.get(i)?.elements;a?a.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};e.\u0275fac=function(i){return new(i||e)(R(Ct),R(fa),R(Al,8),R(Tt))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),Fl={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},$l=/%COMP%/g,iy="%COMP%",P0=`_nghost-${iy}`,x0=`_ngcontent-${iy}`,k0=!0,V0=new q("",{providedIn:"root",factory:()=>k0});function N0(n){return x0.replace($l,n)}function M0(n){return P0.replace($l,n)}function sy(n,e){return e.map(t=>t.replace($l,n))}var Zm=(()=>{let e=class e{constructor(r,i,s,o,a,u,c,l=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=u,this.ngZone=c,this.nonce=l,this.rendererByCompId=new Map,this.platformIsServer=Zn(u),this.defaultRenderer=new ws(r,a,c,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===as.ShadowDom&&(i=te(b({},i),{encapsulation:as.Emulated}));let s=this.getOrCreateRenderer(r,i);return s instanceof Pa?s.applyToHost(r):s instanceof Es&&s.applyStyles(),s}getOrCreateRenderer(r,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let a=this.doc,u=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(i.encapsulation){case as.Emulated:o=new Pa(c,l,i,this.appId,h,a,u,d);break;case as.ShadowDom:return new ql(c,l,r,i,a,u,this.nonce,d);default:o=new Es(c,l,i,h,a,u,d);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(i){return new(i||e)(R(ny),R(ry),R(fa),R(V0),R(Ct),R(Tt),R(le),R(Al))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),ws=class{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(Fl[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(ey(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(ey(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new ce(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let s=Fl[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=Fl[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(ls.DashCase|ls.Important)?e.style.setProperty(t,r,i&ls.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&ls.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r){if(typeof e=="string"&&(e=Jn().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function ey(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var ql=class extends ws{constructor(e,t,r,i,s,o,a,u){super(e,s,o,u),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let c=sy(i.id,i.styles);for(let l of c){let h=document.createElement("style");a&&h.setAttribute("nonce",a),h.textContent=l,this.shadowRoot.appendChild(h)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Es=class extends ws{constructor(e,t,r,i,s,o,a,u){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=u?sy(u,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Pa=class extends Es{constructor(e,t,r,i,s,o,a,u){let c=i+"-"+r.id;super(e,t,r,s,o,a,u,c),this.contentAttr=N0(c),this.hostAttr=M0(c)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},O0=(()=>{let e=class e extends Da{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}};e.\u0275fac=function(i){return new(i||e)(R(Ct))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),ty=["alt","control","meta","shift"],F0={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},L0={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},U0=(()=>{let e=class e extends Da{constructor(r){super(r)}supports(r){return e.parseEventName(r)!=null}addEventListener(r,i,s){let o=e.parseEventName(i),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Jn().onAndCancel(r,o.domEventName,a))}static parseEventName(r){let i=r.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=e._normalizeKey(i.pop()),a="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),a="code."),ty.forEach(l=>{let h=i.indexOf(l);h>-1&&(i.splice(h,1),a+=l+".")}),a+=o,i.length!=0||o.length===0)return null;let c={};return c.domEventName=s,c.fullKey=a,c}static matchEventFullKeyCode(r,i){let s=F0[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),ty.forEach(a=>{if(a!==s){let u=L0[a];u(r)&&(o+=a+".")}}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return r==="esc"?"escape":r}};e.\u0275fac=function(i){return new(i||e)(R(Ct))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})();function j0(){Ul.makeCurrent()}function B0(){return new Tl}function q0(){return _m(document),document}var $0=[{provide:Tt,useValue:Km},{provide:vm,useValue:j0,multi:!0},{provide:Ct,useFactory:q0,deps:[]}],sV=Lm(Um,"browser",$0),z0=new q(""),G0=[{provide:ma,useClass:jl,deps:[]},{provide:Om,useClass:ya,deps:[le,Rl,ma]},{provide:ya,useClass:ya,deps:[le,Rl,ma]}],H0=[{provide:pm,useValue:"root"},{provide:Tl,useFactory:B0,deps:[]},{provide:Bl,useClass:O0,multi:!0,deps:[Ct,le,Tt]},{provide:Bl,useClass:U0,multi:!0,deps:[Ct]},Zm,ry,ny,{provide:Im,useExisting:Zm},{provide:Ym,useClass:D0,deps:[]},[]],oV=(()=>{let e=class e{constructor(r){}static withServerTransition(r){return{ngModule:e,providers:[{provide:fa,useValue:r.appId}]}}};e.\u0275fac=function(i){return new(i||e)(R(z0,12))},e.\u0275mod=qe({type:e}),e.\u0275inj=Be({providers:[...H0,...G0],imports:[Ea,jm]});let n=e;return n})();var oy=(()=>{let e=class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};e.\u0275fac=function(i){return new(i||e)(R(Ct))},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var B="primary",Os=Symbol("RouteTitle"),Kl=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function Yr(n){return new Kl(n)}function K0(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function Q0(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!Lt(n[t],e[t]))return!1;return!0}function Lt(n,e){let t=n?Ql(n):void 0,r=e?Ql(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!my(n[i],e[i]))return!1;return!0}function Ql(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function my(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function yy(n){return n.length>0?n[n.length-1]:null}function bn(n){return rm(n)?n:_a(n)?Z(Promise.resolve(n)):x(n)}var Y0={exact:vy,subset:wy},_y={exact:X0,subset:J0,ignored:()=>!0};function ay(n,e,t){return Y0[t.paths](n.root,e.root,t.matrixParams)&&_y[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function X0(n,e){return Lt(n,e)}function vy(n,e,t){if(!nr(n.segments,e.segments)||!Va(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!vy(n.children[r],e.children[r],t))return!1;return!0}function J0(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>my(n[t],e[t]))}function wy(n,e,t){return Ey(n,e,e.segments,t)}function Ey(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!nr(i,t)||e.hasChildren()||!Va(i,t,r))}else if(n.segments.length===t.length){if(!nr(n.segments,t)||!Va(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!wy(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!nr(n.segments,i)||!Va(n.segments,i,r)||!n.children[B]?!1:Ey(n.children[B],e,s,r)}}function Va(n,e,t){return e.every((r,i)=>_y[t](n[i].parameters,r.parameters))}var An=class{constructor(e=new Y([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Yr(this.queryParams),this._queryParamMap}toString(){return tA.serialize(this)}},Y=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Na(this)}},tr=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=Yr(this.parameters),this._parameterMap}toString(){return Ty(this)}};function Z0(n,e){return nr(n,e)&&n.every((t,r)=>Lt(t.parameters,e[r].parameters))}function nr(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function eA(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===B&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==B&&(t=t.concat(e(i,r)))}),t}var Fs=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>new Rs,providedIn:"root"});let n=e;return n})(),Rs=class{parse(e){let t=new Xl(e);return new An(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${Is(e.root,!0)}`,r=iA(e.queryParams),i=typeof e.fragment=="string"?`#${nA(e.fragment)}`:"";return`${t}${r}${i}`}},tA=new Rs;function Na(n){return n.segments.map(e=>Ty(e)).join("/")}function Is(n,e){if(!n.hasChildren())return Na(n);if(e){let t=n.children[B]?Is(n.children[B],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==B&&r.push(`${i}:${Is(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=eA(n,(r,i)=>i===B?[Is(n.children[B],!1)]:[`${i}:${Is(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[B]!=null?`${Na(n)}/${t[0]}`:`${Na(n)}/(${t.join("//")})`}}function Iy(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function xa(n){return Iy(n).replace(/%3B/gi,";")}function nA(n){return encodeURI(n)}function Yl(n){return Iy(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ma(n){return decodeURIComponent(n)}function uy(n){return Ma(n.replace(/\+/g,"%20"))}function Ty(n){return`${Yl(n.path)}${rA(n.parameters)}`}function rA(n){return Object.entries(n).map(([e,t])=>`;${Yl(e)}=${Yl(t)}`).join("")}function iA(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${xa(t)}=${xa(i)}`).join("&"):`${xa(t)}=${xa(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var sA=/^[^\/()?;#]+/;function zl(n){let e=n.match(sA);return e?e[0]:""}var oA=/^[^\/()?;=#]+/;function aA(n){let e=n.match(oA);return e?e[0]:""}var uA=/^[^=?&#]+/;function cA(n){let e=n.match(uA);return e?e[0]:""}var lA=/^[^&#]+/;function hA(n){let e=n.match(lA);return e?e[0]:""}var Xl=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Y([],{}):new Y([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[B]=new Y(e,t)),r}parseSegment(){let e=zl(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new ce(4009,!1);return this.capture(e),new tr(Ma(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=aA(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=zl(this.remaining);i&&(r=i,this.capture(r))}e[Ma(t)]=Ma(r)}parseQueryParam(e){let t=cA(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=hA(this.remaining);o&&(r=o,this.capture(r))}let i=uy(t),s=uy(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=zl(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new ce(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=B);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[B]:new Y([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new ce(4011,!1)}};function Ay(n){return n.segments.length>0?new Y([],{[B]:n}):n}function Cy(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=Cy(i);if(r===B&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new Y(n.segments,e);return dA(t)}function dA(n){if(n.numberOfChildren===1&&n.children[B]){let e=n.children[B];return new Y(n.segments.concat(e.segments),e.children)}return n}function Xr(n){return n instanceof An}function fA(n,e,t=null,r=null){let i=Sy(n);return by(i,e,t,r)}function Sy(n){let e;function t(s){let o={};for(let u of s.children){let c=t(u);o[u.outlet]=c}let a=new Y(s.url,o);return s===n&&(e=a),a}let r=t(n.root),i=Ay(r);return e??i}function by(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return Gl(i,i,i,t,r);let s=pA(e);if(s.toRoot())return Gl(i,i,new Y([],{}),t,r);let o=gA(s,i,n),a=o.processChildren?Cs(o.segmentGroup,o.index,s.commands):Dy(o.segmentGroup,o.index,s.commands);return Gl(i,o.segmentGroup,a,t,r)}function Oa(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function Ds(n){return typeof n=="object"&&n!=null&&n.outlets}function Gl(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([u,c])=>{s[u]=Array.isArray(c)?c.map(l=>`${l}`):`${c}`});let o;n===e?o=t:o=Ry(n,e,t);let a=Ay(Cy(o));return new An(a,s,i)}function Ry(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=Ry(s,e,t)}),new Y(n.segments,r)}var Fa=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Oa(r[0]))throw new ce(4003,!1);let i=r.find(Ds);if(i&&i!==yy(r))throw new ce(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function pA(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new Fa(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([u,c])=>{a[u]=typeof c=="string"?c.split("/"):c}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,u)=>{u==0&&a==="."||(u==0&&a===""?t=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new Fa(t,e,r)}var Kr=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function gA(n,e,t){if(n.isAbsolute)return new Kr(e,!0,0);if(!t)return new Kr(e,!1,NaN);if(t.parent===null)return new Kr(t,!0,0);let r=Oa(n.commands[0])?0:1,i=t.segments.length-1+r;return mA(t,i,n.numberOfDoubleDots)}function mA(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new ce(4005,!1);i=r.segments.length}return new Kr(r,!1,i-s)}function yA(n){return Ds(n[0])?n[0].outlets:{[B]:n}}function Dy(n,e,t){if(n??=new Y([],{}),n.segments.length===0&&n.hasChildren())return Cs(n,e,t);let r=_A(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new Y(n.segments.slice(0,r.pathIndex),{});return s.children[B]=new Y(n.segments.slice(r.pathIndex),n.children),Cs(s,0,i)}else return r.match&&i.length===0?new Y(n.segments,{}):r.match&&!n.hasChildren()?Jl(n,e,t):r.match?Cs(n,0,i):Jl(n,e,t)}function Cs(n,e,t){if(t.length===0)return new Y(n.segments,{});{let r=yA(t),i={};if(Object.keys(r).some(s=>s!==B)&&n.children[B]&&n.numberOfChildren===1&&n.children[B].segments.length===0){let s=Cs(n.children[B],e,t);return new Y(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=Dy(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new Y(n.segments,i)}}function _A(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let o=n.segments[i],a=t[r];if(Ds(a))break;let u=`${a}`,c=r<t.length-1?t[r+1]:null;if(i>0&&u===void 0)break;if(u&&c&&typeof c=="object"&&c.outlets===void 0){if(!ly(u,c,o))return s;r+=2}else{if(!ly(u,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function Jl(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(Ds(s)){let u=vA(s.outlets);return new Y(r,u)}if(i===0&&Oa(t[0])){let u=n.segments[e];r.push(new tr(u.path,cy(t[0]))),i++;continue}let o=Ds(s)?s.outlets[B]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&Oa(a)?(r.push(new tr(o,cy(a))),i+=2):(r.push(new tr(o,{})),i++)}return new Y(r,{})}function vA(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=Jl(new Y([],{}),0,r))}),e}function cy(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function ly(n,e,t){return n==t.path&&Lt(e,t.parameters)}var Ss="imperative",Pe=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(Pe||{}),gt=class{constructor(e,t){this.id=e,this.url=t}},Jr=class extends gt{constructor(e,t,r="imperative",i=null){super(e,t),this.type=Pe.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},St=class extends gt{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=Pe.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ut=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(ut||{}),La=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(La||{}),Cn=class extends gt{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Pe.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Sn=class extends gt{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Pe.NavigationSkipped}},Ps=class extends gt{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=Pe.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Ua=class extends gt{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Pe.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Zl=class extends gt{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Pe.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},eh=class extends gt{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=Pe.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},th=class extends gt{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Pe.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},nh=class extends gt{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Pe.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},rh=class{constructor(e){this.route=e,this.type=Pe.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},ih=class{constructor(e){this.route=e,this.type=Pe.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},sh=class{constructor(e){this.snapshot=e,this.type=Pe.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},oh=class{constructor(e){this.snapshot=e,this.type=Pe.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},ah=class{constructor(e){this.snapshot=e,this.type=Pe.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},uh=class{constructor(e){this.snapshot=e,this.type=Pe.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},ja=class{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=Pe.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},xs=class{},ks=class{constructor(e){this.url=e}};var ch=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Ls,this.attachRef=null}},Ls=(()=>{let e=class e{constructor(){this.contexts=new Map}onChildOutletCreated(r,i){let s=this.getOrCreateContext(r);s.outlet=i,this.contexts.set(r,s)}onChildOutletDestroyed(r){let i=this.getContext(r);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let i=this.getContext(r);return i||(i=new ch,this.contexts.set(r,i)),i}getContext(r){return this.contexts.get(r)||null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Ba=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=lh(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=lh(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=hh(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return hh(e,this._root).map(t=>t.value)}};function lh(n,e){if(n===e.value)return e;for(let t of e.children){let r=lh(n,t);if(r)return r}return null}function hh(n,e){if(n===e.value)return[e];for(let t of e.children){let r=hh(n,t);if(r.length)return r.unshift(e),r}return[]}var at=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function Wr(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var qa=class extends Ba{constructor(e,t){super(e),this.snapshot=t,Eh(this,e)}toString(){return this.snapshot.toString()}};function Py(n){let e=wA(n),t=new ft([new tr("",{})]),r=new ft({}),i=new ft({}),s=new ft({}),o=new ft(""),a=new rr(t,r,s,o,i,B,n,e.root);return a.snapshot=e.root,new qa(new at(a,[]),e)}function wA(n){let e={},t={},r={},i="",s=new Vs([],e,r,i,t,B,n,null,{});return new $a("",new at(s,[]))}var rr=class{constructor(e,t,r,i,s,o,a,u){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(F(c=>c[Os]))??x(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(F(e=>Yr(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(F(e=>Yr(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function wh(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:b(b({},e.params),n.params),data:b(b({},e.data),n.data),resolve:b(b(b(b({},n.data),e.data),i?.data),n._resolvedData)}:r={params:b({},n.params),data:b({},n.data),resolve:b(b({},n.data),n._resolvedData??{})},i&&ky(i)&&(r.resolve[Os]=i.title),r}var Vs=class{get title(){return this.data?.[Os]}constructor(e,t,r,i,s,o,a,u,c){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Yr(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Yr(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},$a=class extends Ba{constructor(e,t){super(t),this.url=e,Eh(this,t)}toString(){return xy(this._root)}};function Eh(n,e){e.value._routerState=n,e.children.forEach(t=>Eh(n,t))}function xy(n){let e=n.children.length>0?` { ${n.children.map(xy).join(", ")} } `:"";return`${n.value}${e}`}function Hl(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,Lt(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),Lt(e.params,t.params)||n.paramsSubject.next(t.params),Q0(e.url,t.url)||n.urlSubject.next(t.url),Lt(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function dh(n,e){let t=Lt(n.params,e.params)&&Z0(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||dh(n.parent,e.parent))}function ky(n){return typeof n.title=="string"||n.title===null}var EA=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=B,this.activateEvents=new It,this.deactivateEvents=new It,this.attachEvents=new It,this.detachEvents=new It,this.parentContexts=N(Ls),this.location=N(Am),this.changeDetector=N(ps),this.environmentInjector=N(us),this.inputBinder=N(Qa,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:i,previousValue:s}=r.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ce(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ce(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ce(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,i){this.activated=r,this._activatedRoute=i,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,i){if(this.isActivated)throw new ce(4013,!1);this._activatedRoute=r;let s=this.location,a=r.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,c=new fh(r,u,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:c,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=We({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[In]});let n=e;return n})(),fh=class{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r,this.__ngOutletInjector=!0}get(e,t){return e===rr?this.route:e===Ls?this.childContexts:this.parent.get(e,t)}},Qa=new q(""),hy=(()=>{let e=class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(r){this.unsubscribeFromRouteData(r),this.subscribeToRouteData(r)}unsubscribeFromRouteData(r){this.outletDataSubscriptions.get(r)?.unsubscribe(),this.outletDataSubscriptions.delete(r)}subscribeToRouteData(r){let{activatedRoute:i}=r,s=la([i.queryParams,i.params,i.data]).pipe(me(([o,a,u],c)=>(u=b(b(b({},o),a),u),c===0?x(u):Promise.resolve(u)))).subscribe(o=>{if(!r.isActivated||!r.activatedComponentRef||r.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(r);return}let a=Bm(i.component);if(!a){this.unsubscribeFromRouteData(r);return}for(let{templateName:u}of a.inputs)r.activatedComponentRef.setInput(u,o[u])});this.outletDataSubscriptions.set(r,s)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})();function IA(n,e,t){let r=Ns(n,e._root,t?t._root:void 0);return new qa(r,e)}function Ns(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=TA(n,e,t);return new at(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>Ns(n,a)),o}}let r=AA(e.value),i=e.children.map(s=>Ns(n,s));return new at(r,i)}}function TA(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return Ns(n,r,i);return Ns(n,r)})}function AA(n){return new rr(new ft(n.url),new ft(n.params),new ft(n.queryParams),new ft(n.fragment),new ft(n.data),n.outlet,n.component,n)}var Vy="ngNavigationCancelingError";function Ny(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=Xr(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=My(!1,ut.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function My(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[Vy]=!0,t.cancellationCode=e,t}function CA(n){return Oy(n)&&Xr(n.url)}function Oy(n){return!!n&&n[Vy]}var SA=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=we({type:e,selectors:[["ng-component"]],standalone:!0,features:[Nm],decls:1,vars:0,template:function(i,s){i&1&&tt(0,"router-outlet")},dependencies:[EA],encapsulation:2});let n=e;return n})();function bA(n,e){return n.providers&&!n._injector&&(n._injector=Cl(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Ih(n){let e=n.children&&n.children.map(Ih),t=e?te(b({},n),{children:e}):b({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==B&&(t.component=SA),t}function Ut(n){return n.outlet||B}function RA(n,e){let t=n.filter(r=>Ut(r)===e);return t.push(...n.filter(r=>Ut(r)!==e)),t}function Us(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var DA=(n,e,t,r)=>F(i=>(new ph(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),ph=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),Hl(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=Wr(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Wr(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Wr(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=Wr(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new uh(s.value.snapshot))}),e.children.length&&this.forwardEvent(new oh(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(Hl(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),Hl(a.route.value),this.activateChildRoutes(e,null,o.children)}else{let a=Us(i.snapshot);o.attachRef=null,o.route=i,o.injector=a,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}},za=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Qr=class{constructor(e,t){this.component=e,this.route=t}};function PA(n,e,t){let r=n._root,i=e?e._root:null;return Ts(r,i,t,[r.value])}function xA(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function ei(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!dm(n)?n:e.get(n):r}function Ts(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=Wr(e);return n.children.forEach(o=>{kA(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>bs(a,t.getContext(o),i)),i}function kA(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let u=VA(o,s,s.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new za(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?Ts(n,e,a?a.children:null,r,i):Ts(n,e,t,r,i),u&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new Qr(a.outlet.component,o))}else o&&bs(e,a,i),i.canActivateChecks.push(new za(r)),s.component?Ts(n,null,a?a.children:null,r,i):Ts(n,null,t,r,i);return i}function VA(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!nr(n.url,e.url);case"pathParamsOrQueryParamsChange":return!nr(n.url,e.url)||!Lt(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!dh(n,e)||!Lt(n.queryParams,e.queryParams);case"paramsChange":default:return!dh(n,e)}}function bs(n,e,t){let r=Wr(n),i=n.value;Object.entries(r).forEach(([s,o])=>{i.component?e?bs(o,e.children.getContext(s),t):bs(o,null,t):bs(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new Qr(e.outlet.component,i)):t.canDeactivateChecks.push(new Qr(null,i)):t.canDeactivateChecks.push(new Qr(null,i))}function js(n){return typeof n=="function"}function NA(n){return typeof n=="boolean"}function MA(n){return n&&js(n.canLoad)}function OA(n){return n&&js(n.canActivate)}function FA(n){return n&&js(n.canActivateChild)}function LA(n){return n&&js(n.canDeactivate)}function UA(n){return n&&js(n.canMatch)}function Fy(n){return n instanceof im||n?.name==="EmptyError"}var ka=Symbol("INITIAL_VALUE");function Zr(){return me(n=>la(n.map(e=>e.pipe(Lr(1),jr(ka)))).pipe(F(e=>{for(let t of e)if(t!==!0){if(t===ka)return ka;if(t===!1||t instanceof An)return t}return!0}),pt(e=>e!==ka),Lr(1)))}function jA(n,e){return st(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?x(te(b({},t),{guardsResult:!0})):BA(o,r,i,n).pipe(st(a=>a&&NA(a)?qA(r,s,n,e):x(a)),F(a=>te(b({},t),{guardsResult:a})))})}function BA(n,e,t,r){return Z(n).pipe(st(i=>WA(i.component,i.route,t,e,r)),Mt(i=>i!==!0,!0))}function qA(n,e,t,r){return Z(e).pipe(Fr(i=>sm(zA(i.route.parent,r),$A(i.route,r),HA(n,i.path,t),GA(n,i.route,t))),Mt(i=>i!==!0,!0))}function $A(n,e){return n!==null&&e&&e(new ah(n)),x(!0)}function zA(n,e){return n!==null&&e&&e(new sh(n)),x(!0)}function GA(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return x(!0);let i=r.map(s=>yl(()=>{let o=Us(e)??t,a=ei(s,o),u=OA(a)?a.canActivate(e,n):En(o,()=>a(e,n));return bn(u).pipe(Mt())}));return x(i).pipe(Zr())}function HA(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>xA(o)).filter(o=>o!==null).map(o=>yl(()=>{let a=o.guards.map(u=>{let c=Us(o.node)??t,l=ei(u,c),h=FA(l)?l.canActivateChild(r,n):En(c,()=>l(r,n));return bn(h).pipe(Mt())});return x(a).pipe(Zr())}));return x(s).pipe(Zr())}function WA(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return x(!0);let o=s.map(a=>{let u=Us(e)??i,c=ei(a,u),l=LA(c)?c.canDeactivate(n,e,t,r):En(u,()=>c(n,e,t,r));return bn(l).pipe(Mt())});return x(o).pipe(Zr())}function KA(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return x(!0);let s=i.map(o=>{let a=ei(o,n),u=MA(a)?a.canLoad(e,t):En(n,()=>a(e,t));return bn(u)});return x(s).pipe(Zr(),Ly(r))}function Ly(n){return tm(De(e=>{if(Xr(e))throw Ny(n,e)}),F(e=>e===!0))}function QA(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return x(!0);let s=i.map(o=>{let a=ei(o,n),u=UA(a)?a.canMatch(e,t):En(n,()=>a(e,t));return bn(u)});return x(s).pipe(Zr(),Ly(r))}var Ms=class{constructor(e){this.segmentGroup=e||null}},Ga=class extends Error{constructor(e){super(),this.urlTree=e}};function Hr(n){return is(new Ms(n))}function YA(n){return is(new ce(4e3,!1))}function XA(n){return is(My(!1,ut.GuardRejected))}var gh=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return x(r);if(i.numberOfChildren>1||!i.children[B])return YA(e.redirectTo);i=i.children[B]}}applyRedirectCommands(e,t,r){let i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t.startsWith("/"))throw new Ga(i);return i}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new An(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let a=s.substring(1);r[i]=t[a]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),o={};return Object.entries(t.children).forEach(([a,u])=>{o[a]=this.createSegmentGroup(e,u,r,i)}),new Y(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new ce(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},mh={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function JA(n,e,t,r,i){let s=Th(n,e,t);return s.matched?(r=bA(e,r),QA(r,e,t,i).pipe(F(o=>o===!0?s:b({},mh)))):x(s)}function Th(n,e,t){if(e.path==="**")return ZA(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?b({},mh):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||K0)(t,n,e);if(!i)return b({},mh);let s={};Object.entries(i.posParams??{}).forEach(([a,u])=>{s[a]=u.path});let o=i.consumed.length>0?b(b({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function ZA(n){return{matched:!0,parameters:n.length>0?yy(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function dy(n,e,t,r){return t.length>0&&nC(n,t,r)?{segmentGroup:new Y(e,tC(r,new Y(t,n.children))),slicedSegments:[]}:t.length===0&&rC(n,t,r)?{segmentGroup:new Y(n.segments,eC(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new Y(n.segments,n.children),slicedSegments:t}}function eC(n,e,t,r){let i={};for(let s of t)if(Ya(n,e,s)&&!r[Ut(s)]){let o=new Y([],{});i[Ut(s)]=o}return b(b({},r),i)}function tC(n,e){let t={};t[B]=e;for(let r of n)if(r.path===""&&Ut(r)!==B){let i=new Y([],{});t[Ut(r)]=i}return t}function nC(n,e,t){return t.some(r=>Ya(n,e,r)&&Ut(r)!==B)}function rC(n,e,t){return t.some(r=>Ya(n,e,r))}function Ya(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function iC(n,e,t,r){return Ut(n)!==r&&(r===B||!Ya(e,t,n))?!1:Th(e,n,t).matched}function sC(n,e,t){return e.length===0&&!n.children[t]}var yh=class{};function oC(n,e,t,r,i,s,o="emptyOnly"){return new _h(n,e,t,r,i,o,s).recognize()}var aC=31,_h=class{constructor(e,t,r,i,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new gh(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new ce(4002,`'${e.segmentGroup}'`)}recognize(){let e=dy(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(F(t=>{let r=new Vs([],Object.freeze({}),Object.freeze(b({},this.urlTree.queryParams)),this.urlTree.fragment,{},B,this.rootComponentType,null,{}),i=new at(r,t),s=new $a("",i),o=fA(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root,null),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,B).pipe(Et(r=>{if(r instanceof Ga)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Ms?this.noMatchError(r):r}))}inheritParamsAndData(e,t){let r=e.value,i=wh(r,t,this.paramsInheritanceStrategy);r.params=Object.freeze(i.params),r.data=Object.freeze(i.data),e.children.forEach(s=>this.inheritParamsAndData(s,r))}processSegmentGroup(e,t,r,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i,!0).pipe(F(s=>s instanceof at?[s]:[]))}processChildren(e,t,r){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return Z(i).pipe(Fr(s=>{let o=r.children[s],a=RA(t,s);return this.processSegmentGroup(e,a,o,s)}),Ur((s,o)=>(s.push(...o),s)),_l(null),lm(),st(s=>{if(s===null)return Hr(r);let o=Uy(s);return uC(o),x(o)}))}processSegment(e,t,r,i,s,o){return Z(t).pipe(Fr(a=>this.processSegmentAgainstRoute(a._injector??e,t,a,r,i,s,o).pipe(Et(u=>{if(u instanceof Ms)return x(null);throw u}))),Mt(a=>!!a),Et(a=>{if(Fy(a))return sC(r,i,s)?x(new yh):Hr(r);throw a}))}processSegmentAgainstRoute(e,t,r,i,s,o,a){return iC(r,i,s,o)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o):Hr(i):Hr(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){let{matched:a,consumedSegments:u,positionalParamSegments:c,remainingSegments:l}=Th(t,i,s);if(!a)return Hr(t);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>aC&&(this.allowRedirects=!1));let h=this.applyRedirects.applyRedirectCommands(u,i.redirectTo,c);return this.applyRedirects.lineralizeSegments(i,h).pipe(st(d=>this.processSegment(e,r,t,d.concat(l),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){let o=JA(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),o.pipe(me(a=>a.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(me(({routes:u})=>{let c=r._loadedInjector??e,{consumedSegments:l,remainingSegments:h,parameters:d}=a,f=new Vs(l,d,Object.freeze(b({},this.urlTree.queryParams)),this.urlTree.fragment,lC(r),Ut(r),r.component??r._loadedComponent??null,r,hC(r)),{segmentGroup:E,slicedSegments:w}=dy(t,l,h,u);if(w.length===0&&E.hasChildren())return this.processChildren(c,u,E).pipe(F(D=>D===null?null:new at(f,D)));if(u.length===0&&w.length===0)return x(new at(f,[]));let _=Ut(r)===s;return this.processSegment(c,u,E,w,_?B:s,!0).pipe(F(D=>new at(f,D instanceof at?[D]:[])))}))):Hr(t)))}getChildConfig(e,t,r){return t.children?x({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?x({routes:t._loadedRoutes,injector:t._loadedInjector}):KA(e,t,r,this.urlSerializer).pipe(st(i=>i?this.configLoader.loadChildren(e,t).pipe(De(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):XA(t))):x({routes:[],injector:e})}};function uC(n){n.sort((e,t)=>e.value.outlet===B?-1:t.value.outlet===B?1:e.value.outlet.localeCompare(t.value.outlet))}function cC(n){let e=n.value.routeConfig;return e&&e.path===""}function Uy(n){let e=[],t=new Set;for(let r of n){if(!cC(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=Uy(r.children);e.push(new at(r.value,i))}return e.filter(r=>!t.has(r))}function lC(n){return n.data||{}}function hC(n){return n.resolve||{}}function dC(n,e,t,r,i,s){return st(o=>oC(n,e,t,r,o.extractedUrl,i,s).pipe(F(({state:a,tree:u})=>te(b({},o),{targetSnapshot:a,urlAfterRedirects:u}))))}function fC(n,e){return st(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return x(t);let s=new Set(i.map(u=>u.route)),o=new Set;for(let u of s)if(!o.has(u))for(let c of jy(u))o.add(c);let a=0;return Z(o).pipe(Fr(u=>s.has(u)?pC(u,r,n,e):(u.data=wh(u,u.parent,n).resolve,x(void 0))),De(()=>a++),vl(1),st(u=>a===o.size?x(t):_n))})}function jy(n){let e=n.children.map(t=>jy(t)).flat();return[n,...e]}function pC(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!ky(i)&&(s[Os]=i.title),gC(s,n,e,r).pipe(F(o=>(n._resolvedData=o,n.data=wh(n,n.parent,t).resolve,null)))}function gC(n,e,t,r){let i=Ql(n);if(i.length===0)return x({});let s={};return Z(i).pipe(st(o=>mC(n[o],e,t,r).pipe(Mt(),De(a=>{s[o]=a}))),vl(1),um(s),Et(o=>Fy(o)?_n:is(o)))}function mC(n,e,t,r){let i=Us(e)??r,s=ei(n,i),o=s.resolve?s.resolve(e,t):En(i,()=>s(e,t));return bn(o)}function Wl(n){return me(e=>{let t=n(e);return t?Z(t).pipe(F(()=>e)):x(e)})}var By=(()=>{let e=class e{buildTitle(r){let i,s=r.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===B);return i}getResolvedTitleForRoute(r){return r.data[Os]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>N(yC),providedIn:"root"});let n=e;return n})(),yC=(()=>{let e=class e extends By{constructor(r){super(),this.title=r}updateTitle(r){let i=this.buildTitle(r);i!==void 0&&this.title.setTitle(i)}};e.\u0275fac=function(i){return new(i||e)(R(oy))},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Bs=new q("",{providedIn:"root",factory:()=>({})}),Ha=new q(""),Ah=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=N(va)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return x(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let i=bn(r.loadComponent()).pipe(F(qy),De(o=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o}),ha(()=>{this.componentLoaders.delete(r)})),s=new ml(i,()=>new Nt).pipe(gl());return this.componentLoaders.set(r,s),s}loadChildren(r,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return x({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=_C(i,this.compiler,r,this.onLoadEndListener).pipe(ha(()=>{this.childrenLoaders.delete(i)})),a=new ml(o,()=>new Nt).pipe(gl());return this.childrenLoaders.set(i,a),a}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function _C(n,e,t,r){return bn(n.loadChildren()).pipe(F(qy),st(i=>i instanceof Sm||Array.isArray(i)?x(i):Z(e.compileModuleAsync(i))),F(i=>{r&&r(n);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(t).injector,o=s.get(Ha,[],{optional:!0,self:!0}).flat()),{routes:o.map(Ih),injector:s}}))}function vC(n){return n&&typeof n=="object"&&"default"in n}function qy(n){return vC(n)?n.default:n}var Ch=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>N(wC),providedIn:"root"});let n=e;return n})(),wC=(()=>{let e=class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,i){return r}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),$y=new q(""),zy=new q("");function EC(n,e,t){let r=n.get(zy),i=n.get(Ct);return n.get(le).runOutsideAngular(()=>{if(!i.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,Promise.resolve();let s,o=new Promise(c=>{s=c}),a=i.startViewTransition(()=>(s(),IC(n))),{onViewTransitionCreated:u}=r;return u&&En(n,()=>u({transition:a,from:e,to:t})),o})}function IC(n){return new Promise(e=>{Tm(e,{injector:n})})}var Sh=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Nt,this.transitionAbortSubject=new Nt,this.configLoader=N(Ah),this.environmentInjector=N(us),this.urlSerializer=N(Fs),this.rootContexts=N(Ls),this.location=N(ms),this.inputBindingEnabled=N(Qa,{optional:!0})!==null,this.titleStrategy=N(By),this.options=N(Bs,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=N(Ch),this.createViewTransition=N($y,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>x(void 0),this.rootComponentType=null;let r=s=>this.events.next(new rh(s)),i=s=>this.events.next(new ih(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let i=++this.navigationId;this.transitions?.next(te(b(b({},this.transitions.value),r),{id:i}))}setupNavigations(r,i,s){return this.transitions=new ft({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Ss,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(pt(o=>o.id!==0),F(o=>te(b({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),me(o=>{let a=!1,u=!1;return x(o).pipe(me(c=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",ut.SupersededByNewNavigation),_n;this.currentTransition=o,this.currentNavigation={id:c.id,initialUrl:c.rawUrl,extractedUrl:c.extractedUrl,trigger:c.source,extras:c.extras,previousNavigation:this.lastSuccessfulNavigation?te(b({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let l=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),h=c.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!l&&h!=="reload"){let d="";return this.events.next(new Sn(c.id,this.urlSerializer.serialize(c.rawUrl),d,La.IgnoredSameUrlNavigation)),c.resolve(null),_n}if(this.urlHandlingStrategy.shouldProcessUrl(c.rawUrl))return x(c).pipe(me(d=>{let f=this.transitions?.getValue();return this.events.next(new Jr(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),f!==this.transitions?.getValue()?_n:Promise.resolve(d)}),dC(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),De(d=>{o.targetSnapshot=d.targetSnapshot,o.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=te(b({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let f=new Ua(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}));if(l&&this.urlHandlingStrategy.shouldProcessUrl(c.currentRawUrl)){let{id:d,extractedUrl:f,source:E,restoredState:w,extras:_}=c,D=new Jr(d,this.urlSerializer.serialize(f),E,w);this.events.next(D);let M=Py(this.rootComponentType).snapshot;return this.currentTransition=o=te(b({},c),{targetSnapshot:M,urlAfterRedirects:f,extras:te(b({},_),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=f,x(o)}else{let d="";return this.events.next(new Sn(c.id,this.urlSerializer.serialize(c.extractedUrl),d,La.IgnoredByUrlHandlingStrategy)),c.resolve(null),_n}}),De(c=>{let l=new Zl(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),F(c=>(this.currentTransition=o=te(b({},c),{guards:PA(c.targetSnapshot,c.currentSnapshot,this.rootContexts)}),o)),jA(this.environmentInjector,c=>this.events.next(c)),De(c=>{if(o.guardsResult=c.guardsResult,Xr(c.guardsResult))throw Ny(this.urlSerializer,c.guardsResult);let l=new eh(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot,!!c.guardsResult);this.events.next(l)}),pt(c=>c.guardsResult?!0:(this.cancelNavigationTransition(c,"",ut.GuardRejected),!1)),Wl(c=>{if(c.guards.canActivateChecks.length)return x(c).pipe(De(l=>{let h=new th(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}),me(l=>{let h=!1;return x(l).pipe(fC(this.paramsInheritanceStrategy,this.environmentInjector),De({next:()=>h=!0,complete:()=>{h||this.cancelNavigationTransition(l,"",ut.NoDataFromResolver)}}))}),De(l=>{let h=new nh(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}))}),Wl(c=>{let l=h=>{let d=[];h.routeConfig?.loadComponent&&!h.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(h.routeConfig).pipe(De(f=>{h.component=f}),F(()=>{})));for(let f of h.children)d.push(...l(f));return d};return la(l(c.targetSnapshot.root)).pipe(_l(null),Lr(1))}),Wl(()=>this.afterPreactivation()),me(()=>{let{currentSnapshot:c,targetSnapshot:l}=o,h=this.createViewTransition?.(this.environmentInjector,c.root,l.root);return h?Z(h).pipe(F(()=>o)):x(o)}),F(c=>{let l=IA(r.routeReuseStrategy,c.targetSnapshot,c.currentRouterState);return this.currentTransition=o=te(b({},c),{targetRouterState:l}),this.currentNavigation.targetRouterState=l,o}),De(()=>{this.events.next(new xs)}),DA(this.rootContexts,r.routeReuseStrategy,c=>this.events.next(c),this.inputBindingEnabled),Lr(1),De({next:c=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new St(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects))),this.titleStrategy?.updateTitle(c.targetRouterState.snapshot),c.resolve(!0)},complete:()=>{a=!0}}),hm(this.transitionAbortSubject.pipe(De(c=>{throw c}))),ha(()=>{!a&&!u&&this.cancelNavigationTransition(o,"",ut.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),Et(c=>{if(u=!0,Oy(c))this.events.next(new Cn(o.id,this.urlSerializer.serialize(o.extractedUrl),c.message,c.cancellationCode)),CA(c)?this.events.next(new ks(c.url)):o.resolve(!1);else{this.events.next(new Ps(o.id,this.urlSerializer.serialize(o.extractedUrl),c,o.targetSnapshot??void 0));try{o.resolve(r.errorHandler(c))}catch(l){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(l)}}return _n}))}))}cancelNavigationTransition(r,i,s){let o=new Cn(r.id,this.urlSerializer.serialize(r.extractedUrl),i,s);this.events.next(o),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function TC(n){return n!==Ss}var AC=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>N(CC),providedIn:"root"});let n=e;return n})(),vh=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},CC=(()=>{let e=class e extends vh{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Br(e)))(s||e)}})(),e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Gy=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>N(SC),providedIn:"root"});let n=e;return n})(),SC=(()=>{let e=class e extends Gy{constructor(){super(...arguments),this.location=N(ms),this.urlSerializer=N(Fs),this.options=N(Bs,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=N(Ch),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new An,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=Py(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(i=>{i.type==="popstate"&&r(i.url,i.state)})}handleRouterEvent(r,i){if(r instanceof Jr)this.stateMemento=this.createStateMemento();else if(r instanceof Sn)this.rawUrlTree=i.initialUrl;else if(r instanceof Ua){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else r instanceof xs?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):r instanceof Cn&&(r.code===ut.GuardRejected||r.code===ut.NoDataFromResolver)?this.restoreHistory(i):r instanceof Ps?this.restoreHistory(i,!0):r instanceof St&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,i){let s=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,a=b(b({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",a)}else{let o=b(b({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(r,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===r.finalUrl&&o===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,i){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:i}:{navigationId:r}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Br(e)))(s||e)}})(),e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),As=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(As||{});function Hy(n,e){n.events.pipe(pt(t=>t instanceof St||t instanceof Cn||t instanceof Ps||t instanceof Sn),F(t=>t instanceof St||t instanceof Sn?As.COMPLETE:(t instanceof Cn?t.code===ut.Redirect||t.code===ut.SupersededByNewNavigation:!1)?As.REDIRECTING:As.FAILED),pt(t=>t!==As.REDIRECTING),Lr(1)).subscribe(()=>{e()})}function bC(n){throw n}var RC={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},DC={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},rn=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=N(ga),this.stateManager=N(Gy),this.options=N(Bs,{optional:!0})||{},this.pendingTasks=N(bm),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=N(Sh),this.urlSerializer=N(Fs),this.location=N(ms),this.urlHandlingStrategy=N(Ch),this._events=new Nt,this.errorHandler=this.options.errorHandler||bC,this.navigated=!1,this.routeReuseStrategy=N(AC),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=N(Ha,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!N(Qa,{optional:!0}),this.eventsSubscription=new em,this.isNgZoneEnabled=N(le)instanceof le&&le.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof Cn&&i.code!==ut.Redirect&&i.code!==ut.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof St)this.navigated=!0;else if(i instanceof ks){let a=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),u={info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||TC(s.source)};this.scheduleNavigation(a,Ss,null,u,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}xC(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ss,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",i)},0)})}navigateToSyncWithBrowser(r,i,s){let o={replaceUrl:!0},a=s?.navigationId?s:null;if(s){let c=b({},s);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(o.state=c)}let u=this.parseUrl(r);this.scheduleNavigation(u,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(Ih),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,i={}){let{relativeTo:s,queryParams:o,fragment:a,queryParamsHandling:u,preserveFragment:c}=i,l=c?this.currentUrlTree.fragment:a,h=null;switch(u){case"merge":h=b(b({},this.currentUrlTree.queryParams),o);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=o||null}h!==null&&(h=this.removeEmptyProps(h));let d;try{let f=s?s.snapshot:this.routerState.snapshot.root;d=Sy(f)}catch{(typeof r[0]!="string"||!r[0].startsWith("/"))&&(r=[]),d=this.currentUrlTree.root}return by(d,r,h,l??null)}navigateByUrl(r,i={skipLocationChange:!1}){let s=Xr(r)?r:this.parseUrl(r),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,Ss,null,i)}navigate(r,i={skipLocationChange:!1}){return PC(r),this.navigateByUrl(this.createUrlTree(r,i),i)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,i){let s;if(i===!0?s=b({},RC):i===!1?s=b({},DC):s=i,Xr(r))return ay(this.currentUrlTree,r,s);let o=this.parseUrl(r);return ay(this.currentUrlTree,o,s)}removeEmptyProps(r){return Object.entries(r).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(r,i,s,o,a){if(this.disposed)return Promise.resolve(!1);let u,c,l;a?(u=a.resolve,c=a.reject,l=a.promise):l=new Promise((d,f)=>{u=d,c=f});let h=this.pendingTasks.add();return Hy(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(h))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:o,resolve:u,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(d=>Promise.reject(d))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function PC(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new ce(4008,!1)}function xC(n){return!(n instanceof xs)&&!(n instanceof ks)}var Wa=(()=>{let e=class e{constructor(r,i,s,o,a,u){this.router=r,this.route=i,this.tabIndexAttribute=s,this.renderer=o,this.el=a,this.locationStrategy=u,this.href=null,this.commands=null,this.onChanges=new Nt,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let c=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement=c==="a"||c==="area",this.isAnchorElement?this.subscription=r.events.subscribe(l=>{l instanceof St&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(r){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",r)}ngOnChanges(r){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(r){r!=null?(this.commands=Array.isArray(r)?r:[r],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(r,i,s,o,a){let u=this.urlTree;if(u===null||this.isAnchorElement&&(r!==0||i||s||o||a||typeof this.target=="string"&&this.target!="_self"))return!0;let c={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(u,c),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let r=this.urlTree;this.href=r!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(r)):null;let i=this.href===null?null:wm(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(r,i){let s=this.renderer,o=this.el.nativeElement;i!==null?s.setAttribute(o,r,i):s.removeAttribute(o,r)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};e.\u0275fac=function(i){return new(i||e)(Q(rn),Q(rr),ym("tabindex"),Q(zr),Q($r),Q(gs))},e.\u0275dir=We({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,s){i&1&&At("click",function(a){return s.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),i&2&&pa("target",s.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[en.HasDecoratorInputTransform,"preserveFragment","preserveFragment",Gr],skipLocationChange:[en.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",Gr],replaceUrl:[en.HasDecoratorInputTransform,"replaceUrl","replaceUrl",Gr],routerLink:"routerLink"},standalone:!0,features:[Cm,In]});let n=e;return n})(),Wy=(()=>{let e=class e{get isActive(){return this._isActive}constructor(r,i,s,o,a){this.router=r,this.element=i,this.renderer=s,this.cdr=o,this.link=a,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new It,this.routerEventsSubscription=r.events.subscribe(u=>{u instanceof St&&this.update()})}ngAfterContentInit(){x(this.links.changes,x(null)).pipe(ss()).subscribe(r=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let r=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=Z(r).pipe(ss()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(r){let i=Array.isArray(r)?r:r.split(" ");this.classes=i.filter(s=>!!s)}ngOnChanges(r){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let r=this.hasActiveLinks();this.classes.forEach(i=>{r?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),r&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==r&&(this._isActive=r,this.cdr.markForCheck(),this.isActiveChange.emit(r))})}isLinkActive(r){let i=kC(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return s=>{let o=s.urlTree;return o?r.isActive(o,i):!1}}hasActiveLinks(){let r=this.isLinkActive(this.router);return this.link&&r(this.link)||this.links.some(r)}};e.\u0275fac=function(i){return new(i||e)(Q(rn),Q($r),Q(zr),Q(ps),Q(Wa,8))},e.\u0275dir=We({type:e,selectors:[["","routerLinkActive",""]],contentQueries:function(i,s,o){if(i&1&&Pm(o,Wa,5),i&2){let a;xm(a=km())&&(s.links=a)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[In]});let n=e;return n})();function kC(n){return!!n.paths}var Ka=class{};var VC=(()=>{let e=class e{constructor(r,i,s,o,a){this.router=r,this.injector=s,this.preloadingStrategy=o,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(pt(r=>r instanceof St),Fr(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(r,i){let s=[];for(let o of i){o.providers&&!o._injector&&(o._injector=Cl(o.providers,r,`Route: ${o.path}`));let a=o._injector??r,u=o._loadedInjector??a;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&s.push(this.preloadConfig(a,o)),(o.children||o._loadedRoutes)&&s.push(this.processRoutes(u,o.children??o._loadedRoutes))}return Z(s).pipe(ss())}preloadConfig(r,i){return this.preloadingStrategy.preload(i,()=>{let s;i.loadChildren&&i.canLoad===void 0?s=this.loader.loadChildren(r,i):s=x(null);let o=s.pipe(st(a=>a===null?x(void 0):(i._loadedRoutes=a.routes,i._loadedInjector=a.injector,this.processRoutes(a.injector??r,a.routes))));if(i.loadComponent&&!i._loadedComponent){let a=this.loader.loadComponent(i);return Z([o,a]).pipe(ss())}else return o})}};e.\u0275fac=function(i){return new(i||e)(R(rn),R(va),R(us),R(Ka),R(Ah))},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Ky=new q(""),NC=(()=>{let e=class e{constructor(r,i,s,o,a={}){this.urlSerializer=r,this.transitions=i,this.viewportScroller=s,this.zone=o,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration||="disabled",a.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Jr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=r.navigationTrigger,this.restoredId=r.restoredState?r.restoredState.navigationId:0):r instanceof St?(this.lastId=r.id,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.urlAfterRedirects).fragment)):r instanceof Sn&&r.code===La.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof ja&&(r.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(r.position):r.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(r.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(r,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new ja(r,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};e.\u0275fac=function(i){Em()},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})();function MC(n){return n.routerState.root}function qs(n,e){return{\u0275kind:n,\u0275providers:e}}function OC(){let n=N(qr);return e=>{let t=n.get(Pl);if(e!==t.components[0])return;let r=n.get(rn),i=n.get(Qy);n.get(bh)===1&&r.initialNavigation(),n.get(Yy,null,Il.Optional)?.setUpPreloading(),n.get(Ky,null,Il.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var Qy=new q("",{factory:()=>new Nt}),bh=new q("",{providedIn:"root",factory:()=>1});function FC(){return qs(2,[{provide:bh,useValue:0},{provide:Dl,multi:!0,deps:[qr],useFactory:e=>{let t=e.get(zm,Promise.resolve());return()=>t.then(()=>new Promise(r=>{let i=e.get(rn),s=e.get(Qy);Hy(i,()=>{r(!0)}),e.get(Sh).afterPreactivation=()=>(r(!0),s.closed?x(void 0):s),i.initialNavigation()}))}}])}function LC(){return qs(3,[{provide:Dl,multi:!0,useFactory:()=>{let e=N(rn);return()=>{e.setUpLocationChangeListener()}}},{provide:bh,useValue:2}])}var Yy=new q("");function UC(n){return qs(0,[{provide:Yy,useExisting:VC},{provide:Ka,useExisting:n}])}function jC(){return qs(8,[hy,{provide:Qa,useExisting:hy}])}function BC(n){let e=[{provide:$y,useValue:EC},{provide:zy,useValue:b({skipNextTransition:!!n?.skipInitialTransition},n)}];return qs(9,e)}var fy=new q("ROUTER_FORROOT_GUARD"),qC=[ms,{provide:Fs,useClass:Rs},rn,Ls,{provide:rr,useFactory:MC,deps:[rn]},Ah,[]],Xy=(()=>{let e=class e{constructor(r){}static forRoot(r,i){return{ngModule:e,providers:[qC,[],{provide:Ha,multi:!0,useValue:r},{provide:fy,useFactory:HC,deps:[[rn,new Ot,new fm]]},{provide:Bs,useValue:i||{}},i?.useHash?zC():GC(),$C(),i?.preloadingStrategy?UC(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?WC(i):[],i?.bindToComponentInputs?jC().\u0275providers:[],i?.enableViewTransitions?BC().\u0275providers:[],KC()]}}static forChild(r){return{ngModule:e,providers:[{provide:Ha,multi:!0,useValue:r}]}}};e.\u0275fac=function(i){return new(i||e)(R(fy,8))},e.\u0275mod=qe({type:e}),e.\u0275inj=Be({});let n=e;return n})();function $C(){return{provide:Ky,useFactory:()=>{let n=N(Qm),e=N(le),t=N(Bs),r=N(Sh),i=N(Fs);return t.scrollOffset&&n.setOffset(t.scrollOffset),new NC(i,r,n,e,t)}}}function zC(){return{provide:gs,useClass:Hm}}function GC(){return{provide:gs,useClass:Gm}}function HC(n){return"guarded"}function WC(n){return[n.initialNavigation==="disabled"?LC().\u0275providers:[],n.initialNavigation==="enabledBlocking"?FC().\u0275providers:[]]}var py=new q("");function KC(){return[{provide:py,useFactory:OC},{provide:Fm,multi:!0,useExisting:py}]}var a_=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(Q(zr),Q($r))},e.\u0275dir=We({type:e});let n=e;return n})(),YC=(()=>{let e=class e extends a_{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Br(e)))(s||e)}})(),e.\u0275dir=We({type:e,features:[Tn]});let n=e;return n})(),u_=new q("");var XC={provide:u_,useExisting:os(()=>c_),multi:!0};function JC(){let n=Jn()?Jn().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var ZC=new q(""),c_=(()=>{let e=class e extends a_{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!JC())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(Q(zr),Q($r),Q(ZC,8))},e.\u0275dir=We({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&At("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[ds([XC]),Tn]});let n=e;return n})();function Rn(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function l_(n){return n!=null&&typeof n.length=="number"}var xh=new q(""),h_=new q(""),eS=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Jy=class{static min(e){return tS(e)}static max(e){return nS(e)}static required(e){return d_(e)}static requiredTrue(e){return rS(e)}static email(e){return iS(e)}static minLength(e){return sS(e)}static maxLength(e){return oS(e)}static pattern(e){return aS(e)}static nullValidator(e){return Za(e)}static compose(e){return __(e)}static composeAsync(e){return w_(e)}};function tS(n){return e=>{if(Rn(e.value)||Rn(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function nS(n){return e=>{if(Rn(e.value)||Rn(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function d_(n){return Rn(n.value)?{required:!0}:null}function rS(n){return n.value===!0?null:{required:!0}}function iS(n){return Rn(n.value)||eS.test(n.value)?null:{email:!0}}function sS(n){return e=>Rn(e.value)||!l_(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function oS(n){return e=>l_(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function aS(n){if(!n)return Za;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(Rn(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function Za(n){return null}function f_(n){return n!=null}function p_(n){return _a(n)?Z(n):n}function g_(n){let e={};return n.forEach(t=>{e=t!=null?b(b({},e),t):e}),Object.keys(e).length===0?null:e}function m_(n,e){return e.map(t=>t(n))}function uS(n){return!n.validate}function y_(n){return n.map(e=>uS(e)?e:t=>e.validate(t))}function __(n){if(!n)return null;let e=n.filter(f_);return e.length==0?null:function(t){return g_(m_(t,e))}}function v_(n){return n!=null?__(y_(n)):null}function w_(n){if(!n)return null;let e=n.filter(f_);return e.length==0?null:function(t){let r=m_(t,e).map(p_);return om(r).pipe(F(g_))}}function E_(n){return n!=null?w_(y_(n)):null}function Zy(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function I_(n){return n._rawValidators}function T_(n){return n._rawAsyncValidators}function Rh(n){return n?Array.isArray(n)?n:[n]:[]}function eu(n,e){return Array.isArray(n)?n.includes(e):n===e}function e_(n,e){let t=Rh(e);return Rh(n).forEach(i=>{eu(t,i)||t.push(i)}),t}function t_(n,e){return Rh(e).filter(t=>!eu(n,t))}var tu=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=v_(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=E_(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},ni=class extends tu{get formDirective(){return null}get path(){return null}},Gs=class extends tu{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},nu=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},cS={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},BV=te(b({},cS),{"[class.ng-submitted]":"isSubmitted"}),qV=(()=>{let e=class e extends nu{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(Q(Gs,2))},e.\u0275dir=We({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&Sl("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Tn]});let n=e;return n})(),$V=(()=>{let e=class e extends nu{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(Q(ni,10))},e.\u0275dir=We({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&Sl("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[Tn]});let n=e;return n})();var $s="VALID",Xa="INVALID",ti="PENDING",zs="DISABLED";function kh(n){return(ou(n)?n.validators:n)||null}function lS(n){return Array.isArray(n)?v_(n):n||null}function Vh(n,e){return(ou(e)?e.asyncValidators:n)||null}function hS(n){return Array.isArray(n)?E_(n):n||null}function ou(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function A_(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new ce(1e3,"");if(!r[t])throw new ce(1001,"")}function C_(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new ce(1002,"")})}var ri=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===$s}get invalid(){return this.status===Xa}get pending(){return this.status==ti}get disabled(){return this.status===zs}get enabled(){return this.status!==zs}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(e_(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(e_(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(t_(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(t_(e,this._rawAsyncValidators))}hasValidator(e){return eu(this._rawValidators,e)}hasAsyncValidator(e){return eu(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=ti,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=zs,this.errors=null,this._forEachChild(r=>{r.disable(te(b({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(te(b({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=$s,this._forEachChild(r=>{r.enable(te(b({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(te(b({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===$s||this.status===ti)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?zs:$s}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=ti,this._hasOwnPendingAsyncValidator=!0;let t=p_(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new It,this.statusChanges=new It}_calculateStatus(){return this._allControlsDisabled()?zs:this.errors?Xa:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ti)?ti:this._anyControlsHaveStatus(Xa)?Xa:$s}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){ou(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=lS(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=hS(this._rawAsyncValidators)}},ru=class extends ri{constructor(e,t,r){super(kh(t),Vh(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){C_(this,!0,e),Object.keys(e).forEach(r=>{A_(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var Dh=class extends ru{};var S_=new q("CallSetDisabledState",{providedIn:"root",factory:()=>Nh}),Nh="always";function dS(n,e){return[...e.path,n]}function n_(n,e,t=Nh){Mh(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),pS(n,e),mS(n,e),gS(n,e),fS(n,e)}function r_(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),su(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function iu(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function fS(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function Mh(n,e){let t=I_(n);e.validator!==null?n.setValidators(Zy(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=T_(n);e.asyncValidator!==null?n.setAsyncValidators(Zy(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();iu(e._rawValidators,i),iu(e._rawAsyncValidators,i)}function su(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=I_(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let i=T_(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}let r=()=>{};return iu(e._rawValidators,r),iu(e._rawAsyncValidators,r),t}function pS(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&b_(n,e)})}function gS(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&b_(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function b_(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function mS(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function yS(n,e){n==null,Mh(n,e)}function _S(n,e){return su(n,e)}function vS(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function wS(n){return Object.getPrototypeOf(n.constructor)===YC}function ES(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function IS(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===c_?t=s:wS(s)?r=s:i=s}),i||r||t||null}function TS(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function i_(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function s_(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Ja=class extends ri{constructor(e=null,t,r){super(kh(t),Vh(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ou(t)&&(t.nonNullable||t.initialValueIsDefault)&&(s_(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){i_(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){i_(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){s_(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var AS=n=>n instanceof Ja;var GV=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=We({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let n=e;return n})();var R_=new q("");var CS={provide:ni,useExisting:os(()=>SS)},SS=(()=>{let e=class e extends ni{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new It,this._setValidators(r),this._setAsyncValidators(i)}ngOnChanges(r){this._checkFormPresent(),r.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(su(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(r){let i=this.form.get(r.path);return n_(i,r,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(r),i}getControl(r){return this.form.get(r.path)}removeControl(r){r_(r.control||null,r,!1),TS(this.directives,r)}addFormGroup(r){this._setUpFormContainer(r)}removeFormGroup(r){this._cleanUpFormContainer(r)}getFormGroup(r){return this.form.get(r.path)}addFormArray(r){this._setUpFormContainer(r)}removeFormArray(r){this._cleanUpFormContainer(r)}getFormArray(r){return this.form.get(r.path)}updateModel(r,i){this.form.get(r.path).setValue(i)}onSubmit(r){return this.submitted=!0,ES(this.form,this.directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_updateDomValue(){this.directives.forEach(r=>{let i=r.control,s=this.form.get(r.path);i!==s&&(r_(i||null,r),AS(s)&&(n_(s,r,this.callSetDisabledState),r.control=s))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(r){let i=this.form.get(r.path);yS(i,r),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(r){if(this.form){let i=this.form.get(r.path);i&&_S(i,r)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Mh(this.form,this),this._oldForm&&su(this._oldForm,this)}_checkFormPresent(){this.form}};e.\u0275fac=function(i){return new(i||e)(Q(xh,10),Q(h_,10),Q(S_,8))},e.\u0275dir=We({type:e,selectors:[["","formGroup",""]],hostBindings:function(i,s){i&1&&At("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{form:[en.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ds([CS]),Tn,In]});let n=e;return n})();var bS={provide:Gs,useExisting:os(()=>RS)},RS=(()=>{let e=class e extends Gs{set isDisabled(r){}constructor(r,i,s,o,a){super(),this._ngModelWarningConfig=a,this._added=!1,this.name=null,this.update=new It,this._ngModelWarningSent=!1,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=IS(this,o)}ngOnChanges(r){this._added||this._setUpControl(),vS(r,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}get path(){return dS(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};e._ngModelWarningSentOnce=!1,e.\u0275fac=function(i){return new(i||e)(Q(ni,13),Q(xh,10),Q(h_,10),Q(u_,10),Q(R_,8))},e.\u0275dir=We({type:e,selectors:[["","formControlName",""]],inputs:{name:[en.None,"formControlName","name"],isDisabled:[en.None,"disabled","isDisabled"],model:[en.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[ds([bS]),Tn,In]});let n=e;return n})();var DS=(()=>{let e=class e{constructor(){this._validator=Za}ngOnChanges(r){if(this.inputName in r){let i=this.normalizeInput(r[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):Za,this._onChange&&this._onChange()}}validate(r){return this._validator(r)}registerOnValidatorChange(r){this._onChange=r}enabled(r){return r!=null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=We({type:e,features:[In]});let n=e;return n})();var PS={provide:xh,useExisting:os(()=>xS),multi:!0};var xS=(()=>{let e=class e extends DS{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Gr,this.createValidator=r=>d_}enabled(r){return r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Br(e)))(s||e)}})(),e.\u0275dir=We({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,s){i&2&&pa("required",s._enabled?"":null)},inputs:{required:"required"},features:[ds([PS]),Tn]});let n=e;return n})();var kS=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=qe({type:e}),e.\u0275inj=Be({});let n=e;return n})(),Ph=class extends ri{constructor(e,t,r){super(kh(t),Vh(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){C_(this,!1,e),e.forEach((r,i)=>{A_(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>r._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function o_(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var HV=(()=>{let e=class e{constructor(){this.useNonNullable=!1}get nonNullable(){let r=new e;return r.useNonNullable=!0,r}group(r,i=null){let s=this._reduceControls(r),o={};return o_(i)?o=i:i!==null&&(o.validators=i.validator,o.asyncValidators=i.asyncValidator),new ru(s,o)}record(r,i=null){let s=this._reduceControls(r);return new Dh(s,i)}control(r,i,s){let o={};return this.useNonNullable?(o_(i)?o=i:(o.validators=i,o.asyncValidators=s),new Ja(r,te(b({},o),{nonNullable:!0}))):new Ja(r,i,s)}array(r,i,s){let o=r.map(a=>this._createControl(a));return new Ph(o,i,s)}_reduceControls(r){let i={};return Object.keys(r).forEach(s=>{i[s]=this._createControl(r[s])}),i}_createControl(r){if(r instanceof Ja)return r;if(r instanceof ri)return r;if(Array.isArray(r)){let i=r[0],s=r.length>1?r[1]:null,o=r.length>2?r[2]:null;return this.control(i,s,o)}else return this.control(r)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var D_=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:R_,useValue:r.warnOnNgModelWithFormControl??"always"},{provide:S_,useValue:r.callSetDisabledState??Nh}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=qe({type:e}),e.\u0275inj=Be({imports:[kS]});let n=e;return n})();var VS="firebase",NS="10.11.1";Ke(VS,NS,"app");var sn=new fs("ANGULARFIRE2_VERSION");function Fh(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Hs=(n,e)=>{let t=e?[e]:Ra(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},jt=class{constructor(){return Hs(MS)}},MS="app-check";function ii(){}var au=class{zone;delegate;constructor(e,t=nm){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},Oh=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ii,{},ii,ii)),t.pipe(De({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},sr=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new au(Zone.current)),this.insideAngular=t.run(()=>new au(Zone.current,ca)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(R(le))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function uu(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function OS(n){return uu().ngZone.runOutsideAngular(()=>n())}function ir(n){return uu().ngZone.run(()=>n())}function Qe(n){return FS(uu())(n)}function FS(n){return function(t){return t=t.lift(new Oh(n.ngZone)),t.pipe(Xn(n.outsideAngular),vn(n.insideAngular))}}var LS=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),ir(()=>n.apply(void 0,r))},si=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=ir(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ii,{},ii,ii))),r[s]=LS(r[s],t));let i=OS(()=>n.apply(this,r));if(!e)if(i instanceof yn){let s=uu();return i.pipe(Xn(s.outsideAngular),vn(s.insideAngular))}else return ir(()=>i);return i instanceof yn?i.pipe(Qe):i instanceof Promise?ir(()=>new Promise((s,o)=>i.then(a=>ir(()=>s(a)),a=>ir(()=>o(a))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:ir(()=>i)};var cu=class{constructor(e){return e}},lu=class{constructor(){return Ra()}};var US=new Map,jS={activated:!1,tokenObservers:[]},BS={initialized:!1,enabled:!1};function bt(n){return US.get(n)||Object.assign({},jS)}function M_(){return BS}var qS="https://content-firebaseappcheck.googleapis.com/v1";var $S="exchangeDebugToken",x_={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},_N=24*60*60*1e3;var Uh=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return g(this,null,function*(){this.stop();try{this.pending=new Vl,this.pending.promise.catch(t=>{}),yield zS(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Vl,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function zS(n){return new Promise(e=>{setTimeout(e,n)})}var GS={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Dn=new Jm("appCheck","AppCheck",GS);function O_(n){if(!bt(n).activated)throw Dn.create("use-before-activation",{appName:n.name})}function F_(r,i){return g(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let f=yield o.getHeartbeatsHeader();f&&(s["X-Firebase-Client"]=f)}let a={method:"POST",body:JSON.stringify(e),headers:s},u;try{u=yield fetch(n,a)}catch(f){throw Dn.create("fetch-network-error",{originalErrorMessage:f?.message})}if(u.status!==200)throw Dn.create("fetch-status-error",{httpStatus:u.status});let c;try{c=yield u.json()}catch(f){throw Dn.create("fetch-parse-error",{originalErrorMessage:f?.message})}let l=c.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw Dn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let h=Number(l[1])*1e3,d=Date.now();return{token:c.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})}function L_(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${qS}/projects/${t}/apps/${r}:${$S}?key=${i}`,body:{debug_token:e}}}var HS="firebase-app-check-database",WS=1,jh="firebase-app-check-store";var hu=null;function KS(){return hu||(hu=new Promise((n,e)=>{try{let t=indexedDB.open(HS,WS);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Dn.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(jh,{keyPath:"compositeKey"})}}}catch(t){e(Dn.create("storage-open",{originalErrorMessage:t?.message}))}}),hu)}function QS(n,e){return YS(XS(n),e)}function YS(n,e){return g(this,null,function*(){let r=(yield KS()).transaction(jh,"readwrite"),s=r.objectStore(jh).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=u=>{o()},r.onerror=u=>{var c;a(Dn.create("storage-set",{originalErrorMessage:(c=u.target.error)===null||c===void 0?void 0:c.message}))}})})}function XS(n){return`${n.options.appId}-${n.name}`}var Bh=new Ca("@firebase/app-check");function Lh(n,e){return Ta()?QS(n,e).catch(t=>{Bh.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function U_(){return M_().enabled}function j_(){return g(this,null,function*(){let n=M_();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var JS={error:"UNKNOWN_ERROR"};function ZS(n){return Xm.encodeString(JSON.stringify(n),!1)}function qh(n,e=!1){return g(this,null,function*(){let t=n.app;O_(t);let r=bt(t),i=r.token,s;if(i&&!Ws(i)&&(r.token=void 0,i=void 0),!i){let u=yield r.cachedTokenPromise;u&&(Ws(u)?i=u:yield Lh(t,void 0))}if(!e&&i&&Ws(i))return{token:i.token};let o=!1;if(U_()){r.exchangeTokenPromise||(r.exchangeTokenPromise=F_(L_(t,yield j_()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let u=yield r.exchangeTokenPromise;return yield Lh(t,u),r.token=u,{token:u.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield bt(t).exchangeTokenPromise}catch(u){u.code==="appCheck/throttled"?Bh.warn(u.message):Bh.error(u),s=u}let a;return i?s?Ws(i)?a={token:i.token,internalError:s}:a=V_(s):(a={token:i.token},r.token=i,yield Lh(t,i)):a=V_(s),o&&rb(t,a),a})}function eb(n){return g(this,null,function*(){let e=n.app;O_(e);let{provider:t}=bt(e);if(U_()){let r=yield j_(),{token:i}=yield F_(L_(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function tb(n,e,t,r){let{app:i}=n,s=bt(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Ws(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),k_(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>k_(n))}function B_(n,e){let t=bt(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function k_(n){let{app:e}=n,t=bt(e),r=t.tokenRefresher;r||(r=nb(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function nb(n){let{app:e}=n;return new Uh(()=>g(this,null,function*(){let t=bt(e),r;if(t.token?r=yield qh(n,!0):r=yield qh(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=bt(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},x_.RETRIAL_MIN_WAIT,x_.RETRIAL_MAX_WAIT)}function rb(n,e){let t=bt(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Ws(n){return n.expireTimeMillis-Date.now()>0}function V_(n){return{token:ZS(JS),error:n}}var $h=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=bt(this.app);for(let t of e)B_(this.app,t.next);return Promise.resolve()}};function ib(n,e){return new $h(n,e)}function sb(n){return{getToken:e=>qh(n,e),getLimitedUseToken:()=>eb(n),addTokenListener:e=>tb(n,"INTERNAL",e),removeTokenListener:e=>B_(n.app,e)}}var ob="@firebase/app-check",ab="0.8.3";var ub="app-check",N_="app-check-internal";function cb(){er(new nn(ub,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return ib(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(N_).initialize()})),er(new nn(N_,n=>{let e=n.getProvider("app-check").getImmediate();return sb(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Ke(ob,ab)}cb();var lb=["localhost","0.0.0.0","127.0.0.1"],PN=typeof window<"u"&&lb.includes(window.location.hostname);var hb="firebase",db="10.11.1";rt.registerVersion(hb,db,"app-compat");var fb=["ngOnDestroy"],z_=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(fb.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let u=a?.[s];return typeof u=="function"?u.bind(a):u?.then?u.then(c=>t.run(()=>c)):t.run(()=>u)});return new Proxy(()=>{},{get:(a,u)=>o[u],apply:(a,u,c)=>o.then(l=>{let h=l?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,h),h})})})});var du=class{constructor(e){return e}},oi=new q("angularfire2.app.options"),ai=new q("angularfire2.app.name");function Ks(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=rt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>rt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;pb("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new du(o)}var pb=(n,...e)=>{xl()&&typeof console<"u"&&console[n](...e)},gb={provide:du,useFactory:Ks,deps:[oi,le,[new Ot,ai]]},BN=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:oi,useValue:t},{provide:ai,useValue:r}]}}constructor(t){rt.registerVersion("angularfire",sn.full,"core"),rt.registerVersion("angularfire",sn.full,"app-compat"),rt.registerVersion("angular",Mm.full,t.toString())}static \u0275fac=function(r){return new(r||n)(R(Tt))};static \u0275mod=qe({type:n});static \u0275inj=Be({providers:[gb]})}return n})();function fu(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return mb(i,o)||($_("error",`${e} was already initialized on the ${t} Firebase App with different settings.${yb?" You may need to reload as Firebase is not HMR aware.":""}`),$_("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function mb(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var yb=typeof module<"u"&&!!module.hot,$_=(n,...e)=>{xl()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var zh=new q("angularfire2.auth.use-emulator"),Gh=new q("angularfire2.auth.settings"),Hh=new q("angularfire2.auth.tenant-id"),Wh=new q("angularfire2.auth.langugage-code"),Kh=new q("angularfire2.auth.use-device-language"),Qh=new q("angularfire.auth.persistence"),Yh=(n,e,t,r,i,s,o,a)=>fu(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let u=e.runOutsideAngular(()=>n.auth());if(t&&u.useEmulator(...t),r&&(u.tenantId=r),u.languageCode=i,s&&u.useDeviceLanguage(),o)for(let[c,l]of Object.entries(o))u.settings[c]=l;return a&&u.setPersistence(a),u},[t,r,i,s,o,a]),Xh=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,u,c,l,h,d,f){let E=new Nt,w=x(void 0).pipe(vn(o.outsideAngular),me(()=>s.runOutsideAngular(()=>import("./chunk-EUJGYFZR.js"))),F(()=>Ks(t,s,r)),F(_=>Yh(_,s,a,c,l,h,u,d)),wl({bufferSize:1,refCount:!1}));if(Zn(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=x(null);else{w.pipe(Mt()).subscribe();let _=w.pipe(me(C=>C.getRedirectResult().then(V=>V,()=>null)),Qe,wl({bufferSize:1,refCount:!1})),D=w.pipe(me(C=>new yn(V=>({unsubscribe:s.runOutsideAngular(()=>C.onAuthStateChanged(L=>V.next(L),L=>V.error(L),()=>V.complete()))})))),M=w.pipe(me(C=>new yn(V=>({unsubscribe:s.runOutsideAngular(()=>C.onIdTokenChanged(L=>V.next(L),L=>V.error(L),()=>V.complete()))}))));this.authState=_.pipe(El(D),Xn(o.outsideAngular),vn(o.insideAngular)),this.user=_.pipe(El(M),Xn(o.outsideAngular),vn(o.insideAngular)),this.idToken=this.user.pipe(me(C=>C?Z(C.getIdToken()):x(null))),this.idTokenResult=this.user.pipe(me(C=>C?Z(C.getIdTokenResult()):x(null))),this.credential=am(_,E,this.authState.pipe(pt(C=>!C))).pipe(F(C=>C?.user?C:null),Xn(o.outsideAngular),vn(o.insideAngular))}return z_(this,w,s,{spy:{apply:(_,D,M)=>{(_.startsWith("signIn")||_.startsWith("createUser"))&&M.then(C=>E.next(C))}}})}static \u0275fac=function(r){return new(r||n)(R(oi),R(ai,8),R(Tt),R(le),R(sr),R(zh,8),R(Gh,8),R(Hh,8),R(Wh,8),R(Kh,8),R(Qh,8),R(jt,8))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),n1=(()=>{class n{constructor(){rt.registerVersion("angularfire",sn.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=qe({type:n});static \u0275inj=Be({providers:[Xh]})}return n})();var vb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Dt={},A,vd=vd||{},O=vb||self;function bu(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function uo(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function wb(n){return Object.prototype.hasOwnProperty.call(n,Jh)&&n[Jh]||(n[Jh]=++Eb)}var Jh="closure_uid_"+(1e9*Math.random()>>>0),Eb=0;function Ib(n,e,t){return n.call.apply(n.bind,arguments)}function Tb(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function $e(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?$e=Ib:$e=Tb,$e.apply(null,arguments)}function pu(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ke(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Pn(){this.s=this.s,this.o=this.o}var Ab=0;Pn.prototype.s=!1;Pn.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),Ab!=0)&&wb(this)};Pn.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var rv=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function wd(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function G_(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(bu(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function ze(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}ze.prototype.h=function(){this.defaultPrevented=!0};var Cb=function(){if(!O.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};O.addEventListener("test",t,e),O.removeEventListener("test",t,e)}catch{}return n}();function eo(n){return/^[\s\xa0]*$/.test(n)}function Ru(){var n=O.navigator;return n&&(n=n.userAgent)?n:""}function Bt(n){return Ru().indexOf(n)!=-1}function Ed(n){return Ed[" "](n),n}Ed[" "]=function(){};function Sb(n,e){var t=pR;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var bb=Bt("Opera"),hi=Bt("Trident")||Bt("MSIE"),iv=Bt("Edge"),rd=iv||hi,sv=Bt("Gecko")&&!(Ru().toLowerCase().indexOf("webkit")!=-1&&!Bt("Edge"))&&!(Bt("Trident")||Bt("MSIE"))&&!Bt("Edge"),Rb=Ru().toLowerCase().indexOf("webkit")!=-1&&!Bt("Edge");function ov(){var n=O.document;return n?n.documentMode:void 0}var id;e:{if(gu="",mu=function(){var n=Ru();if(sv)return/rv:([^\);]+)(\)|;)/.exec(n);if(iv)return/Edge\/([\d\.]+)/.exec(n);if(hi)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(Rb)return/WebKit\/(\S+)/.exec(n);if(bb)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),mu&&(gu=mu?mu[1]:""),hi&&(yu=ov(),yu!=null&&yu>parseFloat(gu))){id=String(yu);break e}id=gu}var gu,mu,yu,sd;O.document&&hi?(Zh=ov(),sd=Zh||parseInt(id,10)||void 0):sd=void 0;var Zh,Db=sd;function to(n,e){if(ze.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(sv){e:{try{Ed(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:Pb[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&to.$.h.call(this)}}ke(to,ze);var Pb={2:"touch",3:"pen",4:"mouse"};to.prototype.h=function(){to.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var co="closure_listenable_"+(1e6*Math.random()|0),xb=0;function kb(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++xb,this.fa=this.ia=!1}function Du(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Id(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function Vb(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function av(n){let e={};for(let t in n)e[t]=n[t];return e}var H_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function uv(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<H_.length;s++)t=H_[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Pu(n){this.src=n,this.g={},this.h=0}Pu.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=ad(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new kb(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function od(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=rv(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Du(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function ad(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var Td="closure_lm_"+(1e6*Math.random()|0),ed={};function cv(n,e,t,r,i){if(r&&r.once)return hv(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)cv(n,e[s],t,r,i);return null}return t=Sd(t),n&&n[co]?n.O(e,t,uo(r)?!!r.capture:!!r,i):lv(n,e,t,!1,r,i)}function lv(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=uo(i)?!!i.capture:!!i,a=Cd(n);if(a||(n[Td]=a=new Pu(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=Nb(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Cb||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(fv(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function Nb(){function n(t){return e.call(n.src,n.listener,t)}let e=Mb;return n}function hv(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)hv(n,e[s],t,r,i);return null}return t=Sd(t),n&&n[co]?n.P(e,t,uo(r)?!!r.capture:!!r,i):lv(n,e,t,!0,r,i)}function dv(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)dv(n,e[s],t,r,i);else r=uo(r)?!!r.capture:!!r,t=Sd(t),n&&n[co]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=ad(s,t,r,i),-1<t&&(Du(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=Cd(n))&&(e=n.g[e.toString()],n=-1,e&&(n=ad(e,t,r,i)),(t=-1<n?e[n]:null)&&Ad(t))}function Ad(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[co])od(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(fv(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Cd(e))?(od(t,n),t.h==0&&(t.src=null,e[Td]=null)):Du(n)}}}function fv(n){return n in ed?ed[n]:ed[n]="on"+n}function Mb(n,e){if(n.fa)n=!0;else{e=new to(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Ad(n),n=t.call(r,e)}return n}function Cd(n){return n=n[Td],n instanceof Pu?n:null}var td="__closure_events_fn_"+(1e9*Math.random()>>>0);function Sd(n){return typeof n=="function"?n:(n[td]||(n[td]=function(e){return n.handleEvent(e)}),n[td])}function xe(){Pn.call(this),this.i=new Pu(this),this.S=this,this.J=null}ke(xe,Pn);xe.prototype[co]=!0;xe.prototype.removeEventListener=function(n,e,t,r){dv(this,n,e,t,r)};function Fe(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new ze(e,n);else if(e instanceof ze)e.target=e.target||n;else{var i=e;e=new ze(r,n),uv(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=_u(o,r,!0,e)&&i}if(o=e.g=n,i=_u(o,r,!0,e)&&i,i=_u(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=_u(o,r,!1,e)&&i}xe.prototype.N=function(){if(xe.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Du(t[r]);delete n.g[e],n.h--}}this.J=null};xe.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};xe.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function _u(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&od(n.i,o),i=a.call(u,r)!==!1&&i}}return i&&!r.defaultPrevented}var bd=O.JSON.stringify,ud=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function Ob(){var n=Rd;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var cd=class{constructor(){this.h=this.g=null}add(e,t){let r=pv.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},pv=new ud(()=>new ld,n=>n.reset()),ld=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function Fb(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function Lb(n){O.setTimeout(()=>{throw n},0)}var no,ro=!1,Rd=new cd,gv=()=>{let n=O.Promise.resolve(void 0);no=()=>{n.then(Ub)}},Ub=()=>{for(var n;n=Ob();){try{n.h.call(n.g)}catch(t){Lb(t)}var e=pv;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}ro=!1};function xu(n,e){xe.call(this),this.h=n||1,this.g=e||O,this.j=$e(this.qb,this),this.l=Date.now()}ke(xu,xe);A=xu.prototype;A.ga=!1;A.T=null;A.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Fe(this,"tick"),this.ga&&(Dd(this),this.start()))}};A.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Dd(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}A.N=function(){xu.$.N.call(this),Dd(this),delete this.g};function Pd(n,e,t){if(typeof n=="function")t&&(n=$e(n,t));else if(n&&typeof n.handleEvent=="function")n=$e(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:O.setTimeout(n,e||0)}function mv(n){n.g=Pd(()=>{n.g=null,n.i&&(n.i=!1,mv(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var hd=class extends Pn{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:mv(this)}N(){super.N(),this.g&&(O.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function io(n){Pn.call(this),this.h=n,this.g={}}ke(io,Pn);var W_=[];function yv(n,e,t,r){Array.isArray(t)||(t&&(W_[0]=t.toString()),t=W_);for(var i=0;i<t.length;i++){var s=cv(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function _v(n){Id(n.g,function(e,t){this.g.hasOwnProperty(t)&&Ad(e)},n),n.g={}}io.prototype.N=function(){io.$.N.call(this),_v(this)};io.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function ku(){this.g=!0}ku.prototype.Ea=function(){this.g=!1};function jb(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+c+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function Bb(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function ci(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+$b(n,t)+(r?" "+r:"")})}function qb(n,e){n.info(function(){return"TIMEOUT: "+e})}ku.prototype.info=function(){};function $b(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return bd(t)}catch{return e}}var cr={},K_=null;function Vu(){return K_=K_||new xe}cr.Ta="serverreachability";function vv(n){ze.call(this,cr.Ta,n)}ke(vv,ze);function so(n){let e=Vu();Fe(e,new vv(e))}cr.STAT_EVENT="statevent";function wv(n,e){ze.call(this,cr.STAT_EVENT,n),this.stat=e}ke(wv,ze);function Ye(n){let e=Vu();Fe(e,new wv(e,n))}cr.Ua="timingevent";function Ev(n,e){ze.call(this,cr.Ua,n),this.size=e}ke(Ev,ze);function lo(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return O.setTimeout(function(){n()},e)}var Nu={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Iv={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function xd(){}xd.prototype.h=null;function Q_(n){return n.h||(n.h=n.i())}function Tv(){}var ho={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function kd(){ze.call(this,"d")}ke(kd,ze);function Vd(){ze.call(this,"c")}ke(Vd,ze);var dd;function Mu(){}ke(Mu,xd);Mu.prototype.g=function(){return new XMLHttpRequest};Mu.prototype.i=function(){return{}};dd=new Mu;function fo(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new io(this),this.P=zb,n=rd?125:void 0,this.V=new xu(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Av}function Av(){this.i=null,this.g="",this.h=!1}var zb=45e3,Cv={},fd={};A=fo.prototype;A.setTimeout=function(n){this.P=n};function pd(n,e,t){n.L=1,n.A=Fu(an(e)),n.u=t,n.S=!0,Sv(n,null)}function Sv(n,e){n.G=Date.now(),po(n),n.B=an(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Nv(t.i,"t",r),n.o=0,t=n.l.J,n.h=new Av,n.g=tw(n.l,t?e:null,!n.u),0<n.O&&(n.M=new hd($e(n.Pa,n,n.g),n.O)),yv(n.U,n.g,"readystatechange",n.nb),e=n.I?av(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),so(),jb(n.j,n.v,n.B,n.m,n.W,n.u)}A.nb=function(n){n=n.target;let e=this.M;e&&qt(n)==3?e.l():this.Pa(n)};A.Pa=function(n){try{if(n==this.g)e:{let l=qt(this.g);var e=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||rd||this.g&&(this.h.h||this.g.ja()||Z_(this.g)))){this.J||l!=4||e==7||(e==8||0>=h?so(3):so(2)),Ou(this);var t=this.g.da();this.ca=t;t:if(bv(this)){var r=Z_(this.g);n="";var i=r.length,s=qt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){or(this),Zs(this);var o="";break t}this.h.i=new O.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,Bb(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!eo(a)){var c=a;break t}}c=null}if(t=c)ci(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,gd(this,t);else{this.i=!1,this.s=3,Ye(12),or(this),Zs(this);break e}}this.S?(Rv(this,l,o),rd&&this.i&&l==3&&(yv(this.U,this.V,"tick",this.mb),this.V.start())):(ci(this.j,this.m,o,null),gd(this,o)),l==4&&or(this),this.i&&!this.J&&(l==4?Xv(this.l,this):(this.i=!1,po(this)))}else hR(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,Ye(12)):(this.s=0,Ye(13)),or(this),Zs(this)}}}catch{}finally{}};function bv(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function Rv(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=Gb(n,t),i==fd){e==4&&(n.s=4,Ye(14),r=!1),ci(n.j,n.m,null,"[Incomplete Response]");break}else if(i==Cv){n.s=4,Ye(15),ci(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else ci(n.j,n.m,i,null),gd(n,i);bv(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Ye(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Ud(e),e.M=!0,Ye(11))):(ci(n.j,n.m,t,"[Invalid Chunked Response]"),or(n),Zs(n))}A.mb=function(){if(this.g){var n=qt(this.g),e=this.g.ja();this.o<e.length&&(Ou(this),Rv(this,n,e),this.i&&n!=4&&po(this))}};function Gb(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?fd:(t=Number(e.substring(t,r)),isNaN(t)?Cv:(r+=1,r+t>e.length?fd:(e=e.slice(r,r+t),n.o=r+t,e)))}A.cancel=function(){this.J=!0,or(this)};function po(n){n.Y=Date.now()+n.P,Dv(n,n.P)}function Dv(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=lo($e(n.lb,n),e)}function Ou(n){n.C&&(O.clearTimeout(n.C),n.C=null)}A.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(qb(this.j,this.B),this.L!=2&&(so(),Ye(17)),or(this),this.s=2,Zs(this)):Dv(this,this.Y-n)};function Zs(n){n.l.H==0||n.J||Xv(n.l,n)}function or(n){Ou(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,Dd(n.V),_v(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function gd(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||md(t.i,n))){if(!n.K&&md(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)Tu(t),ju(t);else break e;Ld(t),Ye(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=lo($e(t.ib,t),6e3));if(1>=Fv(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else ar(t,11)}else if((n.K||t.g==n)&&Tu(t),!eo(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let l=c[3];l!=null&&(t.ra=l,t.l.info("VER="+t.ra));let h=c[4];h!=null&&(t.Ga=h,t.l.info("SVER="+t.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let f=n.g;if(f){let E=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(E){var s=r.i;s.g||E.indexOf("spdy")==-1&&E.indexOf("quic")==-1&&E.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Nd(s,s.h),s.h=null))}if(r.F){let w=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;w&&(r.Da=w,oe(r.I,r.F,w))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=ew(r,r.J?r.pa:null,r.Y),o.K){Lv(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(Ou(a),po(a)),r.g=o}else Qv(r);0<t.j.length&&Bu(t)}else c[0]!="stop"&&c[0]!="close"||ar(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?ar(t,7):Fd(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}so(4)}catch{}}function Hb(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(bu(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function Wb(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(bu(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function Pv(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(bu(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=Wb(n),r=Hb(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var xv=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Kb(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function ur(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof ur){this.h=n.h,Eu(this,n.j),this.s=n.s,this.g=n.g,Iu(this,n.m),this.l=n.l;var e=n.i,t=new oo;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Y_(this,t),this.o=n.o}else n&&(e=String(n).match(xv))?(this.h=!1,Eu(this,e[1]||"",!0),this.s=Xs(e[2]||""),this.g=Xs(e[3]||"",!0),Iu(this,e[4]),this.l=Xs(e[5]||"",!0),Y_(this,e[6]||"",!0),this.o=Xs(e[7]||"")):(this.h=!1,this.i=new oo(null,this.h))}ur.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Js(e,X_,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Js(e,X_,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(Js(t,t.charAt(0)=="/"?Xb:Yb,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Js(t,Zb)),n.join("")};function an(n){return new ur(n)}function Eu(n,e,t){n.j=t?Xs(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Iu(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Y_(n,e,t){e instanceof oo?(n.i=e,eR(n.i,n.h)):(t||(e=Js(e,Jb)),n.i=new oo(e,n.h))}function oe(n,e,t){n.i.set(e,t)}function Fu(n){return oe(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Xs(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Js(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,Qb),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Qb(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var X_=/[#\/\?@]/g,Yb=/[#\?:]/g,Xb=/[#\?]/g,Jb=/[#\?@]/g,Zb=/#/g;function oo(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function xn(n){n.g||(n.g=new Map,n.h=0,n.i&&Kb(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}A=oo.prototype;A.add=function(n,e){xn(this),this.i=null,n=di(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function kv(n,e){xn(n),e=di(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Vv(n,e){return xn(n),e=di(n,e),n.g.has(e)}A.forEach=function(n,e){xn(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};A.ta=function(){xn(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};A.Z=function(n){xn(this);let e=[];if(typeof n=="string")Vv(this,n)&&(e=e.concat(this.g.get(di(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};A.set=function(n,e){return xn(this),this.i=null,n=di(this,n),Vv(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};A.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function Nv(n,e,t){kv(n,e),0<t.length&&(n.i=null,n.g.set(di(n,e),wd(t)),n.h+=t.length)}A.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function di(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function eR(n,e){e&&!n.j&&(xn(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(kv(this,r),Nv(this,i,t))},n)),n.j=e}var tR=class{constructor(n,e){this.g=n,this.map=e}};function Mv(n){this.l=n||nR,O.PerformanceNavigationTiming?(n=O.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(O.g&&O.g.Ka&&O.g.Ka()&&O.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var nR=10;function Ov(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function Fv(n){return n.h?1:n.g?n.g.size:0}function md(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Nd(n,e){n.g?n.g.add(e):n.h=e}function Lv(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}Mv.prototype.cancel=function(){if(this.i=Uv(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function Uv(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return wd(n.i)}var rR=class{stringify(n){return O.JSON.stringify(n,void 0)}parse(n){return O.JSON.parse(n,void 0)}};function iR(){this.g=new rR}function sR(n,e,t){let r=t||"";try{Pv(n,function(i,s){let o=i;uo(i)&&(o=bd(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function oR(n,e){let t=new ku;if(O.Image){let r=new Image;r.onload=pu(vu,t,r,"TestLoadImage: loaded",!0,e),r.onerror=pu(vu,t,r,"TestLoadImage: error",!1,e),r.onabort=pu(vu,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=pu(vu,t,r,"TestLoadImage: timeout",!1,e),O.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function vu(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function go(n){this.l=n.ec||null,this.j=n.ob||!1}ke(go,xd);go.prototype.g=function(){return new Lu(this.l,this.j)};go.prototype.i=function(n){return function(){return n}}({});function Lu(n,e){xe.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Md,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ke(Lu,xe);var Md=0;A=Lu.prototype;A.open=function(n,e){if(this.readyState!=Md)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,ao(this)};A.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||O).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};A.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,mo(this)),this.readyState=Md};A.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,ao(this)),this.g&&(this.readyState=3,ao(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof O.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;jv(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function jv(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}A.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?mo(this):ao(this),this.readyState==3&&jv(this)}};A.Za=function(n){this.g&&(this.response=this.responseText=n,mo(this))};A.Ya=function(n){this.g&&(this.response=n,mo(this))};A.ka=function(){this.g&&mo(this)};function mo(n){n.readyState=4,n.l=null,n.j=null,n.A=null,ao(n)}A.setRequestHeader=function(n,e){this.v.append(n,e)};A.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};A.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function ao(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Lu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var aR=O.JSON.parse;function fe(n){xe.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Bv,this.L=this.M=!1}ke(fe,xe);var Bv="",uR=/^https?$/i,cR=["POST","PUT"];A=fe.prototype;A.Oa=function(n){this.M=n};A.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():dd.g(),this.C=this.u?Q_(this.u):Q_(dd),this.g.onreadystatechange=$e(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){J_(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=O.FormData&&n instanceof O.FormData,!(0<=rv(cR,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{zv(this),0<this.B&&((this.L=lR(this.g))?(this.g.timeout=this.B,this.g.ontimeout=$e(this.ua,this)):this.A=Pd(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){J_(this,s)}};function lR(n){return hi&&typeof n.timeout=="number"&&n.ontimeout!==void 0}A.ua=function(){typeof vd<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Fe(this,"timeout"),this.abort(8))};function J_(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,qv(n),Uu(n)}function qv(n){n.F||(n.F=!0,Fe(n,"complete"),Fe(n,"error"))}A.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Fe(this,"complete"),Fe(this,"abort"),Uu(this))};A.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Uu(this,!0)),fe.$.N.call(this)};A.La=function(){this.s||(this.G||this.v||this.l?$v(this):this.kb())};A.kb=function(){$v(this)};function $v(n){if(n.h&&typeof vd<"u"&&(!n.C[1]||qt(n)!=4||n.da()!=2)){if(n.v&&qt(n)==4)Pd(n.La,0,n);else if(Fe(n,"readystatechange"),qt(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(xv)[1]||null;!i&&O.self&&O.self.location&&(i=O.self.location.protocol.slice(0,-1)),r=!uR.test(i?i.toLowerCase():"")}t=r}if(t)Fe(n,"complete"),Fe(n,"success");else{n.m=6;try{var s=2<qt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",qv(n)}}finally{Uu(n)}}}}function Uu(n,e){if(n.g){zv(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Fe(n,"ready");try{t.onreadystatechange=r}catch{}}}function zv(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(O.clearTimeout(n.A),n.A=null)}A.isActive=function(){return!!this.g};function qt(n){return n.g?n.g.readyState:0}A.da=function(){try{return 2<qt(this)?this.g.status:-1}catch{return-1}};A.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};A.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),aR(e)}};function Z_(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Bv:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function hR(n){let e={};n=(n.g&&2<=qt(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(eo(n[r]))continue;var t=Fb(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}Vb(e,function(r){return r.join(", ")})}A.Ia=function(){return this.m};A.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Gv(n){let e="";return Id(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function Od(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Gv(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):oe(n,e,t))}function Qs(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Hv(n){this.Ga=0,this.j=[],this.l=new ku,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Qs("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Qs("baseRetryDelayMs",5e3,n),this.hb=Qs("retryDelaySeedMs",1e4,n),this.eb=Qs("forwardChannelMaxRetries",2,n),this.xa=Qs("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Mv(n&&n.concurrentRequestLimit),this.Ja=new iR,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}A=Hv.prototype;A.ra=8;A.H=1;function Fd(n){if(Wv(n),n.H==3){var e=n.W++,t=an(n.I);if(oe(t,"SID",n.K),oe(t,"RID",e),oe(t,"TYPE","terminate"),yo(n,t),e=new fo(n,n.l,e),e.L=2,e.A=Fu(an(t)),t=!1,O.navigator&&O.navigator.sendBeacon)try{t=O.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&O.Image&&(new Image().src=e.A,t=!0),t||(e.g=tw(e.l,null),e.g.ha(e.A)),e.G=Date.now(),po(e)}Zv(n)}function ju(n){n.g&&(Ud(n),n.g.cancel(),n.g=null)}function Wv(n){ju(n),n.u&&(O.clearTimeout(n.u),n.u=null),Tu(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&O.clearTimeout(n.m),n.m=null)}function Bu(n){if(!Ov(n.i)&&!n.m){n.m=!0;var e=n.Na;no||gv(),ro||(no(),ro=!0),Rd.add(e,n),n.C=0}}function dR(n,e){return Fv(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=lo($e(n.Na,n,e),Jv(n,n.C)),n.C++,!0)}A.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new fo(this,this.l,n),s=this.s;if(this.U&&(s?(s=av(s),uv(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Kv(this,i,e),t=an(this.I),oe(t,"RID",n),oe(t,"CVER",22),this.F&&oe(t,"X-HTTP-Session-Id",this.F),yo(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Gv(s)))+"&"+e:this.o&&Od(t,this.o,s)),Nd(this.i,i),this.bb&&oe(t,"TYPE","init"),this.P?(oe(t,"$req",e),oe(t,"SID","null"),i.aa=!0,pd(i,t,null)):pd(i,t,e),this.H=2}}else this.H==3&&(n?ev(this,n):this.j.length==0||Ov(this.i)||ev(this))};function ev(n,e){var t;e?t=e.m:t=n.W++;let r=an(n.I);oe(r,"SID",n.K),oe(r,"RID",t),oe(r,"AID",n.V),yo(n,r),n.o&&n.s&&Od(r,n.o,n.s),t=new fo(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Kv(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Nd(n.i,t),pd(t,r,e)}function yo(n,e){n.na&&Id(n.na,function(t,r){oe(e,r,t)}),n.h&&Pv({},function(t,r){oe(e,r,t)})}function Kv(n,e,t){t=Math.min(n.j.length,t);var r=n.h?$e(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g,l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{sR(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Qv(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;no||gv(),ro||(no(),ro=!0),Rd.add(e,n),n.A=0}}function Ld(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=lo($e(n.Ma,n),Jv(n,n.A)),n.A++,!0)}A.Ma=function(){if(this.u=null,Yv(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=lo($e(this.jb,this),n)}};A.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ye(10),ju(this),Yv(this))};function Ud(n){n.B!=null&&(O.clearTimeout(n.B),n.B=null)}function Yv(n){n.g=new fo(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=an(n.wa);oe(e,"RID","rpc"),oe(e,"SID",n.K),oe(e,"AID",n.V),oe(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&oe(e,"TO",n.qa),oe(e,"TYPE","xmlhttp"),yo(n,e),n.o&&n.s&&Od(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=Fu(an(e)),t.u=null,t.S=!0,Sv(t,n)}A.ib=function(){this.v!=null&&(this.v=null,ju(this),Ld(this),Ye(19))};function Tu(n){n.v!=null&&(O.clearTimeout(n.v),n.v=null)}function Xv(n,e){var t=null;if(n.g==e){Tu(n),Ud(n),n.g=null;var r=2}else if(md(n.i,e))t=e.F,Lv(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=Vu(),Fe(r,new Ev(r,t)),Bu(n)}else Qv(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&dR(n,e)||r==2&&Ld(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:ar(n,5);break;case 4:ar(n,10);break;case 3:ar(n,6);break;default:ar(n,2)}}}function Jv(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function ar(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=$e(n.pb,n);t||(t=new ur("//www.google.com/images/cleardot.gif"),O.location&&O.location.protocol=="http"||Eu(t,"https"),Fu(t)),oR(t.toString(),r)}else Ye(2);n.H=0,n.h&&n.h.za(e),Zv(n),Wv(n)}A.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Ye(2)):(this.l.info("Failed to ping google.com"),Ye(1))};function Zv(n){if(n.H=0,n.ma=[],n.h){let e=Uv(n.i);(e.length!=0||n.j.length!=0)&&(G_(n.ma,e),G_(n.ma,n.j),n.i.i.length=0,wd(n.j),n.j.length=0),n.h.ya()}}function ew(n,e,t){var r=t instanceof ur?an(t):new ur(t);if(r.g!="")e&&(r.g=e+"."+r.g),Iu(r,r.m);else{var i=O.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new ur(null);r&&Eu(s,r),e&&(s.g=e),i&&Iu(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&oe(r,t,e),oe(r,"VER",n.ra),yo(n,r),r}function tw(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new fe(new go({ob:t})):new fe(n.va),e.Oa(n.J),e}A.isActive=function(){return!!this.h&&this.h.isActive(this)};function nw(){}A=nw.prototype;A.Ba=function(){};A.Aa=function(){};A.za=function(){};A.ya=function(){};A.isActive=function(){return!0};A.Va=function(){};function Au(){if(hi&&!(10<=Number(Db)))throw Error("Environmental error: no available transport.")}Au.prototype.g=function(n,e){return new ct(n,e)};function ct(n,e){xe.call(this),this.g=new Hv(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!eo(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!eo(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new fi(this)}ke(ct,xe);ct.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Ye(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=ew(n,null,n.Y),Bu(n)};ct.prototype.close=function(){Fd(this.g)};ct.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=bd(n),n=t);e.j.push(new tR(e.fb++,n)),e.H==3&&Bu(e)};ct.prototype.N=function(){this.g.h=null,delete this.j,Fd(this.g),delete this.g,ct.$.N.call(this)};function rw(n){kd.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}ke(rw,kd);function iw(){Vd.call(this),this.status=1}ke(iw,Vd);function fi(n){this.g=n}ke(fi,nw);fi.prototype.Ba=function(){Fe(this.g,"a")};fi.prototype.Aa=function(n){Fe(this.g,new rw(n))};fi.prototype.za=function(n){Fe(this.g,new iw)};fi.prototype.ya=function(){Fe(this.g,"b")};function fR(){this.blockSize=-1}function Rt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}ke(Rt,fR);Rt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function nd(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}Rt.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)nd(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){nd(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){nd(this,r),i=0;break}}this.h=i,this.i+=e};Rt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function X(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var pR={};function jd(n){return-128<=n&&128>n?Sb(n,function(e){return new X([e|0],0>e?-1:0)}):new X([n|0],0>n?-1:0)}function $t(n){if(isNaN(n)||!isFinite(n))return li;if(0>n)return Oe($t(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=yd;return new X(e,0)}function sw(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return Oe(sw(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=$t(Math.pow(e,8)),r=li,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=$t(Math.pow(e,s)),r=r.R(s).add($t(o))):(r=r.R(t),r=r.add($t(o)))}return r}var yd=4294967296,li=jd(0),_d=jd(1),tv=jd(16777216);A=X.prototype;A.ea=function(){if(mt(this))return-Oe(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:yd+r)*e,e*=yd}return n};A.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(on(this))return"0";if(mt(this))return"-"+Oe(this).toString(n);for(var e=$t(Math.pow(n,6)),t=this,r="";;){var i=Su(t,e).g;t=Cu(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,on(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};A.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function on(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function mt(n){return n.h==-1}A.X=function(n){return n=Cu(this,n),mt(n)?-1:on(n)?0:1};function Oe(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new X(t,~n.h).add(_d)}A.abs=function(){return mt(this)?Oe(this):this};A.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new X(t,t[t.length-1]&-2147483648?-1:0)};function Cu(n,e){return n.add(Oe(e))}A.R=function(n){if(on(this)||on(n))return li;if(mt(this))return mt(n)?Oe(this).R(Oe(n)):Oe(Oe(this).R(n));if(mt(n))return Oe(this.R(Oe(n)));if(0>this.X(tv)&&0>n.X(tv))return $t(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,u=n.D(i)&65535;t[2*r+2*i]+=o*u,wu(t,2*r+2*i),t[2*r+2*i+1]+=s*u,wu(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,wu(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,wu(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new X(t,0)};function wu(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Ys(n,e){this.g=n,this.h=e}function Su(n,e){if(on(e))throw Error("division by zero");if(on(n))return new Ys(li,li);if(mt(n))return e=Su(Oe(n),e),new Ys(Oe(e.g),Oe(e.h));if(mt(e))return e=Su(n,Oe(e)),new Ys(Oe(e.g),e.h);if(30<n.g.length){if(mt(n)||mt(e))throw Error("slowDivide_ only works with positive integers.");for(var t=_d,r=e;0>=r.X(n);)t=nv(t),r=nv(r);var i=ui(t,1),s=ui(r,1);for(r=ui(r,2),t=ui(t,2);!on(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=ui(r,1),t=ui(t,1)}return e=Cu(n,i.R(e)),new Ys(i,e)}for(i=li;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=$t(t),o=s.R(e);mt(o)||0<o.X(n);)t-=r,s=$t(t),o=s.R(e);on(s)&&(s=_d),i=i.add(s),n=Cu(n,o)}return new Ys(i,n)}A.gb=function(n){return Su(this,n).h};A.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new X(t,this.h&n.h)};A.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new X(t,this.h|n.h)};A.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new X(t,this.h^n.h)};function nv(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new X(t,n.h)}function ui(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new X(i,n.h)}Au.prototype.createWebChannel=Au.prototype.g;ct.prototype.send=ct.prototype.u;ct.prototype.open=ct.prototype.m;ct.prototype.close=ct.prototype.close;Nu.NO_ERROR=0;Nu.TIMEOUT=8;Nu.HTTP_ERROR=6;Iv.COMPLETE="complete";Tv.EventType=ho;ho.OPEN="a";ho.CLOSE="b";ho.ERROR="c";ho.MESSAGE="d";xe.prototype.listen=xe.prototype.O;fe.prototype.listenOnce=fe.prototype.P;fe.prototype.getLastError=fe.prototype.Sa;fe.prototype.getLastErrorCode=fe.prototype.Ia;fe.prototype.getStatus=fe.prototype.da;fe.prototype.getResponseJson=fe.prototype.Wa;fe.prototype.getResponseText=fe.prototype.ja;fe.prototype.send=fe.prototype.ha;fe.prototype.setWithCredentials=fe.prototype.Oa;Rt.prototype.digest=Rt.prototype.l;Rt.prototype.reset=Rt.prototype.reset;Rt.prototype.update=Rt.prototype.j;X.prototype.add=X.prototype.add;X.prototype.multiply=X.prototype.R;X.prototype.modulo=X.prototype.gb;X.prototype.compare=X.prototype.X;X.prototype.toNumber=X.prototype.ea;X.prototype.toString=X.prototype.toString;X.prototype.getBits=X.prototype.D;X.fromNumber=$t;X.fromString=sw;var ow=Dt.createWebChannelTransport=function(){return new Au},aw=Dt.getStatEventTarget=function(){return Vu()},qu=Dt.ErrorCode=Nu,uw=Dt.EventType=Iv,cw=Dt.Event=cr,Bd=Dt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},lw=Dt.FetchXmlHttpFactory=go,_o=Dt.WebChannel=Tv,hw=Dt.XhrIo=fe,dw=Dt.Md5=Rt,lr=Dt.Integer=X;var fw="@firebase/firestore";var Ae=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ae.UNAUTHENTICATED=new Ae(null),Ae.GOOGLE_CREDENTIALS=new Ae("google-credentials-uid"),Ae.FIRST_PARTY=new Ae("first-party-uid"),Ae.MOCK_USER=new Ae("mock-user");var zi="10.11.1";var Ln=new Ca("@firebase/firestore");function _i(){return Ln.logLevel}function fE(n){Ln.setLogLevel(n)}function v(n,...e){if(Ln.logLevel<=Ft.DEBUG){let t=e.map(Gp);Ln.debug(`Firestore (${zi}): ${n}`,...t)}}function ye(n,...e){if(Ln.logLevel<=Ft.ERROR){let t=e.map(Gp);Ln.error(`Firestore (${zi}): ${n}`,...t)}}function _t(n,...e){if(Ln.logLevel<=Ft.WARN){let t=e.map(Gp);Ln.warn(`Firestore (${zi}): ${n}`,...t)}}function Gp(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function S(n="Unexpected state"){let e=`FIRESTORE (${zi}) INTERNAL ASSERTION FAILED: `+n;throw ye(e),new Error(e)}function P(n,e){n||S()}function pE(n,e){n||S()}function T(n,e){return n}var m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},y=class extends Aa{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ce=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Zu=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Hd=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ae.UNAUTHENTICATED))}shutdown(){}},Wd=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Kd=class{constructor(e){this.t=e,this.currentUser=Ae.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new Ce;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ce,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>g(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ce)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(P(typeof r.accessToken=="string"),new Zu(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return P(e===null||typeof e=="string"),new Ae(e)}},Qd=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Ae.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Yd=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Qd(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ae.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Xd=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Jd=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,v("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(P(typeof t.token=="string"),this.R=t.token,new Xd(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function gR(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var ec=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=gR(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function U(n,e){return n<e?-1:n>e?1:0}function bi(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function gE(n){return n+"\0"}var he=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?U(this.nanoseconds,e.nanoseconds):U(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var k=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new he(0,0))}static max(){return new n(new he(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var tc=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&S(),r===void 0?r=e.length-t:r>e.length-t&&S(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},W=class n extends tc{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},mR=/^[_a-zA-Z][_a-zA-Z0-9]*$/,_e=class n extends tc{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return mR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new y(m.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new y(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new y(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new y(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var I=class n{constructor(e){this.path=e}static fromPath(e){return new n(W.fromString(e))}static fromName(e){return new n(W.fromString(e).popFirst(5))}static empty(){return new n(W.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&W.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return W.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new W(e.slice()))}};var Ri=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function Zd(n){return n.fields.find(e=>e.kind===2)}function dr(n){return n.fields.filter(e=>e.kind!==2)}Ri.UNKNOWN_ID=-1;var Ai=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Po=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,vt.min())}};function mE(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=k.fromTimestamp(r===1e9?new he(t+1,0):new he(t,r));return new vt(i,I.empty(),e)}function yE(n){return new vt(n.readTime,n.key,-1)}var vt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(k.min(),I.empty(),-1)}static max(){return new n(k.max(),I.empty(),-1)}};function Hp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=I.comparator(n.documentKey,e.documentKey),t!==0?t:U(n.largestBatchId,e.largestBatchId))}var _E="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",nc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Kn(n){return g(this,null,function*(){if(n.code!==m.FAILED_PRECONDITION||n.message!==_E)throw n;v("LocalStore","Unexpectedly lost primary lease")})}var p=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var rc=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Ce,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new _r(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=Wp(r.target.error);this.V.reject(new _r(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new _r(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(v("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new tf(t)}},Un=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(ys())===12.2&&ye("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return v("SimpleDb","Removing database:",e),fr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Ta())return!1;if(n.C())return!0;let e=ys(),t=n.S(e),r=0<t&&t<10,i=vE(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.v)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){return g(this,null,function*(){return this.db||(v("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new _r(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new y(m.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new y(m.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new _r(e,o))},i.onupgradeneeded=s=>{v("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{v("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return g(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=rc.open(this.db,e,s?"readonly":"readwrite",r),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),p.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(v("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function vE(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var ef=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return fr(this.B.delete())}},_r=class extends y{constructor(e,t){super(m.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Qn(n){return n.name==="IndexedDbTransactionError"}var tf=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(v("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(v("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),fr(r)}add(e){return v("SimpleDb","ADD",this.store.name,e,e),fr(this.store.add(e))}get(e){return fr(this.store.get(e)).next(t=>(t===void 0&&(t=null),v("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return v("SimpleDb","DELETE",this.store.name,e),fr(this.store.delete(e))}count(){return v("SimpleDb","COUNT",this.store.name),fr(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new p((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(a,u)=>{o.push(u)}).next(()=>o)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new p((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){v("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new p((r,i)=>{t.onerror=s=>{let o=Wp(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){let r=[];return new p((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new ef(a),c=t(a.primaryKey,a.value,u);if(c instanceof p){let l=c.catch(h=>(u.done(),p.reject(h)));r.push(l)}u.isDone?i():u.K===null?a.continue():a.continue(u.K)}}).next(()=>p.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function fr(n){return new p((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=Wp(r.target.error);t(i)}})}var pw=!1;function Wp(n){let e=Un.S(ys());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return pw||(pw=!0,setTimeout(()=>{throw r},0)),r}}return n}var nf=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){v("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>g(this,null,function*(){this.task=null;try{v("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Qn(t)?v("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield Kn(t)}yield this.X(6e4)}))}},rf=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return g(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,s=!0;return p.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return v("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(v("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=yE(s);Hp(o,r)>0&&(r=o)}),new vt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var lt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function Jo(n){return n==null}function xo(n){return n===0&&1/n==-1/0}function wE(n){return typeof n=="number"&&Number.isInteger(n)&&!xo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Xe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=gw(e)),e=yR(n.get(t),e);return gw(e)}function yR(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function gw(n){return n+""}function zt(n){let e=n.length;if(P(e>=2),e===2)return P(n.charAt(0)===""&&n.charAt(1)===""),W.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&S(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:S()}s=o+2}return new W(r)}var mw=["userId","batchId"];function Wu(n,e){return[n,Xe(e)]}function EE(n,e,t){return[n,Xe(e),t]}var _R={},vR=["prefixPath","collectionGroup","readTime","documentId"],wR=["prefixPath","collectionGroup","documentId"],ER=["collectionGroup","readTime","prefixPath","documentId"],IR=["canonicalId","targetId"],TR=["targetId","path"],AR=["path","targetId"],CR=["collectionId","parent"],SR=["indexId","uid"],bR=["uid","sequenceNumber"],RR=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],DR=["indexId","uid","orderedDocumentKey"],PR=["userId","collectionPath","documentId"],xR=["userId","collectionPath","largestBatchId"],kR=["userId","collectionGroup","largestBatchId"],IE=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],VR=[...IE,"documentOverlays"],TE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],AE=TE,CE=[...AE,"indexConfiguration","indexState","indexEntries"],NR=CE;var ko=class extends nc{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function Ne(n,e){let t=T(n);return Un.F(t._e,e)}function yw(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Pr(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function SE(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ae=class n{constructor(e,t){this.comparator=e,this.root=t||Ht.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ht.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ht.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ti(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ti(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ti(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ti(this.root,e,this.comparator,!0)}},Ti=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ht=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw S();let e=this.left.check();if(e!==this.right.check())throw S();return e+(this.isRed()?0:1)}};Ht.EMPTY=null,Ht.RED=!0,Ht.BLACK=!1;Ht.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Ht(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ne=class n{constructor(e){this.comparator=e,this.data=new ae(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ic(this.data.getIterator())}getIteratorFrom(e){return new ic(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},ic=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function pi(n){return n.hasNext()?n.getNext():void 0}var ht=class n{constructor(e){this.fields=e,e.sort(_e.comparator)}static empty(){return new n([])}unionWith(e){let t=new ne(_e.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return bi(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var sc=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function bE(){return typeof atob<"u"}var Ve=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new sc("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return U(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ve.EMPTY_BYTE_STRING=new Ve("");var MR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ln(n){if(P(!!n),typeof n=="string"){let e=0,t=MR.exec(n);if(P(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:pe(n.seconds),nanos:pe(n.nanos)}}function pe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function jn(n){return typeof n=="string"?Ve.fromBase64String(n):Ve.fromUint8Array(n)}function Qc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Kp(n){let e=n.mapValue.fields.__previous_value__;return Qc(e)?Kp(e):e}function Vo(n){let e=ln(n.mapValue.fields.__local_write_time__.timestampValue);return new he(e.seconds,e.nanos)}var sf=class{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},Bn=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var On={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ku={nullValue:"NULL_VALUE"};function vr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Qc(n)?4:RE(n)?9007199254740991:10:S()}function Qt(n,e){if(n===e)return!0;let t=vr(n);if(t!==vr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Vo(n).isEqual(Vo(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=ln(i.timestampValue),a=ln(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return jn(i.bytesValue).isEqual(jn(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return pe(i.geoPointValue.latitude)===pe(s.geoPointValue.latitude)&&pe(i.geoPointValue.longitude)===pe(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return pe(i.integerValue)===pe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=pe(i.doubleValue),a=pe(s.doubleValue);return o===a?xo(o)===xo(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return bi(n.arrayValue.values||[],e.arrayValue.values||[],Qt);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(yw(o)!==yw(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!Qt(o[u],a[u])))return!1;return!0}(n,e);default:return S()}}function No(n,e){return(n.values||[]).find(t=>Qt(t,e))!==void 0}function qn(n,e){if(n===e)return 0;let t=vr(n),r=vr(e);if(t!==r)return U(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return U(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=pe(s.integerValue||s.doubleValue),u=pe(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return _w(n.timestampValue,e.timestampValue);case 4:return _w(Vo(n),Vo(e));case 5:return U(n.stringValue,e.stringValue);case 6:return function(s,o){let a=jn(s),u=jn(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let l=U(a[c],u[c]);if(l!==0)return l}return U(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=U(pe(s.latitude),pe(o.latitude));return a!==0?a:U(pe(s.longitude),pe(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){let a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){let l=qn(a[c],u[c]);if(l)return l}return U(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===On.mapValue&&o===On.mapValue)return 0;if(s===On.mapValue)return 1;if(o===On.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){let d=U(u[h],l[h]);if(d!==0)return d;let f=qn(a[u[h]],c[l[h]]);if(f!==0)return f}return U(u.length,l.length)}(n.mapValue,e.mapValue);default:throw S()}}function _w(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return U(n,e);let t=ln(n),r=ln(e),i=U(t.seconds,r.seconds);return i!==0?i:U(t.nanos,r.nanos)}function Di(n){return of(n)}function of(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=ln(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return jn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return I.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=of(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${of(t.fields[o])}`;return i+"}"}(n.mapValue):S()}function wr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function af(n){return!!n&&"integerValue"in n}function Mo(n){return!!n&&"arrayValue"in n}function vw(n){return!!n&&"nullValue"in n}function ww(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Qu(n){return!!n&&"mapValue"in n}function Co(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Pr(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Co(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Co(n.arrayValue.values[t]);return e}return Object.assign({},n)}function RE(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function OR(n){return"nullValue"in n?Ku:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?wr(Bn.empty(),I.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:S()}function FR(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?wr(Bn.empty(),I.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?On:S()}function Ew(n,e){let t=qn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Iw(n,e){let t=qn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var He=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Qu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Co(t)}setAll(e){let t=_e.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Co(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Qu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Qt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Qu(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Pr(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Co(this.value))}};function DE(n){let e=[];return Pr(n.fields,(t,r)=>{let i=new _e([t]);if(Qu(r)){let s=DE(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new ht(e)}var Se=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,k.min(),k.min(),k.min(),He.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,k.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,k.min(),k.min(),He.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,k.min(),k.min(),He.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(k.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=He.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=He.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=k.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Yt=class{constructor(e,t){this.position=e,this.inclusive=t}};function Tw(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=I.comparator(I.fromName(o.referenceValue),t.key):r=qn(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Aw(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Qt(n.position[t],e.position[t]))return!1;return!0}var Er=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function LR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var oc=class{},G=class n extends oc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new lf(e,t,r):t==="array-contains"?new ff(e,r):t==="in"?new ac(e,r):t==="not-in"?new pf(e,r):t==="array-contains-any"?new gf(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new hf(e,r):new df(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(qn(t,this.value)):t!==null&&vr(this.value)===vr(t)&&this.matchesComparison(qn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return S()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},J=class n extends oc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return Pi(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Pi(n){return n.op==="and"}function uf(n){return n.op==="or"}function Qp(n){return PE(n)&&Pi(n)}function PE(n){for(let e of n.filters)if(e instanceof J)return!1;return!0}function cf(n){if(n instanceof G)return n.field.canonicalString()+n.op.toString()+Di(n.value);if(Qp(n))return n.filters.map(e=>cf(e)).join(",");{let e=n.filters.map(t=>cf(t)).join(",");return`${n.op}(${e})`}}function xE(n,e){return n instanceof G?function(r,i){return i instanceof G&&r.op===i.op&&r.field.isEqual(i.field)&&Qt(r.value,i.value)}(n,e):n instanceof J?function(r,i){return i instanceof J&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&xE(o,i.filters[a]),!0):!1}(n,e):void S()}function kE(n,e){let t=n.filters.concat(e);return J.create(t,n.op)}function VE(n){return n instanceof G?function(t){return`${t.field.canonicalString()} ${t.op} ${Di(t.value)}`}(n):n instanceof J?function(t){return t.op.toString()+" {"+t.getFilters().map(VE).join(" ,")+"}"}(n):"Filter"}var lf=class extends G{constructor(e,t,r){super(e,t,r),this.key=I.fromName(r.referenceValue)}matches(e){let t=I.comparator(e.key,this.key);return this.matchesComparison(t)}},hf=class extends G{constructor(e,t){super(e,"in",t),this.keys=NE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},df=class extends G{constructor(e,t){super(e,"not-in",t),this.keys=NE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function NE(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>I.fromName(r.referenceValue))}var ff=class extends G{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Mo(t)&&No(t.arrayValue,this.value)}},ac=class extends G{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&No(this.value.arrayValue,t)}},pf=class extends G{constructor(e,t){super(e,"not-in",t)}matches(e){if(No(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!No(this.value.arrayValue,t)}},gf=class extends G{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Mo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>No(this.value.arrayValue,r))}};var mf=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function yf(n,e=null,t=[],r=[],i=null,s=null,o=null){return new mf(n,e,t,r,i,s,o)}function Ir(n){let e=T(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>cf(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Jo(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Di(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Di(r)).join(",")),e.ue=t}return e.ue}function Zo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!LR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!xE(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Aw(n.startAt,e.startAt)&&Aw(n.endAt,e.endAt)}function uc(n){return I.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function cc(n,e){return n.filters.filter(t=>t instanceof G&&t.field.isEqual(e))}function Cw(n,e,t){let r=Ku,i=!0;for(let s of cc(n,e)){let o=Ku,a=!0;switch(s.op){case"<":case"<=":o=OR(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Ku}Ew({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];Ew({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function Sw(n,e,t){let r=On,i=!0;for(let s of cc(n,e)){let o=On,a=!0;switch(s.op){case">=":case">":o=FR(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=On}Iw({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];Iw({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var Pt=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function ME(n,e,t,r,i,s,o,a){return new Pt(n,e,t,r,i,s,o,a)}function Gi(n){return new Pt(n)}function bw(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Yp(n){return n.collectionGroup!==null}function Ci(n){let e=T(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ne(_e.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Er(s,r))}),t.has(_e.keyField().canonicalString())||e.ce.push(new Er(_e.keyField(),r))}return e.ce}function Je(n){let e=T(n);return e.le||(e.le=UR(e,Ci(n))),e.le}function UR(n,e){if(n.limitType==="F")return yf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Er(i.field,s)});let t=n.endAt?new Yt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Yt(n.startAt.position,n.startAt.inclusive):null;return yf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function _f(n,e){let t=n.filters.concat([e]);return new Pt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function lc(n,e,t){return new Pt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ea(n,e){return Zo(Je(n),Je(e))&&n.limitType===e.limitType}function OE(n){return`${Ir(Je(n))}|lt:${n.limitType}`}function vi(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>VE(i)).join(", ")}]`),Jo(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Di(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Di(i)).join(",")),`Target(${r})`}(Je(n))}; limitType=${n.limitType})`}function ta(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):I.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Ci(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,u){let c=Tw(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,Ci(r),i)||r.endAt&&!function(o,a,u){let c=Tw(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,Ci(r),i))}(n,e)}function FE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function LE(n){return(e,t)=>{let r=!1;for(let i of Ci(n)){let s=jR(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function jR(n,e,t){let r=n.field.isKeyField()?I.comparator(e.key,t.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?qn(u,c):S()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return S()}}var Xt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Pr(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return SE(this.inner)}size(){return this.innerSize}};var BR=new ae(I.comparator);function it(){return BR}var UE=new ae(I.comparator);function To(...n){let e=UE;for(let t of n)e=e.insert(t.key,t);return e}function jE(n){let e=UE;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Gt(){return So()}function BE(){return So()}function So(){return new Xt(n=>n.toString(),(n,e)=>n.isEqual(e))}var qR=new ae(I.comparator),$R=new ne(I.comparator);function j(...n){let e=$R;for(let t of n)e=e.add(t);return e}var zR=new ne(U);function Xp(){return zR}function qE(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xo(e)?"-0":e}}function $E(n){return{integerValue:""+n}}function zE(n,e){return wE(e)?$E(e):qE(n,e)}var xi=class{constructor(){this._=void 0}};function GR(n,e,t){return n instanceof $n?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Qc(s)&&(s=Kp(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof hn?HE(n,e):n instanceof dn?WE(n,e):function(i,s){let o=GE(i,s),a=Rw(o)+Rw(i.Pe);return af(o)&&af(i.Pe)?$E(a):qE(i.serializer,a)}(n,e)}function HR(n,e,t){return n instanceof hn?HE(n,e):n instanceof dn?WE(n,e):t}function GE(n,e){return n instanceof zn?function(r){return af(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var $n=class extends xi{},hn=class extends xi{constructor(e){super(),this.elements=e}};function HE(n,e){let t=KE(e);for(let r of n.elements)t.some(i=>Qt(i,r))||t.push(r);return{arrayValue:{values:t}}}var dn=class extends xi{constructor(e){super(),this.elements=e}};function WE(n,e){let t=KE(e);for(let r of n.elements)t=t.filter(i=>!Qt(i,r));return{arrayValue:{values:t}}}var zn=class extends xi{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function Rw(n){return pe(n.integerValue||n.doubleValue)}function KE(n){return Mo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Tr=class{constructor(e,t){this.field=e,this.transform=t}};function WR(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof hn&&i instanceof hn||r instanceof dn&&i instanceof dn?bi(r.elements,i.elements,Qt):r instanceof zn&&i instanceof zn?Qt(r.Pe,i.Pe):r instanceof $n&&i instanceof $n}(n.transform,e.transform)}var vf=class{constructor(e,t){this.version=e,this.transformResults=t}},ge=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Yu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var ki=class{};function QE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Hn(n.key,ge.none()):new Gn(n.key,n.data,ge.none());{let t=n.data,r=He.empty(),i=new ne(_e.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new xt(n.key,r,new ht(i.toArray()),ge.none())}}function KR(n,e,t){n instanceof Gn?function(i,s,o){let a=i.value.clone(),u=Pw(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof xt?function(i,s,o){if(!Yu(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=Pw(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(YE(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function bo(n,e,t,r){return n instanceof Gn?function(s,o,a,u){if(!Yu(s.precondition,o))return a;let c=s.value.clone(),l=xw(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof xt?function(s,o,a,u){if(!Yu(s.precondition,o))return a;let c=xw(s.fieldTransforms,u,o),l=o.data;return l.setAll(YE(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(s,o,a){return Yu(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function QR(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=GE(r.transform,i||null);s!=null&&(t===null&&(t=He.empty()),t.set(r.field,s))}return t||null}function Dw(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&bi(r,i,(s,o)=>WR(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Gn=class extends ki{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},xt=class extends ki{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function YE(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Pw(n,e,t){let r=new Map;P(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,HR(o,a,t[i]))}return r}function xw(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,GR(s,o,e))}return r}var Hn=class extends ki{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Oo=class extends ki{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Fo=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&KR(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=bo(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=bo(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=BE();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let u=QE(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(k.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),j())}isEqual(e){return this.batchId===e.batchId&&bi(this.mutations,e.mutations,(t,r)=>Dw(t,r))&&bi(this.baseMutations,e.baseMutations,(t,r)=>Dw(t,r))}},wf=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){P(e.mutations.length===r.length);let i=function(){return qR}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Lo=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Ef=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ie,H;function XE(n){switch(n){default:return S();case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return!1;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return!0}}function JE(n){if(n===void 0)return ye("GRPC error has no .code"),m.UNKNOWN;switch(n){case Ie.OK:return m.OK;case Ie.CANCELLED:return m.CANCELLED;case Ie.UNKNOWN:return m.UNKNOWN;case Ie.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case Ie.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case Ie.INTERNAL:return m.INTERNAL;case Ie.UNAVAILABLE:return m.UNAVAILABLE;case Ie.UNAUTHENTICATED:return m.UNAUTHENTICATED;case Ie.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case Ie.NOT_FOUND:return m.NOT_FOUND;case Ie.ALREADY_EXISTS:return m.ALREADY_EXISTS;case Ie.PERMISSION_DENIED:return m.PERMISSION_DENIED;case Ie.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case Ie.ABORTED:return m.ABORTED;case Ie.OUT_OF_RANGE:return m.OUT_OF_RANGE;case Ie.UNIMPLEMENTED:return m.UNIMPLEMENTED;case Ie.DATA_LOSS:return m.DATA_LOSS;default:return S()}}(H=Ie||(Ie={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";var kw=null;function ZE(){return new TextEncoder}var YR=new lr([4294967295,4294967295],0);function Vw(n){let e=ZE().encode(n),t=new dw;return t.update(e),new Uint8Array(t.digest())}function Nw(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new lr([t,r],0),new lr([i,s],0)]}var If=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new yr(`Invalid padding: ${t}`);if(r<0)throw new yr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new yr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new yr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=lr.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(lr.fromNumber(r)));return i.compare(YR)===1&&(i=new lr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Vw(e),[r,i]=Nw(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=Vw(e),[r,i]=Nw(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},yr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Uo=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,jo.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(k.min(),i,new ae(U),it(),j())}},jo=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,j(),j(),j())}};var Si=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},hc=class{constructor(e,t){this.targetId=e,this.me=t}},dc=class{constructor(e,t,r=Ve.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},fc=class{constructor(){this.fe=0,this.ge=Ow(),this.pe=Ve.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=j(),t=j(),r=j();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:S()}}),new jo(this.pe,this.ye,e,t,r)}ve(){this.we=!1,this.ge=Ow()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,P(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Tf=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=it(),this.qe=Mw(),this.Qe=new ae(U)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:S()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(uc(s))if(r===0){let o=new I(s.path);this.Ue(t,o,Se.newNoDocument(o,k.min()))}else P(r===1);else{let o=this.Ye(t);if(o!==r){let a=this.Ze(e),u=a?this.Xe(a,e,o):1;if(u!==0){this.je(t);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}kw?.et(function(l,h,d,f,E){var w,_,D,M,C,V;let L={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},z=h.unchangedNames;return z&&(L.bloomFilter={applied:E===0,hashCount:(w=z?.hashCount)!==null&&w!==void 0?w:0,bitmapLength:(M=(D=(_=z?.bits)===null||_===void 0?void 0:_.bitmap)===null||D===void 0?void 0:D.length)!==null&&M!==void 0?M:0,padding:(V=(C=z?.bits)===null||C===void 0?void 0:C.padding)!==null&&V!==void 0?V:0,mightContain:de=>{var et;return(et=f?.mightContain(de))!==null&&et!==void 0&&et}}),L}(o,e.me,this.Le.tt(),a,u))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=jn(r).toUint8Array()}catch(u){if(u instanceof sc)return _t("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new If(o,i,s)}catch(u){return _t(u instanceof yr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&uc(a.target)){let u=new I(a.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,Se.newNoDocument(u,e))}s.be&&(t.set(o,s.Ce()),s.ve())}});let r=j();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Je(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new Uo(e,t,this.Qe,this.ke,r);return this.ke=it(),this.qe=Mw(),this.Qe=new ae(U),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new fc,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ne(U),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||v("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new fc),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function Mw(){return new ae(I.comparator)}function Ow(){return new ae(I.comparator)}var XR={asc:"ASCENDING",desc:"DESCENDING"},JR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ZR={and:"AND",or:"OR"},Af=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Cf(n,e){return n.useProto3Json||Jo(e)?e:{value:e}}function Vi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function eI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function eD(n,e){return Vi(n,e.toTimestamp())}function ve(n){return P(!!n),k.fromTimestamp(function(t){let r=ln(t);return new he(r.seconds,r.nanos)}(n))}function Jp(n,e){return Sf(n,e).canonicalString()}function Sf(n,e){let t=function(i){return new W(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function tI(n){let e=W.fromString(n);return P(hI(e)),e}function Bo(n,e){return Jp(n.databaseId,e.path)}function Wt(n,e){let t=tI(e);if(t.get(1)!==n.databaseId.projectId)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new I(iI(t))}function nI(n,e){return Jp(n.databaseId,e)}function rI(n){let e=tI(n);return e.length===4?W.emptyPath():iI(e)}function bf(n){return new W(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function iI(n){return P(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Fw(n,e,t){return{name:Bo(n,e),fields:t.value.mapValue.fields}}function sI(n,e,t){let r=Wt(n,e.name),i=ve(e.updateTime),s=e.createTime?ve(e.createTime):k.min(),o=new He({mapValue:{fields:e.fields}}),a=Se.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function tD(n,e){return"found"in e?function(r,i){P(!!i.found),i.found.name,i.found.updateTime;let s=Wt(r,i.found.name),o=ve(i.found.updateTime),a=i.found.createTime?ve(i.found.createTime):k.min(),u=new He({mapValue:{fields:i.found.fields}});return Se.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){P(!!i.missing),P(!!i.readTime);let s=Wt(r,i.missing),o=ve(i.readTime);return Se.newNoDocument(s,o)}(n,e):S()}function nD(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:S()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(P(l===void 0||typeof l=="string"),Ve.fromBase64String(l||"")):(P(l===void 0||l instanceof Buffer||l instanceof Uint8Array),Ve.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){let l=c.code===void 0?m.UNKNOWN:JE(c.code);return new y(l,c.message||"")}(o);t=new dc(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Wt(n,r.document.name),s=ve(r.document.updateTime),o=r.document.createTime?ve(r.document.createTime):k.min(),a=new He({mapValue:{fields:r.document.fields}}),u=Se.newFoundDocument(i,s,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];t=new Si(c,l,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Wt(n,r.document),s=r.readTime?ve(r.readTime):k.min(),o=Se.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Si([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Wt(n,r.document),s=r.removedTargetIds||[];t=new Si([],s,i,null)}else{if(!("filter"in e))return S();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Ef(i,s),a=r.targetId;t=new hc(a,o)}}return t}function qo(n,e){let t;if(e instanceof Gn)t={update:Fw(n,e.key,e.value)};else if(e instanceof Hn)t={delete:Bo(n,e.key)};else if(e instanceof xt)t={update:Fw(n,e.key,e.data),updateMask:uD(e.fieldMask)};else{if(!(e instanceof Oo))return S();t={verify:Bo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof $n)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof hn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof dn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof zn)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw S()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:eD(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:S()}(n,e.precondition)),t}function Rf(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?ge.updateTime(ve(s.updateTime)):s.exists!==void 0?ge.exists(s.exists):ge.none()}(e.currentDocument):ge.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)P(a.setToServerValue==="REQUEST_TIME"),u=new $n;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];u=new hn(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];u=new dn(l)}else"increment"in a?u=new zn(o,a.increment):S();let c=_e.fromServerFormat(a.fieldPath);return new Tr(c,u)}(n,i)):[];if(e.update){e.update.name;let i=Wt(n,e.update.name),s=new He({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let c=u.fieldPaths||[];return new ht(c.map(l=>_e.fromServerFormat(l)))}(e.updateMask);return new xt(i,s,o,t,r)}return new Gn(i,s,t,r)}if(e.delete){let i=Wt(n,e.delete);return new Hn(i,t)}if(e.verify){let i=Wt(n,e.verify);return new Oo(i,t)}return S()}function rD(n,e){return n&&n.length>0?(P(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?ve(i.updateTime):ve(s);return o.isEqual(k.min())&&(o=ve(s)),new vf(o,i.transformResults||[])}(t,e))):[]}function oI(n,e){return{documents:[nI(n,e.path)]}}function aI(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=nI(n,i);let s=function(c){if(c.length!==0)return lI(J.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(l=>function(d){return{field:wi(d.field),direction:sD(d.dir)}}(l))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Cf(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:i}}function uI(n){let e=rI(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){P(r===1);let l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){let d=cI(h);return d instanceof J&&Qp(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(d=>function(E){return new Er(Ei(E.field),function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction))}(d))}(t.orderBy));let a=null;t.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,Jo(d)?null:d}(t.limit));let u=null;t.startAt&&(u=function(h){let d=!!h.before,f=h.values||[];return new Yt(f,d)}(t.startAt));let c=null;return t.endAt&&(c=function(h){let d=!h.before,f=h.values||[];return new Yt(f,d)}(t.endAt)),ME(e,i,o,s,a,"F",u,c)}function iD(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function cI(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Ei(t.unaryFilter.field);return G.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Ei(t.unaryFilter.field);return G.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Ei(t.unaryFilter.field);return G.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Ei(t.unaryFilter.field);return G.create(o,"!=",{nullValue:"NULL_VALUE"});default:return S()}}(n):n.fieldFilter!==void 0?function(t){return G.create(Ei(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return J.create(t.compositeFilter.filters.map(r=>cI(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return S()}}(t.compositeFilter.op))}(n):S()}function sD(n){return XR[n]}function oD(n){return JR[n]}function aD(n){return ZR[n]}function wi(n){return{fieldPath:n.canonicalString()}}function Ei(n){return _e.fromServerFormat(n.fieldPath)}function lI(n){return n instanceof G?function(t){if(t.op==="=="){if(ww(t.value))return{unaryFilter:{field:wi(t.field),op:"IS_NAN"}};if(vw(t.value))return{unaryFilter:{field:wi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(ww(t.value))return{unaryFilter:{field:wi(t.field),op:"IS_NOT_NAN"}};if(vw(t.value))return{unaryFilter:{field:wi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wi(t.field),op:oD(t.op),value:t.value}}}(n):n instanceof J?function(t){let r=t.getFilters().map(i=>lI(i));return r.length===1?r[0]:{compositeFilter:{op:aD(t.op),filters:r}}}(n):S()}function uD(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function hI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ni=class n{constructor(e,t,r,i,s=k.min(),o=k.min(),a=Ve.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var pc=class{constructor(e){this.ut=e}};function cD(n,e){let t;if(e.document)t=sI(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=I.fromSegments(e.noDocument.path),i=Cr(e.noDocument.readTime);t=Se.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return S();{let r=I.fromSegments(e.unknownDocument.path),i=Cr(e.unknownDocument.version);t=Se.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new he(i[0],i[1]);return k.fromTimestamp(s)}(e.readTime)),t}function Lw(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:gc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:Bo(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Vi(s,o.version.toTimestamp()),createTime:Vi(s,o.createTime.toTimestamp())}}(n.ut,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ar(e.version)};else{if(!e.isUnknownDocument())return S();r.unknownDocument={path:t.path.toArray(),version:Ar(e.version)}}return r}function gc(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ar(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Cr(n){let e=new he(n.seconds,n.nanoseconds);return k.fromTimestamp(e)}function pr(n,e){let t=(e.baseMutations||[]).map(s=>Rf(n.ut,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Rf(n.ut,s)),i=he.fromMillis(e.localWriteTimeMs);return new Fo(e.batchId,i,t,r)}function Ao(n){let e=Cr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Cr(n.lastLimboFreeSnapshotVersion):k.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return P(s.documents.length===1),Je(Gi(rI(s.documents[0])))}(n.query):function(s){return Je(uI(s))}(n.query),new Ni(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ve.fromBase64String(n.resumeToken))}function dI(n,e){let t=Ar(e.snapshotVersion),r=Ar(e.lastLimboFreeSnapshotVersion),i;i=uc(e.target)?oI(n.ut,e.target):aI(n.ut,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ir(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Zp(n){let e=uI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?lc(e,e.limit,"L"):e}function qd(n,e){return new Lo(e.largestBatchId,Rf(n.ut,e.overlayMutation))}function Uw(n,e){let t=e.path.lastSegment();return[n,Xe(e.path.popLast()),t]}function jw(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ar(r.readTime),documentKey:Xe(r.documentKey.path),largestBatchId:r.largestBatchId}}var Df=class{getBundleMetadata(e,t){return Bw(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Cr(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return Bw(e).put(function(i){return{bundleId:i.id,createTime:Ar(ve(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return qw(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:Zp(s.bundledQuery),readTime:Cr(s.readTime)}}(r)})}saveNamedQuery(e,t){return qw(e).put(function(i){return{name:i.name,readTime:Ar(ve(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function Bw(n){return Ne(n,"bundles")}function qw(n){return Ne(n,"namedQueries")}var mc=class n{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return vo(e).get(Uw(this.userId,t)).next(r=>r?qd(this.serializer,r):null)}getOverlays(e,t){let r=Gt();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Lo(t,o);i.push(this.lt(e,a))}),p.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Xe(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(vo(e).j("collectionPathOverlayIndex",a))}),p.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Gt(),s=Xe(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return vo(e).U("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=qd(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Gt(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return vo(e).J({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{let h=qd(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}lt(e,t){return vo(e).put(function(i,s,o){let[a,u,c]=Uw(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:qo(i.ut,o.mutation)}}(this.serializer,this.userId,t))}};function vo(n){return Ne(n,"documentOverlays")}var un=class{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(pe(e.integerValue));else if("doubleValue"in e){let r=pe(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),xo(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Tt(t,20),typeof r=="string"&&(r=ln(r)),t.dt(`${r.seconds||""}`),t.Et(r.nanos||0)}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(jn(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?RE(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):S()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){let r=e.fields||{};this.Tt(t,55);for(let i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){let r=e.values||[];this.Tt(t,50);for(let i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),I.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}};un.St=new un;function lD(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function $w(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=lD(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var Pf=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{let i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){let t=this.Lt(e),r=$w(t);this.Bt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){let t=this.Lt(e),r=$w(t);this.Bt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Bt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Lt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){let t=255&e;t===0?(this.Qt(0),this.Qt(255)):t===255?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){let t=255&e;t===0?(this.$t(0),this.$t(255)):t===255?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Bt(1),this.buffer[this.position++]=e}$t(e){this.Bt(1),this.buffer[this.position++]=~e}Bt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},xf=class{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}},kf=class{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}},gr=class{constructor(){this.Wt=new Pf,this.Gt=new xf(this.Wt),this.zt=new kf(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return e===0?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}};var mr=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function kn(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=zw(n.arrayValue,e.arrayValue),t!==0?t:(t=zw(n.directionalValue,e.directionalValue),t!==0?t:I.comparator(n.documentKey,e.documentKey)))}function zw(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var yc=class{constructor(e){this.Jt=new ne((t,r)=>_e.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(let t of e.filters){let r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(P(e.collectionGroup===this.collectionId),this.Xt)return!1;let t=Zd(e);if(t!==void 0&&!this.tn(t))return!1;let r=dr(e),i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){let a=this.Jt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.nn(a,u)||!this.rn(this.Yt[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Yt.length||!this.rn(this.Yt[o++],a))return!1}return!0}sn(){if(this.Xt)return null;let e=new ne(_e.comparator),t=[];for(let r of this.Zt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Ai(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ai(r.field,0))}for(let r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ai(r.field,r.dir==="asc"?0:1)));return new Ri(Ri.UNKNOWN_ID,this.collectionId,t,Po.empty())}tn(e){for(let t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function fI(n){var e,t;if(P(n instanceof G||n instanceof J),n instanceof G){if(n instanceof ac){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>G.create(n.field,"==",s)))||[];return J.create(i,"or")}return n}let r=n.filters.map(i=>fI(i));return J.create(r,n.op)}function hD(n){if(n.getFilters().length===0)return[];let e=Mf(fI(n));return P(pI(e)),Vf(e)||Nf(e)?[e]:e.getFilters()}function Vf(n){return n instanceof G}function Nf(n){return n instanceof J&&Qp(n)}function pI(n){return Vf(n)||Nf(n)||function(t){if(t instanceof J&&uf(t)){for(let r of t.getFilters())if(!Vf(r)&&!Nf(r))return!1;return!0}return!1}(n)}function Mf(n){if(P(n instanceof G||n instanceof J),n instanceof G)return n;if(n.filters.length===1)return Mf(n.filters[0]);let e=n.filters.map(r=>Mf(r)),t=J.create(e,n.op);return t=_c(t),pI(t)?t:(P(t instanceof J),P(Pi(t)),P(t.filters.length>1),t.filters.reduce((r,i)=>eg(r,i)))}function eg(n,e){let t;return P(n instanceof G||n instanceof J),P(e instanceof G||e instanceof J),t=n instanceof G?e instanceof G?function(i,s){return J.create([i,s],"and")}(n,e):Gw(n,e):e instanceof G?Gw(e,n):function(i,s){if(P(i.filters.length>0&&s.filters.length>0),Pi(i)&&Pi(s))return kE(i,s.getFilters());let o=uf(i)?i:s,a=uf(i)?s:i,u=o.filters.map(c=>eg(c,a));return J.create(u,"or")}(n,e),_c(t)}function Gw(n,e){if(Pi(e))return kE(e,n.getFilters());{let t=e.filters.map(r=>eg(n,r));return J.create(t,"or")}}function _c(n){if(P(n instanceof G||n instanceof J),n instanceof G)return n;let e=n.getFilters();if(e.length===1)return _c(e[0]);if(PE(n))return n;let t=e.map(i=>_c(i)),r=[];return t.forEach(i=>{i instanceof G?r.push(i):i instanceof J&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:J.create(r,n.op)}var Of=class{constructor(){this.on=new $o}addToCollectionParentIndex(e,t){return this.on.add(t),p.resolve()}getCollectionParents(e,t){return p.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return p.resolve()}deleteFieldIndex(e,t){return p.resolve()}deleteAllFieldIndexes(e){return p.resolve()}createTargetIndexes(e,t){return p.resolve()}getDocumentsMatchingTarget(e,t){return p.resolve(null)}getIndexType(e,t){return p.resolve(0)}getFieldIndexes(e,t){return p.resolve([])}getNextCollectionGroupToUpdate(e){return p.resolve(null)}getMinOffset(e,t){return p.resolve(vt.min())}getMinOffsetFromCollectionGroup(e,t){return p.resolve(vt.min())}updateCollectionGroup(e,t,r){return p.resolve()}updateIndexEntries(e,t){return p.resolve()}},$o=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ne(W.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ne(W.comparator)).toArray()}};var $u=new Uint8Array(0),Ff=class{constructor(e,t){this.databaseId=t,this._n=new $o,this.an=new Xt(r=>Ir(r),(r,i)=>Zo(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});let s={collectionId:r,parent:Xe(i)};return Hw(e).put(s)}return p.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[gE(t),""],!1,!0);return Hw(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(zt(o.parent))}return r})}addFieldIndex(e,t){let r=wo(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=mi(e);return s.next(a=>{o.put(jw(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=wo(e),i=mi(e),s=gi(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=wo(e),r=gi(e),i=mi(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return p.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new yc(r).sn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=gi(e),i=!0,s=new Map;return p.forEach(this.un(t),o=>this.cn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=j(),a=[];return p.forEach(s,(u,c)=>{v("IndexedDbIndexManager",`Using index ${function(C){return`id=${C.indexId}|cg=${C.collectionGroup}|f=${C.fields.map(V=>`${V.fieldPath}:${V.kind}`).join(",")}`}(u)} to execute ${Ir(t)}`);let l=function(C,V){let L=Zd(V);if(L===void 0)return null;for(let z of cc(C,L.fieldPath))switch(z.op){case"array-contains-any":return z.value.arrayValue.values||[];case"array-contains":return[z.value]}return null}(c,u),h=function(C,V){let L=new Map;for(let z of dr(V))for(let de of cc(C,z.fieldPath))switch(de.op){case"==":case"in":L.set(z.fieldPath.canonicalString(),de.value);break;case"not-in":case"!=":return L.set(z.fieldPath.canonicalString(),de.value),Array.from(L.values())}return null}(c,u),d=function(C,V){let L=[],z=!0;for(let de of dr(V)){let et=de.kind===0?Cw(C,de.fieldPath,C.startAt):Sw(C,de.fieldPath,C.startAt);L.push(et.value),z&&(z=et.inclusive)}return new Yt(L,z)}(c,u),f=function(C,V){let L=[],z=!0;for(let de of dr(V)){let et=de.kind===0?Sw(C,de.fieldPath,C.endAt):Cw(C,de.fieldPath,C.endAt);L.push(et.value),z&&(z=et.inclusive)}return new Yt(L,z)}(c,u),E=this.ln(u,c,d),w=this.ln(u,c,f),_=this.hn(u,c,h),D=this.Pn(u.indexId,l,E,d.inclusive,w,f.inclusive,_);return p.forEach(D,M=>r.G(M,t.limit).next(C=>{C.forEach(V=>{let L=I.fromSegments(V.documentKey);o.has(L)||(o=o.add(L),a.push(L))})}))}).next(()=>a)}return p.resolve(null)})}un(e){let t=this.an.get(e);return t||(e.filters.length===0?t=[e]:t=hD(J.create(e.filters,"and")).map(r=>yf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,o,a){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),c=u/(t!=null?t.length:1),l=[];for(let h=0;h<u;++h){let d=t?this.In(t[h/c]):$u,f=this.Tn(e,d,r[h%c],i),E=this.En(e,d,s[h%c],o),w=a.map(_=>this.Tn(e,d,_,!0));l.push(...this.createRange(f,E,w))}return l}Tn(e,t,r,i){let s=new mr(e,I.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){let s=new mr(e,I.empty(),t,r);return i?s.Ht():s}cn(e,t){let r=new yc(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.en(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.un(t);return p.forEach(i,s=>this.cn(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new ne(_e.comparator),l=!1;for(let h of u.filters)for(let d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:c=c.add(d.field));for(let h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}dn(e,t){let r=new gr;for(let i of dr(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.jt(i.kind);un.St.ht(s,o)}return r.Ut()}In(e){let t=new gr;return un.St.ht(e,t.jt(0)),t.Ut()}An(e,t){let r=new gr;return un.St.ht(wr(this.databaseId,t),r.jt(function(s){let o=dr(s);return o.length===0?0:o[o.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(r===null)return[];let i=[];i.push(new gr);let s=0;for(let o of dr(e)){let a=r[s++];for(let u of i)if(this.Rn(t,o.fieldPath)&&Mo(a))i=this.Vn(i,o,a);else{let c=u.jt(o.kind);un.St.ht(a,c)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new gr;u.seed(a.Ut()),un.St.ht(o,u.jt(t.kind)),s.push(u)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof G&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=wo(e),i=mi(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{let o=[];return p.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){let d=h?new Po(h.sequenceNumber,new vt(Cr(h.readTime),new I(zt(h.documentKey)),h.largestBatchId)):Po.empty(),f=l.fields.map(([E,w])=>new Ai(_e.fromServerFormat(E),w));return new Ri(l.indexId,l.collectionGroup,f,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:U(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=wo(e),s=mi(e);return this.fn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>p.forEach(a,u=>s.put(jw(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return p.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?p.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),p.forEach(a,u=>this.gn(e,i,u).next(c=>{let l=this.pn(s,u);return c.isEqual(l)?p.resolve():this.yn(e,s,u,c,l)}))))})}wn(e,t,r,i){return gi(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return gi(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){let i=gi(e),s=new ne(kn);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(o,a)=>{s=s.add(new mr(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}pn(e,t){let r=new ne(kn),i=this.dn(t,e);if(i==null)return r;let s=Zd(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Mo(o))for(let a of o.arrayValue.values||[])r=r.add(new mr(t.indexId,e.key,this.In(a),i))}else r=r.add(new mr(t.indexId,e.key,$u,i));return r}yn(e,t,r,i,s){v("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,c,l,h,d){let f=u.getIterator(),E=c.getIterator(),w=pi(f),_=pi(E);for(;w||_;){let D=!1,M=!1;if(w&&_){let C=l(w,_);C<0?M=!0:C>0&&(D=!0)}else w!=null?M=!0:D=!0;D?(h(_),_=pi(E)):M?(d(w),w=pi(f)):(w=pi(f),_=pi(E))}}(i,s,kn,a=>{o.push(this.wn(e,t,r,a))},a=>{o.push(this.Sn(e,t,r,a))}),p.waitFor(o)}fn(e){let t=1;return mi(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>kn(o,a)).filter((o,a,u)=>!a||kn(o,u[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=kn(o,e),u=kn(o,t);if(a===0)i[0]=e.Ht();else if(a>0&&u<0)i.push(o),i.push(o.Ht());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.bn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,$u,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,$u,[]];s.push(IDBKeyRange.bound(a,u))}return s}bn(e,t){return kn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Ww)}getMinOffset(e,t){return p.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||S())).next(Ww)}};function Hw(n){return Ne(n,"collectionParents")}function gi(n){return Ne(n,"indexEntries")}function wo(n){return Ne(n,"indexConfiguration")}function mi(n){return Ne(n,"indexState")}function Ww(n){P(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Hp(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new vt(e.readTime,e.documentKey,t)}var Kw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},yt=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function gI(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,u=r.J({range:o},(l,h,d)=>(a++,d.delete()));s.push(u.next(()=>{P(a===1)}));let c=[];for(let l of t.mutations){let h=EE(e,l.key.path,t.batchId);s.push(i.delete(h)),c.push(l.key)}return p.waitFor(s).next(()=>c)}function vc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw S();e=n.noDocument}return JSON.stringify(e).length}yt.DEFAULT_COLLECTION_PERCENTILE=10,yt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yt.DEFAULT=new yt(41943040,yt.DEFAULT_COLLECTION_PERCENTILE,yt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yt.DISABLED=new yt(-1,0,0);var wc=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){P(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Vn(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Ii(e),o=Vn(e);return o.add({}).next(a=>{P(typeof a=="number");let u=new Fo(a,t,r,i),c=function(f,E,w){let _=w.baseMutations.map(M=>qo(f.ut,M)),D=w.mutations.map(M=>qo(f.ut,M));return{userId:E,batchId:w.batchId,localWriteTimeMs:w.localWriteTime.toMillis(),baseMutations:_,mutations:D}}(this.serializer,this.userId,u),l=[],h=new ne((d,f)=>U(d.canonicalString(),f.canonicalString()));for(let d of i){let f=EE(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(s.put(f,_R))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.Dn[a]=u.keys()}),p.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return Vn(e).get(t).next(r=>r?(P(r.userId===this.userId),pr(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?p.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Vn(e).J({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(P(a.batchId>=r),s=pr(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Vn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Vn(e).U("userMutationsIndex",t).next(r=>r.map(i=>pr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Wu(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Ii(e).J({range:i},(o,a,u)=>{let[c,l,h]=o,d=zt(l);if(c===this.userId&&t.path.isEqual(d))return Vn(e).get(h).next(f=>{if(!f)throw S();P(f.userId===this.userId),s.push(pr(this.serializer,f))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ne(U),i=[];return t.forEach(s=>{let o=Wu(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=Ii(e).J({range:a},(c,l,h)=>{let[d,f,E]=c,w=zt(f);d===this.userId&&s.path.isEqual(w)?r=r.add(E):h.done()});i.push(u)}),p.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Wu(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new ne(U);return Ii(e).J({range:o},(u,c,l)=>{let[h,d,f]=u,E=zt(d);h===this.userId&&r.isPrefixOf(E)?E.length===i&&(a=a.add(f)):l.done()}).next(()=>this.vn(e,a))}vn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Vn(e).get(s).next(o=>{if(o===null)throw S();P(o.userId===this.userId),r.push(pr(this.serializer,o))}))}),p.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return gI(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),p.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return p.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Ii(e).J({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=zt(s[1]);i.push(u)}else a.done()}).next(()=>{P(i.length===0)})})}containsKey(e,t){return mI(e,this.userId,t)}Mn(e){return yI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function mI(n,e,t){let r=Wu(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Ii(n).J({range:s,H:!0},(a,u,c)=>{let[l,h,d]=a;l===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function Vn(n){return Ne(n,"mutations")}function Ii(n){return Ne(n,"documentMutations")}function yI(n){return Ne(n,"mutationQueues")}var Mi=class n{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new n(0)}static Nn(){return new n(-1)}};var Lf=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next(t=>{let r=new Mi(t.highestTargetId);return t.highestTargetId=r.next(),this.Bn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ln(e).next(t=>k.fromTimestamp(new he(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ln(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Ln(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Bn(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Ln(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Bn(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>yi(e).delete(t.targetId)).next(()=>this.Ln(e)).next(r=>(P(r.targetCount>0),r.targetCount-=1,this.Bn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return yi(e).J((o,a)=>{let u=Ao(a);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>p.waitFor(s)).next(()=>i)}forEachTarget(e,t){return yi(e).J((r,i)=>{let s=Ao(i);t(s)})}Ln(e){return Qw(e).get("targetGlobalKey").next(t=>(P(t!==null),t))}Bn(e,t){return Qw(e).put("targetGlobalKey",t)}kn(e,t){return yi(e).put(dI(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Ln(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Ir(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return yi(e).J({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=Ao(a);Zo(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Nn(e);return t.forEach(o=>{let a=Xe(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),p.waitFor(i)}removeMatchingKeys(e,t,r){let i=Nn(e);return p.forEach(t,s=>{let o=Xe(s.path);return p.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Nn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Nn(e),s=j();return i.J({range:r,H:!0},(o,a,u)=>{let c=zt(o[1]),l=new I(c);s=s.add(l)}).next(()=>s)}containsKey(e,t){let r=Xe(t.path),i=IDBKeyRange.bound([r],[gE(r)],!1,!0),s=0;return Nn(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}ot(e,t){return yi(e).get(t).next(r=>r?Ao(r):null)}};function yi(n){return Ne(n,"targets")}function Qw(n){return Ne(n,"targetGlobal")}function Nn(n){return Ne(n,"targetDocuments")}function Yw([n,e],[t,r]){let i=U(n,t);return i===0?U(e,r):i}var Uf=class{constructor(e){this.Qn=e,this.buffer=new ne(Yw),this.Kn=0}$n(){return++this.Kn}Un(e){let t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Yw(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},jf=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return this.Wn!==null}Gn(e){v("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>g(this,null,function*(){this.Wn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Qn(t)?v("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Kn(t)}yield this.Gn(3e5)}))}},Bf=class{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return p.resolve(lt.oe);let r=new Uf(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(v("LruGarbageCollector","Garbage collection skipped; disabled"),p.resolve(Kw)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Kw):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,o,a,u,c,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(v("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),_i()<=Ft.DEBUG&&v("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${h} documents in `+(c-u)+`ms
Total Duration: ${c-l}ms`),p.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}};function dD(n,e){return new Bf(n,e)}var qf=class{constructor(e,t){this.db=e,this.garbageCollector=dD(this,t)}jn(e){let t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return zu(e,r)}removeReference(e,t,r){return zu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return zu(e,t)}Xn(e,t){return function(i,s){let o=!1;return yI(i).Y(a=>mI(i,a,s).next(u=>(u&&(o=!0),p.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Zn(e,(o,a)=>{if(a<=t){let u=this.Xn(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,k.min()),Nn(e).delete(function(h){return[0,Xe(h.path)]}(o))))});i.push(u)}}).next(()=>p.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return zu(e,t)}Zn(e,t){let r=Nn(e),i,s=lt.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==lt.oe&&t(new I(zt(i)),s),s=c,i=u):s=lt.oe}).next(()=>{s!==lt.oe&&t(new I(zt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function zu(n,e){return Nn(n).put(function(r,i){return{targetId:0,path:Xe(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var Ec=class{constructor(){this.changes=new Xt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Se.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?p.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var $f=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return hr(e).put(r)}removeEntry(e,t,r){return hr(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],gc(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=Se.newInvalidDocument(t);return hr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Eo(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:Se.newInvalidDocument(t)};return hr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Eo(t))},(i,s)=>{r={document:this.tr(t,s),size:vc(s)}}).next(()=>r)}getEntries(e,t){let r=it();return this.rr(e,t,(i,s)=>{let o=this.tr(i,s);r=r.insert(i,o)}).next(()=>r)}ir(e,t){let r=it(),i=new ae(I.comparator);return this.rr(e,t,(s,o)=>{let a=this.tr(s,o);r=r.insert(s,a),i=i.insert(s,vc(o))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return p.resolve();let i=new ne(Zw);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(Eo(i.first()),Eo(i.last())),o=i.getIterator(),a=o.getNext();return hr(e).J({index:"documentKeyIndex",range:s},(u,c,l)=>{let h=I.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Zw(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.$(Eo(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),gc(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return hr(e).U(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=it();for(let h of c){let d=this.tr(I.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(ta(t,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(e,t,r,i){let s=it(),o=Jw(t,r),a=Jw(t,vt.max());return hr(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{let h=this.tr(I.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new zf(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Xw(e).get("remoteDocumentGlobalKey").next(t=>(P(!!t),t))}er(e,t){return Xw(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){let r=cD(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(k.min())))return r}return Se.newInvalidDocument(e)}};function _I(n){return new $f(n)}var zf=class extends Ec{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new Xt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new ne((s,o)=>U(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,a.readTime)),o.isValidDocument()){let u=Lw(this._r.serializer,o);i=i.add(s.path.popLast());let c=vc(u);r+=c-a.size,t.push(this._r.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){let u=Lw(this._r.serializer,o.convertToNoDocument(k.min()));t.push(this._r.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),p.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,o)=>{this.ar.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function Xw(n){return Ne(n,"remoteDocumentGlobal")}function hr(n){return Ne(n,"remoteDocumentsV14")}function Eo(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Jw(n,e){let t=e.documentKey.path.toArray();return[n,gc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Zw(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=U(t[s],r[s]),i)return i;return i=U(t.length,r.length),i||(i=U(t[t.length-2],r[r.length-2]),i||U(t[t.length-1],r[r.length-1]))}var Gf=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Ic=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&bo(r.mutation,i,ht.empty(),he.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,j()).next(()=>r))}getLocalViewOfDocuments(e,t,r=j()){let i=Gt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=To();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Gt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,j()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=it(),o=So(),a=function(){return So()}();return t.forEach((u,c)=>{let l=r.get(c.key);i.has(c.key)&&(l===void 0||l.mutation instanceof xt)?s=s.insert(c.key,c):l!==void 0?(o.set(c.key,l.mutation.getFieldMask()),bo(l.mutation,c,l.mutation.getFieldMask(),he.now())):o.set(c.key,ht.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new Gf(l,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){let r=So(),i=new ae((o,a)=>o-a),s=j();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=t.get(u);if(c===null)return;let l=r.get(u)||ht.empty();l=a.applyToLocalView(c,l),r.set(u,l);let h=(i.get(a.batchId)||j()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,l=u.value,h=BE();l.forEach(d=>{if(!s.has(d)){let f=QE(t.get(d),r.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return p.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return I.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Yp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):p.resolve(Gt()),a=-1,u=s;return o.next(c=>p.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?p.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,j())).next(l=>({batchId:a,changes:jE(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new I(t)).next(r=>{let i=To();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=To();return this.indexManager.getCollectionParents(e,s).next(a=>p.forEach(a,u=>{let c=function(h,d){return new Pt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{let l=c.getKey();o.get(l)===null&&(o=o.insert(l,Se.newInvalidDocument(l)))});let a=To();return o.forEach((u,c)=>{let l=s.get(u);l!==void 0&&bo(l.mutation,c,ht.empty(),he.now()),ta(t,c)&&(a=a.insert(u,c))}),a})}};var Hf=class{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return p.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,function(i){return{id:i.id,version:i.version,createTime:ve(i.createTime)}}(t)),p.resolve()}getNamedQuery(e,t){return p.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,function(i){return{name:i.name,query:Zp(i.bundledQuery),readTime:ve(i.readTime)}}(t)),p.resolve()}};var Wf=class{constructor(){this.overlays=new ae(I.comparator),this.lr=new Map}getOverlay(e,t){return p.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Gt();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),p.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),p.resolve()}getOverlaysForCollection(e,t,r){let i=Gt(),s=t.length+1,o=new I(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return p.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ae((c,l)=>c-l),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=s.get(c.largestBatchId);l===null&&(l=Gt(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}let a=Gt(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return p.resolve(a)}lt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Lo(t,r));let s=this.lr.get(t);s===void 0&&(s=j(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}};var zo=class{constructor(){this.hr=new ne(Te.Pr),this.Ir=new ne(Te.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){let r=new Te(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new Te(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){let t=new I(new W([])),r=new Te(t,e),i=new Te(t,e+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){let t=new I(new W([])),r=new Te(t,e),i=new Te(t,e+1),s=j();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Te(e,0),r=this.hr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Te=class{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return I.comparator(e.key,t.key)||U(e.gr,t.gr)}static Tr(e,t){return U(e.gr,t.gr)||I.comparator(e.key,t.key)}};var Kf=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new ne(Te.Pr)}checkEmpty(e){return p.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Fo(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.yr=this.yr.add(new Te(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return p.resolve(o)}lookupMutationBatch(e,t){return p.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Sr(r),s=i<0?0:i;return p.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return p.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(e){return p.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Te(t,0),i=new Te(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{let a=this.wr(o.gr);s.push(a)}),p.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ne(U);return t.forEach(i=>{let s=new Te(i,0),o=new Te(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],a=>{r=r.add(a.gr)})}),p.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;I.isDocumentKey(s)||(s=s.child(""));let o=new Te(new I(s),0),a=new ne(U);return this.yr.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.gr)),!0)},o),p.resolve(this.br(a))}br(e){let t=[];return e.forEach(r=>{let i=this.wr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){P(this.Dr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.yr;return p.forEach(t.mutations,i=>{let s=new Te(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){let r=new Te(t,0),i=this.yr.firstAfterOrEqual(r);return p.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,p.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}wr(e){let t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Qf=class{constructor(e){this.Cr=e,this.docs=function(){return new ae(I.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return p.resolve(r?r.document.mutableCopy():Se.newInvalidDocument(t))}getEntries(e,t){let r=it();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Se.newInvalidDocument(i))}),p.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=it(),o=t.path,a=new I(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Hp(yE(l),r)<=0||(i.has(l.key)||ta(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return p.resolve(s)}getAllFromCollectionGroup(e,t,r,i){S()}vr(e,t){return p.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Yf(this)}getSize(e){return p.resolve(this.size)}},Yf=class extends Ec{constructor(e){super(),this._r=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),p.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}};var Xf=class{constructor(e){this.persistence=e,this.Fr=new Xt(t=>Ir(t),Zo),this.lastRemoteSnapshotVersion=k.min(),this.highestTargetId=0,this.Mr=0,this.Or=new zo,this.targetCount=0,this.Nr=Mi.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),p.resolve()}getLastRemoteSnapshotVersion(e){return p.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return p.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),p.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),p.resolve()}kn(e){this.Fr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Nr=new Mi(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,p.resolve()}updateTargetData(e,t){return this.kn(t),p.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,p.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),p.waitFor(s).next(()=>i)}getTargetCount(e){return p.resolve(this.targetCount)}getTargetData(e,t){let r=this.Fr.get(t)||null;return p.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),p.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),p.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),p.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Or.mr(t);return p.resolve(r)}containsKey(e,t){return p.resolve(this.Or.containsKey(t))}};var Tc=class{constructor(e,t){this.Lr={},this.overlays={},this.Br=new lt(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new Xf(this),this.indexManager=new Of,this.remoteDocumentCache=function(i){return new Qf(i)}(r=>this.referenceDelegate.Qr(r)),this.serializer=new pc(t),this.Kr=new Hf(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Wf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Lr[e.toKey()];return r||(r=new Kf(t,this.referenceDelegate),this.Lr[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){v("MemoryPersistence","Starting transaction:",e);let i=new Jf(this.Br.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return p.or(Object.values(this.Lr).map(r=>()=>r.containsKey(e,t)))}},Jf=class extends nc{constructor(e){super(),this.currentSequenceNumber=e}},Ac=class n{constructor(e){this.persistence=e,this.Gr=new zo,this.zr=null}static jr(e){return new n(e)}get Hr(){if(this.zr)return this.zr;throw S()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),p.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),p.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),p.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return p.forEach(this.Hr,r=>{let i=I.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,k.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return p.or([()=>p.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}};var Zf=class{constructor(e){this.serializer=e}O(e,t,r,i){let s=new rc("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",mw,{unique:!0}),u.createObjectStore("documentMutations")}(e),eE(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=p.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),eE(e)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:k.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",mw,{unique:!0});let h=c.store("mutations"),d=l.map(f=>h.put(f));return p.waitFor(d)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.Zr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(o=o.next(()=>this.ei(s))),r<8&&i>=8&&(o=o.next(()=>this.ti(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.ni(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:PR});c.createIndex("collectionPathOverlayIndex",xR,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",kR,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:vR});c.createIndex("documentKeyIndex",wR),c.createIndex("collectionGroupIndex",ER)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ii(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:SR}).createIndex("sequenceNumberIndex",bR,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:RR}).createIndex("documentKeyIndex",DR,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),o}Xr(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=vc(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>p.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>p.forEach(a,u=>{P(u.userId===s.userId);let c=pr(this.serializer,u);return gI(e,s.userId,c).next(()=>{})}))}))}ei(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,a)=>{let u=new W(o),c=function(h){return[0,Xe(h)]}(u);s.push(t.get(c).next(l=>l?p.resolve():(h=>t.put({targetId:0,path:Xe(h),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>p.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:CR});let r=t.store("collectionParents"),i=new $o,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Xe(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let u=new W(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],c)=>{let l=zt(a);return s(l.popLast())}))}ni(e){let t=e.store("targets");return t.J((r,i)=>{let s=Ao(i),o=dI(this.serializer,s);return t.put(o)})}ri(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{let a=t.store("remoteDocumentsV14"),u=function(h){return h.document?new I(W.fromString(h.document.name).popFirst(5)):h.noDocument?I.fromSegments(h.noDocument.path):h.unknownDocument?I.fromSegments(h.unknownDocument.path):S()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>p.waitFor(i))}ii(e,t){let r=t.store("mutations"),i=_I(this.serializer),s=new Tc(Ac.jr,this.serializer.ut);return r.U().next(o=>{let a=new Map;return o.forEach(u=>{var c;let l=(c=a.get(u.userId))!==null&&c!==void 0?c:j();pr(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),p.forEach(a,(u,c)=>{let l=new Ae(c),h=mc.ct(this.serializer,l),d=s.getIndexManager(l),f=wc.ct(l,this.serializer,d,s.referenceDelegate);return new Ic(i,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new ko(t,lt.oe),u).next()})})}};function eE(n){n.createObjectStore("targetDocuments",{keyPath:TR}).createIndex("documentTargetsIndex",AR,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",IR,{unique:!0}),n.createObjectStore("targetGlobal")}var $d="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ep=class n{constructor(e,t,r,i,s,o,a,u,c,l,h=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=o,this.document=a,this.oi=c,this._i=l,this.ai=h,this.Br=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=d=>Promise.resolve(),!n.D())throw new y(m.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new qf(this,i),this.Ii=t+"main",this.serializer=new pc(u),this.Ti=new Un(this.Ii,this.ai,new Zf(this.serializer)),this.qr=new Lf(this.referenceDelegate,this.serializer),this.remoteDocumentCache=_I(this.serializer),this.Kr=new Df,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,l===!1&&ye("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,$d);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Br=new lt(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){return this.Pi=t=>g(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(t=>g(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget(()=>g(this,null,function*(){this.started&&(yield this.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Gu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if(Qn(e))return v("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return v("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return Io(e).get("owner").next(t=>p.resolve(this.wi(t)))}Si(e){return Gu(e).delete(this.clientId)}bi(){return g(this,null,function*(){if(this.isPrimary&&!this.Di(this.hi,18e5)){this.hi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=Ne(t,"clientMetadata");return r.U().next(i=>{let s=this.Ci(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return p.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ei)for(let t of e)this.Ei.removeItem(this.vi(t.clientId))}})}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?p.resolve(!0):Io(e).get("owner").next(t=>{if(t!==null&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,$d);return!1}}return!(!this.networkEnabled||!this.inForeground)||Gu(e).U().next(r=>this.Ci(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&v("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return g(this,null,function*(){this.kr=!1,this.Mi(),this.li&&(this.li.cancel(),this.li=null),this.xi(),this.Oi(),yield this.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new ko(e,lt.oe);return this.pi(t).next(()=>this.Si(t))}),this.Ti.close(),this.Ni()})}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",e=>Gu(e).U().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return wc.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Ff(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return mc.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){v("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===16?NR:u===15?CE:u===14?AE:u===13?TE:u===12?VR:u===11?IE:void S()}(this.ai),o;return this.Ti.runTransaction(e,i,s,a=>(o=new ko(a,this.Br?this.Br.next():lt.oe),t==="readwrite-primary"?this.fi(o).next(u=>!!u||this.gi(o)).next(u=>{if(!u)throw ye(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new y(m.FAILED_PRECONDITION,_E);return r(o)}).next(u=>this.yi(o).next(()=>u)):this.Bi(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Bi(e){return Io(e).get("owner").next(t=>{if(t!==null&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new y(m.FAILED_PRECONDITION,$d)})}yi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Io(e).put("owner",t)}static D(){return Un.D()}pi(e){let t=Io(e);return t.get("owner").next(r=>this.wi(r)?(v("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):p.resolve())}Di(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(ye(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ai(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground=this.document.visibilityState==="visible")}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ui=()=>{this.Mi();let t=/(?:Version|Mobile)\/1[456]/;Nl()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{let r=((t=this.Ei)===null||t===void 0?void 0:t.getItem(this.vi(e)))!==null;return v("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ye("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){ye("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Io(n){return Ne(n,"owner")}function Gu(n){return Ne(n,"clientMetadata")}function tg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var tp=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=j(),i=j();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var np=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Cc=class{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=function(){return Nl()?8:vE(ys())>0?6:4}()}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.zi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new np;return this.Hi(e,t,o).next(a=>{if(s.result=a,this.$i)return this.Ji(e,t,o,a.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(_i()<=Ft.DEBUG&&v("QueryEngine","SDK will not create cache indexes for query:",vi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),p.resolve()):(_i()<=Ft.DEBUG&&v("QueryEngine","Query:",vi(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(_i()<=Ft.DEBUG&&v("QueryEngine","The SDK decides to create cache indexes for query:",vi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Je(t))):p.resolve())}zi(e,t){if(bw(t))return p.resolve(null);let r=Je(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=lc(t,null,"F"),r=Je(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=j(...s);return this.Gi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{let c=this.Yi(t,a);return this.Zi(t,c,o,u.readTime)?this.zi(e,lc(t,null,"F")):this.Xi(e,c,t,u)}))})))}ji(e,t,r,i){return bw(t)||i.isEqual(k.min())?p.resolve(null):this.Gi.getDocuments(e,r).next(s=>{let o=this.Yi(t,s);return this.Zi(t,o,r,i)?p.resolve(null):(_i()<=Ft.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),vi(t)),this.Xi(e,o,t,mE(i,-1)).next(a=>a))})}Yi(e,t){let r=new ne(LE(e));return t.forEach((i,s)=>{ta(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return _i()<=Ft.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",vi(t)),this.Gi.getDocumentsMatchingQuery(e,t,vt.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var rp=class{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new ae(U),this.ns=new Xt(s=>Ir(s),Zo),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ic(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}};function vI(n,e,t,r){return new rp(n,e,t,r)}function wI(n,e){return g(this,null,function*(){let t=T(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=j();for(let c of i){o.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}for(let c of s){a.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({_s:c,removedBatchIds:o,addedBatchIds:a}))})})})}function fD(n,e){let t=T(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){let h=c.batch,d=h.keys(),f=p.resolve();return d.forEach(E=>{f=f.next(()=>l.getEntry(u,E)).next(w=>{let _=c.docVersions.get(E);P(_!==null),w.version.compareTo(_)<0&&(h.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),l.addEntry(w)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=j();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function EI(n){let e=T(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function pD(n,e){let t=T(n),r=e.snapshotVersion,i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;let a=[];e.targetChanges.forEach((l,h)=>{let d=i.get(h);if(!d)return;a.push(t.qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.qr.addMatchingKeys(s,l.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?f=f.withResumeToken(Ve.EMPTY_BYTE_STRING,k.min()).withLastLimboFreeSnapshotVersion(k.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,r)),i=i.insert(h,f),function(w,_,D){return w.resumeToken.approximateByteSize()===0||_.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0}(d,f,l)&&a.push(t.qr.updateTargetData(s,f))});let u=it(),c=j();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(II(s,o,e.documentUpdates).next(l=>{u=l.us,c=l.cs})),!r.isEqual(k.min())){let l=t.qr.getLastRemoteSnapshotVersion(s).next(h=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return p.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.ts=i,s))}function II(n,e,t){let r=j(),i=j();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=it();return t.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(k.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):v("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{us:o,cs:i}})}function gD(n,e){let t=T(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Oi(n,e){let t=T(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,p.resolve(i)):t.qr.allocateTargetId(r).next(o=>(i=new Ni(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}function Fi(n,e,t){return g(this,null,function*(){let r=T(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Qn(o))throw o;v("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)})}function Sc(n,e,t){let r=T(n),i=k.min(),s=j();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){let h=T(u),d=h.ns.get(l);return d!==void 0?p.resolve(h.ts.get(d)):h.qr.getTargetData(c,l)}(r,o,Je(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.es.getDocumentsMatchingQuery(o,e,t?i:k.min(),t?s:j())).next(a=>(CI(r,FE(e),a),{documents:a,ls:s})))}function TI(n,e){let t=T(n),r=T(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function AI(n,e){let t=T(n),r=t.rs.get(e)||k.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,mE(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(CI(t,e,i),i))}function CI(n,e,t){let r=n.rs.get(e)||k.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}function mD(n,e,t,r){return g(this,null,function*(){let i=T(n),s=j(),o=it();for(let c of t){let l=e.hs(c.metadata.name);c.document&&(s=s.add(l));let h=e.Ps(c);h.setReadTime(e.Is(c.metadata.readTime)),o=o.insert(l,h)}let a=i.ss.newChangeBuffer({trackRemovals:!0}),u=yield Oi(i,function(l){return Je(Gi(W.fromString(`__bundle__/docs/${l}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>II(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.us,l.cs)).next(()=>l.us)))})}function yD(r,i){return g(this,arguments,function*(n,e,t=j()){let s=yield Oi(n,Je(Zp(e.bundledQuery))),o=T(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=ve(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.Kr.saveNamedQuery(a,e);let c=s.withResumeToken(Ve.EMPTY_BYTE_STRING,u);return o.ts=o.ts.insert(c.targetId,c),o.qr.updateTargetData(a,c).next(()=>o.qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.qr.addMatchingKeys(a,t,s.targetId)).next(()=>o.Kr.saveNamedQuery(a,e))})})}function tE(n,e){return`firestore_clients_${n}_${e}`}function nE(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function zd(n,e){return`firestore_targets_${n}_${e}`}var bc=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new y(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(ye("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ro=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new y(r.error.code,r.error.message))),s?new n(e,r.state,i):(ye("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Rc=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Xp();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=wE(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(ye("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},ip=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(ye("SharedClientState",`Failed to parse online state: ${e}`),null)}},Go=class{constructor(){this.activeTargetIds=Xp()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Do=class{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new ae(U),this.started=!1,this.ps=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=tE(this.persistenceKey,this.Rs),this.ws=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.gs=this.gs.insert(this.Rs,new Go),this.Ss=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Cs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.vs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}start(){return g(this,null,function*(){let e=yield this.syncEngine.Li();for(let r of e){if(r===this.Rs)continue;let i=this.getItem(tE(this.persistenceKey,r));if(i){let s=Rc.Ts(r,i);s&&(this.gs=this.gs.insert(s.clientId,s))}}this.Fs();let t=this.storage.getItem(this.Cs);if(t){let r=this.Ms(t);r&&this.xs(r)}for(let r of this.ps)this.fs(r);this.ps=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Ls(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(zd(this.persistenceKey,e));if(r){let i=Ro.Ts(e,r);i&&(t=i.state)}}return this.Bs.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Bs.As(e),this.Fs()}isLocalQueryTarget(e){return this.Bs.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(zd(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Ls(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return v("SharedClientState","READ",e,t),t}setItem(e,t){v("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){v("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){let t=e;if(t.storageArea===this.storage){if(v("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ys)return void ye("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable(()=>g(this,null,function*(){if(this.started){if(t.key!==null){if(this.Ss.test(t.key)){if(t.newValue==null){let r=this.Ks(t.key);return this.$s(r,null)}{let r=this.Us(t.key,t.newValue);if(r)return this.$s(r.clientId,r)}}else if(this.bs.test(t.key)){if(t.newValue!==null){let r=this.Ws(t.key,t.newValue);if(r)return this.Gs(r)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){let r=this.zs(t.key,t.newValue);if(r)return this.js(r)}}else if(t.key===this.Cs){if(t.newValue!==null){let r=this.Ms(t.newValue);if(r)return this.xs(r)}}else if(t.key===this.ws){let r=function(s){let o=lt.oe;if(s!=null)try{let a=JSON.parse(s);P(typeof a=="number"),o=a}catch(a){ye("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==lt.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.vs){let r=this.Hs(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.Js(i)))}}}else this.ps.push(t)}))}}get Bs(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Bs.Es())}Ns(e,t,r){let i=new bc(this.currentUser,e,t,r),s=nE(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Ls(e){let t=nE(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){let t={clientId:this.Rs,onlineState:e};this.storage.setItem(this.Cs,JSON.stringify(t))}ks(e,t,r){let i=zd(this.persistenceKey,e),s=new Ro(e,t,r);this.setItem(i,s.Es())}Qs(e){let t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){let t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){let r=this.Ks(e);return Rc.Ts(r,t)}Ws(e,t){let r=this.bs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return bc.Ts(new Ae(s),i,t)}zs(e,t){let r=this.Ds.exec(e),i=Number(r[1]);return Ro.Ts(i,t)}Ms(e){return ip.Ts(e)}Hs(e){return JSON.parse(e)}Gs(e){return g(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Ys(e.batchId,e.state,e.error);v("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){let r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.Xs(o,a).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=Xp();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Dc=class{constructor(){this.eo=new Go,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new Go,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var sp=class{ro(e){}shutdown(){}};var Pc=class{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ao)e(0)}_o(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ao)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Hu=null;function Gd(){return Hu===null?Hu=function(){return 268435456+Math.round(2147483648*Math.random())}():Hu++,"0x"+Hu.toString(16)}var _D={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var op=class{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}Eo(e){this.Ao=e}onMessage(e){this.Ro=e}close(){this.lo()}send(e){this.co(e)}Vo(){this.Po()}mo(){this.To()}fo(e){this.Ao(e)}po(e){this.Ro(e)}};var Ge="WebChannelConnection",ap=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.yo=r+"://"+t.host,this.wo=`projects/${i}/databases/${s}`,this.So=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get bo(){return!1}Do(t,r,i,s,o){let a=Gd(),u=this.Co(t,r.toUriEncodedString());v("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(c,s,o),this.Fo(t,u,c,i).then(l=>(v("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw _t("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}Mo(t,r,i,s,o,a){return this.Do(t,r,i,s,o)}vo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+zi}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}Co(t,r){let i=_D[t];return`${this.yo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Fo(e,t,r,i){let s=Gd();return new Promise((o,a)=>{let u=new hw;u.setWithCredentials(!0),u.listenOnce(uw.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case qu.NO_ERROR:let l=u.getResponseJson();v(Ge,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case qu.TIMEOUT:v(Ge,`RPC '${e}' ${s} timed out`),a(new y(m.DEADLINE_EXCEEDED,"Request time out"));break;case qu.HTTP_ERROR:let h=u.getStatus();if(v(Ge,`RPC '${e}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);let f=d?.error;if(f&&f.status&&f.message){let E=function(_){let D=_.toLowerCase().replace(/_/g,"-");return Object.values(m).indexOf(D)>=0?D:m.UNKNOWN}(f.status);a(new y(E,f.message))}else a(new y(m.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new y(m.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{v(Ge,`RPC '${e}' ${s} completed.`)}});let c=JSON.stringify(i);v(Ge,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}xo(e,t,r){let i=Gd(),s=[this.yo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=ow(),a=aw(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new lw({})),this.vo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let l=s.join("");v(Ge,`Creating RPC '${e}' stream ${i}: ${l}`,u);let h=o.createWebChannel(l,u),d=!1,f=!1,E=new op({co:_=>{f?v(Ge,`Not sending because RPC '${e}' stream ${i} is closed:`,_):(d||(v(Ge,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),v(Ge,`RPC '${e}' stream ${i} sending:`,_),h.send(_))},lo:()=>h.close()}),w=(_,D,M)=>{_.listen(D,C=>{try{M(C)}catch(V){setTimeout(()=>{throw V},0)}})};return w(h,_o.EventType.OPEN,()=>{f||(v(Ge,`RPC '${e}' stream ${i} transport opened.`),E.Vo())}),w(h,_o.EventType.CLOSE,()=>{f||(f=!0,v(Ge,`RPC '${e}' stream ${i} transport closed`),E.fo())}),w(h,_o.EventType.ERROR,_=>{f||(f=!0,_t(Ge,`RPC '${e}' stream ${i} transport errored:`,_),E.fo(new y(m.UNAVAILABLE,"The operation could not be completed")))}),w(h,_o.EventType.MESSAGE,_=>{var D;if(!f){let M=_.data[0];P(!!M);let C=M,V=C.error||((D=C[0])===null||D===void 0?void 0:D.error);if(V){v(Ge,`RPC '${e}' stream ${i} received error:`,V);let L=V.status,z=function(A0){let Zg=Ie[A0];if(Zg!==void 0)return JE(Zg)}(L),de=V.message;z===void 0&&(z=m.INTERNAL,de="Unknown error status: "+L+" with message "+V.message),f=!0,E.fo(new y(z,de)),h.close()}else v(Ge,`RPC '${e}' stream ${i} received:`,M),E.po(M)}}),w(a,cw.STAT_EVENT,_=>{_.stat===Bd.PROXY?v(Ge,`RPC '${e}' stream ${i} detected buffering proxy`):_.stat===Bd.NOPROXY&&v(Ge,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{E.mo()},0),E}};function SI(){return typeof window<"u"?window:null}function Xu(){return typeof document<"u"?document:null}function na(n){return new Af(n,!0)}var Ho=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Oo=r,this.No=i,this.Lo=s,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(e){this.cancel();let t=Math.floor(this.Bo+this.$o()),r=Math.max(0,Date.now()-this.qo),i=Math.max(0,t-r);i>0&&v("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Bo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.qo=Date.now(),e())),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){this.ko!==null&&(this.ko.skipDelay(),this.ko=null)}cancel(){this.ko!==null&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}};var xc=class{constructor(e,t,r,i,s,o,a,u){this.si=e,this.Wo=r,this.Go=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new Ho(e,t)}Yo(){return this.state===1||this.state===5||this.Zo()}Zo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Xo()}stop(){return g(this,null,function*(){this.Yo()&&(yield this.close(0))})}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&this.jo===null&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,()=>this.n_()))}r_(e){this.i_(),this.stream.send(e)}n_(){return g(this,null,function*(){if(this.Zo())return this.close(0)})}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}close(e,t){return g(this,null,function*(){this.i_(),this.s_(),this.Jo.cancel(),this.zo++,e!==4?this.Jo.reset():t&&t.code===m.RESOURCE_EXHAUSTED?(ye(t.toString()),ye("Using maximum backoff delay to prevent overloading the backend."),this.Jo.Qo()):t&&t.code===m.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.o_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Eo(t)})}o_(){}auth(){this.state=1;let e=this.__(this.zo),t=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.zo===t&&this.a_(r,i)},r=>{e(()=>{let i=new y(m.UNKNOWN,"Fetching auth token failed: "+r.message);return this.u_(i)})})}a_(e,t){let r=this.__(this.zo);this.stream=this.c_(e,t),this.stream.ho(()=>{r(()=>this.listener.ho())}),this.stream.Io(()=>{r(()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,()=>(this.Zo()&&(this.state=3),Promise.resolve())),this.listener.Io()))}),this.stream.Eo(i=>{r(()=>this.u_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Xo(){this.state=5,this.Jo.Ko(()=>g(this,null,function*(){this.state=0,this.start()}))}u_(e){return v("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}__(e){return t=>{this.si.enqueueAndForget(()=>this.zo===e?t():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},up=class extends xc{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}c_(e,t){return this.connection.xo("Listen",e,t)}onMessage(e){this.Jo.reset();let t=nD(this.serializer,e),r=function(s){if(!("targetChange"in s))return k.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?k.min():o.readTime?ve(o.readTime):k.min()}(e);return this.listener.l_(t,r)}h_(e){let t={};t.database=bf(this.serializer),t.addTarget=function(s,o){let a,u=o.target;if(a=uc(u)?{documents:oI(s,u)}:{query:aI(s,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=eI(s,o.resumeToken);let c=Cf(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(k.min())>0){a.readTime=Vi(s,o.snapshotVersion.toTimestamp());let c=Cf(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);let r=iD(this.serializer,e);r&&(t.labels=r),this.r_(t)}P_(e){let t={};t.database=bf(this.serializer),t.removeTarget=e,this.r_(t)}},cp=class extends xc{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.I_=!1}get T_(){return this.I_}start(){this.I_=!1,this.lastStreamToken=void 0,super.start()}o_(){this.I_&&this.E_([])}c_(e,t){return this.connection.xo("Write",e,t)}onMessage(e){if(P(!!e.streamToken),this.lastStreamToken=e.streamToken,this.I_){this.Jo.reset();let t=rD(e.writeResults,e.commitTime),r=ve(e.commitTime);return this.listener.d_(r,t)}return P(!e.writeResults||e.writeResults.length===0),this.I_=!0,this.listener.A_()}R_(){let e={};e.database=bf(this.serializer),this.r_(e)}E_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>qo(this.serializer,r))};this.r_(t)}};var lp=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.V_=!1}m_(){if(this.V_)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}Do(e,t,r,i){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Do(e,Sf(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(m.UNKNOWN,s.toString())})}Mo(e,t,r,i,s){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Mo(e,Sf(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new y(m.UNKNOWN,o.toString())})}terminate(){this.V_=!0,this.connection.terminate()}};var hp=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,e==="Online"&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(ye(t),this.y_=!1):v("OnlineStateTracker",t)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var dp=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.ro(o=>{r.enqueueAndForget(()=>g(this,null,function*(){Yn(this)&&(v("RemoteStore","Restarting streams for network reachability change."),yield function(u){return g(this,null,function*(){let c=T(u);c.M_.add(4),yield Hi(c),c.N_.set("Unknown"),c.M_.delete(4),yield ra(c)})}(this))}))}),this.N_=new hp(r,i)}};function ra(n){return g(this,null,function*(){if(Yn(n))for(let e of n.x_)yield e(!0)})}function Hi(n){return g(this,null,function*(){for(let e of n.x_)yield e(!1)})}function Yc(n,e){let t=T(n);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),ig(t)?rg(t):Ki(t).Zo()&&ng(t,e))}function Li(n,e){let t=T(n),r=Ki(t);t.F_.delete(e),r.Zo()&&bI(t,e),t.F_.size===0&&(r.Zo()?r.t_():Yn(t)&&t.N_.set("Unknown"))}function ng(n,e){if(n.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(k.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ki(n).h_(e)}function bI(n,e){n.L_.xe(e),Ki(n).P_(e)}function rg(n){n.L_=new Tf({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.F_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Ki(n).start(),n.N_.w_()}function ig(n){return Yn(n)&&!Ki(n).Yo()&&n.F_.size>0}function Yn(n){return T(n).M_.size===0}function RI(n){n.L_=void 0}function vD(n){return g(this,null,function*(){n.N_.set("Online")})}function wD(n){return g(this,null,function*(){n.F_.forEach((e,t)=>{ng(n,e)})})}function ED(n,e){return g(this,null,function*(){RI(n),ig(n)?(n.N_.D_(e),rg(n)):n.N_.set("Unknown")})}function ID(n,e,t){return g(this,null,function*(){if(n.N_.set("Online"),e instanceof dc&&e.state===2&&e.cause)try{yield function(i,s){return g(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.F_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.F_.delete(a),i.L_.removeTarget(a))})}(n,e)}catch(r){v("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield kc(n,r)}else if(e instanceof Si?n.L_.Ke(e):e instanceof hc?n.L_.He(e):n.L_.We(e),!t.isEqual(k.min()))try{let r=yield EI(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.L_.rt(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let l=s.F_.get(c);l&&s.F_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let l=s.F_.get(u);if(!l)return;s.F_.set(u,l.withResumeToken(Ve.EMPTY_BYTE_STRING,l.snapshotVersion)),bI(s,u);let h=new Ni(l.target,u,c,l.sequenceNumber);ng(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){v("RemoteStore","Failed to raise snapshot:",r),yield kc(n,r)}})}function kc(n,e,t){return g(this,null,function*(){if(!Qn(e))throw e;n.M_.add(1),yield Hi(n),n.N_.set("Offline"),t||(t=()=>EI(n.localStore)),n.asyncQueue.enqueueRetryable(()=>g(this,null,function*(){v("RemoteStore","Retrying IndexedDB access"),yield t(),n.M_.delete(1),yield ra(n)}))})}function DI(n,e){return e().catch(t=>kc(n,t,e))}function Wi(n){return g(this,null,function*(){let e=T(n),t=Wn(e),r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;TD(e);)try{let i=yield gD(e.localStore,r);if(i===null){e.v_.length===0&&t.t_();break}r=i.batchId,AD(e,i)}catch(i){yield kc(e,i)}PI(e)&&xI(e)})}function TD(n){return Yn(n)&&n.v_.length<10}function AD(n,e){n.v_.push(e);let t=Wn(n);t.Zo()&&t.T_&&t.E_(e.mutations)}function PI(n){return Yn(n)&&!Wn(n).Yo()&&n.v_.length>0}function xI(n){Wn(n).start()}function CD(n){return g(this,null,function*(){Wn(n).R_()})}function SD(n){return g(this,null,function*(){let e=Wn(n);for(let t of n.v_)e.E_(t.mutations)})}function bD(n,e,t){return g(this,null,function*(){let r=n.v_.shift(),i=wf.from(r,e,t);yield DI(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Wi(n)})}function RD(n,e){return g(this,null,function*(){e&&Wn(n).T_&&(yield function(r,i){return g(this,null,function*(){if(function(o){return XE(o)&&o!==m.ABORTED}(i.code)){let s=r.v_.shift();Wn(r).e_(),yield DI(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Wi(r)}})}(n,e)),PI(n)&&xI(n)})}function rE(n,e){return g(this,null,function*(){let t=T(n);t.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");let r=Yn(t);t.M_.add(3),yield Hi(t),r&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield ra(t)})}function fp(n,e){return g(this,null,function*(){let t=T(n);e?(t.M_.delete(2),yield ra(t)):e||(t.M_.add(2),yield Hi(t),t.N_.set("Unknown"))})}function Ki(n){return n.B_||(n.B_=function(t,r,i){let s=T(t);return s.m_(),new up(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:vD.bind(null,n),Io:wD.bind(null,n),Eo:ED.bind(null,n),l_:ID.bind(null,n)}),n.x_.push(e=>g(this,null,function*(){e?(n.B_.e_(),ig(n)?rg(n):n.N_.set("Unknown")):(yield n.B_.stop(),RI(n))}))),n.B_}function Wn(n){return n.k_||(n.k_=function(t,r,i){let s=T(t);return s.m_(),new cp(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:()=>Promise.resolve(),Io:CD.bind(null,n),Eo:RD.bind(null,n),A_:SD.bind(null,n),d_:bD.bind(null,n)}),n.x_.push(e=>g(this,null,function*(){e?(n.k_.e_(),yield Wi(n)):(yield n.k_.stop(),n.v_.length>0&&(v("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))}))),n.k_}var pp=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ce,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new y(m.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Qi(n,e){if(ye("AsyncQueue",`${e}: ${n}`),Qn(n))return new y(m.UNAVAILABLE,`${e}: ${n}`);throw n}var Vc=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||I.comparator(t.key,r.key):(t,r)=>I.comparator(t.key,r.key),this.keyedMap=To(),this.sortedSet=new ae(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Nc=class{constructor(){this.q_=new ae(I.comparator)}track(e){let t=e.doc.key,r=this.q_.get(t);r?e.type!==0&&r.type===3?this.q_=this.q_.insert(t,e):e.type===3&&r.type!==1?this.q_=this.q_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.q_=this.q_.remove(t):e.type===1&&r.type===2?this.q_=this.q_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):S():this.q_=this.q_.insert(t,e)}Q_(){let e=[];return this.q_.inorderTraversal((t,r)=>{e.push(r)}),e}},Ui=class n{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Vc.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ea(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var gp=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}},mp=class{constructor(){this.queries=new Xt(e=>OE(e),ea),this.onlineState="Unknown",this.z_=new Set}};function sg(n,e){return g(this,null,function*(){let t=T(n),r=3,i=e.query,s=t.queries.get(i);s?!s.W_()&&e.G_()&&(r=2):(s=new gp,r=e.G_()?0:1);try{switch(r){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=Qi(o,`Initialization of query '${vi(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&ag(t)})}function og(n,e){return g(this,null,function*(){let t=T(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.U_.indexOf(e);o>=0&&(s.U_.splice(o,1),s.U_.length===0?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function DD(n,e){let t=T(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.U_)a.H_(i)&&(r=!0);o.K_=i}}r&&ag(t)}function PD(n,e,t){let r=T(n),i=r.queries.get(e);if(i)for(let s of i.U_)s.onError(t);r.queries.delete(e)}function ag(n){n.z_.forEach(e=>{e.next()})}var yp,iE;(iE=yp||(yp={})).J_="default",iE.Cache="cache";var Wo=class{constructor(e,t,r){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Ui(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache||!this.G_())return!0;let r=t!=="Offline";return(!this.options.ra||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ea(e){if(e.docChanges.length>0)return!0;let t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}na(e){e=Ui.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==yp.Cache}};var _p=class{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}};var Mc=class{constructor(e){this.serializer=e}hs(e){return Wt(this.serializer,e)}Ps(e){return e.metadata.exists?sI(this.serializer,e.document,!1):Se.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return ve(e)}},vp=class{constructor(e,t,r){this.oa=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=kI(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;let r=W.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){let t=new Map,r=new Mc(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.hs(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||j()).add(s);t.set(o,a)}}return t}complete(){return g(this,null,function*(){let e=yield mD(this.localStore,new Mc(this.serializer),this.documents,this.oa.id),t=this.aa(this.documents);for(let r of this.queries)yield yD(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:e}})}};function kI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Oc=class{constructor(e){this.key=e}},Fc=class{constructor(e){this.key=e}},Lc=class{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=j(),this.mutatedKeys=j(),this.Ia=LE(e),this.Ta=new Vc(this.Ia)}get Ea(){return this.la}da(e,t){let r=t?t.Aa:new Nc,i=t?t.Ta:this.Ta,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{let d=i.get(l),f=ta(this.query,h)?h:null,E=!!d&&this.mutatedKeys.has(d.key),w=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations),_=!1;d&&f?d.data.isEqual(f.data)?E!==w&&(r.track({type:3,doc:f}),_=!0):this.Ra(d,f)||(r.track({type:2,doc:f}),_=!0,(u&&this.Ia(f,u)>0||c&&this.Ia(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),_=!0):d&&!f&&(r.track({type:1,doc:d}),_=!0,(u||c)&&(a=!0)),_&&(f?(o=o.add(f),s=w?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Ta:o,Aa:r,Zi:a,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;let o=e.Aa.Q_();o.sort((l,h)=>function(f,E){let w=_=>{switch(_){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return w(f)-w(E)}(l.type,h.type)||this.Ia(l.doc,h.doc)),this.Va(r),i=i!=null&&i;let a=t&&!i?this.ma():[],u=this.Pa.size===0&&this.current&&!i?1:0,c=u!==this.ha;return this.ha=u,o.length!==0||c?{snapshot:new Ui(this.query,e.Ta,s,o,e.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Nc,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];let e=this.Pa;this.Pa=j(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});let t=[];return e.forEach(r=>{this.Pa.has(r)||t.push(new Fc(r))}),this.Pa.forEach(r=>{e.has(r)||t.push(new Oc(r))}),t}pa(e){this.la=e.ls,this.Pa=j();let t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Ui.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},wp=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Ep=class{constructor(e){this.key=e,this.wa=!1}},Ip=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new Xt(a=>OE(a),ea),this.Da=new Map,this.Ca=new Set,this.va=new ae(I.comparator),this.Fa=new Map,this.Ma=new zo,this.xa={},this.Oa=new Map,this.Na=Mi.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function xD(n,e,t=!0){return g(this,null,function*(){let r=Xc(n),i,s=r.ba.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield VI(r,e,t,!0),i})}function kD(n,e){return g(this,null,function*(){let t=Xc(n);yield VI(t,e,!0,!1)})}function VI(n,e,t,r){return g(this,null,function*(){let i=yield Oi(n.localStore,Je(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield ug(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Yc(n.remoteStore,i),a})}function ug(n,e,t,r,i){return g(this,null,function*(){n.Ba=(h,d,f)=>function(w,_,D,M){return g(this,null,function*(){let C=_.view.da(D);C.Zi&&(C=yield Sc(w.localStore,_.query,!1).then(({documents:de})=>_.view.da(de,C)));let V=M&&M.targetChanges.get(_.targetId),L=M&&M.targetMismatches.get(_.targetId)!=null,z=_.view.applyChanges(C,w.isPrimaryClient,V,L);return Tp(w,_.targetId,z.fa),z.snapshot})}(n,h,d,f);let s=yield Sc(n.localStore,e,!0),o=new Lc(e,s.ls),a=o.da(s.documents),u=jo.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,u);Tp(n,t,c.fa);let l=new wp(e,t,o);return n.ba.set(e,l),n.Da.has(t)?n.Da.get(t).push(e):n.Da.set(t,[e]),c.snapshot})}function VD(n,e,t){return g(this,null,function*(){let r=T(n),i=r.ba.get(e),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter(o=>!ea(o,e))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Fi(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Li(r.remoteStore,i.targetId),ji(r,i.targetId)}).catch(Kn))):(ji(r,i.targetId),yield Fi(r.localStore,i.targetId,!0))})}function ND(n,e){return g(this,null,function*(){let t=T(n),r=t.ba.get(e),i=t.Da.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Li(t.remoteStore,r.targetId))})}function MD(n,e,t){return g(this,null,function*(){let r=dg(n);try{let i=yield function(o,a){let u=T(o),c=he.now(),l=a.reduce((f,E)=>f.add(E.key),j()),h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",f=>{let E=it(),w=j();return u.ss.getEntries(f,l).next(_=>{E=_,E.forEach((D,M)=>{M.isValidDocument()||(w=w.add(D))})}).next(()=>u.localDocuments.getOverlayedDocuments(f,E)).next(_=>{h=_;let D=[];for(let M of a){let C=QR(M,h.get(M.key).overlayedDocument);C!=null&&D.push(new xt(M.key,C,DE(C.value.mapValue),ge.exists(!0)))}return u.mutationQueue.addMutationBatch(f,c,D,a)}).next(_=>{d=_;let D=_.applyToLocalDocumentSet(h,w);return u.documentOverlayCache.saveOverlays(f,_.batchId,D)})}).then(()=>({batchId:d.batchId,changes:jE(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.xa[o.currentUser.toKey()];c||(c=new ae(U)),c=c.insert(a,u),o.xa[o.currentUser.toKey()]=c}(r,i.batchId,t),yield gn(r,i.changes),yield Wi(r.remoteStore)}catch(i){let s=Qi(i,"Failed to persist write");t.reject(s)}})}function NI(n,e){return g(this,null,function*(){let t=T(n);try{let r=yield pD(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Fa.get(s);o&&(P(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.wa=!0:i.modifiedDocuments.size>0?P(o.wa):i.removedDocuments.size>0&&(P(o.wa),o.wa=!1))}),yield gn(t,r,e)}catch(r){yield Kn(r)}})}function sE(n,e,t){let r=T(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.ba.forEach((s,o)=>{let a=o.view.j_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=T(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(let d of h.U_)d.j_(a)&&(c=!0)}),c&&ag(u)}(r.eventManager,e),i.length&&r.Sa.l_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function OD(n,e,t){return g(this,null,function*(){let r=T(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Fa.get(e),s=i&&i.key;if(s){let o=new ae(I.comparator);o=o.insert(s,Se.newNoDocument(s,k.min()));let a=j().add(s),u=new Uo(k.min(),new Map,new ae(U),o,a);yield NI(r,u),r.va=r.va.remove(s),r.Fa.delete(e),hg(r)}else yield Fi(r.localStore,e,!1).then(()=>ji(r,e,t)).catch(Kn)})}function FD(n,e){return g(this,null,function*(){let t=T(n),r=e.batch.batchId;try{let i=yield fD(t.localStore,e);lg(t,r,null),cg(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield gn(t,i)}catch(i){yield Kn(i)}})}function LD(n,e,t){return g(this,null,function*(){let r=T(n);try{let i=yield function(o,a){let u=T(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(P(h!==null),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);lg(r,e,t),cg(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield gn(r,i)}catch(i){yield Kn(i)}})}function UD(n,e){return g(this,null,function*(){let t=T(n);Yn(t.remoteStore)||v("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=T(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===-1)return void e.resolve();let i=t.Oa.get(r)||[];i.push(e),t.Oa.set(r,i)}catch(r){let i=Qi(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function cg(n,e){(n.Oa.get(e)||[]).forEach(t=>{t.resolve()}),n.Oa.delete(e)}function lg(n,e,t){let r=T(n),i=r.xa[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.xa[r.currentUser.toKey()]=i}}function ji(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Da.get(e))n.ba.delete(r),t&&n.Sa.ka(r,t);n.Da.delete(e),n.isPrimaryClient&&n.Ma.Rr(e).forEach(r=>{n.Ma.containsKey(r)||MI(n,r)})}function MI(n,e){n.Ca.delete(e.path.canonicalString());let t=n.va.get(e);t!==null&&(Li(n.remoteStore,t),n.va=n.va.remove(e),n.Fa.delete(t),hg(n))}function Tp(n,e,t){for(let r of t)r instanceof Oc?(n.Ma.addReference(r.key,e),jD(n,r)):r instanceof Fc?(v("SyncEngine","Document no longer in limbo: "+r.key),n.Ma.removeReference(r.key,e),n.Ma.containsKey(r.key)||MI(n,r.key)):S()}function jD(n,e){let t=e.key,r=t.path.canonicalString();n.va.get(t)||n.Ca.has(r)||(v("SyncEngine","New document in limbo: "+t),n.Ca.add(r),hg(n))}function hg(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){let e=n.Ca.values().next().value;n.Ca.delete(e);let t=new I(W.fromString(e)),r=n.Na.next();n.Fa.set(r,new Ep(t)),n.va=n.va.insert(t,r),Yc(n.remoteStore,new Ni(Je(Gi(t.path)),r,"TargetPurposeLimboResolution",lt.oe))}}function gn(n,e,t){return g(this,null,function*(){let r=T(n),i=[],s=[],o=[];r.ba.isEmpty()||(r.ba.forEach((a,u)=>{o.push(r.Ba(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let l=tp.Qi(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.Sa.l_(i),yield function(u,c){return g(this,null,function*(){let l=T(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>p.forEach(c,d=>p.forEach(d.ki,f=>l.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>p.forEach(d.qi,f=>l.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!Qn(h))throw h;v("LocalStore","Failed to update sequence numbers: "+h)}for(let h of c){let d=h.targetId;if(!h.fromCache){let f=l.ts.get(d),E=f.snapshotVersion,w=f.withLastLimboFreeSnapshotVersion(E);l.ts=l.ts.insert(d,w)}}})}(r.localStore,s))})}function BD(n,e){return g(this,null,function*(){let t=T(n);if(!t.currentUser.isEqual(e)){v("SyncEngine","User change. New user:",e.toKey());let r=yield wI(t.localStore,e);t.currentUser=e,function(s,o){s.Oa.forEach(a=>{a.forEach(u=>{u.reject(new y(m.CANCELLED,o))})}),s.Oa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield gn(t,r._s)}})}function qD(n,e){let t=T(n),r=t.Fa.get(e);if(r&&r.wa)return j().add(r.key);{let i=j(),s=t.Da.get(e);if(!s)return i;for(let o of s){let a=t.ba.get(o);i=i.unionWith(a.view.Ea)}return i}}function $D(n,e){return g(this,null,function*(){let t=T(n),r=yield Sc(t.localStore,e.query,!0),i=e.view.pa(r);return t.isPrimaryClient&&Tp(t,e.targetId,i.fa),i})}function zD(n,e){return g(this,null,function*(){let t=T(n);return AI(t.localStore,e).then(r=>gn(t,r))})}function GD(n,e,t,r){return g(this,null,function*(){let i=T(n),s=yield function(a,u){let c=T(a),l=T(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.Cn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):p.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield Wi(i.remoteStore):t==="acknowledged"||t==="rejected"?(lg(i,e,r||null),cg(i,e),function(a,u){T(T(a).mutationQueue).Fn(u)}(i.localStore,e)):S(),yield gn(i,s)):v("SyncEngine","Cannot apply mutation batch with id: "+e)})}function HD(n,e){return g(this,null,function*(){let t=T(n);if(Xc(t),dg(t),e===!0&&t.La!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield oE(t,r.toArray());t.La=!0,yield fp(t.remoteStore,!0);for(let s of i)Yc(t.remoteStore,s)}else if(e===!1&&t.La!==!1){let r=[],i=Promise.resolve();t.Da.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(ji(t,o),Fi(t.localStore,o,!0))),Li(t.remoteStore,o)}),yield i,yield oE(t,r),function(o){let a=T(o);a.Fa.forEach((u,c)=>{Li(a.remoteStore,c)}),a.Ma.Vr(),a.Fa=new Map,a.va=new ae(I.comparator)}(t),t.La=!1,yield fp(t.remoteStore,!1)}})}function oE(n,e,t){return g(this,null,function*(){let r=T(n),i=[],s=[];for(let o of e){let a,u=r.Da.get(o);if(u&&u.length!==0){a=yield Oi(r.localStore,Je(u[0]));for(let c of u){let l=r.ba.get(c),h=yield $D(r,l);h.snapshot&&s.push(h.snapshot)}}else{let c=yield TI(r.localStore,o);a=yield Oi(r.localStore,c),yield ug(r,OI(c),o,!1,a.resumeToken)}i.push(a)}return r.Sa.l_(s),i})}function OI(n){return ME(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function WD(n){return function(t){return T(T(t).persistence).Li()}(T(n).localStore)}function KD(n,e,t,r){return g(this,null,function*(){let i=T(n);if(i.La)return void v("SyncEngine","Ignoring unexpected query state notification.");let s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield AI(i.localStore,FE(s[0])),a=Uo.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ve.EMPTY_BYTE_STRING);yield gn(i,o,a);break}case"rejected":yield Fi(i.localStore,e,!0),ji(i,e,r);break;default:S()}})}function QD(n,e,t){return g(this,null,function*(){let r=Xc(n);if(r.La){for(let i of e){if(r.Da.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){v("SyncEngine","Adding an already active target "+i);continue}let s=yield TI(r.localStore,i),o=yield Oi(r.localStore,s);yield ug(r,OI(s),o.targetId,!1,o.resumeToken),Yc(r.remoteStore,o)}for(let i of t)r.Da.has(i)&&(yield Fi(r.localStore,i,!1).then(()=>{Li(r.remoteStore,i),ji(r,i)}).catch(Kn))}})}function Xc(n){let e=T(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=NI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=qD.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=OD.bind(null,e),e.Sa.l_=DD.bind(null,e.eventManager),e.Sa.ka=PD.bind(null,e.eventManager),e}function dg(n){let e=T(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=FD.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=LD.bind(null,e),e}function YD(n,e,t){let r=T(n);(function(s,o,a){return g(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(f,E){let w=T(f),_=ve(E.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",D=>w.Kr.getBundleMetadata(D,E.id)).then(D=>!!D&&D.createTime.compareTo(_)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(f){return{taskState:"Success",documentsLoaded:f.totalDocuments,bytesLoaded:f.totalBytes,totalDocuments:f.totalDocuments,totalBytes:f.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(kI(u));let c=new vp(u,s.localStore,o.serializer),l=yield o.qa();for(;l;){let d=yield c._a(l);d&&a._updateProgress(d),l=yield o.qa()}let h=yield c.complete();return yield gn(s,h.ca,void 0),yield function(f,E){let w=T(f);return w.persistence.runTransaction("Save bundle","readwrite",_=>w.Kr.saveBundleMetadata(_,E))}(s.localStore,u),a._completeWith(h.progress),Promise.resolve(h.ua)}catch(u){return _t("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var Ko=class{constructor(){this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){this.serializer=na(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return vI(this.persistence,new Cc,e.initialUser,this.serializer)}createPersistence(e){return new Tc(Ac.jr,this.serializer)}createSharedClientState(e){return new Dc}terminate(){return g(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Uc=class n extends Ko{constructor(e,t,r){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){yield pl(n.prototype,this,"initialize").call(this,e),yield this.Qa.initialize(this,e),yield dg(this.Qa.syncEngine),yield Wi(this.Qa.remoteStore),yield this.persistence.mi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return vI(this.persistence,new Cc,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new jf(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new rf(t,this.persistence);return new nf(e.asyncQueue,r)}createPersistence(e){let t=tg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?yt.withCacheSize(this.cacheSizeBytes):yt.DEFAULT;return new ep(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,SI(),Xu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Dc}},Ap=class n extends Uc{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return g(this,null,function*(){yield pl(n.prototype,this,"initialize").call(this,e);let t=this.Qa.syncEngine;this.sharedClientState instanceof Do&&(this.sharedClientState.syncEngine={Ys:GD.bind(null,t),Zs:KD.bind(null,t),Xs:QD.bind(null,t),Li:WD.bind(null,t),Js:zD.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.mi(r=>g(this,null,function*(){yield HD(this.Qa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=SI();if(!Do.D(t))throw new y(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=tg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Do(t,e.asyncQueue,r,e.clientId,e.initialUser)}},Qo=class{initialize(e,t){return g(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>sE(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=BD.bind(null,this.syncEngine),yield fp(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new mp}()}createDatastore(e){let t=na(e.databaseInfo.databaseId),r=function(s){return new ap(s)}(e.databaseInfo);return function(s,o,a,u){return new lp(s,o,a,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new dp(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>sE(this.syncEngine,t,0),function(){return Pc.D()?new Pc:new sp}())}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){let h=new Ip(i,s,o,a,u,c);return l&&(h.La=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return g(this,null,function*(){var e;yield function(r){return g(this,null,function*(){let i=T(r);v("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield Hi(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function aE(n,e=10240){let t=0;return{read(){return g(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return g(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Bi=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):ye("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Cp=class{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new Ce,this.buffer=new Uint8Array,this.Wa=function(){return new TextDecoder("utf-8")}(),this.Ga().then(r=>{r&&r.sa()?this.metadata.resolve(r.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.ia)}`))},r=>this.metadata.reject(r))}close(){return this.Ua.cancel()}getMetadata(){return g(this,null,function*(){return this.metadata.promise})}qa(){return g(this,null,function*(){return yield this.getMetadata(),this.Ga()})}Ga(){return g(this,null,function*(){let e=yield this.za();if(e===null)return null;let t=this.Wa.decode(e),r=Number(t);isNaN(r)&&this.ja(`length string (${t}) is not valid number`);let i=yield this.Ha(r);return new _p(JSON.parse(i),e.length+r)})}Ja(){return this.buffer.findIndex(e=>e===123)}za(){return g(this,null,function*(){for(;this.Ja()<0&&!(yield this.Ya()););if(this.buffer.length===0)return null;let e=this.Ja();e<0&&this.ja("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Ha(e){return g(this,null,function*(){for(;this.buffer.length<e;)(yield this.Ya())&&this.ja("Reached the end of bundle when more is expected.");let t=this.Wa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){return g(this,null,function*(){let e=yield this.Ua.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Sp=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new y(m.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return g(this,null,function*(){let o=T(i),a={documents:s.map(h=>Bo(o.serializer,h))},u=yield o.Mo("BatchGetDocuments",o.serializer.databaseId,W.emptyPath(),a,s.length),c=new Map;u.forEach(h=>{let d=tD(o.serializer,h);c.set(d.key.toString(),d)});let l=[];return s.forEach(h=>{let d=c.get(h.toString());P(!!d),l.push(d)}),l})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Hn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=I.fromPath(r);this.mutations.push(new Oo(i,this.precondition(i)))}),yield function(r,i){return g(this,null,function*(){let s=T(r),o={writes:i.map(a=>qo(s.serializer,a))};yield s.Do("Commit",s.serializer.databaseId,W.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw S();t=k.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new y(m.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(k.min())?ge.exists(!1):ge.updateTime(t):ge.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(k.min()))throw new y(m.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ge.updateTime(t)}return ge.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var bp=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Za=r.maxAttempts,this.Jo=new Ho(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Jo.Ko(()=>g(this,null,function*(){let e=new Sp(this.datastore),t=this.tu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.nu(i)}))}).catch(r=>{this.nu(r)})}))}tu(e){try{let t=this.updateFunction(e);return!Jo(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!XE(t)}return!1}};var Rp=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ae.UNAUTHENTICATED,this.clientId=ec.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>g(this,null,function*(){v("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(v("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ce;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Qi(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Ju(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>g(this,null,function*(){r.isEqual(i)||(yield wI(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Dp(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield fg(n);v("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>rE(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>rE(e.remoteStore,i)),n._onlineComponents=e})}function FI(n){return n.name==="FirebaseError"?n.code===m.FAILED_PRECONDITION||n.code===m.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function fg(n){return g(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){v("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ju(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!FI(t))throw t;_t("Error using user provided cache. Falling back to memory cache: "+t),yield Ju(n,new Ko)}}else v("FirestoreClient","Using default OfflineComponentProvider"),yield Ju(n,new Ko);return n._offlineComponents})}function Jc(n){return g(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(v("FirestoreClient","Using user provided OnlineComponentProvider"),yield Dp(n,n._uninitializedComponentsProvider._online)):(v("FirestoreClient","Using default OnlineComponentProvider"),yield Dp(n,new Qo))),n._onlineComponents})}function LI(n){return fg(n).then(e=>e.persistence)}function pg(n){return fg(n).then(e=>e.localStore)}function UI(n){return Jc(n).then(e=>e.remoteStore)}function gg(n){return Jc(n).then(e=>e.syncEngine)}function XD(n){return Jc(n).then(e=>e.datastore)}function qi(n){return g(this,null,function*(){let e=yield Jc(n),t=e.eventManager;return t.onListen=xD.bind(null,e.syncEngine),t.onUnlisten=VD.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=kD.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=ND.bind(null,e.syncEngine),t})}function JD(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield LI(n),t=yield UI(n);return e.setNetworkEnabled(!0),function(i){let s=T(i);return s.M_.delete(0),ra(s)}(t)}))}function ZD(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield LI(n),t=yield UI(n);return e.setNetworkEnabled(!1),function(i){return g(this,null,function*(){let s=T(i);s.M_.add(0),yield Hi(s),s.N_.set("Offline")})}(t)}))}function eP(n,e){let t=new Ce;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(i,s,o){return g(this,null,function*(){try{let a=yield function(c,l){let h=T(c);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new y(m.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=Qi(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield pg(n),e,t)})),t.promise}function jI(n,e,t={}){let r=new Ce;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(s,o,a,u,c){let l=new Bi({next:d=>{o.enqueueAndForget(()=>og(s,h));let f=d.docs.has(a);!f&&d.fromCache?c.reject(new y(m.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&u&&u.source==="server"?c.reject(new y(m.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Wo(Gi(a.path),l,{includeMetadataChanges:!0,ra:!0});return sg(s,h)}(yield qi(n),n.asyncQueue,e,t,r)})),r.promise}function tP(n,e){let t=new Ce;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(i,s,o){return g(this,null,function*(){try{let a=yield Sc(i,s,!0),u=new Lc(s,a.ls),c=u.da(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){let u=Qi(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield pg(n),e,t)})),t.promise}function BI(n,e,t={}){let r=new Ce;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(s,o,a,u,c){let l=new Bi({next:d=>{o.enqueueAndForget(()=>og(s,h)),d.fromCache&&u.source==="server"?c.reject(new y(m.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Wo(a,l,{includeMetadataChanges:!0,ra:!0});return sg(s,h)}(yield qi(n),n.asyncQueue,e,t,r)})),r.promise}function nP(n,e){let t=new Bi(e);return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(i,s){T(i).z_.add(s),s.next()}(yield qi(n),t)})),()=>{t.$a(),n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(i,s){T(i).z_.delete(s)}(yield qi(n),t)}))}}function rP(n,e,t,r){let i=function(o,a){let u;return u=typeof o=="string"?ZE().encode(o):o,function(l,h){return new Cp(l,h)}(function(l,h){if(l instanceof Uint8Array)return aE(l,h);if(l instanceof ArrayBuffer)return aE(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,na(e));n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){YD(yield gg(n),i,r)}))}function iP(n,e){return n.asyncQueue.enqueue(()=>g(this,null,function*(){return function(r,i){let s=T(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Kr.getNamedQuery(o,i))}(yield pg(n),e)}))}function qI(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var uE=new Map;function mg(n,e,t){if(!t)throw new y(m.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function yg(n,e,t,r){if(e===!0&&r===!0)throw new y(m.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function cE(n){if(!I.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function lE(n){if(I.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Zc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":S()}function K(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new y(m.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Zc(n);throw new y(m.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function $I(n,e){if(e<=0)throw new y(m.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var jc=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new y(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new y(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}yg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=qI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new y(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new y(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new y(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Sr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new jc({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new jc(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Hd;switch(r.type){case"firstParty":return new Yd(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new y(m.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=uE.get(t);r&&(v("ComponentProvider","Removing Datastore"),uE.delete(t),r.terminate())}(this),Promise.resolve()}};function zI(n,e,t,r={}){var i;let s=(n=K(n,Sr))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&_t("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=Ae.MOCK_USER;else{a=Ia(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new y(m.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Ae(c)}n._authCredentials=new Wd(new Zu(a,u))}}var Le=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ie=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Kt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Kt=class n extends Le{constructor(e,t,r){super(e,t,Gi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ie(this.firestore,null,new I(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function _g(n,e,...t){if(n=ee(n),mg("collection","path",e),n instanceof Sr){let r=W.fromString(e,...t);return lE(r),new Kt(n,null,r)}{if(!(n instanceof ie||n instanceof Kt))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(W.fromString(e,...t));return lE(r),new Kt(n.firestore,null,r)}}function GI(n,e){if(n=K(n,Sr),mg("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Le(n,null,function(r){return new Pt(W.emptyPath(),r)}(e))}function ia(n,e,...t){if(n=ee(n),arguments.length===1&&(e=ec.newId()),mg("doc","path",e),n instanceof Sr){let r=W.fromString(e,...t);return cE(r),new ie(n,null,new I(r))}{if(!(n instanceof ie||n instanceof Kt))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(W.fromString(e,...t));return cE(r),new ie(n.firestore,n instanceof Kt?n.converter:null,new I(r))}}function vg(n,e){return n=ee(n),e=ee(e),(n instanceof ie||n instanceof Kt)&&(e instanceof ie||e instanceof Kt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function wg(n,e){return n=ee(n),e=ee(e),n instanceof Le&&e instanceof Le&&n.firestore===e.firestore&&ea(n._query,e._query)&&n.converter===e.converter}var Pp=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new Ho(this,"async_queue_retry"),this.hu=()=>{let t=Xu();t&&v("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Jo.Uo()};let e=Xu();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;let t=Xu();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});let t=new Ce;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){return g(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Jo.reset()}catch(e){if(!Qn(e))throw e;v("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Jo.Ko(()=>this.Tu())}})}Iu(e){let t=this.iu.then(()=>(this.uu=!0,e().catch(r=>{this.au=r,this.uu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw ye("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.uu=!1,r))));return this.iu=t,t}enqueueAfterDelay(e,t,r){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);let i=pp.createAndSchedule(this,e,t,r,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&S()}verifyOperationInProgress(){}du(){return g(this,null,function*(){let e;do e=this.iu,yield e;while(e!==this.iu)})}Au(e){for(let t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this._u)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){let t=this._u.indexOf(e);this._u.splice(t,1)}};function xp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var kp=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ce,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var HI=-1,ue=class extends Sr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new Pp}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||WI(this),this._firestoreClient.terminate()}};function Re(n){return n._firestoreClient||WI(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function WI(n){var e,t,r;let i=n._freezeSettings(),s=function(a,u,c,l){return new sf(a,u,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,qI(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Rp(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function KI(n,e){rT(n=K(n,ue));let t=Re(n);if(t._uninitializedComponentsProvider)throw new y(m.FAILED_PRECONDITION,"SDK cache is already specified.");_t("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Qo;return YI(t,i,new Uc(i,r.cacheSizeBytes,e?.forceOwnership))}function QI(n){rT(n=K(n,ue));let e=Re(n);if(e._uninitializedComponentsProvider)throw new y(m.FAILED_PRECONDITION,"SDK cache is already specified.");_t("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new Qo;return YI(e,r,new Ap(r,t.cacheSizeBytes))}function YI(n,e,t){let r=new Ce;return n.asyncQueue.enqueue(()=>g(this,null,function*(){try{yield Ju(n,t),yield Dp(n,e),r.resolve()}catch(i){let s=i;if(!FI(s))throw s;_t("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function XI(n){if(n._initialized&&!n._terminated)throw new y(m.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Ce;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{yield function(r){return g(this,null,function*(){if(!Un.D())return Promise.resolve();let i=r+"main";yield Un.delete(i)})}(tg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function JI(n){return function(t){let r=new Ce;return t.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return UD(yield gg(t),r)})),r.promise}(Re(n=K(n,ue)))}function ZI(n){return JD(Re(n=K(n,ue)))}function eT(n){return ZD(Re(n=K(n,ue)))}function tT(n,e){let t=Re(n=K(n,ue)),r=new kp;return rP(t,n._databaseId,e,r),r}function nT(n,e){return iP(Re(n=K(n,ue)),e).then(t=>t?new Le(n,null,t.query):null)}function rT(n){if(n._initialized||n._terminated)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Jt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ve.fromBase64String(e))}catch(t){throw new y(m.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ve.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var kt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new y(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _e(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var fn=class{constructor(e){this._methodName=e}};var br=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new y(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new y(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return U(this._lat,e._lat)||U(this._long,e._long)}};var sP=/^__.*__$/,Vp=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new xt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Gn(e,this.data,t,this.fieldTransforms)}},Bc=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new xt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function iT(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}var qc=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.wu(e),i}Su(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return $c(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(e.length===0)throw this.Du("Document fields must not be empty");if(iT(this.fu)&&sP.test(e))throw this.Du('Document fields cannot begin and end with "__"')}},Np=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||na(e)}Fu(e,t,r,i=!1){return new qc({fu:e,methodName:t,vu:r,path:_e.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function xr(n){let e=n._freezeSettings(),t=na(n._databaseId);return new Np(n._databaseId,!!e.ignoreUndefinedProperties,t)}function el(n,e,t,r,i,s={}){let o=n.Fu(s.merge||s.mergeFields?2:0,e,t,i);Tg("Data must be an object, but it was:",o,r);let a=aT(r,o),u,c;if(s.merge)u=new ht(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let h of s.mergeFields){let d=Up(e,h,t);if(!o.contains(d))throw new y(m.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);cT(l,d)||l.push(d)}u=new ht(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new Vp(new He(a),u,c)}var Yo=class n extends fn{_toFieldTransform(e){if(e.fu!==2)throw e.fu===1?e.Du(`${this._methodName}() can only appear at the top level of your update data`):e.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function sT(n,e,t){return new qc({fu:3,vu:e.settings.vu,methodName:n._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Mp=class n extends fn{_toFieldTransform(e){return new Tr(e.path,new $n)}isEqual(e){return e instanceof n}},Op=class n extends fn{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=sT(this,e,!0),r=this.Mu.map(s=>kr(s,t)),i=new hn(r);return new Tr(e.path,i)}isEqual(e){return e instanceof n&&Ml(this.Mu,e.Mu)}},Fp=class n extends fn{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=sT(this,e,!0),r=this.Mu.map(s=>kr(s,t)),i=new dn(r);return new Tr(e.path,i)}isEqual(e){return e instanceof n&&Ml(this.Mu,e.Mu)}},Lp=class n extends fn{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){let t=new zn(e.serializer,zE(e.serializer,this.xu));return new Tr(e.path,t)}isEqual(e){return e instanceof n&&this.xu===e.xu}};function Eg(n,e,t,r){let i=n.Fu(1,e,t);Tg("Data must be an object, but it was:",i,r);let s=[],o=He.empty();Pr(r,(u,c)=>{let l=Ag(e,u,t);c=ee(c);let h=i.Su(l);if(c instanceof Yo)s.push(l);else{let d=kr(c,h);d!=null&&(s.push(l),o.set(l,d))}});let a=new ht(s);return new Bc(o,a,i.fieldTransforms)}function Ig(n,e,t,r,i,s){let o=n.Fu(1,e,t),a=[Up(e,r,t)],u=[i];if(s.length%2!=0)throw new y(m.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Up(e,s[d])),u.push(s[d+1]);let c=[],l=He.empty();for(let d=a.length-1;d>=0;--d)if(!cT(c,a[d])){let f=a[d],E=u[d];E=ee(E);let w=o.Su(f);if(E instanceof Yo)c.push(f);else{let _=kr(E,w);_!=null&&(c.push(f),l.set(f,_))}}let h=new ht(c);return new Bc(l,h,o.fieldTransforms)}function oT(n,e,t,r=!1){return kr(t,n.Fu(r?4:3,e))}function kr(n,e){if(uT(n=ee(n)))return Tg("Unsupported field value:",e,n),aT(n,e);if(n instanceof fn)return function(r,i){if(!iT(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.yu&&e.fu!==4)throw e.Du("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=kr(a,i.bu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ee(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return zE(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=he.fromDate(r);return{timestampValue:Vi(i.serializer,s)}}if(r instanceof he){let s=new he(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Vi(i.serializer,s)}}if(r instanceof br)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Jt)return{bytesValue:eI(i.serializer,r._byteString)};if(r instanceof ie){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Du(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Jp(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${Zc(r)}`)}(n,e)}function aT(n,e){let t={};return SE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Pr(n,(r,i)=>{let s=kr(i,e.pu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function uT(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof he||n instanceof br||n instanceof Jt||n instanceof ie||n instanceof fn)}function Tg(n,e,t){if(!uT(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=Zc(t);throw r==="an object"?e.Du(n+" a custom object"):e.Du(n+" "+r)}}function Up(n,e,t){if((e=ee(e))instanceof kt)return e._internalPath;if(typeof e=="string")return Ag(n,e);throw $c("Field path arguments must be of type string or ",n,!1,void 0,t)}var oP=new RegExp("[~\\*/\\[\\]]");function Ag(n,e,t){if(e.search(oP)>=0)throw $c(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new kt(...e.split("."))._internalPath}catch{throw $c(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function $c(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new y(m.INVALID_ARGUMENT,a+n+u)}function cT(n,e){return n.some(t=>t.isEqual(e))}var Rr=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ie(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new jp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(tl("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},jp=class extends Rr{data(){return super.data()}};function tl(n,e){return typeof e=="string"?Ag(n,e):e instanceof kt?e._internalPath:e._delegate._internalPath}function lT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new y(m.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Xo=class{},Dr=class extends Xo{};function mn(n,e,...t){let r=[];e instanceof Xo&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof Bp).length,a=s.filter(u=>u instanceof zc).length;if(o>1||o>0&&a>0)throw new y(m.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var zc=class n extends Dr{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return wT(e._query,t),new Le(e.firestore,e.converter,_f(e._query,t))}_parse(e){let t=xr(e.firestore);return function(s,o,a,u,c,l,h){let d;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new y(m.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){dE(h,l);let f=[];for(let E of h)f.push(hE(u,s,E));d={arrayValue:{values:f}}}else d=hE(u,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||dE(h,l),d=oT(a,o,h,l==="in"||l==="not-in");return G.create(c,l,d)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function hT(n,e,t){let r=e,i=tl("where",n);return zc._create(i,r,t)}var Bp=class n extends Xo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:J.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)wT(o,u),o=_f(o,u)}(e._query,t),new Le(e.firestore,e.converter,_f(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var qp=class n extends Dr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Er(s,o)}(e._query,this._field,this._direction);return new Le(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Pt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function dT(n,e="asc"){let t=e,r=tl("orderBy",n);return qp._create(r,t)}var Gc=class n extends Dr{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Le(e.firestore,e.converter,lc(e._query,this._limit,this._limitType))}};function fT(n){return $I("limit",n),Gc._create("limit",n,"F")}function pT(n){return $I("limitToLast",n),Gc._create("limitToLast",n,"L")}var Hc=class n extends Dr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=vT(e,this.type,this._docOrFields,this._inclusive);return new Le(e.firestore,e.converter,function(i,s){return new Pt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function gT(...n){return Hc._create("startAt",n,!0)}function mT(...n){return Hc._create("startAfter",n,!1)}var Wc=class n extends Dr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=vT(e,this.type,this._docOrFields,this._inclusive);return new Le(e.firestore,e.converter,function(i,s){return new Pt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function yT(...n){return Wc._create("endBefore",n,!1)}function _T(...n){return Wc._create("endAt",n,!0)}function vT(n,e,t,r){if(t[0]=ee(t[0]),t[0]instanceof Rr)return function(s,o,a,u,c){if(!u)throw new y(m.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let h of Ci(s))if(h.field.isKeyField())l.push(wr(o,u.key));else{let d=u.data.field(h.field);if(Qc(d))throw new y(m.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){let f=h.field.canonicalString();throw new y(m.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}l.push(d)}return new Yt(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=xr(n.firestore);return function(o,a,u,c,l,h){let d=o.explicitOrderBy;if(l.length>d.length)throw new y(m.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let f=[];for(let E=0;E<l.length;E++){let w=l[E];if(d[E].field.isKeyField()){if(typeof w!="string")throw new y(m.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof w}`);if(!Yp(o)&&w.indexOf("/")!==-1)throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${w}' contains a slash.`);let _=o.path.child(W.fromString(w));if(!I.isDocumentKey(_))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${_}' is not because it contains an odd number of segments.`);let D=new I(_);f.push(wr(a,D))}else{let _=oT(u,c,w);f.push(_)}}return new Yt(f,h)}(n._query,n.firestore._databaseId,i,e,t,r)}}function hE(n,e,t){if(typeof(t=ee(t))=="string"){if(t==="")throw new y(m.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yp(e)&&t.indexOf("/")!==-1)throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(W.fromString(t));if(!I.isDocumentKey(r))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return wr(n,new I(r))}if(t instanceof ie)return wr(n,t._key);throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zc(t)}.`)}function dE(n,e){if(!Array.isArray(n)||n.length===0)throw new y(m.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function wT(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new y(m.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new y(m.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var $i=class{convertValue(e,t="none"){switch(vr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(jn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw S()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Pr(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new br(pe(e.latitude),pe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Kp(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Vo(e));default:return null}}convertTimestamp(e){let t=ln(e);return new he(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=W.fromString(e);P(hI(r));let i=new Bn(r.get(1),r.get(3)),s=new I(r.popFirst(5));return i.isEqual(t)||ye(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function nl(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var $p=class extends $i{constructor(e){super(),this.firestore=e}convertBytes(e){return new Jt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ie(this.firestore,null,t)}};var cn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},wt=class extends Rr{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Fn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(tl("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Fn=class extends wt{data(e={}){return super.data(e)}},Vt=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new cn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Fn(this._firestore,this._userDataWriter,r.key,r,new cn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new y(m.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new Fn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new cn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new Fn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new cn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,l=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:aP(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function aP(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function Cg(n,e){return n instanceof wt&&e instanceof wt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Vt&&e instanceof Vt&&n._firestore===e._firestore&&wg(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function ET(n){n=K(n,ie);let e=K(n.firestore,ue);return jI(Re(e),n._key).then(t=>Dg(e,n,t))}var pn=class extends $i{constructor(e){super(),this.firestore=e}convertBytes(e){return new Jt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ie(this.firestore,null,t)}};function IT(n){n=K(n,ie);let e=K(n.firestore,ue),t=Re(e),r=new pn(e);return eP(t,n._key).then(i=>new wt(e,r,n._key,i,new cn(i!==null&&i.hasLocalMutations,!0),n.converter))}function TT(n){n=K(n,ie);let e=K(n.firestore,ue);return jI(Re(e),n._key,{source:"server"}).then(t=>Dg(e,n,t))}function AT(n){n=K(n,Le);let e=K(n.firestore,ue),t=Re(e),r=new pn(e);return lT(n._query),BI(t,n._query).then(i=>new Vt(e,r,n,i))}function CT(n){n=K(n,Le);let e=K(n.firestore,ue),t=Re(e),r=new pn(e);return tP(t,n._query).then(i=>new Vt(e,r,n,i))}function ST(n){n=K(n,Le);let e=K(n.firestore,ue),t=Re(e),r=new pn(e);return BI(t,n._query,{source:"server"}).then(i=>new Vt(e,r,n,i))}function Sg(n,e,t){n=K(n,ie);let r=K(n.firestore,ue),i=nl(n.converter,e,t);return Yi(r,[el(xr(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,ge.none())])}function bg(n,e,t,...r){n=K(n,ie);let i=K(n.firestore,ue),s=xr(i),o;return o=typeof(e=ee(e))=="string"||e instanceof kt?Ig(s,"updateDoc",n._key,e,t,r):Eg(s,"updateDoc",n._key,e),Yi(i,[o.toMutation(n._key,ge.exists(!0))])}function bT(n){return Yi(K(n.firestore,ue),[new Hn(n._key,ge.none())])}function RT(n,e){let t=K(n.firestore,ue),r=ia(n),i=nl(n.converter,e);return Yi(t,[el(xr(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,ge.exists(!1))]).then(()=>r)}function Rg(n,...e){var t,r,i;n=ee(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||xp(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(xp(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let u,c,l;if(n instanceof ie)c=K(n.firestore,ue),l=Gi(n._key.path),u={next:h=>{e[o]&&e[o](Dg(c,n,h))},error:e[o+1],complete:e[o+2]};else{let h=K(n,Le);c=K(h.firestore,ue),l=h._query;let d=new pn(c);u={next:f=>{e[o]&&e[o](new Vt(c,d,h,f))},error:e[o+1],complete:e[o+2]},lT(n._query)}return function(d,f,E,w){let _=new Bi(w),D=new Wo(f,_,E);return d.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return sg(yield qi(d),D)})),()=>{_.$a(),d.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return og(yield qi(d),D)}))}}(Re(c),l,a,u)}function DT(n,e){return nP(Re(n=K(n,ue)),xp(e)?e:{next:e})}function Yi(n,e){return function(r,i){let s=new Ce;return r.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return MD(yield gg(r),i,s)})),s.promise}(Re(n),e)}function Dg(n,e,t){let r=t.docs.get(e._key),i=new pn(n);return new wt(n,i,e._key,r,new cn(t.hasPendingWrites,t.fromCache),e.converter)}var uP={maxAttempts:5};var Kc=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=xr(e)}set(e,t,r){this._verifyNotCommitted();let i=Mn(e,this._firestore),s=nl(i.converter,t,r),o=el(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,ge.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Mn(e,this._firestore),o;return o=typeof(t=ee(t))=="string"||t instanceof kt?Ig(this._dataReader,"WriteBatch.update",s._key,t,r,i):Eg(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,ge.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Mn(e,this._firestore);return this._mutations=this._mutations.concat(new Hn(t._key,ge.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(m.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Mn(n,e){if((n=ee(n)).firestore!==e)throw new y(m.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var zp=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=xr(t)}get(t){let r=Mn(t,this._firestore),i=new $p(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return S();let o=s[0];if(o.isFoundDocument())return new Rr(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Rr(this._firestore,i,r._key,null,r.converter);throw S()})}set(t,r,i){let s=Mn(t,this._firestore),o=nl(s.converter,r,i),a=el(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=Mn(t,this._firestore),a;return a=typeof(r=ee(r))=="string"||r instanceof kt?Ig(this._dataReader,"Transaction.update",o._key,r,i,s):Eg(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=Mn(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Mn(e,this._firestore),r=new pn(this._firestore);return super.get(e).then(i=>new wt(this._firestore,r,t._key,i._document,new cn(!1,!1),t.converter))}};function PT(n,e,t){n=K(n,ue);let r=Object.assign(Object.assign({},uP),t);return function(s){if(s.maxAttempts<1)throw new y(m.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new Ce;return s.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let c=yield XD(s);new bp(s.asyncQueue,c,a,o,u).Xa()})),u.promise}(Re(n),i=>e(new zp(n,i)),r)}function xT(){return new Yo("deleteField")}function kT(){return new Mp("serverTimestamp")}function VT(...n){return new Op("arrayUnion",n)}function NT(...n){return new Fp("arrayRemove",n)}function MT(n){return new Lp("increment",n)}(function(e,t=!0){(function(i){zi=i})(ba),er(new nn("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new ue(new Kd(r.getProvider("auth-internal")),new Jd(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new y(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bn(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Ke(fw,"4.6.1",e),Ke(fw,"4.6.1","esm2017")})();var cP="@firebase/firestore-compat",lP="0.3.30";function Mg(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function OT(){if(typeof Uint8Array>"u")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function FT(){if(!bE())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}var rl=class n{constructor(e){this._delegate=e}static fromBase64String(e){return FT(),new n(Jt.fromBase64String(e))}static fromUint8Array(e){return OT(),new n(Jt.fromUint8Array(e))}toBase64(){return FT(),this._delegate.toBase64()}toUint8Array(){return OT(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Pg(n){return hP(n,["next","error","complete"])}function hP(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var xg=class{enableIndexedDbPersistence(e,t){return KI(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return QI(e._delegate)}clearIndexedDbPersistence(e){return XI(e._delegate)}},il=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Bn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&_t("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){zI(this._delegate,e,t,r)}enableNetwork(){return ZI(this._delegate)}disableNetwork(){return eT(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,yg("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return JI(this._delegate)}onSnapshotsInSync(e){return DT(this._delegate,e)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Zi(this,_g(this._delegate,e))}catch(t){throw Ze(t,"collection()","Firestore.collection()")}}doc(e){try{return new Zt(this,ia(this._delegate,e))}catch(t){throw Ze(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Or(this,GI(this._delegate,e))}catch(t){throw Ze(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return PT(this._delegate,t=>e(new sl(this,t)))}batch(){return Re(this._delegate),new ol(new Kc(this._delegate,e=>Yi(this._delegate,e)))}loadBundle(e){return tT(this._delegate,e)}namedQuery(e){return nT(this._delegate,e).then(t=>t?new Or(this,t):null)}},Xi=class extends $i{constructor(e){super(),this.firestore=e}convertBytes(e){return new rl(new Jt(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Zt.forKey(t,this.firestore,null)}};function dP(n){fE(n)}var sl=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Xi(e)}get(e){let t=Vr(e);return this._delegate.get(t).then(r=>new Nr(this._firestore,new wt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Vr(e);return r?(Mg("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Vr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Vr(e);return this._delegate.delete(t),this}},ol=class{constructor(e){this._delegate=e}set(e,t,r){let i=Vr(e);return r?(Mg("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Vr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Vr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Ji=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Fn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Mr(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Xi(e),t),i.set(t,s)),s}};Ji.INSTANCES=new WeakMap;var Zt=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Xi(e)}static forPath(e,t,r){if(e.length%2!==0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new ie(t._delegate,r,new I(e)))}static forKey(e,t,r){return new n(t,new ie(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Zi(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Zi(this.firestore,_g(this._delegate,e))}catch(t){throw Ze(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ee(e),e instanceof ie?vg(this._delegate,e):!1}set(e,t){t=Mg("DocumentReference.set",t);try{return t?Sg(this._delegate,e,t):Sg(this._delegate,e)}catch(r){throw Ze(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?bg(this._delegate,e):bg(this._delegate,e,t,...r)}catch(i){throw Ze(i,"updateDoc()","DocumentReference.update()")}}delete(){return bT(this._delegate)}onSnapshot(...e){let t=LT(e),r=UT(e,i=>new Nr(this.firestore,new wt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Rg(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=IT(this._delegate):e?.source==="server"?t=TT(this._delegate):t=ET(this._delegate),t.then(r=>new Nr(this.firestore,new wt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ji.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ze(n,e,t){return n.message=n.message.replace(e,t),n}function LT(n){for(let e of n)if(typeof e=="object"&&!Pg(e))return e;return{}}function UT(n,e){var t,r;let i;return Pg(n[0])?i=n[0]:Pg(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Nr=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Zt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Cg(this._delegate,e._delegate)}},Mr=class extends Nr{data(e){let t=this._delegate.data(e);return this._delegate._converter||pE(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Or=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Xi(e)}where(e,t,r){try{return new n(this.firestore,mn(this._delegate,hT(e,t,r)))}catch(i){throw Ze(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,mn(this._delegate,dT(e,t)))}catch(r){throw Ze(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,mn(this._delegate,fT(e)))}catch(t){throw Ze(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,mn(this._delegate,pT(e)))}catch(t){throw Ze(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,mn(this._delegate,gT(...e)))}catch(t){throw Ze(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,mn(this._delegate,mT(...e)))}catch(t){throw Ze(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,mn(this._delegate,yT(...e)))}catch(t){throw Ze(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,mn(this._delegate,_T(...e)))}catch(t){throw Ze(t,"endAt()","Query.endAt()")}}isEqual(e){return wg(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=CT(this._delegate):e?.source==="server"?t=ST(this._delegate):t=AT(this._delegate),t.then(r=>new sa(this.firestore,new Vt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=LT(e),r=UT(e,i=>new sa(this.firestore,new Vt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Rg(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ji.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},kg=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Mr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},sa=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Or(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Mr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new kg(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Mr(this._firestore,r))})}isEqual(e){return Cg(this._delegate,e._delegate)}},Zi=class n extends Or{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Zt(this.firestore,e):null}doc(e){try{return e===void 0?new Zt(this.firestore,ia(this._delegate)):new Zt(this.firestore,ia(this._delegate,e))}catch(t){throw Ze(t,"doc()","CollectionReference.doc()")}}add(e){return RT(this._delegate,e).then(t=>new Zt(this.firestore,t))}isEqual(e){return vg(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ji.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Vr(n){return K(n,ie)}var Vg=class n{constructor(...e){this._delegate=new kt(...e)}static documentId(){return new n(_e.keyField().canonicalString())}isEqual(e){return e=ee(e),e instanceof kt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Ng=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=kT();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=xT();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=VT(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=NT(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=MT(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var fP={Firestore:il,GeoPoint:br,Timestamp:he,Blob:rl,Transaction:sl,WriteBatch:ol,DocumentReference:Zt,DocumentSnapshot:Nr,Query:Or,QueryDocumentSnapshot:Mr,QuerySnapshot:sa,CollectionReference:Zi,FieldPath:Vg,FieldValue:Ng,setLogLevel:dP,CACHE_SIZE_UNLIMITED:HI};function pP(n,e){n.INTERNAL.registerComponent(new nn("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},fP)))}function gP(n){pP(n,(e,t)=>new il(e,t,new xg)),n.registerVersion(cP,lP)}gP(rt);function mP(n,e=ca){return new yn(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function jT(n,e){return mP(n,e)}function yP(n,e){return jT(n,e).pipe(jr(void 0),da(),F(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function Lg(n,e){return jT(n,e).pipe(F(t=>({payload:t,type:"query"})))}var al=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=$T(r,t);return new cl(i,s,this.afs)}snapshotChanges(){return yP(this.ref,this.afs.schedulers.outsideAngular).pipe(Qe)}valueChanges(e={}){return this.snapshotChanges().pipe(F(({payload:t})=>e.idField?te(b({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Z(this.ref.get(e)).pipe(Qe)}};function ul(n,e){return Lg(n,e).pipe(jr(void 0),da(),F(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{let c=s.find(h=>h.doc.ref.isEqual(a.ref)),l=r?.payload.docs.find(h=>h.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&l&&JSON.stringify(l.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function BT(n,e,t){return ul(n,t).pipe(Ur((r,i)=>_P(r,i.map(s=>s.payload),e),[]),cm(),F(r=>r.map(i=>({type:i.type,payload:i}))))}function _P(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=vP(n,r))}),n}function Og(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function vP(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return Og(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return Og(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Og(n,e.oldIndex,1);break}return n}function qT(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var cl=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=ul(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(F(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(jr(void 0),da(),pt(([r,i])=>i.length>0||!r),F(([,r])=>r),Qe)}auditTrail(e){return this.stateChanges(e).pipe(Ur((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=qT(e);return BT(this.query,t,this.afs.schedulers.outsideAngular).pipe(Qe)}valueChanges(e={}){return Lg(this.query,this.afs.schedulers.outsideAngular).pipe(F(t=>t.payload.docs.map(r=>e.idField?te(b({},r.data()),{[e.idField]:r.id}):r.data())),Qe)}get(e){return Z(this.query.get(e)).pipe(Qe)}add(e){return this.ref.add(e)}doc(e){return new al(this.ref.doc(e),this.afs)}},Fg=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?ul(this.query,this.afs.schedulers.outsideAngular).pipe(Qe):ul(this.query,this.afs.schedulers.outsideAngular).pipe(F(t=>t.filter(r=>e.indexOf(r.type)>-1)),pt(t=>t.length>0),Qe)}auditTrail(e){return this.stateChanges(e).pipe(Ur((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=qT(e);return BT(this.query,t,this.afs.schedulers.outsideAngular).pipe(Qe)}valueChanges(e={}){return Lg(this.query,this.afs.schedulers.outsideAngular).pipe(F(r=>r.payload.docs.map(i=>e.idField?b({[e.idField]:i.id},i.data()):i.data())),Qe)}get(e){return Z(this.query.get(e)).pipe(Qe)}},wP=new q("angularfire2.enableFirestorePersistence"),EP=new q("angularfire2.firestore.persistenceSettings"),IP=new q("angularfire2.firestore.settings"),TP=new q("angularfire2.firestore.use-emulator");function $T(n,e=t=>t){return{query:e(n),ref:n}}var es=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,u,c,l,h,d,f,E,w,_,D,M){this.schedulers=u;let C=Ks(t,a,r),V=l;h&&Yh(C,a,d,E,w,_,f,D),[this.firestore,this.persistenceEnabled$]=fu(`${C.name}.firestore`,"AngularFirestore",C.name,()=>{let L=a.runOutsideAngular(()=>C.firestore());if(s&&L.settings(s),V&&L.useEmulator(...V),i&&!Zn(o)){let z=()=>{try{return Z(L.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(de){return typeof console<"u"&&console.warn(de),x(!1)}};return[L,a.runOutsideAngular(z)]}else return[L,x(!1)]},[s,V,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=$T(i,r),a=this.schedulers.ngZone.run(()=>s);return new cl(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new Fg(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new al(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(R(oi),R(ai,8),R(wP,8),R(IP,8),R(Tt),R(le),R(sr),R(EP,8),R(TP,8),R(Xh,8),R(zh,8),R(Gh,8),R(Hh,8),R(Wh,8),R(Kh,8),R(Qh,8),R(jt,8))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var ll=(()=>{let e=class e{constructor(r){this.firestore=r}setCollection(r){this.collection=this.firestore.collection(r)}getDocuments(){if(!this.collection)throw new Error("Collection path not set.");return this.collection.snapshotChanges().pipe(F(r=>r.map(i=>{let s=i.payload.doc.data(),o=i.payload.doc.id;return te(b({},s),{id:o})})),Et(r=>{throw console.error("Error obtaining data from Firestore:",r),r}))}addDocument(r){return Z(this.collection.add(r)).pipe(me(i=>this.collection.doc(i.id).valueChanges()))}updateDocument(r,i){return Z(this.collection.doc(r).update(i)).pipe(Et(s=>{throw console.error("Error updating document in Firestore:",s),s}))}deleteDocument(r){return Z(this.collection.doc(r).delete()).pipe(Et(i=>{throw console.error("Error deleting document from Firestore:",i),i}))}getDocumentById(r){return this.collection.doc(r).get().pipe(me(i=>{if(i.exists){let s=i.data();return x(s)}else return console.error("Document with provided ID does not exist:",r),x(void 0)}),Et(i=>{throw console.error("Error getting document by ID:",i),i}))}};e.\u0275fac=function(i){return new(i||e)(R(es))},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var zT=(()=>{let e=class e{imageLoaded(){console.log("La imagen ha sido cargada.")}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=we({type:e,selectors:[["shared-image-perfil"]],decls:2,vars:0,consts:[[1,"flex","justify-center","mx-3","rounded-xl"],["src","https://firebasestorage.googleapis.com/v0/b/portfolio-549f8.appspot.com/o/portfolio%2Fperfil.jpeg?alt=media&token=5913f7c4-163a-4e4e-8663-977507603d90","alt","Profile Picture",1,"w-16","sm:w-56","md:w-48","lg:w-64","h-auto","rounded-xl","object-cover",3,"load"]],template:function(i,s){i&1&&(re(0,"div",0)(1,"img",1),At("load",function(){return s.imageLoaded()}),se()())},styles:["[_nghost-%COMP%]{display:block}"]});let n=e;return n})();var GT=(()=>{let e=class e{constructor(){this.description=""}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=we({type:e,selectors:[["share-descriptions"]],inputs:{description:"description"},decls:2,vars:1,consts:[[1,"text-slate-300","text-md","mx-4","mt-2","text-center"]],template:function(i,s){i&1&&(re(0,"p",0),nt(1),se()),i&2&&(Ee(),tn(" ",s.description,`
`))}});let n=e;return n})();var HT=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=we({type:e,selectors:[["shared-title"]],inputs:{name:"name",university_title:"university_title"},decls:4,vars:2,consts:[[1,"text-center","font-bold","text-2xl","mt-4","mx-3"],[1,"text-center","font-semibold","text-xl","mt-1","mx-3"]],template:function(i,s){i&1&&(re(0,"p",0),nt(1),se(),re(2,"p",1),nt(3),se()),i&2&&(Ee(),tn(" ",s.name,`
`),Ee(2),tn(" ",s.university_title,`
`))}});let n=e;return n})();var WT=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=we({type:e,selectors:[["shared-social-networks"]],decls:6,vars:0,consts:[[1,"flex","justify-center"],[1,"flex","space-x-16"],["href","https://github.com/maxpoblete2905","target","_blank",1,"hover:text-blue-500","transition","duration-300","transform","hover:scale-110"],["src","https://firebasestorage.googleapis.com/v0/b/portfolio-549f8.appspot.com/o/portfolio%2Fgithub.png?alt=media&token=d64c46a0-e694-466c-8adb-24df0abe4f2c","alt","img-codepen",1,"w-8","h-8"],["href","https://www.linkedin.com/in/max-esteban-poblete-pizarro-9979811bb/","target","_blank",1,"hover:text-blue-500","transition","duration-300","transform","hover:scale-110"],["src","https://firebasestorage.googleapis.com/v0/b/portfolio-549f8.appspot.com/o/portfolio%2Flinkedin.png?alt=media&token=e7220f70-edfa-4b1c-855d-5c68c95dd0d0","alt","img-codepen",1,"w-8","h-8"]],template:function(i,s){i&1&&(re(0,"div",0)(1,"div",1)(2,"a",2),tt(3,"img",3),se(),re(4,"a",4),tt(5,"img",5),se()()())}});let n=e;return n})();function RP(n,e){if(n&1&&(re(0,"li",5),tt(1,"img",6),re(2,"p",7),nt(3),se()()),n&2){let t=e.$implicit;ot("routerLink",t.route),Ee(),bl("alt","",t.name," icon"),ot("src",t.icon,cs),Ee(2),tn(" ",t.name," ")}}function DP(n,e){if(n&1&&(re(0,"li",8),tt(1,"img",9),se()),n&2){let t=e.$implicit;ot("routerLink",t.route),Ee(),bl("alt","",t.name," icon"),ot("src",t.icon,cs)}}var KT=(()=>{let e=class e{constructor(){this.images=["assets/perfil.jpeg","assets/perfil.jpeg","assets/perfil.jpeg"],this.sections=[{route:"projects",name:"Proyectos",icon:"https://firebasestorage.googleapis.com/v0/b/portfolio-549f8.appspot.com/o/portfolio%2Ftecnologias%2Fprojects.png?alt=media&token=4ce67736-85ae-4090-b406-4c129c734635"},{route:"skills",name:"Skills",icon:"https://firebasestorage.googleapis.com/v0/b/portfolio-549f8.appspot.com/o/portfolio%2Ftecnologias%2Fskills.png?alt=media&token=d2807831-2bef-4af7-84c1-e665ff43fb0b"},{route:"education",name:"Educaci\xF3n",icon:"https://firebasestorage.googleapis.com/v0/b/portfolio-549f8.appspot.com/o/portfolio%2Ftecnologias%2Fgraduation.png?alt=media&token=2f511121-ac98-47aa-9994-058c8754447a"},{route:"contact",name:"Contacto",icon:"https://cdn-icons-png.flaticon.com/128/732/732200.png"}]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=we({type:e,selectors:[["shared-menu"]],decls:5,vars:2,consts:[[1,"mx-3"],[1,"hidden","sm:flex","flex-col"],["routerLinkActive","text-blue-400","class","flex items-center cursor-pointer border-b-2 ml-4 mt-4",3,"routerLink",4,"ngFor","ngForOf"],[1,"sm:hidden","flex","justify-center","gap-5"],["routerLinkActive","text-blue-400","class","cursor-pointer ml-4 mt-4 flex",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","text-blue-400",1,"flex","items-center","cursor-pointer","border-b-2","ml-4","mt-4",3,"routerLink"],[1,"mr-2","w-6","h-6",3,"src","alt"],[1,"text-lg"],["routerLinkActive","text-blue-400",1,"cursor-pointer","ml-4","mt-4","flex",3,"routerLink"],[1,"mr-1","w-6","h-6",3,"src","alt"]],template:function(i,s){i&1&&(re(0,"div",0)(1,"ul",1),hs(2,RP,4,5,"li",2),se(),re(3,"ul",3),hs(4,DP,2,4,"li",4),se()()),i&2&&(Ee(2),ot("ngForOf",s.sections),Ee(2),ot("ngForOf",s.sections))},dependencies:[wa,Wa,Wy]});let n=e;return n})();var xx="auth";var hl=class{constructor(){return Hs(xx)}};var t0="firebasestorage.googleapis.com",n0="storageBucket",kx=2*60*1e3,Vx=10*60*1e3;var Me=class n extends Aa{constructor(e,t,r=0){super(jg(e),`Firebase Storage: ${t} (${jg(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return jg(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},je=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(je||{});function jg(n){return"storage/"+n}function r0(){let n="An unknown error occurred, please check the error payload for server response.";return new Me(je.UNKNOWN,n)}function Nx(n){return new Me(je.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function Mx(n){return new Me(je.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Ox(){let n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Me(je.UNAUTHENTICATED,n)}function Fx(){return new Me(je.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Lx(n){return new Me(je.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function Ux(){return new Me(je.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function jx(){return new Me(je.CANCELED,"User canceled the upload/download.")}function Bx(n){return new Me(je.INVALID_URL,"Invalid URL '"+n+"'.")}function qx(n){return new Me(je.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function $x(){return new Me(je.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+n0+"' property when initializing the app?")}function zx(){return new Me(je.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Bg(n){return new Me(je.INVALID_ARGUMENT,n)}function i0(){return new Me(je.APP_DELETED,"The Firebase app was deleted.")}function Gx(n){return new Me(je.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function oa(n){throw new Me(je.INTERNAL_ERROR,"Internal error: "+n)}var dt=class n{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=n.makeFromUrl(e,t)}catch{return new n(e,"")}if(r.path==="")return r;throw qx(e)}static makeFromUrl(e,t){let r=null,i="([A-Za-z0-9.\\-_]+)";function s(V){V.path.charAt(V.path.length-1)==="/"&&(V.path_=V.path_.slice(0,-1))}let o="(/(.*))?$",a=new RegExp("^gs://"+i+o,"i"),u={bucket:1,path:3};function c(V){V.path_=decodeURIComponent(V.path)}let l="v[A-Za-z0-9_]+",h=t.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",f=new RegExp(`^https?://${h}/${l}/b/${i}/o${d}`,"i"),E={bucket:1,path:3},w=t===t0?"(?:storage.googleapis.com|storage.cloud.google.com)":t,_="([^?#]*)",D=new RegExp(`^https?://${w}/${i}/${_}`,"i"),C=[{regex:a,indices:u,postModify:s},{regex:f,indices:E,postModify:c},{regex:D,indices:{bucket:1,path:2},postModify:c}];for(let V=0;V<C.length;V++){let L=C[V],z=L.regex.exec(e);if(z){let de=z[L.indices.bucket],et=z[L.indices.path];et||(et=""),r=new n(de,et),L.postModify(r);break}}if(r==null)throw Bx(e);return r}},qg=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function Hx(n,e,t){let r=1,i=null,s=null,o=!1,a=0;function u(){return a===2}let c=!1;function l(..._){c||(c=!0,e.apply(null,_))}function h(_){i=setTimeout(()=>{i=null,n(f,u())},_)}function d(){s&&clearTimeout(s)}function f(_,...D){if(c){d();return}if(_){d(),l.call(null,_,...D);return}if(u()||o){d(),l.call(null,_,...D);return}r<64&&(r*=2);let C;a===1?(a=2,C=0):C=(r+Math.random())*1e3,h(C)}let E=!1;function w(_){E||(E=!0,d(),!c&&(i!==null?(_||(a=2),clearTimeout(i),h(0)):_||(a=1)))}return h(0),s=setTimeout(()=>{o=!0,w(!0)},t),w}function Wx(n){n(!1)}function Kx(n){return n!==void 0}function Qx(n){return typeof n=="object"&&!Array.isArray(n)}function s0(n){return typeof n=="string"||n instanceof String}function $g(n,e,t,r){if(r<e)throw Bg(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Bg(`Invalid value for '${n}'. Expected ${t} or less.`)}function Wg(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function o0(n){let e=encodeURIComponent,t="?";for(let r in n)if(n.hasOwnProperty(r)){let i=e(r)+"="+e(n[r]);t=t+i+"&"}return t=t.slice(0,-1),t}var ns=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(ns||{});function Yx(n,e){let t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||i||s}var zg=class{constructor(e,t,r,i,s,o,a,u,c,l,h,d=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=u,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=h,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((f,E)=>{this.resolve_=f,this.reject_=E,this.start_()})}start_(){let e=(r,i)=>{if(i){r(!1,new ts(!1,null,!0));return}let s=this.connectionFactory_();this.pendingConnection_=s;let o=a=>{let u=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,c)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;let a=s.getErrorCode()===ns.NO_ERROR,u=s.getStatus();if(!a||Yx(u,this.additionalRetryCodes_)&&this.retry){let l=s.getErrorCode()===ns.ABORT;r(!1,new ts(!1,null,l));return}let c=this.successCodes_.indexOf(u)!==-1;r(!0,new ts(c,s))})},t=(r,i)=>{let s=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{let u=this.callback_(a,a.getResponse());Kx(u)?s(u):s()}catch(u){o(u)}else if(a!==null){let u=r0();u.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,u)):o(u)}else if(i.canceled){let u=this.appDelete_?i0():jx();o(u)}else{let u=Ux();o(u)}};this.canceled_?t(!1,new ts(!1,null,!0)):this.backoffId_=Hx(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Wx(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},ts=class{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}};function Xx(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function Jx(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function Zx(n,e){e&&(n["X-Firebase-GMPID"]=e)}function ek(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function tk(n,e,t,r,i,s,o=!0){let a=o0(n.urlParams),u=n.url+a,c=Object.assign({},n.headers);return Zx(c,e),Xx(c,t),Jx(c,s),ek(c,r),new zg(u,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o)}function Kg(n){let e;try{e=JSON.parse(n)}catch{return null}return Qx(e)?e:null}function nk(n){if(n.length===0)return null;let e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function rk(n,e){let t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function a0(n){let e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}function ik(n,e){return e}var Ue=class{constructor(e,t,r,i){this.server=e,this.local=t||e,this.writable=!!r,this.xform=i||ik}},dl=null;function sk(n){return!s0(n)||n.length<2?n:a0(n)}function ok(){if(dl)return dl;let n=[];n.push(new Ue("bucket")),n.push(new Ue("generation")),n.push(new Ue("metageneration")),n.push(new Ue("name","fullPath",!0));function e(s,o){return sk(o)}let t=new Ue("name");t.xform=e,n.push(t);function r(s,o){return o!==void 0?Number(o):o}let i=new Ue("size");return i.xform=r,n.push(i),n.push(new Ue("timeCreated")),n.push(new Ue("updated")),n.push(new Ue("md5Hash",null,!0)),n.push(new Ue("cacheControl",null,!0)),n.push(new Ue("contentDisposition",null,!0)),n.push(new Ue("contentEncoding",null,!0)),n.push(new Ue("contentLanguage",null,!0)),n.push(new Ue("contentType",null,!0)),n.push(new Ue("metadata","customMetadata",!0)),dl=n,dl}function ak(n,e){function t(){let r=n.bucket,i=n.fullPath,s=new dt(r,i);return e._makeStorageReference(s)}Object.defineProperty(n,"ref",{get:t})}function uk(n,e,t){let r={};r.type="file";let i=t.length;for(let s=0;s<i;s++){let o=t[s];r[o.local]=o.xform(r,e[o.server])}return ak(r,n),r}function ck(n,e,t){let r=Kg(e);return r===null?null:uk(n,r,t)}function lk(n,e,t,r){let i=Kg(e);if(i===null||!s0(i.downloadTokens))return null;let s=i.downloadTokens;if(s.length===0)return null;let o=encodeURIComponent;return s.split(",").map(c=>{let l=n.bucket,h=n.fullPath,d="/b/"+o(l)+"/o/"+o(h),f=Wg(d,t,r),E=o0({alt:"media",token:c});return f+E})[0]}var QT="prefixes",YT="items";function hk(n,e,t){let r={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[QT])for(let i of t[QT]){let s=i.replace(/\/$/,""),o=n._makeStorageReference(new dt(e,s));r.prefixes.push(o)}if(t[YT])for(let i of t[YT]){let s=n._makeStorageReference(new dt(e,i.name));r.items.push(s)}return r}function dk(n,e,t){let r=Kg(t);return r===null?null:hk(n,e,r)}var fl=class{constructor(e,t,r,i){this.url=e,this.method=t,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};function u0(n){if(!n)throw r0()}function fk(n,e){function t(r,i){let s=dk(n,e,i);return u0(s!==null),s}return t}function pk(n,e){function t(r,i){let s=ck(n,i,e);return u0(s!==null),lk(s,i,n.host,n._protocol)}return t}function c0(n){function e(t,r){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=Fx():i=Ox():t.getStatus()===402?i=Mx(n.bucket):t.getStatus()===403?i=Lx(n.path):i=r,i.status=t.getStatus(),i.serverResponse=r.serverResponse,i}return e}function gk(n){let e=c0(n);function t(r,i){let s=e(r,i);return r.getStatus()===404&&(s=Nx(n.path)),s.serverResponse=i.serverResponse,s}return t}function mk(n,e,t,r,i){let s={};e.isRoot?s.prefix="":s.prefix=e.path+"/",t&&t.length>0&&(s.delimiter=t),r&&(s.pageToken=r),i&&(s.maxResults=i);let o=e.bucketOnlyServerUrl(),a=Wg(o,n.host,n._protocol),u="GET",c=n.maxOperationRetryTime,l=new fl(a,u,fk(n,e.bucket),c);return l.urlParams=s,l.errorHandler=c0(e),l}function yk(n,e,t){let r=e.fullServerUrl(),i=Wg(r,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,a=new fl(i,s,pk(n,t),o);return a.errorHandler=gk(e),a}var MM=256*1024;var XT=null,Gg=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ns.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ns.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ns.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,i){if(this.sent_)throw oa("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(let s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw oa("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw oa("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw oa("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw oa("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}},Hg=class extends Gg{initXhr(){this.xhr_.responseType="text"}};function l0(){return XT?XT():new Hg}var rs=class n{constructor(e,t){this._service=e,t instanceof dt?this._location=t:this._location=dt.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new n(e,t)}get root(){let e=new dt(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return a0(this._location.path)}get storage(){return this._service}get parent(){let e=nk(this._location.path);if(e===null)return null;let t=new dt(this._location.bucket,e);return new n(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw Gx(e)}};function _k(n){let e={prefixes:[],items:[]};return h0(n,e).then(()=>e)}function h0(n,e,t){return g(this,null,function*(){let i=yield vk(n,{pageToken:t});e.prefixes.push(...i.prefixes),e.items.push(...i.items),i.nextPageToken!=null&&(yield h0(n,e,i.nextPageToken))})}function vk(n,e){e!=null&&typeof e.maxResults=="number"&&$g("options.maxResults",1,1e3,e.maxResults);let t=e||{},r=mk(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(r,l0)}function wk(n){n._throwIfRoot("getDownloadURL");let e=yk(n.storage,n._location,ok());return n.storage.makeRequestWithTokens(e,l0).then(t=>{if(t===null)throw zx();return t})}function Ek(n,e){let t=rk(n._location.path,e),r=new dt(n._location.bucket,t);return new rs(n.storage,r)}function Ik(n){return/^[A-Za-z]+:\/\//.test(n)}function Tk(n,e){return new rs(n,e)}function d0(n,e){if(n instanceof aa){let t=n;if(t._bucket==null)throw $x();let r=new rs(t,t._bucket);return e!=null?d0(r,e):r}else return e!==void 0?Ek(n,e):n}function Ak(n,e){if(e&&Ik(e)){if(n instanceof aa)return Tk(n,e);throw Bg("To use ref(service, url), the first argument must be a Storage instance.")}else return d0(n,e)}function JT(n,e){let t=e?.[n0];return t==null?null:dt.makeFromBucketSpec(t,n)}function Ck(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";let{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:Ia(i,n.app.options.projectId))}var aa=class{constructor(e,t,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=t0,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=kx,this._maxUploadRetryTime=Vx,this._requests=new Set,i!=null?this._bucket=dt.makeFromBucketSpec(i,this._host):this._bucket=JT(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=dt.makeFromBucketSpec(this._url,e):this._bucket=JT(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){$g("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){$g("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return g(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return g(this,null,function*(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new rs(this,e)}_makeRequest(e,t,r,i,s=!0){if(this._deleted)return new qg(i0());{let o=tk(e,this._appId,r,i,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){return g(this,null,function*(){let[r,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,i).getPromise()})}},ZT="@firebase/storage",e0="0.12.4";var f0="storage";function p0(n){return n=ee(n),_k(n)}function g0(n){return n=ee(n),wk(n)}function m0(n,e){return n=ee(n),Ak(n,e)}function y0(n=_s(),e){n=ee(n);let r=Sa(n,f0).getImmediate({identifier:e}),i=kl("storage");return i&&_0(r,...i),r}function _0(n,e,t,r={}){Ck(n,e,t,r)}function Sk(n,{instanceIdentifier:e}){let t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new aa(t,r,i,e,ba)}function bk(){er(new nn(f0,Sk,"PUBLIC").setMultipleInstances(!0)),Ke(ZT,e0,""),Ke(ZT,e0,"esm2017")}bk();var ua=class{constructor(e){return e}},v0="storage",Qg=class{constructor(){return Hs(v0)}};var Yg=new q("angularfire2.storage-instances");function Rk(n,e){let t=Fh(v0,n,e);return t&&new ua(t)}function Dk(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new ua(r)}}var Pk={provide:Qg,deps:[[new Ot,Yg]]},xk={provide:ua,useFactory:Rk,deps:[[new Ot,Yg],cu]},kk=(()=>{class n{constructor(){Ke("angularfire",sn.full,"gcs")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=qe({type:n});static \u0275inj=Be({providers:[xk,Pk]})}return n})();function rO(n,...e){return{ngModule:kk,providers:[{provide:Yg,useFactory:Dk(n),multi:!0,deps:[le,qr,sr,lu,[new Ot,hl],[new Ot,jt],...e]}]}}var Xg=si(g0,!0);var w0=si(y0,!0);var E0=si(p0,!0),Jg=si(m0,!0);var I0=(()=>{let e=class e{constructor(){this.storage=w0()}getFileUrl(r){return g(this,null,function*(){let i=Jg(this.storage,r);try{return yield Xg(i)}catch(s){throw console.error(`Archivo no encontrado: ${r}`,s),new Error("Archivo no encontrado")}})}getAllFileUrls(r){return g(this,null,function*(){let i=Jg(this.storage,r);try{let o=(yield E0(i)).items.map(u=>g(this,null,function*(){try{let c=yield Xg(u);return{name:u.name,url:c}}catch(c){return console.warn(`No se pudo obtener la URL de ${u.fullPath}`,c),null}}));return(yield Promise.all(o)).filter(u=>u!==null)}catch(s){return console.error(`Error al listar archivos en ${r}:`,s),[]}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var T0=(()=>{let e=class e{constructor(r){this.storageService=r}downloadPDF(){return g(this,null,function*(){let r=yield this.storageService.getFileUrl("portfolio/cv/cv_max_poblete.pdf"),i=document.createElement("a");i.href=r,i.target="_blank";let s=new Date().toISOString().split("T")[0];i.download=`cv_max_poblete_${s}.pdf`,document.body.appendChild(i),i.click(),document.body.removeChild(i)})}};e.\u0275fac=function(i){return new(i||e)(Q(I0))},e.\u0275cmp=we({type:e,selectors:[["app-download-cv"]],decls:3,vars:0,consts:[[1,"btn-download",3,"click"],[1,"fas","fa-file-pdf"]],template:function(i,s){i&1&&(re(0,"button",0),At("click",function(){return s.downloadPDF()}),tt(1,"i",1),nt(2,` Descargar curriculum PDF
`),se())},styles:[".btn-download[_ngcontent-%COMP%]{background-color:#124670;color:#fff;font-size:16px;font-weight:700;padding:10px 15px;border:none;border-radius:5px;cursor:pointer;display:flex;align-items:center;gap:8px;transition:background .3s;margin:22px}.btn-download[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px}.btn-download[_ngcontent-%COMP%]:hover{background-color:#125185}"]});let n=e;return n})();var lO=(()=>{let e=class e{constructor(r){this.firestore=r,this.images=["assets/perfil.jpeg","assets/perfil.jpeg","assets/perfil.jpeg"],this.name="",this.description="",this.university_title="",this.update="",this.sections=[{route:"projects",name:"Proyectos",icon:"fas fa-code"},{route:"skills",name:"Habilidades",icon:"fas fa-pencil-alt"},{route:"experience",name:"Experiencia",icon:"fas fa-briefcase"},{route:"education",name:"Educaci\xF3n",icon:"fas fa-graduation-cap"},{route:"contact",name:"Contactos",icon:"fas fa-envelope"}],this.firestoreService=new ll(this.firestore),this.firestoreService.setCollection("personal-information")}ngOnInit(){this.firestoreService.getDocuments().subscribe({next:r=>{this.name=r[0].name.toUpperCase(),this.description=r[0].description,this.university_title=r[0].university_title,this.update=r[0].update},error:r=>{console.error("Error loading projects:",r)}})}};e.\u0275fac=function(i){return new(i||e)(Q(es))},e.\u0275cmp=we({type:e,selectors:[["shared-sidebar"]],decls:7,vars:3,consts:[[1,"flex","flex-col","sm:min-h-screen","sm:h-56","lg:h-full","pb-3"],[3,"name","university_title"],[3,"description"],[1,"hidden","md:block","mt-auto"]],template:function(i,s){i&1&&(re(0,"div",0),tt(1,"shared-title",1)(2,"shared-image-perfil")(3,"share-descriptions",2)(4,"shared-menu")(5,"app-download-cv")(6,"shared-social-networks",3),se()),i&2&&(Ee(),ot("name",s.name)("university_title",s.university_title),Ee(2),ot("description",s.description))},dependencies:[zT,GT,HT,WT,KT,T0]});let n=e;return n})();var dO=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=we({type:e,selectors:[["shared-head"]],inputs:{title:"title"},decls:4,vars:1,consts:[[1,"background-class","py-4","m-3","mt-0","rounded-b-xl","text-center","sticky","top-0","z-10"],[1,"mx-auto","items-center"],[1,"text-lg","font-semibold","text-center"]],template:function(i,s){i&1&&(re(0,"header",0)(1,"div",1)(2,"p",2),nt(3),se()()()),i&2&&(Ee(3),Vm(s.title.toUpperCase()))}});let n=e;return n})();function Mk(n,e){if(n&1){let t=Rm();re(0,"div",3),At("click",function(){let i=gm(t).$implicit,s=Dm();return mm(s.realizarAccion(i.label,i.value))}),tt(1,"img",4),re(2,"span"),nt(3),se()()}if(n&2){let t=e.$implicit;Ee(),ot("src",t.icon,cs),Ee(2),tn("",t.value," ")}}var yO=(()=>{let e=class e{constructor(r){this.firestore=r,this.personalInformation=[],this.firestoreService=new ll(this.firestore),this.firestoreService.setCollection("contact-Information")}ngOnInit(){this.firestoreService.getDocuments().subscribe({next:r=>{this.personalInformation=r},error:r=>{console.error("Error loading projects:",r)}})}realizarAccion(r,i){switch(r){case"phone":window.location.href=`tel:+${i}`;break;case"whatsapp":window.open("https://web.whatsapp.com/","_blank");break;case"email":window.location.href=`mailto:${i}`;break}}};e.\u0275fac=function(i){return new(i||e)(Q(es))},e.\u0275cmp=we({type:e,selectors:[["shared-contact-information"]],decls:4,vars:1,consts:[[1,"bg-blue-950","shadow-lg","rounded-lg","p-6","mb-5"],[1,"text-xl","font-semibold","mb-4"],["class","flex items-center mb-4 cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"flex","items-center","mb-4","cursor-pointer",3,"click"],["alt","",1,"h-8","w-8","mr-5",3,"src"]],template:function(i,s){i&1&&(re(0,"div",0)(1,"h2",1),nt(2,"Informaci\xF3n de Contacto"),se(),hs(3,Mk,4,2,"div",2),se()),i&2&&(Ee(3),ot("ngForOf",s.personalInformation))},dependencies:[wa]});let n=e;return n})();var zO=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=qe({type:e}),e.\u0275inj=Be({imports:[Ea,Xy,D_]});let n=e;return n})();export{Zm as a,sV as b,oV as c,rr as d,EA as e,rn as f,Wa as g,Xy as h,BN as i,n1 as j,es as k,ll as l,dO as m,rO as n,w0 as o,I0 as p,c_ as q,Jy as r,qV as s,$V as t,GV as u,SS as v,RS as w,xS as x,HV as y,D_ as z,yO as A,lO as B,zO as C};
