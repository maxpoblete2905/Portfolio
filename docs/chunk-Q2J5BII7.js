import{a as dm,b as il,c as fm,d as rs,e as sl,f as sa,g as pm,h as gm,i as ol,j as ce,k as zn,l as Pt,m as oa,n as is,o as mm,p as ym,q as fn,r as Qe}from"./chunk-ZPRKIMH5.js";import{$ as M,$a as $g,A as pt,Aa as Vg,Ab as Zg,B as Rr,Ba as Mg,Bb as rl,C as Gc,Ca as Yi,Cb as es,D as Dr,Da as we,Db as em,E as wg,Ea as Q,Eb as tm,F as Eg,Fa as kg,Fb as Nr,G as Ho,Gb as nm,H as Dt,Ha as Ng,Hb as qn,I as Kc,Ia as kr,Ib as rm,J as Ig,Jb as im,K as Wo,Ka as ge,Kb as vt,L as Pr,La as Og,Lb as sm,M as Hc,Ma as Fg,Mb as ts,N as xr,Na as dn,Nb as om,O as pe,Oa as Lg,Ob as am,P as Wc,Pa as Ug,Pb as ns,Q as Tg,Qa as Xc,Qb as um,R as be,Ra as jg,Rb as ra,S as ae,Sa as Ji,T as cn,Ta as Jo,Tb as ia,U as Ki,Ua as yt,Ub as cm,V as z,Va as Zc,Vb as $n,W as He,Wa as Bg,Wb as lm,X as Ag,Xa as qg,Xb as hm,Y as q,Ya as se,Z as Qc,Za as ue,_ as R,_a as ot,a as dg,aa as Hi,ab as Ht,b as fg,ba as Cg,bb as zg,c as Sr,ca as Wi,cb as Gg,d as qc,da as Kt,db as Kg,e as $c,ea as Re,eb as Hg,f as Rt,fa as We,fb as at,g as it,ga as qe,gb as Wg,h as Go,hb as Wt,i as pg,ia as Sg,j as un,ja as Qi,jb as Xi,k as Bn,ka as ln,kb as Qg,l as br,la as hn,m as Z,ma as bg,n as P,na as Rg,o as zi,oa as Vr,ob as Zi,p as gg,pa as Dg,pb as Yg,q as mg,qa as Qo,qb as Xo,r as N,ra as Yc,rb as Jg,s as Ko,sa as Mr,sb as Zo,t as Xe,ta as gt,tb as ea,u as Gi,ua as Pg,ub as el,v as yg,va as Yo,vb as ta,w as zc,wa as xg,wb as tl,x as vg,xa as mt,xb as Xg,y as _g,yb as nl,z as st,za as Jc,zb as na}from"./chunk-KA25DUZG.js";import{a as S,b as ee,e as Bc,f as m}from"./chunk-CQCHLVVT.js";var cl=class extends im{constructor(){super(...arguments),this.supportsDOMEvents=!0}},ll=class n extends cl{static makeCurrent(){rm(new n)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=y0();return t==null?null:v0(t)}resetBaseElement(){ss=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return um(document.cookie,e)}},ss=null;function y0(){return ss=ss||document.querySelector("base"),ss?ss.getAttribute("href"):null}function v0(n){return new URL(n,document.baseURI).pathname}var hl=class{addToWindow(e){cn.getAngularTestability=(r,i=!0)=>{let s=e.findTestabilityInTree(r,i);if(s==null)throw new ae(5103,!1);return s},cn.getAllAngularTestabilities=()=>e.getAllTestabilities(),cn.getAllAngularRootElements=()=>e.getAllRootElements();let t=r=>{let i=cn.getAllAngularTestabilities(),s=i.length,o=function(){s--,s==0&&r()};i.forEach(a=>{a.whenStable(o)})};cn.frameworkStabilizers||(cn.frameworkStabilizers=[]),cn.frameworkStabilizers.push(t)}findTestabilityInTree(e,t,r){if(t==null)return null;let i=e.getTestability(t);return i??(r?qn().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},_0=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=z({token:e,factory:e.\u0275fac});let n=e;return n})(),dl=new q(""),Em=(()=>{let e=class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new ae(5101,!1);return this._eventNameToPlugin.set(r,i),i}};e.\u0275fac=function(i){return new(i||e)(R(dl),R(ge))},e.\u0275prov=z({token:e,factory:e.\u0275fac});let n=e;return n})(),aa=class{constructor(e){this._doc=e}},al="ng-app-id",Im=(()=>{let e=class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=$n(o),this.resetHostNodes()}addStyles(r){for(let i of r)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(r){for(let i of r)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let i of this.hostNodes)this.addStyleToHost(i,r)}onStyleRemoved(r){let i=this.styleRef;i.get(r)?.elements?.forEach(s=>s.remove()),i.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${al}="${this.appId}"]`);if(r?.length){let i=new Map;return r.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){let s=this.styleRef;if(s.has(r)){let o=s.get(r);return o.usage+=i,o.usage}return s.set(r,{usage:i,elements:[]}),i}getStyleElement(r,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(al),o;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(al,this.appId),r.appendChild(a),a}}addStyleToHost(r,i){let s=this.getStyleElement(r,i),o=this.styleRef,a=o.get(i)?.elements;a?a.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};e.\u0275fac=function(i){return new(i||e)(R(vt),R(Yo),R(Jc,8),R(mt))},e.\u0275prov=z({token:e,factory:e.\u0275fac});let n=e;return n})(),ul={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},pl=/%COMP%/g,Tm="%COMP%",w0=`_nghost-${Tm}`,E0=`_ngcontent-${Tm}`,I0=!0,T0=new q("",{providedIn:"root",factory:()=>I0});function A0(n){return E0.replace(pl,n)}function C0(n){return w0.replace(pl,n)}function Am(n,e){return e.map(t=>t.replace(pl,n))}var vm=(()=>{let e=class e{constructor(r,i,s,o,a,u,c,l=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=u,this.ngZone=c,this.nonce=l,this.rendererByCompId=new Map,this.platformIsServer=$n(u),this.defaultRenderer=new os(r,a,c,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Wi.ShadowDom&&(i=ee(S({},i),{encapsulation:Wi.Emulated}));let s=this.getOrCreateRenderer(r,i);return s instanceof ua?s.applyToHost(r):s instanceof as&&s.applyStyles(),s}getOrCreateRenderer(r,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let a=this.doc,u=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(i.encapsulation){case Wi.Emulated:o=new ua(c,l,i,this.appId,h,a,u,d);break;case Wi.ShadowDom:return new fl(c,l,r,i,a,u,this.nonce,d);default:o=new as(c,l,i,h,a,u,d);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(i){return new(i||e)(R(Em),R(Im),R(Yo),R(T0),R(vt),R(mt),R(ge),R(Jc))},e.\u0275prov=z({token:e,factory:e.\u0275fac});let n=e;return n})(),os=class{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(ul[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(_m(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(_m(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new ae(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let s=ul[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=ul[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(Yi.DashCase|Yi.Important)?e.style.setProperty(t,r,i&Yi.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&Yi.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r){if(typeof e=="string"&&(e=qn().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function _m(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var fl=class extends os{constructor(e,t,r,i,s,o,a,u){super(e,s,o,u),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let c=Am(i.id,i.styles);for(let l of c){let h=document.createElement("style");a&&h.setAttribute("nonce",a),h.textContent=l,this.shadowRoot.appendChild(h)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},as=class extends os{constructor(e,t,r,i,s,o,a,u){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=u?Am(u,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},ua=class extends as{constructor(e,t,r,i,s,o,a,u){let c=i+"-"+r.id;super(e,t,r,s,o,a,u,c),this.contentAttr=A0(c),this.hostAttr=C0(c)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},S0=(()=>{let e=class e extends aa{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}};e.\u0275fac=function(i){return new(i||e)(R(vt))},e.\u0275prov=z({token:e,factory:e.\u0275fac});let n=e;return n})(),wm=["alt","control","meta","shift"],b0={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},R0={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},D0=(()=>{let e=class e extends aa{constructor(r){super(r)}supports(r){return e.parseEventName(r)!=null}addEventListener(r,i,s){let o=e.parseEventName(i),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>qn().onAndCancel(r,o.domEventName,a))}static parseEventName(r){let i=r.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=e._normalizeKey(i.pop()),a="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),a="code."),wm.forEach(l=>{let h=i.indexOf(l);h>-1&&(i.splice(h,1),a+=l+".")}),a+=o,i.length!=0||o.length===0)return null;let c={};return c.domEventName=s,c.fullKey=a,c}static matchEventFullKeyCode(r,i){let s=b0[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),wm.forEach(a=>{if(a!==s){let u=R0[a];u(r)&&(o+=a+".")}}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return r==="esc"?"escape":r}};e.\u0275fac=function(i){return new(i||e)(R(vt))},e.\u0275prov=z({token:e,factory:e.\u0275fac});let n=e;return n})();function P0(){ll.makeCurrent()}function x0(){return new Yc}function V0(){return Pg(document),document}var M0=[{provide:mt,useValue:cm},{provide:xg,useValue:P0,multi:!0},{provide:vt,useFactory:V0,deps:[]}],HD=Zg(em,"browser",M0),k0=new q(""),N0=[{provide:Zo,useClass:hl,deps:[]},{provide:Jg,useClass:ea,deps:[ge,el,Zo]},{provide:ea,useClass:ea,deps:[ge,el,Zo]}],O0=[{provide:Sg,useValue:"root"},{provide:Yc,useFactory:x0,deps:[]},{provide:dl,useClass:S0,multi:!0,deps:[vt,ge,mt]},{provide:dl,useClass:D0,multi:!0,deps:[vt]},vm,Im,Em,{provide:Ng,useExisting:vm},{provide:hm,useClass:_0,deps:[]},[]],WD=(()=>{let e=class e{constructor(r){}static withServerTransition(r){return{ngModule:e,providers:[{provide:Yo,useValue:r.appId}]}}};e.\u0275fac=function(i){return new(i||e)(R(k0,12))},e.\u0275mod=We({type:e}),e.\u0275inj=He({providers:[...O0,...N0],imports:[ia,tm]});let n=e;return n})();var Cm=(()=>{let e=class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};e.\u0275fac=function(i){return new(i||e)(R(vt))},e.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var U="primary",Is=Symbol("RouteTitle"),_l=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function jr(n){return new _l(n)}function L0(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function U0(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!xt(n[t],e[t]))return!1;return!0}function xt(n,e){let t=n?wl(n):void 0,r=e?wl(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!Nm(n[i],e[i]))return!1;return!0}function wl(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function Nm(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function Om(n){return n.length>0?n[n.length-1]:null}function yn(n){return gg(n)?n:ta(n)?Z(Promise.resolve(n)):P(n)}var j0={exact:Lm,subset:Um},Fm={exact:B0,subset:q0,ignored:()=>!0};function Sm(n,e,t){return j0[t.paths](n.root,e.root,t.matrixParams)&&Fm[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function B0(n,e){return xt(n,e)}function Lm(n,e,t){if(!Kn(n.segments,e.segments)||!ha(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!Lm(n.children[r],e.children[r],t))return!1;return!0}function q0(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>Nm(n[t],e[t]))}function Um(n,e,t){return jm(n,e,e.segments,t)}function jm(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!Kn(i,t)||e.hasChildren()||!ha(i,t,r))}else if(n.segments.length===t.length){if(!Kn(n.segments,t)||!ha(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!Um(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!Kn(n.segments,i)||!ha(n.segments,i,r)||!n.children[U]?!1:jm(n.children[U],e,s,r)}}function ha(n,e,t){return e.every((r,i)=>Fm[t](n[i].parameters,r.parameters))}var pn=class{constructor(e=new Y([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=jr(this.queryParams),this._queryParamMap}toString(){return G0.serialize(this)}},Y=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return da(this)}},Gn=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=jr(this.parameters),this._parameterMap}toString(){return qm(this)}};function $0(n,e){return Kn(n,e)&&n.every((t,r)=>xt(t.parameters,e[r].parameters))}function Kn(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function z0(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===U&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==U&&(t=t.concat(e(i,r)))}),t}var Ts=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=z({token:e,factory:()=>new ps,providedIn:"root"});let n=e;return n})(),ps=class{parse(e){let t=new Il(e);return new pn(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${us(e.root,!0)}`,r=W0(e.queryParams),i=typeof e.fragment=="string"?`#${K0(e.fragment)}`:"";return`${t}${r}${i}`}},G0=new ps;function da(n){return n.segments.map(e=>qm(e)).join("/")}function us(n,e){if(!n.hasChildren())return da(n);if(e){let t=n.children[U]?us(n.children[U],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==U&&r.push(`${i}:${us(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=z0(n,(r,i)=>i===U?[us(n.children[U],!1)]:[`${i}:${us(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[U]!=null?`${da(n)}/${t[0]}`:`${da(n)}/(${t.join("//")})`}}function Bm(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ca(n){return Bm(n).replace(/%3B/gi,";")}function K0(n){return encodeURI(n)}function El(n){return Bm(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function fa(n){return decodeURIComponent(n)}function bm(n){return fa(n.replace(/\+/g,"%20"))}function qm(n){return`${El(n.path)}${H0(n.parameters)}`}function H0(n){return Object.entries(n).map(([e,t])=>`;${El(e)}=${El(t)}`).join("")}function W0(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${ca(t)}=${ca(i)}`).join("&"):`${ca(t)}=${ca(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var Q0=/^[^\/()?;#]+/;function gl(n){let e=n.match(Q0);return e?e[0]:""}var Y0=/^[^\/()?;=#]+/;function J0(n){let e=n.match(Y0);return e?e[0]:""}var X0=/^[^=?&#]+/;function Z0(n){let e=n.match(X0);return e?e[0]:""}var eT=/^[^&#]+/;function tT(n){let e=n.match(eT);return e?e[0]:""}var Il=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Y([],{}):new Y([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[U]=new Y(e,t)),r}parseSegment(){let e=gl(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new ae(4009,!1);return this.capture(e),new Gn(fa(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=J0(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=gl(this.remaining);i&&(r=i,this.capture(r))}e[fa(t)]=fa(r)}parseQueryParam(e){let t=Z0(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=tT(this.remaining);o&&(r=o,this.capture(r))}let i=bm(t),s=bm(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=gl(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new ae(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=U);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[U]:new Y([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new ae(4011,!1)}};function $m(n){return n.segments.length>0?new Y([],{[U]:n}):n}function zm(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=zm(i);if(r===U&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new Y(n.segments,e);return nT(t)}function nT(n){if(n.numberOfChildren===1&&n.children[U]){let e=n.children[U];return new Y(n.segments.concat(e.segments),e.children)}return n}function Br(n){return n instanceof pn}function rT(n,e,t=null,r=null){let i=Gm(n);return Km(i,e,t,r)}function Gm(n){let e;function t(s){let o={};for(let u of s.children){let c=t(u);o[u.outlet]=c}let a=new Y(s.url,o);return s===n&&(e=a),a}let r=t(n.root),i=$m(r);return e??i}function Km(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return ml(i,i,i,t,r);let s=iT(e);if(s.toRoot())return ml(i,i,new Y([],{}),t,r);let o=sT(s,i,n),a=o.processChildren?hs(o.segmentGroup,o.index,s.commands):Wm(o.segmentGroup,o.index,s.commands);return ml(i,o.segmentGroup,a,t,r)}function pa(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function gs(n){return typeof n=="object"&&n!=null&&n.outlets}function ml(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([u,c])=>{s[u]=Array.isArray(c)?c.map(l=>`${l}`):`${c}`});let o;n===e?o=t:o=Hm(n,e,t);let a=$m(zm(o));return new pn(a,s,i)}function Hm(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=Hm(s,e,t)}),new Y(n.segments,r)}var ga=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&pa(r[0]))throw new ae(4003,!1);let i=r.find(gs);if(i&&i!==Om(r))throw new ae(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function iT(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new ga(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([u,c])=>{a[u]=typeof c=="string"?c.split("/"):c}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,u)=>{u==0&&a==="."||(u==0&&a===""?t=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new ga(t,e,r)}var Lr=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function sT(n,e,t){if(n.isAbsolute)return new Lr(e,!0,0);if(!t)return new Lr(e,!1,NaN);if(t.parent===null)return new Lr(t,!0,0);let r=pa(n.commands[0])?0:1,i=t.segments.length-1+r;return oT(t,i,n.numberOfDoubleDots)}function oT(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new ae(4005,!1);i=r.segments.length}return new Lr(r,!1,i-s)}function aT(n){return gs(n[0])?n[0].outlets:{[U]:n}}function Wm(n,e,t){if(n??=new Y([],{}),n.segments.length===0&&n.hasChildren())return hs(n,e,t);let r=uT(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new Y(n.segments.slice(0,r.pathIndex),{});return s.children[U]=new Y(n.segments.slice(r.pathIndex),n.children),hs(s,0,i)}else return r.match&&i.length===0?new Y(n.segments,{}):r.match&&!n.hasChildren()?Tl(n,e,t):r.match?hs(n,0,i):Tl(n,e,t)}function hs(n,e,t){if(t.length===0)return new Y(n.segments,{});{let r=aT(t),i={};if(Object.keys(r).some(s=>s!==U)&&n.children[U]&&n.numberOfChildren===1&&n.children[U].segments.length===0){let s=hs(n.children[U],e,t);return new Y(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=Wm(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new Y(n.segments,i)}}function uT(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let o=n.segments[i],a=t[r];if(gs(a))break;let u=`${a}`,c=r<t.length-1?t[r+1]:null;if(i>0&&u===void 0)break;if(u&&c&&typeof c=="object"&&c.outlets===void 0){if(!Dm(u,c,o))return s;r+=2}else{if(!Dm(u,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function Tl(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(gs(s)){let u=cT(s.outlets);return new Y(r,u)}if(i===0&&pa(t[0])){let u=n.segments[e];r.push(new Gn(u.path,Rm(t[0]))),i++;continue}let o=gs(s)?s.outlets[U]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&pa(a)?(r.push(new Gn(o,Rm(a))),i+=2):(r.push(new Gn(o,{})),i++)}return new Y(r,{})}function cT(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=Tl(new Y([],{}),0,r))}),e}function Rm(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function Dm(n,e,t){return n==t.path&&xt(e,t.parameters)}var ds="imperative",De=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(De||{}),ut=class{constructor(e,t){this.id=e,this.url=t}},qr=class extends ut{constructor(e,t,r="imperative",i=null){super(e,t),this.type=De.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},_t=class extends ut{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=De.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},et=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(et||{}),ma=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(ma||{}),gn=class extends ut{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=De.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},mn=class extends ut{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=De.NavigationSkipped}},ms=class extends ut{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=De.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},ya=class extends ut{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=De.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Al=class extends ut{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=De.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Cl=class extends ut{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=De.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Sl=class extends ut{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=De.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},bl=class extends ut{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=De.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Rl=class{constructor(e){this.route=e,this.type=De.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Dl=class{constructor(e){this.route=e,this.type=De.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Pl=class{constructor(e){this.snapshot=e,this.type=De.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},xl=class{constructor(e){this.snapshot=e,this.type=De.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Vl=class{constructor(e){this.snapshot=e,this.type=De.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Ml=class{constructor(e){this.snapshot=e,this.type=De.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},va=class{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=De.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},ys=class{},vs=class{constructor(e){this.url=e}};var kl=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new As,this.attachRef=null}},As=(()=>{let e=class e{constructor(){this.contexts=new Map}onChildOutletCreated(r,i){let s=this.getOrCreateContext(r);s.outlet=i,this.contexts.set(r,s)}onChildOutletDestroyed(r){let i=this.getContext(r);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let i=this.getContext(r);return i||(i=new kl,this.contexts.set(r,i)),i}getContext(r){return this.contexts.get(r)||null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),_a=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=Nl(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=Nl(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=Ol(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return Ol(e,this._root).map(t=>t.value)}};function Nl(n,e){if(n===e.value)return e;for(let t of e.children){let r=Nl(n,t);if(r)return r}return null}function Ol(n,e){if(n===e.value)return[e];for(let t of e.children){let r=Ol(n,t);if(r.length)return r.unshift(e),r}return[]}var Ze=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function Fr(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var wa=class extends _a{constructor(e,t){super(e),this.snapshot=t,Kl(this,e)}toString(){return this.snapshot.toString()}};function Qm(n){let e=lT(n),t=new it([new Gn("",{})]),r=new it({}),i=new it({}),s=new it({}),o=new it(""),a=new Hn(t,r,s,o,i,U,n,e.root);return a.snapshot=e.root,new wa(new Ze(a,[]),e)}function lT(n){let e={},t={},r={},i="",s=new _s([],e,r,i,t,U,n,null,{});return new Ea("",new Ze(s,[]))}var Hn=class{constructor(e,t,r,i,s,o,a,u){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(N(c=>c[Is]))??P(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(N(e=>jr(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(N(e=>jr(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Gl(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:S(S({},e.params),n.params),data:S(S({},e.data),n.data),resolve:S(S(S(S({},n.data),e.data),i?.data),n._resolvedData)}:r={params:S({},n.params),data:S({},n.data),resolve:S(S({},n.data),n._resolvedData??{})},i&&Jm(i)&&(r.resolve[Is]=i.title),r}var _s=class{get title(){return this.data?.[Is]}constructor(e,t,r,i,s,o,a,u,c){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=jr(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=jr(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},Ea=class extends _a{constructor(e,t){super(t),this.url=e,Kl(this,t)}toString(){return Ym(this._root)}};function Kl(n,e){e.value._routerState=n,e.children.forEach(t=>Kl(n,t))}function Ym(n){let e=n.children.length>0?` { ${n.children.map(Ym).join(", ")} } `:"";return`${n.value}${e}`}function yl(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,xt(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),xt(e.params,t.params)||n.paramsSubject.next(t.params),U0(e.url,t.url)||n.urlSubject.next(t.url),xt(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function Fl(n,e){let t=xt(n.params,e.params)&&$0(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||Fl(n.parent,e.parent))}function Jm(n){return typeof n.title=="string"||n.title===null}var hT=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=U,this.activateEvents=new gt,this.deactivateEvents=new gt,this.attachEvents=new gt,this.detachEvents=new gt,this.parentContexts=M(As),this.location=M(Fg),this.changeDetector=M(es),this.environmentInjector=M(Qi),this.inputBinder=M(ba,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:i,previousValue:s}=r.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ae(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ae(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ae(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,i){this.activated=r,this._activatedRoute=i,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,i){if(this.isActivated)throw new ae(4013,!1);this._activatedRoute=r;let s=this.location,a=r.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,c=new Ll(r,u,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:c,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=qe({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[hn]});let n=e;return n})(),Ll=class{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r,this.__ngOutletInjector=!0}get(e,t){return e===Hn?this.route:e===As?this.childContexts:this.parent.get(e,t)}},ba=new q(""),Pm=(()=>{let e=class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(r){this.unsubscribeFromRouteData(r),this.subscribeToRouteData(r)}unsubscribeFromRouteData(r){this.outletDataSubscriptions.get(r)?.unsubscribe(),this.outletDataSubscriptions.delete(r)}subscribeToRouteData(r){let{activatedRoute:i}=r,s=Ko([i.queryParams,i.params,i.data]).pipe(pe(([o,a,u],c)=>(u=S(S(S({},o),a),u),c===0?P(u):Promise.resolve(u)))).subscribe(o=>{if(!r.isActivated||!r.activatedComponentRef||r.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(r);return}let a=nm(i.component);if(!a){this.unsubscribeFromRouteData(r);return}for(let{templateName:u}of a.inputs)r.activatedComponentRef.setInput(u,o[u])});this.outletDataSubscriptions.set(r,s)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=z({token:e,factory:e.\u0275fac});let n=e;return n})();function dT(n,e,t){let r=ws(n,e._root,t?t._root:void 0);return new wa(r,e)}function ws(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=fT(n,e,t);return new Ze(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>ws(n,a)),o}}let r=pT(e.value),i=e.children.map(s=>ws(n,s));return new Ze(r,i)}}function fT(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return ws(n,r,i);return ws(n,r)})}function pT(n){return new Hn(new it(n.url),new it(n.params),new it(n.queryParams),new it(n.fragment),new it(n.data),n.outlet,n.component,n)}var Xm="ngNavigationCancelingError";function Zm(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=Br(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=ey(!1,et.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function ey(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[Xm]=!0,t.cancellationCode=e,t}function gT(n){return ty(n)&&Br(n.url)}function ty(n){return!!n&&n[Xm]}var mT=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Re({type:e,selectors:[["ng-component"]],standalone:!0,features:[Qg],decls:1,vars:0,template:function(i,s){i&1&&ot(0,"router-outlet")},dependencies:[hT],encapsulation:2});let n=e;return n})();function yT(n,e){return n.providers&&!n._injector&&(n._injector=Xc(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Hl(n){let e=n.children&&n.children.map(Hl),t=e?ee(S({},n),{children:e}):S({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==U&&(t.component=mT),t}function Vt(n){return n.outlet||U}function vT(n,e){let t=n.filter(r=>Vt(r)===e);return t.push(...n.filter(r=>Vt(r)!==e)),t}function Cs(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var _T=(n,e,t,r)=>N(i=>(new Ul(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),Ul=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),yl(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=Fr(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Fr(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Fr(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=Fr(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new Ml(s.value.snapshot))}),e.children.length&&this.forwardEvent(new xl(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(yl(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),yl(a.route.value),this.activateChildRoutes(e,null,o.children)}else{let a=Cs(i.snapshot);o.attachRef=null,o.route=i,o.injector=a,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}},Ia=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Ur=class{constructor(e,t){this.component=e,this.route=t}};function wT(n,e,t){let r=n._root,i=e?e._root:null;return cs(r,i,t,[r.value])}function ET(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function zr(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!Ag(n)?n:e.get(n):r}function cs(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=Fr(e);return n.children.forEach(o=>{IT(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>fs(a,t.getContext(o),i)),i}function IT(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let u=TT(o,s,s.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new Ia(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?cs(n,e,a?a.children:null,r,i):cs(n,e,t,r,i),u&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new Ur(a.outlet.component,o))}else o&&fs(e,a,i),i.canActivateChecks.push(new Ia(r)),s.component?cs(n,null,a?a.children:null,r,i):cs(n,null,t,r,i);return i}function TT(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!Kn(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Kn(n.url,e.url)||!xt(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Fl(n,e)||!xt(n.queryParams,e.queryParams);case"paramsChange":default:return!Fl(n,e)}}function fs(n,e,t){let r=Fr(n),i=n.value;Object.entries(r).forEach(([s,o])=>{i.component?e?fs(o,e.children.getContext(s),t):fs(o,null,t):fs(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new Ur(e.outlet.component,i)):t.canDeactivateChecks.push(new Ur(null,i)):t.canDeactivateChecks.push(new Ur(null,i))}function Ss(n){return typeof n=="function"}function AT(n){return typeof n=="boolean"}function CT(n){return n&&Ss(n.canLoad)}function ST(n){return n&&Ss(n.canActivate)}function bT(n){return n&&Ss(n.canActivateChild)}function RT(n){return n&&Ss(n.canDeactivate)}function DT(n){return n&&Ss(n.canMatch)}function ny(n){return n instanceof mg||n?.name==="EmptyError"}var la=Symbol("INITIAL_VALUE");function $r(){return pe(n=>Ko(n.map(e=>e.pipe(Dr(1),xr(la)))).pipe(N(e=>{for(let t of e)if(t!==!0){if(t===la)return la;if(t===!1||t instanceof pn)return t}return!0}),st(e=>e!==la),Dr(1)))}function PT(n,e){return Xe(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?P(ee(S({},t),{guardsResult:!0})):xT(o,r,i,n).pipe(Xe(a=>a&&AT(a)?VT(r,s,n,e):P(a)),N(a=>ee(S({},t),{guardsResult:a})))})}function xT(n,e,t,r){return Z(n).pipe(Xe(i=>FT(i.component,i.route,t,e,r)),Dt(i=>i!==!0,!0))}function VT(n,e,t,r){return Z(e).pipe(Rr(i=>yg(kT(i.route.parent,r),MT(i.route,r),OT(n,i.path,t),NT(n,i.route,t))),Dt(i=>i!==!0,!0))}function MT(n,e){return n!==null&&e&&e(new Vl(n)),P(!0)}function kT(n,e){return n!==null&&e&&e(new Pl(n)),P(!0)}function NT(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return P(!0);let i=r.map(s=>zc(()=>{let o=Cs(e)??t,a=zr(s,o),u=ST(a)?a.canActivate(e,n):ln(o,()=>a(e,n));return yn(u).pipe(Dt())}));return P(i).pipe($r())}function OT(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>ET(o)).filter(o=>o!==null).map(o=>zc(()=>{let a=o.guards.map(u=>{let c=Cs(o.node)??t,l=zr(u,c),h=bT(l)?l.canActivateChild(r,n):ln(c,()=>l(r,n));return yn(h).pipe(Dt())});return P(a).pipe($r())}));return P(s).pipe($r())}function FT(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return P(!0);let o=s.map(a=>{let u=Cs(e)??i,c=zr(a,u),l=RT(c)?c.canDeactivate(n,e,t,r):ln(u,()=>c(n,e,t,r));return yn(l).pipe(Dt())});return P(o).pipe($r())}function LT(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return P(!0);let s=i.map(o=>{let a=zr(o,n),u=CT(a)?a.canLoad(e,t):ln(n,()=>a(e,t));return yn(u)});return P(s).pipe($r(),ry(r))}function ry(n){return fg(be(e=>{if(Br(e))throw Zm(n,e)}),N(e=>e===!0))}function UT(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return P(!0);let s=i.map(o=>{let a=zr(o,n),u=DT(a)?a.canMatch(e,t):ln(n,()=>a(e,t));return yn(u)});return P(s).pipe($r(),ry(r))}var Es=class{constructor(e){this.segmentGroup=e||null}},Ta=class extends Error{constructor(e){super(),this.urlTree=e}};function Or(n){return zi(new Es(n))}function jT(n){return zi(new ae(4e3,!1))}function BT(n){return zi(ey(!1,et.GuardRejected))}var jl=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return P(r);if(i.numberOfChildren>1||!i.children[U])return jT(e.redirectTo);i=i.children[U]}}applyRedirectCommands(e,t,r){let i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t.startsWith("/"))throw new Ta(i);return i}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new pn(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let a=s.substring(1);r[i]=t[a]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),o={};return Object.entries(t.children).forEach(([a,u])=>{o[a]=this.createSegmentGroup(e,u,r,i)}),new Y(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new ae(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},Bl={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function qT(n,e,t,r,i){let s=Wl(n,e,t);return s.matched?(r=yT(e,r),UT(r,e,t,i).pipe(N(o=>o===!0?s:S({},Bl)))):P(s)}function Wl(n,e,t){if(e.path==="**")return $T(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?S({},Bl):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||L0)(t,n,e);if(!i)return S({},Bl);let s={};Object.entries(i.posParams??{}).forEach(([a,u])=>{s[a]=u.path});let o=i.consumed.length>0?S(S({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function $T(n){return{matched:!0,parameters:n.length>0?Om(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function xm(n,e,t,r){return t.length>0&&KT(n,t,r)?{segmentGroup:new Y(e,GT(r,new Y(t,n.children))),slicedSegments:[]}:t.length===0&&HT(n,t,r)?{segmentGroup:new Y(n.segments,zT(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new Y(n.segments,n.children),slicedSegments:t}}function zT(n,e,t,r){let i={};for(let s of t)if(Ra(n,e,s)&&!r[Vt(s)]){let o=new Y([],{});i[Vt(s)]=o}return S(S({},r),i)}function GT(n,e){let t={};t[U]=e;for(let r of n)if(r.path===""&&Vt(r)!==U){let i=new Y([],{});t[Vt(r)]=i}return t}function KT(n,e,t){return t.some(r=>Ra(n,e,r)&&Vt(r)!==U)}function HT(n,e,t){return t.some(r=>Ra(n,e,r))}function Ra(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function WT(n,e,t,r){return Vt(n)!==r&&(r===U||!Ra(e,t,n))?!1:Wl(e,n,t).matched}function QT(n,e,t){return e.length===0&&!n.children[t]}var ql=class{};function YT(n,e,t,r,i,s,o="emptyOnly"){return new $l(n,e,t,r,i,o,s).recognize()}var JT=31,$l=class{constructor(e,t,r,i,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new jl(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new ae(4002,`'${e.segmentGroup}'`)}recognize(){let e=xm(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(N(t=>{let r=new _s([],Object.freeze({}),Object.freeze(S({},this.urlTree.queryParams)),this.urlTree.fragment,{},U,this.rootComponentType,null,{}),i=new Ze(r,t),s=new Ea("",i),o=rT(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root,null),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,U).pipe(pt(r=>{if(r instanceof Ta)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Es?this.noMatchError(r):r}))}inheritParamsAndData(e,t){let r=e.value,i=Gl(r,t,this.paramsInheritanceStrategy);r.params=Object.freeze(i.params),r.data=Object.freeze(i.data),e.children.forEach(s=>this.inheritParamsAndData(s,r))}processSegmentGroup(e,t,r,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i,!0).pipe(N(s=>s instanceof Ze?[s]:[]))}processChildren(e,t,r){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return Z(i).pipe(Rr(s=>{let o=r.children[s],a=vT(t,s);return this.processSegmentGroup(e,a,o,s)}),Pr((s,o)=>(s.push(...o),s)),Gc(null),Ig(),Xe(s=>{if(s===null)return Or(r);let o=iy(s);return XT(o),P(o)}))}processSegment(e,t,r,i,s,o){return Z(t).pipe(Rr(a=>this.processSegmentAgainstRoute(a._injector??e,t,a,r,i,s,o).pipe(pt(u=>{if(u instanceof Es)return P(null);throw u}))),Dt(a=>!!a),pt(a=>{if(ny(a))return QT(r,i,s)?P(new ql):Or(r);throw a}))}processSegmentAgainstRoute(e,t,r,i,s,o,a){return WT(r,i,s,o)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o):Or(i):Or(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){let{matched:a,consumedSegments:u,positionalParamSegments:c,remainingSegments:l}=Wl(t,i,s);if(!a)return Or(t);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>JT&&(this.allowRedirects=!1));let h=this.applyRedirects.applyRedirectCommands(u,i.redirectTo,c);return this.applyRedirects.lineralizeSegments(i,h).pipe(Xe(d=>this.processSegment(e,r,t,d.concat(l),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){let o=qT(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),o.pipe(pe(a=>a.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(pe(({routes:u})=>{let c=r._loadedInjector??e,{consumedSegments:l,remainingSegments:h,parameters:d}=a,f=new _s(l,d,Object.freeze(S({},this.urlTree.queryParams)),this.urlTree.fragment,eA(r),Vt(r),r.component??r._loadedComponent??null,r,tA(r)),{segmentGroup:E,slicedSegments:w}=xm(t,l,h,u);if(w.length===0&&E.hasChildren())return this.processChildren(c,u,E).pipe(N(x=>x===null?null:new Ze(f,x)));if(u.length===0&&w.length===0)return P(new Ze(f,[]));let _=Vt(r)===s;return this.processSegment(c,u,E,w,_?U:s,!0).pipe(N(x=>new Ze(f,x instanceof Ze?[x]:[])))}))):Or(t)))}getChildConfig(e,t,r){return t.children?P({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?P({routes:t._loadedRoutes,injector:t._loadedInjector}):LT(e,t,r,this.urlSerializer).pipe(Xe(i=>i?this.configLoader.loadChildren(e,t).pipe(be(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):BT(t))):P({routes:[],injector:e})}};function XT(n){n.sort((e,t)=>e.value.outlet===U?-1:t.value.outlet===U?1:e.value.outlet.localeCompare(t.value.outlet))}function ZT(n){let e=n.value.routeConfig;return e&&e.path===""}function iy(n){let e=[],t=new Set;for(let r of n){if(!ZT(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=iy(r.children);e.push(new Ze(r.value,i))}return e.filter(r=>!t.has(r))}function eA(n){return n.data||{}}function tA(n){return n.resolve||{}}function nA(n,e,t,r,i,s){return Xe(o=>YT(n,e,t,r,o.extractedUrl,i,s).pipe(N(({state:a,tree:u})=>ee(S({},o),{targetSnapshot:a,urlAfterRedirects:u}))))}function rA(n,e){return Xe(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return P(t);let s=new Set(i.map(u=>u.route)),o=new Set;for(let u of s)if(!o.has(u))for(let c of sy(u))o.add(c);let a=0;return Z(o).pipe(Rr(u=>s.has(u)?iA(u,r,n,e):(u.data=Gl(u,u.parent,n).resolve,P(void 0))),be(()=>a++),Kc(1),Xe(u=>a===o.size?P(t):un))})}function sy(n){let e=n.children.map(t=>sy(t)).flat();return[n,...e]}function iA(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!Jm(i)&&(s[Is]=i.title),sA(s,n,e,r).pipe(N(o=>(n._resolvedData=o,n.data=Gl(n,n.parent,t).resolve,null)))}function sA(n,e,t,r){let i=wl(n);if(i.length===0)return P({});let s={};return Z(i).pipe(Xe(o=>oA(n[o],e,t,r).pipe(Dt(),be(a=>{s[o]=a}))),Kc(1),wg(s),pt(o=>ny(o)?un:zi(o)))}function oA(n,e,t,r){let i=Cs(e)??r,s=zr(n,i),o=s.resolve?s.resolve(e,t):ln(i,()=>s(e,t));return yn(o)}function vl(n){return pe(e=>{let t=n(e);return t?Z(t).pipe(N(()=>e)):P(e)})}var oy=(()=>{let e=class e{buildTitle(r){let i,s=r.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===U);return i}getResolvedTitleForRoute(r){return r.data[Is]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=z({token:e,factory:()=>M(aA),providedIn:"root"});let n=e;return n})(),aA=(()=>{let e=class e extends oy{constructor(r){super(),this.title=r}updateTitle(r){let i=this.buildTitle(r);i!==void 0&&this.title.setTitle(i)}};e.\u0275fac=function(i){return new(i||e)(R(Cm))},e.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),bs=new q("",{providedIn:"root",factory:()=>({})}),Aa=new q(""),Ql=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=M(na)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return P(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let i=yn(r.loadComponent()).pipe(N(ay),be(o=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o}),Ho(()=>{this.componentLoaders.delete(r)})),s=new $c(i,()=>new Rt).pipe(qc());return this.componentLoaders.set(r,s),s}loadChildren(r,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return P({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=uA(i,this.compiler,r,this.onLoadEndListener).pipe(Ho(()=>{this.childrenLoaders.delete(i)})),a=new $c(o,()=>new Rt).pipe(qc());return this.childrenLoaders.set(i,a),a}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function uA(n,e,t,r){return yn(n.loadChildren()).pipe(N(ay),Xe(i=>i instanceof Ug||Array.isArray(i)?P(i):Z(e.compileModuleAsync(i))),N(i=>{r&&r(n);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(t).injector,o=s.get(Aa,[],{optional:!0,self:!0}).flat()),{routes:o.map(Hl),injector:s}}))}function cA(n){return n&&typeof n=="object"&&"default"in n}function ay(n){return cA(n)?n.default:n}var Yl=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=z({token:e,factory:()=>M(lA),providedIn:"root"});let n=e;return n})(),lA=(()=>{let e=class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,i){return r}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),uy=new q(""),cy=new q("");function hA(n,e,t){let r=n.get(cy),i=n.get(vt);return n.get(ge).runOutsideAngular(()=>{if(!i.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,Promise.resolve();let s,o=new Promise(c=>{s=c}),a=i.startViewTransition(()=>(s(),dA(n))),{onViewTransitionCreated:u}=r;return u&&ln(n,()=>u({transition:a,from:e,to:t})),o})}function dA(n){return new Promise(e=>{Og(e,{injector:n})})}var Jl=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Rt,this.transitionAbortSubject=new Rt,this.configLoader=M(Ql),this.environmentInjector=M(Qi),this.urlSerializer=M(Ts),this.rootContexts=M(As),this.location=M(ns),this.inputBindingEnabled=M(ba,{optional:!0})!==null,this.titleStrategy=M(oy),this.options=M(bs,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=M(Yl),this.createViewTransition=M(uy,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>P(void 0),this.rootComponentType=null;let r=s=>this.events.next(new Rl(s)),i=s=>this.events.next(new Dl(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let i=++this.navigationId;this.transitions?.next(ee(S(S({},this.transitions.value),r),{id:i}))}setupNavigations(r,i,s){return this.transitions=new it({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:ds,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(st(o=>o.id!==0),N(o=>ee(S({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),pe(o=>{let a=!1,u=!1;return P(o).pipe(pe(c=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",et.SupersededByNewNavigation),un;this.currentTransition=o,this.currentNavigation={id:c.id,initialUrl:c.rawUrl,extractedUrl:c.extractedUrl,trigger:c.source,extras:c.extras,previousNavigation:this.lastSuccessfulNavigation?ee(S({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let l=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),h=c.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!l&&h!=="reload"){let d="";return this.events.next(new mn(c.id,this.urlSerializer.serialize(c.rawUrl),d,ma.IgnoredSameUrlNavigation)),c.resolve(null),un}if(this.urlHandlingStrategy.shouldProcessUrl(c.rawUrl))return P(c).pipe(pe(d=>{let f=this.transitions?.getValue();return this.events.next(new qr(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),f!==this.transitions?.getValue()?un:Promise.resolve(d)}),nA(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),be(d=>{o.targetSnapshot=d.targetSnapshot,o.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=ee(S({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let f=new ya(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}));if(l&&this.urlHandlingStrategy.shouldProcessUrl(c.currentRawUrl)){let{id:d,extractedUrl:f,source:E,restoredState:w,extras:_}=c,x=new qr(d,this.urlSerializer.serialize(f),E,w);this.events.next(x);let O=Qm(this.rootComponentType).snapshot;return this.currentTransition=o=ee(S({},c),{targetSnapshot:O,urlAfterRedirects:f,extras:ee(S({},_),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=f,P(o)}else{let d="";return this.events.next(new mn(c.id,this.urlSerializer.serialize(c.extractedUrl),d,ma.IgnoredByUrlHandlingStrategy)),c.resolve(null),un}}),be(c=>{let l=new Al(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),N(c=>(this.currentTransition=o=ee(S({},c),{guards:wT(c.targetSnapshot,c.currentSnapshot,this.rootContexts)}),o)),PT(this.environmentInjector,c=>this.events.next(c)),be(c=>{if(o.guardsResult=c.guardsResult,Br(c.guardsResult))throw Zm(this.urlSerializer,c.guardsResult);let l=new Cl(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot,!!c.guardsResult);this.events.next(l)}),st(c=>c.guardsResult?!0:(this.cancelNavigationTransition(c,"",et.GuardRejected),!1)),vl(c=>{if(c.guards.canActivateChecks.length)return P(c).pipe(be(l=>{let h=new Sl(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}),pe(l=>{let h=!1;return P(l).pipe(rA(this.paramsInheritanceStrategy,this.environmentInjector),be({next:()=>h=!0,complete:()=>{h||this.cancelNavigationTransition(l,"",et.NoDataFromResolver)}}))}),be(l=>{let h=new bl(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}))}),vl(c=>{let l=h=>{let d=[];h.routeConfig?.loadComponent&&!h.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(h.routeConfig).pipe(be(f=>{h.component=f}),N(()=>{})));for(let f of h.children)d.push(...l(f));return d};return Ko(l(c.targetSnapshot.root)).pipe(Gc(null),Dr(1))}),vl(()=>this.afterPreactivation()),pe(()=>{let{currentSnapshot:c,targetSnapshot:l}=o,h=this.createViewTransition?.(this.environmentInjector,c.root,l.root);return h?Z(h).pipe(N(()=>o)):P(o)}),N(c=>{let l=dT(r.routeReuseStrategy,c.targetSnapshot,c.currentRouterState);return this.currentTransition=o=ee(S({},c),{targetRouterState:l}),this.currentNavigation.targetRouterState=l,o}),be(()=>{this.events.next(new ys)}),_T(this.rootContexts,r.routeReuseStrategy,c=>this.events.next(c),this.inputBindingEnabled),Dr(1),be({next:c=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new _t(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects))),this.titleStrategy?.updateTitle(c.targetRouterState.snapshot),c.resolve(!0)},complete:()=>{a=!0}}),Tg(this.transitionAbortSubject.pipe(be(c=>{throw c}))),Ho(()=>{!a&&!u&&this.cancelNavigationTransition(o,"",et.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),pt(c=>{if(u=!0,ty(c))this.events.next(new gn(o.id,this.urlSerializer.serialize(o.extractedUrl),c.message,c.cancellationCode)),gT(c)?this.events.next(new vs(c.url)):o.resolve(!1);else{this.events.next(new ms(o.id,this.urlSerializer.serialize(o.extractedUrl),c,o.targetSnapshot??void 0));try{o.resolve(r.errorHandler(c))}catch(l){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(l)}}return un}))}))}cancelNavigationTransition(r,i,s){let o=new gn(r.id,this.urlSerializer.serialize(r.extractedUrl),i,s);this.events.next(o),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function fA(n){return n!==ds}var pA=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=z({token:e,factory:()=>M(gA),providedIn:"root"});let n=e;return n})(),zl=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},gA=(()=>{let e=class e extends zl{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Vr(e)))(s||e)}})(),e.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),ly=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=z({token:e,factory:()=>M(mA),providedIn:"root"});let n=e;return n})(),mA=(()=>{let e=class e extends ly{constructor(){super(...arguments),this.location=M(ns),this.urlSerializer=M(Ts),this.options=M(bs,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=M(Yl),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new pn,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=Qm(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(i=>{i.type==="popstate"&&r(i.url,i.state)})}handleRouterEvent(r,i){if(r instanceof qr)this.stateMemento=this.createStateMemento();else if(r instanceof mn)this.rawUrlTree=i.initialUrl;else if(r instanceof ya){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else r instanceof ys?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):r instanceof gn&&(r.code===et.GuardRejected||r.code===et.NoDataFromResolver)?this.restoreHistory(i):r instanceof ms?this.restoreHistory(i,!0):r instanceof _t&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,i){let s=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,a=S(S({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",a)}else{let o=S(S({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(r,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===r.finalUrl&&o===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,i){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:i}:{navigationId:r}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Vr(e)))(s||e)}})(),e.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),ls=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(ls||{});function hy(n,e){n.events.pipe(st(t=>t instanceof _t||t instanceof gn||t instanceof ms||t instanceof mn),N(t=>t instanceof _t||t instanceof mn?ls.COMPLETE:(t instanceof gn?t.code===et.Redirect||t.code===et.SupersededByNewNavigation:!1)?ls.REDIRECTING:ls.FAILED),st(t=>t!==ls.REDIRECTING),Dr(1)).subscribe(()=>{e()})}function yA(n){throw n}var vA={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},_A={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Qt=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=M(Xo),this.stateManager=M(ly),this.options=M(bs,{optional:!0})||{},this.pendingTasks=M(jg),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=M(Jl),this.urlSerializer=M(Ts),this.location=M(ns),this.urlHandlingStrategy=M(Yl),this._events=new Rt,this.errorHandler=this.options.errorHandler||yA,this.navigated=!1,this.routeReuseStrategy=M(pA),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=M(Aa,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!M(ba,{optional:!0}),this.eventsSubscription=new dg,this.isNgZoneEnabled=M(ge)instanceof ge&&ge.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof gn&&i.code!==et.Redirect&&i.code!==et.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof _t)this.navigated=!0;else if(i instanceof vs){let a=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),u={info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||fA(s.source)};this.scheduleNavigation(a,ds,null,u,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}EA(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),ds,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",i)},0)})}navigateToSyncWithBrowser(r,i,s){let o={replaceUrl:!0},a=s?.navigationId?s:null;if(s){let c=S({},s);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(o.state=c)}let u=this.parseUrl(r);this.scheduleNavigation(u,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(Hl),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,i={}){let{relativeTo:s,queryParams:o,fragment:a,queryParamsHandling:u,preserveFragment:c}=i,l=c?this.currentUrlTree.fragment:a,h=null;switch(u){case"merge":h=S(S({},this.currentUrlTree.queryParams),o);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=o||null}h!==null&&(h=this.removeEmptyProps(h));let d;try{let f=s?s.snapshot:this.routerState.snapshot.root;d=Gm(f)}catch{(typeof r[0]!="string"||!r[0].startsWith("/"))&&(r=[]),d=this.currentUrlTree.root}return Km(d,r,h,l??null)}navigateByUrl(r,i={skipLocationChange:!1}){let s=Br(r)?r:this.parseUrl(r),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,ds,null,i)}navigate(r,i={skipLocationChange:!1}){return wA(r),this.navigateByUrl(this.createUrlTree(r,i),i)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,i){let s;if(i===!0?s=S({},vA):i===!1?s=S({},_A):s=i,Br(r))return Sm(this.currentUrlTree,r,s);let o=this.parseUrl(r);return Sm(this.currentUrlTree,o,s)}removeEmptyProps(r){return Object.entries(r).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(r,i,s,o,a){if(this.disposed)return Promise.resolve(!1);let u,c,l;a?(u=a.resolve,c=a.reject,l=a.promise):l=new Promise((d,f)=>{u=d,c=f});let h=this.pendingTasks.add();return hy(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(h))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:o,resolve:u,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(d=>Promise.reject(d))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function wA(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new ae(4008,!1)}function EA(n){return!(n instanceof ys)&&!(n instanceof vs)}var Ca=(()=>{let e=class e{constructor(r,i,s,o,a,u){this.router=r,this.route=i,this.tabIndexAttribute=s,this.renderer=o,this.el=a,this.locationStrategy=u,this.href=null,this.commands=null,this.onChanges=new Rt,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let c=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement=c==="a"||c==="area",this.isAnchorElement?this.subscription=r.events.subscribe(l=>{l instanceof _t&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(r){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",r)}ngOnChanges(r){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(r){r!=null?(this.commands=Array.isArray(r)?r:[r],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(r,i,s,o,a){let u=this.urlTree;if(u===null||this.isAnchorElement&&(r!==0||i||s||o||a||typeof this.target=="string"&&this.target!="_self"))return!0;let c={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(u,c),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let r=this.urlTree;this.href=r!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(r)):null;let i=this.href===null?null:Mg(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(r,i){let s=this.renderer,o=this.el.nativeElement;i!==null?s.setAttribute(o,r,i):s.removeAttribute(o,r)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};e.\u0275fac=function(i){return new(i||e)(Q(Qt),Q(Hn),Dg("tabindex"),Q(kr),Q(Mr),Q(ts))},e.\u0275dir=qe({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,s){i&1&&Ht("click",function(a){return s.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),i&2&&Jo("target",s.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[Kt.HasDecoratorInputTransform,"preserveFragment","preserveFragment",Nr],skipLocationChange:[Kt.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",Nr],replaceUrl:[Kt.HasDecoratorInputTransform,"replaceUrl","replaceUrl",Nr],routerLink:"routerLink"},standalone:!0,features:[Lg,hn]});let n=e;return n})(),dy=(()=>{let e=class e{get isActive(){return this._isActive}constructor(r,i,s,o,a){this.router=r,this.element=i,this.renderer=s,this.cdr=o,this.link=a,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new gt,this.routerEventsSubscription=r.events.subscribe(u=>{u instanceof _t&&this.update()})}ngAfterContentInit(){P(this.links.changes,P(null)).pipe(Gi()).subscribe(r=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let r=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=Z(r).pipe(Gi()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(r){let i=Array.isArray(r)?r:r.split(" ");this.classes=i.filter(s=>!!s)}ngOnChanges(r){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let r=this.hasActiveLinks();this.classes.forEach(i=>{r?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),r&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==r&&(this._isActive=r,this.cdr.markForCheck(),this.isActiveChange.emit(r))})}isLinkActive(r){let i=IA(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return s=>{let o=s.urlTree;return o?r.isActive(o,i):!1}}hasActiveLinks(){let r=this.isLinkActive(this.router);return this.link&&r(this.link)||this.links.some(r)}};e.\u0275fac=function(i){return new(i||e)(Q(Qt),Q(Mr),Q(kr),Q(es),Q(Ca,8))},e.\u0275dir=qe({type:e,selectors:[["","routerLinkActive",""]],contentQueries:function(i,s,o){if(i&1&&Gg(o,Ca,5),i&2){let a;Kg(a=Hg())&&(s.links=a)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[hn]});let n=e;return n})();function IA(n){return!!n.paths}var Sa=class{};var TA=(()=>{let e=class e{constructor(r,i,s,o,a){this.router=r,this.injector=s,this.preloadingStrategy=o,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(st(r=>r instanceof _t),Rr(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(r,i){let s=[];for(let o of i){o.providers&&!o._injector&&(o._injector=Xc(o.providers,r,`Route: ${o.path}`));let a=o._injector??r,u=o._loadedInjector??a;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&s.push(this.preloadConfig(a,o)),(o.children||o._loadedRoutes)&&s.push(this.processRoutes(u,o.children??o._loadedRoutes))}return Z(s).pipe(Gi())}preloadConfig(r,i){return this.preloadingStrategy.preload(i,()=>{let s;i.loadChildren&&i.canLoad===void 0?s=this.loader.loadChildren(r,i):s=P(null);let o=s.pipe(Xe(a=>a===null?P(void 0):(i._loadedRoutes=a.routes,i._loadedInjector=a.injector,this.processRoutes(a.injector??r,a.routes))));if(i.loadComponent&&!i._loadedComponent){let a=this.loader.loadComponent(i);return Z([o,a]).pipe(Gi())}else return o})}};e.\u0275fac=function(i){return new(i||e)(R(Qt),R(na),R(Qi),R(Sa),R(Ql))},e.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),fy=new q(""),AA=(()=>{let e=class e{constructor(r,i,s,o,a={}){this.urlSerializer=r,this.transitions=i,this.viewportScroller=s,this.zone=o,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration||="disabled",a.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof qr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=r.navigationTrigger,this.restoredId=r.restoredState?r.restoredState.navigationId:0):r instanceof _t?(this.lastId=r.id,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.urlAfterRedirects).fragment)):r instanceof mn&&r.code===ma.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof va&&(r.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(r.position):r.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(r.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(r,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new va(r,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};e.\u0275fac=function(i){kg()},e.\u0275prov=z({token:e,factory:e.\u0275fac});let n=e;return n})();function CA(n){return n.routerState.root}function Rs(n,e){return{\u0275kind:n,\u0275providers:e}}function SA(){let n=M(Qo);return e=>{let t=n.get(nl);if(e!==t.components[0])return;let r=n.get(Qt),i=n.get(py);n.get(Xl)===1&&r.initialNavigation(),n.get(gy,null,Qc.Optional)?.setUpPreloading(),n.get(fy,null,Qc.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var py=new q("",{factory:()=>new Rt}),Xl=new q("",{providedIn:"root",factory:()=>1});function bA(){return Rs(2,[{provide:Xl,useValue:0},{provide:tl,multi:!0,deps:[Qo],useFactory:e=>{let t=e.get(sm,Promise.resolve());return()=>t.then(()=>new Promise(r=>{let i=e.get(Qt),s=e.get(py);hy(i,()=>{r(!0)}),e.get(Jl).afterPreactivation=()=>(r(!0),s.closed?P(void 0):s),i.initialNavigation()}))}}])}function RA(){return Rs(3,[{provide:tl,multi:!0,useFactory:()=>{let e=M(Qt);return()=>{e.setUpLocationChangeListener()}}},{provide:Xl,useValue:2}])}var gy=new q("");function DA(n){return Rs(0,[{provide:gy,useExisting:TA},{provide:Sa,useExisting:n}])}function PA(){return Rs(8,[Pm,{provide:ba,useExisting:Pm}])}function xA(n){let e=[{provide:uy,useValue:hA},{provide:cy,useValue:S({skipNextTransition:!!n?.skipInitialTransition},n)}];return Rs(9,e)}var Vm=new q("ROUTER_FORROOT_GUARD"),VA=[ns,{provide:Ts,useClass:ps},Qt,As,{provide:Hn,useFactory:CA,deps:[Qt]},Ql,[]],my=(()=>{let e=class e{constructor(r){}static forRoot(r,i){return{ngModule:e,providers:[VA,[],{provide:Aa,multi:!0,useValue:r},{provide:Vm,useFactory:OA,deps:[[Qt,new Hi,new Cg]]},{provide:bs,useValue:i||{}},i?.useHash?kA():NA(),MA(),i?.preloadingStrategy?DA(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?FA(i):[],i?.bindToComponentInputs?PA().\u0275providers:[],i?.enableViewTransitions?xA().\u0275providers:[],LA()]}}static forChild(r){return{ngModule:e,providers:[{provide:Aa,multi:!0,useValue:r}]}}};e.\u0275fac=function(i){return new(i||e)(R(Vm,8))},e.\u0275mod=We({type:e}),e.\u0275inj=He({});let n=e;return n})();function MA(){return{provide:fy,useFactory:()=>{let n=M(lm),e=M(ge),t=M(bs),r=M(Jl),i=M(Ts);return t.scrollOffset&&n.setOffset(t.scrollOffset),new AA(i,r,n,e,t)}}}function kA(){return{provide:ts,useClass:am}}function NA(){return{provide:ts,useClass:om}}function OA(n){return"guarded"}function FA(n){return[n.initialNavigation==="disabled"?RA().\u0275providers:[],n.initialNavigation==="enabledBlocking"?bA().\u0275providers:[]]}var Mm=new q("");function LA(){return[{provide:Mm,useFactory:SA},{provide:Xg,multi:!0,useExisting:Mm}]}var Sy=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(Q(kr),Q(Mr))},e.\u0275dir=qe({type:e});let n=e;return n})(),jA=(()=>{let e=class e extends Sy{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Vr(e)))(s||e)}})(),e.\u0275dir=qe({type:e,features:[dn]});let n=e;return n})(),by=new q("");var BA={provide:by,useExisting:Ki(()=>Ry),multi:!0};function qA(){let n=qn()?qn().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var $A=new q(""),Ry=(()=>{let e=class e extends Sy{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!qA())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(Q(kr),Q(Mr),Q($A,8))},e.\u0275dir=qe({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&Ht("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[Xi([BA]),dn]});let n=e;return n})();function vn(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function Dy(n){return n!=null&&typeof n.length=="number"}var nh=new q(""),Py=new q(""),zA=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,yy=class{static min(e){return GA(e)}static max(e){return KA(e)}static required(e){return xy(e)}static requiredTrue(e){return HA(e)}static email(e){return WA(e)}static minLength(e){return QA(e)}static maxLength(e){return YA(e)}static pattern(e){return JA(e)}static nullValidator(e){return xa(e)}static compose(e){return Fy(e)}static composeAsync(e){return Uy(e)}};function GA(n){return e=>{if(vn(e.value)||vn(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function KA(n){return e=>{if(vn(e.value)||vn(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function xy(n){return vn(n.value)?{required:!0}:null}function HA(n){return n.value===!0?null:{required:!0}}function WA(n){return vn(n.value)||zA.test(n.value)?null:{email:!0}}function QA(n){return e=>vn(e.value)||!Dy(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function YA(n){return e=>Dy(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function JA(n){if(!n)return xa;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(vn(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function xa(n){return null}function Vy(n){return n!=null}function My(n){return ta(n)?Z(n):n}function ky(n){let e={};return n.forEach(t=>{e=t!=null?S(S({},e),t):e}),Object.keys(e).length===0?null:e}function Ny(n,e){return e.map(t=>t(n))}function XA(n){return!n.validate}function Oy(n){return n.map(e=>XA(e)?e:t=>e.validate(t))}function Fy(n){if(!n)return null;let e=n.filter(Vy);return e.length==0?null:function(t){return ky(Ny(t,e))}}function Ly(n){return n!=null?Fy(Oy(n)):null}function Uy(n){if(!n)return null;let e=n.filter(Vy);return e.length==0?null:function(t){let r=Ny(t,e).map(My);return vg(r).pipe(N(ky))}}function jy(n){return n!=null?Uy(Oy(n)):null}function vy(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function By(n){return n._rawValidators}function qy(n){return n._rawAsyncValidators}function Zl(n){return n?Array.isArray(n)?n:[n]:[]}function Va(n,e){return Array.isArray(n)?n.includes(e):n===e}function _y(n,e){let t=Zl(e);return Zl(n).forEach(i=>{Va(t,i)||t.push(i)}),t}function wy(n,e){return Zl(e).filter(t=>!Va(n,t))}var Ma=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Ly(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=jy(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Kr=class extends Ma{get formDirective(){return null}get path(){return null}},xs=class extends Ma{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},ka=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},ZA={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},DP=ee(S({},ZA),{"[class.ng-submitted]":"isSubmitted"}),PP=(()=>{let e=class e extends ka{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(Q(xs,2))},e.\u0275dir=qe({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&Zc("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[dn]});let n=e;return n})(),xP=(()=>{let e=class e extends ka{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(Q(Kr,10))},e.\u0275dir=qe({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&Zc("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[dn]});let n=e;return n})();var Ds="VALID",Da="INVALID",Gr="PENDING",Ps="DISABLED";function rh(n){return(La(n)?n.validators:n)||null}function eC(n){return Array.isArray(n)?Ly(n):n||null}function ih(n,e){return(La(e)?e.asyncValidators:n)||null}function tC(n){return Array.isArray(n)?jy(n):n||null}function La(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function $y(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new ae(1e3,"");if(!r[t])throw new ae(1001,"")}function zy(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new ae(1002,"")})}var Hr=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Ds}get invalid(){return this.status===Da}get pending(){return this.status==Gr}get disabled(){return this.status===Ps}get enabled(){return this.status!==Ps}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(_y(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(_y(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(wy(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(wy(e,this._rawAsyncValidators))}hasValidator(e){return Va(this._rawValidators,e)}hasAsyncValidator(e){return Va(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Gr,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ps,this.errors=null,this._forEachChild(r=>{r.disable(ee(S({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(ee(S({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ds,this._forEachChild(r=>{r.enable(ee(S({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(ee(S({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ds||this.status===Gr)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ps:Ds}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Gr,this._hasOwnPendingAsyncValidator=!0;let t=My(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new gt,this.statusChanges=new gt}_calculateStatus(){return this._allControlsDisabled()?Ps:this.errors?Da:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Gr)?Gr:this._anyControlsHaveStatus(Da)?Da:Ds}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){La(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=eC(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=tC(this._rawAsyncValidators)}},Na=class extends Hr{constructor(e,t,r){super(rh(t),ih(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){zy(this,!0,e),Object.keys(e).forEach(r=>{$y(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var eh=class extends Na{};var Gy=new q("CallSetDisabledState",{providedIn:"root",factory:()=>sh}),sh="always";function nC(n,e){return[...e.path,n]}function Ey(n,e,t=sh){oh(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),iC(n,e),oC(n,e),sC(n,e),rC(n,e)}function Iy(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),Fa(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Oa(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function rC(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function oh(n,e){let t=By(n);e.validator!==null?n.setValidators(vy(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=qy(n);e.asyncValidator!==null?n.setAsyncValidators(vy(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();Oa(e._rawValidators,i),Oa(e._rawAsyncValidators,i)}function Fa(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=By(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let i=qy(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}let r=()=>{};return Oa(e._rawValidators,r),Oa(e._rawAsyncValidators,r),t}function iC(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&Ky(n,e)})}function sC(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&Ky(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function Ky(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function oC(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function aC(n,e){n==null,oh(n,e)}function uC(n,e){return Fa(n,e)}function cC(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function lC(n){return Object.getPrototypeOf(n.constructor)===jA}function hC(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function dC(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===Ry?t=s:lC(s)?r=s:i=s}),i||r||t||null}function fC(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function Ty(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function Ay(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Pa=class extends Hr{constructor(e=null,t,r){super(rh(t),ih(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),La(t)&&(t.nonNullable||t.initialValueIsDefault)&&(Ay(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Ty(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Ty(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){Ay(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var pC=n=>n instanceof Pa;var MP=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=qe({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let n=e;return n})();var Hy=new q("");var gC={provide:Kr,useExisting:Ki(()=>mC)},mC=(()=>{let e=class e extends Kr{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new gt,this._setValidators(r),this._setAsyncValidators(i)}ngOnChanges(r){this._checkFormPresent(),r.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Fa(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(r){let i=this.form.get(r.path);return Ey(i,r,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(r),i}getControl(r){return this.form.get(r.path)}removeControl(r){Iy(r.control||null,r,!1),fC(this.directives,r)}addFormGroup(r){this._setUpFormContainer(r)}removeFormGroup(r){this._cleanUpFormContainer(r)}getFormGroup(r){return this.form.get(r.path)}addFormArray(r){this._setUpFormContainer(r)}removeFormArray(r){this._cleanUpFormContainer(r)}getFormArray(r){return this.form.get(r.path)}updateModel(r,i){this.form.get(r.path).setValue(i)}onSubmit(r){return this.submitted=!0,hC(this.form,this.directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_updateDomValue(){this.directives.forEach(r=>{let i=r.control,s=this.form.get(r.path);i!==s&&(Iy(i||null,r),pC(s)&&(Ey(s,r,this.callSetDisabledState),r.control=s))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(r){let i=this.form.get(r.path);aC(i,r),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(r){if(this.form){let i=this.form.get(r.path);i&&uC(i,r)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){oh(this.form,this),this._oldForm&&Fa(this._oldForm,this)}_checkFormPresent(){this.form}};e.\u0275fac=function(i){return new(i||e)(Q(nh,10),Q(Py,10),Q(Gy,8))},e.\u0275dir=qe({type:e,selectors:[["","formGroup",""]],hostBindings:function(i,s){i&1&&Ht("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{form:[Kt.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Xi([gC]),dn,hn]});let n=e;return n})();var yC={provide:xs,useExisting:Ki(()=>vC)},vC=(()=>{let e=class e extends xs{set isDisabled(r){}constructor(r,i,s,o,a){super(),this._ngModelWarningConfig=a,this._added=!1,this.name=null,this.update=new gt,this._ngModelWarningSent=!1,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=dC(this,o)}ngOnChanges(r){this._added||this._setUpControl(),cC(r,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}get path(){return nC(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};e._ngModelWarningSentOnce=!1,e.\u0275fac=function(i){return new(i||e)(Q(Kr,13),Q(nh,10),Q(Py,10),Q(by,10),Q(Hy,8))},e.\u0275dir=qe({type:e,selectors:[["","formControlName",""]],inputs:{name:[Kt.None,"formControlName","name"],isDisabled:[Kt.None,"disabled","isDisabled"],model:[Kt.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[Xi([yC]),dn,hn]});let n=e;return n})();var _C=(()=>{let e=class e{constructor(){this._validator=xa}ngOnChanges(r){if(this.inputName in r){let i=this.normalizeInput(r[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):xa,this._onChange&&this._onChange()}}validate(r){return this._validator(r)}registerOnValidatorChange(r){this._onChange=r}enabled(r){return r!=null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=qe({type:e,features:[hn]});let n=e;return n})();var wC={provide:nh,useExisting:Ki(()=>EC),multi:!0};var EC=(()=>{let e=class e extends _C{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Nr,this.createValidator=r=>xy}enabled(r){return r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Vr(e)))(s||e)}})(),e.\u0275dir=qe({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,s){i&2&&Jo("required",s._enabled?"":null)},inputs:{required:"required"},features:[Xi([wC]),dn]});let n=e;return n})();var IC=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=We({type:e}),e.\u0275inj=He({});let n=e;return n})(),th=class extends Hr{constructor(e,t,r){super(rh(t),ih(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){zy(this,!1,e),e.forEach((r,i)=>{$y(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>r._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function Cy(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var kP=(()=>{let e=class e{constructor(){this.useNonNullable=!1}get nonNullable(){let r=new e;return r.useNonNullable=!0,r}group(r,i=null){let s=this._reduceControls(r),o={};return Cy(i)?o=i:i!==null&&(o.validators=i.validator,o.asyncValidators=i.asyncValidator),new Na(s,o)}record(r,i=null){let s=this._reduceControls(r);return new eh(s,i)}control(r,i,s){let o={};return this.useNonNullable?(Cy(i)?o=i:(o.validators=i,o.asyncValidators=s),new Pa(r,ee(S({},o),{nonNullable:!0}))):new Pa(r,i,s)}array(r,i,s){let o=r.map(a=>this._createControl(a));return new th(o,i,s)}_reduceControls(r){let i={};return Object.keys(r).forEach(s=>{i[s]=this._createControl(r[s])}),i}_createControl(r){if(r instanceof Pa)return r;if(r instanceof Hr)return r;if(Array.isArray(r)){let i=r[0],s=r.length>1?r[1]:null,o=r.length>2?r[2]:null;return this.control(i,s,o)}else return this.control(r)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Wy=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:Hy,useValue:r.warnOnNgModelWithFormControl??"always"},{provide:Gy,useValue:r.callSetDisabledState??sh}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=We({type:e}),e.\u0275inj=He({imports:[IC]});let n=e;return n})();var TC="firebase",AC="10.11.1";fn(TC,AC,"app");var Wr=new Zi("ANGULARFIRE2_VERSION");var CC=(n,e)=>{let t=e?[e]:ym(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Wn=class{constructor(){return CC(SC)}},SC="app-check";function ah(){}var Ua=class{zone;delegate;constructor(e,t=pg){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},uh=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ah,{},ah,ah)),t.pipe(be({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},ja=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Ua(Zone.current)),this.insideAngular=t.run(()=>new Ua(Zone.current,Go)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(R(ge))};static \u0275prov=z({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function bC(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function Ye(n){return RC(bC())(n)}function RC(n){return function(t){return t=t.lift(new uh(n.ngZone)),t.pipe(br(n.outsideAngular),Bn(n.insideAngular))}}var xC=new Map,VC={activated:!1,tokenObservers:[]},MC={initialized:!1,enabled:!1};function wt(n){return xC.get(n)||Object.assign({},VC)}function ev(){return MC}var kC="https://content-firebaseappcheck.googleapis.com/v1";var NC="exchangeDebugToken",Yy={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},ZP=24*60*60*1e3;var lh=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return m(this,null,function*(){this.stop();try{this.pending=new il,this.pending.promise.catch(t=>{}),yield OC(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new il,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function OC(n){return new Promise(e=>{setTimeout(e,n)})}var FC={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},_n=new gm("appCheck","AppCheck",FC);function tv(n){if(!wt(n).activated)throw _n.create("use-before-activation",{appName:n.name})}function nv(r,i){return m(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let f=yield o.getHeartbeatsHeader();f&&(s["X-Firebase-Client"]=f)}let a={method:"POST",body:JSON.stringify(e),headers:s},u;try{u=yield fetch(n,a)}catch(f){throw _n.create("fetch-network-error",{originalErrorMessage:f?.message})}if(u.status!==200)throw _n.create("fetch-status-error",{httpStatus:u.status});let c;try{c=yield u.json()}catch(f){throw _n.create("fetch-parse-error",{originalErrorMessage:f?.message})}let l=c.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw _n.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let h=Number(l[1])*1e3,d=Date.now();return{token:c.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})}function rv(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${kC}/projects/${t}/apps/${r}:${NC}?key=${i}`,body:{debug_token:e}}}var LC="firebase-app-check-database",UC=1,hh="firebase-app-check-store";var Ba=null;function jC(){return Ba||(Ba=new Promise((n,e)=>{try{let t=indexedDB.open(LC,UC);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(_n.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(hh,{keyPath:"compositeKey"})}}}catch(t){e(_n.create("storage-open",{originalErrorMessage:t?.message}))}}),Ba)}function BC(n,e){return qC($C(n),e)}function qC(n,e){return m(this,null,function*(){let r=(yield jC()).transaction(hh,"readwrite"),s=r.objectStore(hh).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=u=>{o()},r.onerror=u=>{var c;a(_n.create("storage-set",{originalErrorMessage:(c=u.target.error)===null||c===void 0?void 0:c.message}))}})})}function $C(n){return`${n.options.appId}-${n.name}`}var dh=new oa("@firebase/app-check");function ch(n,e){return sa()?BC(n,e).catch(t=>{dh.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function iv(){return ev().enabled}function sv(){return m(this,null,function*(){let n=ev();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var zC={error:"UNKNOWN_ERROR"};function GC(n){return dm.encodeString(JSON.stringify(n),!1)}function fh(n,e=!1){return m(this,null,function*(){let t=n.app;tv(t);let r=wt(t),i=r.token,s;if(i&&!Vs(i)&&(r.token=void 0,i=void 0),!i){let u=yield r.cachedTokenPromise;u&&(Vs(u)?i=u:yield ch(t,void 0))}if(!e&&i&&Vs(i))return{token:i.token};let o=!1;if(iv()){r.exchangeTokenPromise||(r.exchangeTokenPromise=nv(rv(t,yield sv()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let u=yield r.exchangeTokenPromise;return yield ch(t,u),r.token=u,{token:u.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield wt(t).exchangeTokenPromise}catch(u){u.code==="appCheck/throttled"?dh.warn(u.message):dh.error(u),s=u}let a;return i?s?Vs(i)?a={token:i.token,internalError:s}:a=Xy(s):(a={token:i.token},r.token=i,yield ch(t,i)):a=Xy(s),o&&QC(t,a),a})}function KC(n){return m(this,null,function*(){let e=n.app;tv(e);let{provider:t}=wt(e);if(iv()){let r=yield sv(),{token:i}=yield nv(rv(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function HC(n,e,t,r){let{app:i}=n,s=wt(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Vs(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Jy(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Jy(n))}function ov(n,e){let t=wt(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Jy(n){let{app:e}=n,t=wt(e),r=t.tokenRefresher;r||(r=WC(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function WC(n){let{app:e}=n;return new lh(()=>m(this,null,function*(){let t=wt(e),r;if(t.token?r=yield fh(n,!0):r=yield fh(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=wt(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Yy.RETRIAL_MIN_WAIT,Yy.RETRIAL_MAX_WAIT)}function QC(n,e){let t=wt(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Vs(n){return n.expireTimeMillis-Date.now()>0}function Xy(n){return{token:GC(zC),error:n}}var ph=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=wt(this.app);for(let t of e)ov(this.app,t.next);return Promise.resolve()}};function YC(n,e){return new ph(n,e)}function JC(n){return{getToken:e=>fh(n,e),getLimitedUseToken:()=>KC(n),addTokenListener:e=>HC(n,"INTERNAL",e),removeTokenListener:e=>ov(n.app,e)}}var XC="@firebase/app-check",ZC="0.8.3";var eS="app-check",Zy="app-check-internal";function tS(){is(new zn(eS,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return YC(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Zy).initialize()})),is(new zn(Zy,n=>{let e=n.getProvider("app-check").getImmediate();return JC(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),fn(XC,ZC)}tS();var nS=["localhost","0.0.0.0","127.0.0.1"],hx=typeof window<"u"&&nS.includes(window.location.hostname);var rS="firebase",iS="10.11.1";Qe.registerVersion(rS,iS,"app-compat");var sS=["ngOnDestroy"],cv=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(sS.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let u=a?.[s];return typeof u=="function"?u.bind(a):u?.then?u.then(c=>t.run(()=>c)):t.run(()=>u)});return new Proxy(()=>{},{get:(a,u)=>o[u],apply:(a,u,c)=>o.then(l=>{let h=l?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,h),h})})})});var qa=class{constructor(e){return e}},Qr=new q("angularfire2.app.options"),Yr=new q("angularfire2.app.name");function Ms(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Qe.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Qe.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;oS("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new qa(o)}var oS=(n,...e)=>{rl()&&typeof console<"u"&&console[n](...e)},aS={provide:qa,useFactory:Ms,deps:[Qr,ge,[new Hi,Yr]]},Ix=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Qr,useValue:t},{provide:Yr,useValue:r}]}}constructor(t){Qe.registerVersion("angularfire",Wr.full,"core"),Qe.registerVersion("angularfire",Wr.full,"app-compat"),Qe.registerVersion("angular",Yg.full,t.toString())}static \u0275fac=function(r){return new(r||n)(R(mt))};static \u0275mod=We({type:n});static \u0275inj=He({providers:[aS]})}return n})();function $a(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return uS(i,o)||(uv("error",`${e} was already initialized on the ${t} Firebase App with different settings.${cS?" You may need to reload as Firebase is not HMR aware.":""}`),uv("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function uS(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var cS=typeof module<"u"&&!!module.hot,uv=(n,...e)=>{rl()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var gh=new q("angularfire2.auth.use-emulator"),mh=new q("angularfire2.auth.settings"),yh=new q("angularfire2.auth.tenant-id"),vh=new q("angularfire2.auth.langugage-code"),_h=new q("angularfire2.auth.use-device-language"),wh=new q("angularfire.auth.persistence"),Eh=(n,e,t,r,i,s,o,a)=>$a(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let u=e.runOutsideAngular(()=>n.auth());if(t&&u.useEmulator(...t),r&&(u.tenantId=r),u.languageCode=i,s&&u.useDeviceLanguage(),o)for(let[c,l]of Object.entries(o))u.settings[c]=l;return a&&u.setPersistence(a),u},[t,r,i,s,o,a]),Ih=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,u,c,l,h,d,f){let E=new Rt,w=P(void 0).pipe(Bn(o.outsideAngular),pe(()=>s.runOutsideAngular(()=>import("./chunk-BIEAD774.js"))),N(()=>Ms(t,s,r)),N(_=>Eh(_,s,a,c,l,h,u,d)),Hc({bufferSize:1,refCount:!1}));if($n(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=P(null);else{w.pipe(Dt()).subscribe();let _=w.pipe(pe(b=>b.getRedirectResult().then(j=>j,()=>null)),Ye,Hc({bufferSize:1,refCount:!1})),x=w.pipe(pe(b=>new Sr(j=>({unsubscribe:s.runOutsideAngular(()=>b.onAuthStateChanged(B=>j.next(B),B=>j.error(B),()=>j.complete()))})))),O=w.pipe(pe(b=>new Sr(j=>({unsubscribe:s.runOutsideAngular(()=>b.onIdTokenChanged(B=>j.next(B),B=>j.error(B),()=>j.complete()))}))));this.authState=_.pipe(Wc(x),br(o.outsideAngular),Bn(o.insideAngular)),this.user=_.pipe(Wc(O),br(o.outsideAngular),Bn(o.insideAngular)),this.idToken=this.user.pipe(pe(b=>b?Z(b.getIdToken()):P(null))),this.idTokenResult=this.user.pipe(pe(b=>b?Z(b.getIdTokenResult()):P(null))),this.credential=_g(_,E,this.authState.pipe(st(b=>!b))).pipe(N(b=>b?.user?b:null),br(o.outsideAngular),Bn(o.insideAngular))}return cv(this,w,s,{spy:{apply:(_,x,O)=>{(_.startsWith("signIn")||_.startsWith("createUser"))&&O.then(b=>E.next(b))}}})}static \u0275fac=function(r){return new(r||n)(R(Qr),R(Yr,8),R(mt),R(ge),R(ja),R(gh,8),R(mh,8),R(yh,8),R(vh,8),R(_h,8),R(wh,8),R(Wn,8))};static \u0275prov=z({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Fx=(()=>{class n{constructor(){Qe.registerVersion("angularfire",Wr.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=We({type:n});static \u0275inj=He({providers:[Ih]})}return n})();var hS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},It={},A,zh=zh||{},k=hS||self;function ru(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function Hs(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function dS(n){return Object.prototype.hasOwnProperty.call(n,Th)&&n[Th]||(n[Th]=++fS)}var Th="closure_uid_"+(1e9*Math.random()>>>0),fS=0;function pS(n,e,t){return n.call.apply(n.bind,arguments)}function gS(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Le(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Le=pS:Le=gS,Le.apply(null,arguments)}function za(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function xe(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function wn(){this.s=this.s,this.o=this.o}var mS=0;wn.prototype.s=!1;wn.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),mS!=0)&&dS(this)};wn.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Iv=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Gh(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function lv(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(ru(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function Ue(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Ue.prototype.h=function(){this.defaultPrevented=!0};var yS=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};k.addEventListener("test",t,e),k.removeEventListener("test",t,e)}catch{}return n}();function Us(n){return/^[\s\xa0]*$/.test(n)}function iu(){var n=k.navigator;return n&&(n=n.userAgent)?n:""}function Mt(n){return iu().indexOf(n)!=-1}function Kh(n){return Kh[" "](n),n}Kh[" "]=function(){};function vS(n,e){var t=ob;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var _S=Mt("Opera"),ei=Mt("Trident")||Mt("MSIE"),Tv=Mt("Edge"),Rh=Tv||ei,Av=Mt("Gecko")&&!(iu().toLowerCase().indexOf("webkit")!=-1&&!Mt("Edge"))&&!(Mt("Trident")||Mt("MSIE"))&&!Mt("Edge"),wS=iu().toLowerCase().indexOf("webkit")!=-1&&!Mt("Edge");function Cv(){var n=k.document;return n?n.documentMode:void 0}var Dh;e:{if(Ga="",Ka=function(){var n=iu();if(Av)return/rv:([^\);]+)(\)|;)/.exec(n);if(Tv)return/Edge\/([\d\.]+)/.exec(n);if(ei)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(wS)return/WebKit\/(\S+)/.exec(n);if(_S)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),Ka&&(Ga=Ka?Ka[1]:""),ei&&(Ha=Cv(),Ha!=null&&Ha>parseFloat(Ga))){Dh=String(Ha);break e}Dh=Ga}var Ga,Ka,Ha,Ph;k.document&&ei?(Ah=Cv(),Ph=Ah||parseInt(Dh,10)||void 0):Ph=void 0;var Ah,ES=Ph;function js(n,e){if(Ue.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Av){e:{try{Kh(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:IS[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&js.$.h.call(this)}}xe(js,Ue);var IS={2:"touch",3:"pen",4:"mouse"};js.prototype.h=function(){js.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Ws="closure_listenable_"+(1e6*Math.random()|0),TS=0;function AS(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++TS,this.fa=this.ia=!1}function su(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Hh(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function CS(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function Sv(n){let e={};for(let t in n)e[t]=n[t];return e}var hv="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function bv(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<hv.length;s++)t=hv[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function ou(n){this.src=n,this.g={},this.h=0}ou.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=Vh(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new AS(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function xh(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=Iv(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(su(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function Vh(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var Wh="closure_lm_"+(1e6*Math.random()|0),Ch={};function Rv(n,e,t,r,i){if(r&&r.once)return Pv(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Rv(n,e[s],t,r,i);return null}return t=Jh(t),n&&n[Ws]?n.O(e,t,Hs(r)?!!r.capture:!!r,i):Dv(n,e,t,!1,r,i)}function Dv(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=Hs(i)?!!i.capture:!!i,a=Yh(n);if(a||(n[Wh]=a=new ou(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=SS(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)yS||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(Vv(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function SS(){function n(t){return e.call(n.src,n.listener,t)}let e=bS;return n}function Pv(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Pv(n,e[s],t,r,i);return null}return t=Jh(t),n&&n[Ws]?n.P(e,t,Hs(r)?!!r.capture:!!r,i):Dv(n,e,t,!0,r,i)}function xv(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)xv(n,e[s],t,r,i);else r=Hs(r)?!!r.capture:!!r,t=Jh(t),n&&n[Ws]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=Vh(s,t,r,i),-1<t&&(su(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=Yh(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Vh(e,t,r,i)),(t=-1<n?e[n]:null)&&Qh(t))}function Qh(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[Ws])xh(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(Vv(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Yh(e))?(xh(t,n),t.h==0&&(t.src=null,e[Wh]=null)):su(n)}}}function Vv(n){return n in Ch?Ch[n]:Ch[n]="on"+n}function bS(n,e){if(n.fa)n=!0;else{e=new js(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Qh(n),n=t.call(r,e)}return n}function Yh(n){return n=n[Wh],n instanceof ou?n:null}var Sh="__closure_events_fn_"+(1e9*Math.random()>>>0);function Jh(n){return typeof n=="function"?n:(n[Sh]||(n[Sh]=function(e){return n.handleEvent(e)}),n[Sh])}function Pe(){wn.call(this),this.i=new ou(this),this.S=this,this.J=null}xe(Pe,wn);Pe.prototype[Ws]=!0;Pe.prototype.removeEventListener=function(n,e,t,r){xv(this,n,e,t,r)};function Ne(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new Ue(e,n);else if(e instanceof Ue)e.target=e.target||n;else{var i=e;e=new Ue(r,n),bv(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=Wa(o,r,!0,e)&&i}if(o=e.g=n,i=Wa(o,r,!0,e)&&i,i=Wa(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=Wa(o,r,!1,e)&&i}Pe.prototype.N=function(){if(Pe.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)su(t[r]);delete n.g[e],n.h--}}this.J=null};Pe.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};Pe.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function Wa(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&xh(n.i,o),i=a.call(u,r)!==!1&&i}}return i&&!r.defaultPrevented}var Xh=k.JSON.stringify,Mh=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function RS(){var n=Zh;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var kh=class{constructor(){this.h=this.g=null}add(e,t){let r=Mv.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},Mv=new Mh(()=>new Nh,n=>n.reset()),Nh=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function DS(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function PS(n){k.setTimeout(()=>{throw n},0)}var Bs,qs=!1,Zh=new kh,kv=()=>{let n=k.Promise.resolve(void 0);Bs=()=>{n.then(xS)}},xS=()=>{for(var n;n=RS();){try{n.h.call(n.g)}catch(t){PS(t)}var e=Mv;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}qs=!1};function au(n,e){Pe.call(this),this.h=n||1,this.g=e||k,this.j=Le(this.qb,this),this.l=Date.now()}xe(au,Pe);A=au.prototype;A.ga=!1;A.T=null;A.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ne(this,"tick"),this.ga&&(ed(this),this.start()))}};A.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function ed(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}A.N=function(){au.$.N.call(this),ed(this),delete this.g};function td(n,e,t){if(typeof n=="function")t&&(n=Le(n,t));else if(n&&typeof n.handleEvent=="function")n=Le(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:k.setTimeout(n,e||0)}function Nv(n){n.g=td(()=>{n.g=null,n.i&&(n.i=!1,Nv(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var Oh=class extends wn{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Nv(this)}N(){super.N(),this.g&&(k.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function $s(n){wn.call(this),this.h=n,this.g={}}xe($s,wn);var dv=[];function Ov(n,e,t,r){Array.isArray(t)||(t&&(dv[0]=t.toString()),t=dv);for(var i=0;i<t.length;i++){var s=Rv(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Fv(n){Hh(n.g,function(e,t){this.g.hasOwnProperty(t)&&Qh(e)},n),n.g={}}$s.prototype.N=function(){$s.$.N.call(this),Fv(this)};$s.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function uu(){this.g=!0}uu.prototype.Ea=function(){this.g=!1};function VS(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+c+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function MS(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function Xr(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+NS(n,t)+(r?" "+r:"")})}function kS(n,e){n.info(function(){return"TIMEOUT: "+e})}uu.prototype.info=function(){};function NS(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Xh(t)}catch{return e}}var Xn={},fv=null;function cu(){return fv=fv||new Pe}Xn.Ta="serverreachability";function Lv(n){Ue.call(this,Xn.Ta,n)}xe(Lv,Ue);function zs(n){let e=cu();Ne(e,new Lv(e))}Xn.STAT_EVENT="statevent";function Uv(n,e){Ue.call(this,Xn.STAT_EVENT,n),this.stat=e}xe(Uv,Ue);function $e(n){let e=cu();Ne(e,new Uv(e,n))}Xn.Ua="timingevent";function jv(n,e){Ue.call(this,Xn.Ua,n),this.size=e}xe(jv,Ue);function Qs(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return k.setTimeout(function(){n()},e)}var lu={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Bv={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function nd(){}nd.prototype.h=null;function pv(n){return n.h||(n.h=n.i())}function qv(){}var Ys={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function rd(){Ue.call(this,"d")}xe(rd,Ue);function id(){Ue.call(this,"c")}xe(id,Ue);var Fh;function hu(){}xe(hu,nd);hu.prototype.g=function(){return new XMLHttpRequest};hu.prototype.i=function(){return{}};Fh=new hu;function Js(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new $s(this),this.P=OS,n=Rh?125:void 0,this.V=new au(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new $v}function $v(){this.i=null,this.g="",this.h=!1}var OS=45e3,zv={},Lh={};A=Js.prototype;A.setTimeout=function(n){this.P=n};function Uh(n,e,t){n.L=1,n.A=fu(Jt(e)),n.u=t,n.S=!0,Gv(n,null)}function Gv(n,e){n.G=Date.now(),Xs(n),n.B=Jt(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Zv(t.i,"t",r),n.o=0,t=n.l.J,n.h=new $v,n.g=w_(n.l,t?e:null,!n.u),0<n.O&&(n.M=new Oh(Le(n.Pa,n,n.g),n.O)),Ov(n.U,n.g,"readystatechange",n.nb),e=n.I?Sv(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),zs(),VS(n.j,n.v,n.B,n.m,n.W,n.u)}A.nb=function(n){n=n.target;let e=this.M;e&&kt(n)==3?e.l():this.Pa(n)};A.Pa=function(n){try{if(n==this.g)e:{let l=kt(this.g);var e=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||Rh||this.g&&(this.h.h||this.g.ja()||vv(this.g)))){this.J||l!=4||e==7||(e==8||0>=h?zs(3):zs(2)),du(this);var t=this.g.da();this.ca=t;t:if(Kv(this)){var r=vv(this.g);n="";var i=r.length,s=kt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Qn(this),Ls(this);var o="";break t}this.h.i=new k.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,MS(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Us(a)){var c=a;break t}}c=null}if(t=c)Xr(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,jh(this,t);else{this.i=!1,this.s=3,$e(12),Qn(this),Ls(this);break e}}this.S?(Hv(this,l,o),Rh&&this.i&&l==3&&(Ov(this.U,this.V,"tick",this.mb),this.V.start())):(Xr(this.j,this.m,o,null),jh(this,o)),l==4&&Qn(this),this.i&&!this.J&&(l==4?m_(this.l,this):(this.i=!1,Xs(this)))}else rb(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,$e(12)):(this.s=0,$e(13)),Qn(this),Ls(this)}}}catch{}finally{}};function Kv(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function Hv(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=FS(n,t),i==Lh){e==4&&(n.s=4,$e(14),r=!1),Xr(n.j,n.m,null,"[Incomplete Response]");break}else if(i==zv){n.s=4,$e(15),Xr(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else Xr(n.j,n.m,i,null),jh(n,i);Kv(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,$e(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),ld(e),e.M=!0,$e(11))):(Xr(n.j,n.m,t,"[Invalid Chunked Response]"),Qn(n),Ls(n))}A.mb=function(){if(this.g){var n=kt(this.g),e=this.g.ja();this.o<e.length&&(du(this),Hv(this,n,e),this.i&&n!=4&&Xs(this))}};function FS(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?Lh:(t=Number(e.substring(t,r)),isNaN(t)?zv:(r+=1,r+t>e.length?Lh:(e=e.slice(r,r+t),n.o=r+t,e)))}A.cancel=function(){this.J=!0,Qn(this)};function Xs(n){n.Y=Date.now()+n.P,Wv(n,n.P)}function Wv(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=Qs(Le(n.lb,n),e)}function du(n){n.C&&(k.clearTimeout(n.C),n.C=null)}A.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(kS(this.j,this.B),this.L!=2&&(zs(),$e(17)),Qn(this),this.s=2,Ls(this)):Wv(this,this.Y-n)};function Ls(n){n.l.H==0||n.J||m_(n.l,n)}function Qn(n){du(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,ed(n.V),Fv(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function jh(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||Bh(t.i,n))){if(!n.K&&Bh(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)Za(t),mu(t);else break e;cd(t),$e(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=Qs(Le(t.ib,t),6e3));if(1>=n_(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Yn(t,11)}else if((n.K||t.g==n)&&Za(t),!Us(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let l=c[3];l!=null&&(t.ra=l,t.l.info("VER="+t.ra));let h=c[4];h!=null&&(t.Ga=h,t.l.info("SVER="+t.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let f=n.g;if(f){let E=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(E){var s=r.i;s.g||E.indexOf("spdy")==-1&&E.indexOf("quic")==-1&&E.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(sd(s,s.h),s.h=null))}if(r.F){let w=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;w&&(r.Da=w,re(r.I,r.F,w))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=__(r,r.J?r.pa:null,r.Y),o.K){r_(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(du(a),Xs(a)),r.g=o}else p_(r);0<t.j.length&&yu(t)}else c[0]!="stop"&&c[0]!="close"||Yn(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Yn(t,7):ud(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}zs(4)}catch{}}function LS(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(ru(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function US(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(ru(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function Qv(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(ru(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=US(n),r=LS(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var Yv=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function jS(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Jn(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Jn){this.h=n.h,Ja(this,n.j),this.s=n.s,this.g=n.g,Xa(this,n.m),this.l=n.l;var e=n.i,t=new Gs;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),gv(this,t),this.o=n.o}else n&&(e=String(n).match(Yv))?(this.h=!1,Ja(this,e[1]||"",!0),this.s=Os(e[2]||""),this.g=Os(e[3]||"",!0),Xa(this,e[4]),this.l=Os(e[5]||"",!0),gv(this,e[6]||"",!0),this.o=Os(e[7]||"")):(this.h=!1,this.i=new Gs(null,this.h))}Jn.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Fs(e,mv,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Fs(e,mv,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(Fs(t,t.charAt(0)=="/"?$S:qS,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Fs(t,GS)),n.join("")};function Jt(n){return new Jn(n)}function Ja(n,e,t){n.j=t?Os(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Xa(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function gv(n,e,t){e instanceof Gs?(n.i=e,KS(n.i,n.h)):(t||(e=Fs(e,zS)),n.i=new Gs(e,n.h))}function re(n,e,t){n.i.set(e,t)}function fu(n){return re(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Os(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Fs(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,BS),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function BS(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var mv=/[#\/\?@]/g,qS=/[#\?:]/g,$S=/[#\?]/g,zS=/[#\?@]/g,GS=/#/g;function Gs(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function En(n){n.g||(n.g=new Map,n.h=0,n.i&&jS(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}A=Gs.prototype;A.add=function(n,e){En(this),this.i=null,n=ti(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function Jv(n,e){En(n),e=ti(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Xv(n,e){return En(n),e=ti(n,e),n.g.has(e)}A.forEach=function(n,e){En(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};A.ta=function(){En(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};A.Z=function(n){En(this);let e=[];if(typeof n=="string")Xv(this,n)&&(e=e.concat(this.g.get(ti(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};A.set=function(n,e){return En(this),this.i=null,n=ti(this,n),Xv(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};A.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function Zv(n,e,t){Jv(n,e),0<t.length&&(n.i=null,n.g.set(ti(n,e),Gh(t)),n.h+=t.length)}A.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function ti(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function KS(n,e){e&&!n.j&&(En(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Jv(this,r),Zv(this,i,t))},n)),n.j=e}var HS=class{constructor(n,e){this.g=n,this.map=e}};function e_(n){this.l=n||WS,k.PerformanceNavigationTiming?(n=k.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(k.g&&k.g.Ka&&k.g.Ka()&&k.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var WS=10;function t_(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function n_(n){return n.h?1:n.g?n.g.size:0}function Bh(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function sd(n,e){n.g?n.g.add(e):n.h=e}function r_(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}e_.prototype.cancel=function(){if(this.i=i_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function i_(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return Gh(n.i)}var QS=class{stringify(n){return k.JSON.stringify(n,void 0)}parse(n){return k.JSON.parse(n,void 0)}};function YS(){this.g=new QS}function JS(n,e,t){let r=t||"";try{Qv(n,function(i,s){let o=i;Hs(i)&&(o=Xh(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function XS(n,e){let t=new uu;if(k.Image){let r=new Image;r.onload=za(Qa,t,r,"TestLoadImage: loaded",!0,e),r.onerror=za(Qa,t,r,"TestLoadImage: error",!1,e),r.onabort=za(Qa,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=za(Qa,t,r,"TestLoadImage: timeout",!1,e),k.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function Qa(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Zs(n){this.l=n.ec||null,this.j=n.ob||!1}xe(Zs,nd);Zs.prototype.g=function(){return new pu(this.l,this.j)};Zs.prototype.i=function(n){return function(){return n}}({});function pu(n,e){Pe.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=od,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}xe(pu,Pe);var od=0;A=pu.prototype;A.open=function(n,e){if(this.readyState!=od)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Ks(this)};A.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||k).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};A.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,eo(this)),this.readyState=od};A.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Ks(this)),this.g&&(this.readyState=3,Ks(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof k.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;s_(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function s_(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}A.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?eo(this):Ks(this),this.readyState==3&&s_(this)}};A.Za=function(n){this.g&&(this.response=this.responseText=n,eo(this))};A.Ya=function(n){this.g&&(this.response=n,eo(this))};A.ka=function(){this.g&&eo(this)};function eo(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Ks(n)}A.setRequestHeader=function(n,e){this.v.append(n,e)};A.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};A.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function Ks(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(pu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var ZS=k.JSON.parse;function he(n){Pe.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=o_,this.L=this.M=!1}xe(he,Pe);var o_="",eb=/^https?$/i,tb=["POST","PUT"];A=he.prototype;A.Oa=function(n){this.M=n};A.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Fh.g(),this.C=this.u?pv(this.u):pv(Fh),this.g.onreadystatechange=Le(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){yv(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=k.FormData&&n instanceof k.FormData,!(0<=Iv(tb,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{c_(this),0<this.B&&((this.L=nb(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Le(this.ua,this)):this.A=td(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){yv(this,s)}};function nb(n){return ei&&typeof n.timeout=="number"&&n.ontimeout!==void 0}A.ua=function(){typeof zh<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ne(this,"timeout"),this.abort(8))};function yv(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,a_(n),gu(n)}function a_(n){n.F||(n.F=!0,Ne(n,"complete"),Ne(n,"error"))}A.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Ne(this,"complete"),Ne(this,"abort"),gu(this))};A.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),gu(this,!0)),he.$.N.call(this)};A.La=function(){this.s||(this.G||this.v||this.l?u_(this):this.kb())};A.kb=function(){u_(this)};function u_(n){if(n.h&&typeof zh<"u"&&(!n.C[1]||kt(n)!=4||n.da()!=2)){if(n.v&&kt(n)==4)td(n.La,0,n);else if(Ne(n,"readystatechange"),kt(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(Yv)[1]||null;!i&&k.self&&k.self.location&&(i=k.self.location.protocol.slice(0,-1)),r=!eb.test(i?i.toLowerCase():"")}t=r}if(t)Ne(n,"complete"),Ne(n,"success");else{n.m=6;try{var s=2<kt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",a_(n)}}finally{gu(n)}}}}function gu(n,e){if(n.g){c_(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Ne(n,"ready");try{t.onreadystatechange=r}catch{}}}function c_(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(k.clearTimeout(n.A),n.A=null)}A.isActive=function(){return!!this.g};function kt(n){return n.g?n.g.readyState:0}A.da=function(){try{return 2<kt(this)?this.g.status:-1}catch{return-1}};A.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};A.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),ZS(e)}};function vv(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case o_:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function rb(n){let e={};n=(n.g&&2<=kt(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Us(n[r]))continue;var t=DS(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}CS(e,function(r){return r.join(", ")})}A.Ia=function(){return this.m};A.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function l_(n){let e="";return Hh(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function ad(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=l_(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):re(n,e,t))}function ks(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function h_(n){this.Ga=0,this.j=[],this.l=new uu,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=ks("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=ks("baseRetryDelayMs",5e3,n),this.hb=ks("retryDelaySeedMs",1e4,n),this.eb=ks("forwardChannelMaxRetries",2,n),this.xa=ks("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new e_(n&&n.concurrentRequestLimit),this.Ja=new YS,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}A=h_.prototype;A.ra=8;A.H=1;function ud(n){if(d_(n),n.H==3){var e=n.W++,t=Jt(n.I);if(re(t,"SID",n.K),re(t,"RID",e),re(t,"TYPE","terminate"),to(n,t),e=new Js(n,n.l,e),e.L=2,e.A=fu(Jt(t)),t=!1,k.navigator&&k.navigator.sendBeacon)try{t=k.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&k.Image&&(new Image().src=e.A,t=!0),t||(e.g=w_(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Xs(e)}v_(n)}function mu(n){n.g&&(ld(n),n.g.cancel(),n.g=null)}function d_(n){mu(n),n.u&&(k.clearTimeout(n.u),n.u=null),Za(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&k.clearTimeout(n.m),n.m=null)}function yu(n){if(!t_(n.i)&&!n.m){n.m=!0;var e=n.Na;Bs||kv(),qs||(Bs(),qs=!0),Zh.add(e,n),n.C=0}}function ib(n,e){return n_(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=Qs(Le(n.Na,n,e),y_(n,n.C)),n.C++,!0)}A.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new Js(this,this.l,n),s=this.s;if(this.U&&(s?(s=Sv(s),bv(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=f_(this,i,e),t=Jt(this.I),re(t,"RID",n),re(t,"CVER",22),this.F&&re(t,"X-HTTP-Session-Id",this.F),to(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(l_(s)))+"&"+e:this.o&&ad(t,this.o,s)),sd(this.i,i),this.bb&&re(t,"TYPE","init"),this.P?(re(t,"$req",e),re(t,"SID","null"),i.aa=!0,Uh(i,t,null)):Uh(i,t,e),this.H=2}}else this.H==3&&(n?_v(this,n):this.j.length==0||t_(this.i)||_v(this))};function _v(n,e){var t;e?t=e.m:t=n.W++;let r=Jt(n.I);re(r,"SID",n.K),re(r,"RID",t),re(r,"AID",n.V),to(n,r),n.o&&n.s&&ad(r,n.o,n.s),t=new Js(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=f_(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),sd(n.i,t),Uh(t,r,e)}function to(n,e){n.na&&Hh(n.na,function(t,r){re(e,r,t)}),n.h&&Qv({},function(t,r){re(e,r,t)})}function f_(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Le(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g,l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{JS(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function p_(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Bs||kv(),qs||(Bs(),qs=!0),Zh.add(e,n),n.A=0}}function cd(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=Qs(Le(n.Ma,n),y_(n,n.A)),n.A++,!0)}A.Ma=function(){if(this.u=null,g_(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Qs(Le(this.jb,this),n)}};A.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,$e(10),mu(this),g_(this))};function ld(n){n.B!=null&&(k.clearTimeout(n.B),n.B=null)}function g_(n){n.g=new Js(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=Jt(n.wa);re(e,"RID","rpc"),re(e,"SID",n.K),re(e,"AID",n.V),re(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&re(e,"TO",n.qa),re(e,"TYPE","xmlhttp"),to(n,e),n.o&&n.s&&ad(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=fu(Jt(e)),t.u=null,t.S=!0,Gv(t,n)}A.ib=function(){this.v!=null&&(this.v=null,mu(this),cd(this),$e(19))};function Za(n){n.v!=null&&(k.clearTimeout(n.v),n.v=null)}function m_(n,e){var t=null;if(n.g==e){Za(n),ld(n),n.g=null;var r=2}else if(Bh(n.i,e))t=e.F,r_(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=cu(),Ne(r,new jv(r,t)),yu(n)}else p_(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&ib(n,e)||r==2&&cd(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Yn(n,5);break;case 4:Yn(n,10);break;case 3:Yn(n,6);break;default:Yn(n,2)}}}function y_(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Yn(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=Le(n.pb,n);t||(t=new Jn("//www.google.com/images/cleardot.gif"),k.location&&k.location.protocol=="http"||Ja(t,"https"),fu(t)),XS(t.toString(),r)}else $e(2);n.H=0,n.h&&n.h.za(e),v_(n),d_(n)}A.pb=function(n){n?(this.l.info("Successfully pinged google.com"),$e(2)):(this.l.info("Failed to ping google.com"),$e(1))};function v_(n){if(n.H=0,n.ma=[],n.h){let e=i_(n.i);(e.length!=0||n.j.length!=0)&&(lv(n.ma,e),lv(n.ma,n.j),n.i.i.length=0,Gh(n.j),n.j.length=0),n.h.ya()}}function __(n,e,t){var r=t instanceof Jn?Jt(t):new Jn(t);if(r.g!="")e&&(r.g=e+"."+r.g),Xa(r,r.m);else{var i=k.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Jn(null);r&&Ja(s,r),e&&(s.g=e),i&&Xa(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&re(r,t,e),re(r,"VER",n.ra),to(n,r),r}function w_(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new he(new Zs({ob:t})):new he(n.va),e.Oa(n.J),e}A.isActive=function(){return!!this.h&&this.h.isActive(this)};function E_(){}A=E_.prototype;A.Ba=function(){};A.Aa=function(){};A.za=function(){};A.ya=function(){};A.isActive=function(){return!0};A.Va=function(){};function eu(){if(ei&&!(10<=Number(ES)))throw Error("Environmental error: no available transport.")}eu.prototype.g=function(n,e){return new tt(n,e)};function tt(n,e){Pe.call(this),this.g=new h_(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Us(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Us(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new ni(this)}xe(tt,Pe);tt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;$e(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=__(n,null,n.Y),yu(n)};tt.prototype.close=function(){ud(this.g)};tt.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=Xh(n),n=t);e.j.push(new HS(e.fb++,n)),e.H==3&&yu(e)};tt.prototype.N=function(){this.g.h=null,delete this.j,ud(this.g),delete this.g,tt.$.N.call(this)};function I_(n){rd.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}xe(I_,rd);function T_(){id.call(this),this.status=1}xe(T_,id);function ni(n){this.g=n}xe(ni,E_);ni.prototype.Ba=function(){Ne(this.g,"a")};ni.prototype.Aa=function(n){Ne(this.g,new I_(n))};ni.prototype.za=function(n){Ne(this.g,new T_)};ni.prototype.ya=function(){Ne(this.g,"b")};function sb(){this.blockSize=-1}function Et(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}xe(Et,sb);Et.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function bh(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}Et.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)bh(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){bh(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){bh(this,r),i=0;break}}this.h=i,this.i+=e};Et.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function J(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var ob={};function hd(n){return-128<=n&&128>n?vS(n,function(e){return new J([e|0],0>e?-1:0)}):new J([n|0],0>n?-1:0)}function Nt(n){if(isNaN(n)||!isFinite(n))return Zr;if(0>n)return ke(Nt(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=qh;return new J(e,0)}function A_(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return ke(A_(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Nt(Math.pow(e,8)),r=Zr,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Nt(Math.pow(e,s)),r=r.R(s).add(Nt(o))):(r=r.R(t),r=r.add(Nt(o)))}return r}var qh=4294967296,Zr=hd(0),$h=hd(1),wv=hd(16777216);A=J.prototype;A.ea=function(){if(ct(this))return-ke(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:qh+r)*e,e*=qh}return n};A.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(Yt(this))return"0";if(ct(this))return"-"+ke(this).toString(n);for(var e=Nt(Math.pow(n,6)),t=this,r="";;){var i=nu(t,e).g;t=tu(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,Yt(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};A.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function Yt(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function ct(n){return n.h==-1}A.X=function(n){return n=tu(this,n),ct(n)?-1:Yt(n)?0:1};function ke(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new J(t,~n.h).add($h)}A.abs=function(){return ct(this)?ke(this):this};A.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new J(t,t[t.length-1]&-2147483648?-1:0)};function tu(n,e){return n.add(ke(e))}A.R=function(n){if(Yt(this)||Yt(n))return Zr;if(ct(this))return ct(n)?ke(this).R(ke(n)):ke(ke(this).R(n));if(ct(n))return ke(this.R(ke(n)));if(0>this.X(wv)&&0>n.X(wv))return Nt(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,u=n.D(i)&65535;t[2*r+2*i]+=o*u,Ya(t,2*r+2*i),t[2*r+2*i+1]+=s*u,Ya(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,Ya(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,Ya(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new J(t,0)};function Ya(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Ns(n,e){this.g=n,this.h=e}function nu(n,e){if(Yt(e))throw Error("division by zero");if(Yt(n))return new Ns(Zr,Zr);if(ct(n))return e=nu(ke(n),e),new Ns(ke(e.g),ke(e.h));if(ct(e))return e=nu(n,ke(e)),new Ns(ke(e.g),e.h);if(30<n.g.length){if(ct(n)||ct(e))throw Error("slowDivide_ only works with positive integers.");for(var t=$h,r=e;0>=r.X(n);)t=Ev(t),r=Ev(r);var i=Jr(t,1),s=Jr(r,1);for(r=Jr(r,2),t=Jr(t,2);!Yt(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=Jr(r,1),t=Jr(t,1)}return e=tu(n,i.R(e)),new Ns(i,e)}for(i=Zr;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=Nt(t),o=s.R(e);ct(o)||0<o.X(n);)t-=r,s=Nt(t),o=s.R(e);Yt(s)&&(s=$h),i=i.add(s),n=tu(n,o)}return new Ns(i,n)}A.gb=function(n){return nu(this,n).h};A.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new J(t,this.h&n.h)};A.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new J(t,this.h|n.h)};A.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new J(t,this.h^n.h)};function Ev(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new J(t,n.h)}function Jr(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new J(i,n.h)}eu.prototype.createWebChannel=eu.prototype.g;tt.prototype.send=tt.prototype.u;tt.prototype.open=tt.prototype.m;tt.prototype.close=tt.prototype.close;lu.NO_ERROR=0;lu.TIMEOUT=8;lu.HTTP_ERROR=6;Bv.COMPLETE="complete";qv.EventType=Ys;Ys.OPEN="a";Ys.CLOSE="b";Ys.ERROR="c";Ys.MESSAGE="d";Pe.prototype.listen=Pe.prototype.O;he.prototype.listenOnce=he.prototype.P;he.prototype.getLastError=he.prototype.Sa;he.prototype.getLastErrorCode=he.prototype.Ia;he.prototype.getStatus=he.prototype.da;he.prototype.getResponseJson=he.prototype.Wa;he.prototype.getResponseText=he.prototype.ja;he.prototype.send=he.prototype.ha;he.prototype.setWithCredentials=he.prototype.Oa;Et.prototype.digest=Et.prototype.l;Et.prototype.reset=Et.prototype.reset;Et.prototype.update=Et.prototype.j;J.prototype.add=J.prototype.add;J.prototype.multiply=J.prototype.R;J.prototype.modulo=J.prototype.gb;J.prototype.compare=J.prototype.X;J.prototype.toNumber=J.prototype.ea;J.prototype.toString=J.prototype.toString;J.prototype.getBits=J.prototype.D;J.fromNumber=Nt;J.fromString=A_;var C_=It.createWebChannelTransport=function(){return new eu},S_=It.getStatEventTarget=function(){return cu()},vu=It.ErrorCode=lu,b_=It.EventType=Bv,R_=It.Event=Xn,dd=It.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},D_=It.FetchXmlHttpFactory=Zs,no=It.WebChannel=qv,P_=It.XhrIo=he,x_=It.Md5=Et,Zn=It.Integer=J;var V_="@firebase/firestore";var Te=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Te.UNAUTHENTICATED=new Te(null),Te.GOOGLE_CREDENTIALS=new Te("google-credentials-uid"),Te.FIRST_PARTY=new Te("first-party-uid"),Te.MOCK_USER=new Te("mock-user");var Mi="10.11.1";var Rn=new oa("@firebase/firestore");function ai(){return Rn.logLevel}function Vw(n){Rn.setLogLevel(n)}function v(n,...e){if(Rn.logLevel<=Pt.DEBUG){let t=e.map(mp);Rn.debug(`Firestore (${Mi}): ${n}`,...t)}}function me(n,...e){if(Rn.logLevel<=Pt.ERROR){let t=e.map(mp);Rn.error(`Firestore (${Mi}): ${n}`,...t)}}function ht(n,...e){if(Rn.logLevel<=Pt.WARN){let t=e.map(mp);Rn.warn(`Firestore (${Mi}): ${n}`,...t)}}function mp(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function C(n="Unexpected state"){let e=`FIRESTORE (${Mi}) INTERNAL ASSERTION FAILED: `+n;throw me(e),new Error(e)}function D(n,e){n||C()}function Mw(n,e){n||C()}function T(n,e){return n}var g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},y=class extends pm{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ae=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Du=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},yd=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Te.UNAUTHENTICATED))}shutdown(){}},vd=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},_d=class{constructor(e){this.t=e,this.currentUser=Te.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new Ae;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ae,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>m(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ae)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(D(typeof r.accessToken=="string"),new Du(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return D(e===null||typeof e=="string"),new Te(e)}},wd=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Te.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Ed=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new wd(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Te.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Id=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Td=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,v("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(D(typeof t.token=="string"),this.R=t.token,new Id(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function ab(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Pu=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=ab(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function F(n,e){return n<e?-1:n>e?1:0}function mi(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function kw(n){return n+"\0"}var le=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?F(this.nanoseconds,e.nanoseconds):F(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var V=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new le(0,0))}static max(){return new n(new le(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var xu=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&C(),r===void 0?r=e.length-t:r>e.length-t&&C(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},K=class n extends xu{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},ub=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ye=class n extends xu{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return ub.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new y(g.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new y(g.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new y(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new y(g.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var I=class n{constructor(e){this.path=e}static fromPath(e){return new n(K.fromString(e))}static fromName(e){return new n(K.fromString(e).popFirst(5))}static empty(){return new n(K.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&K.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return K.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new K(e.slice()))}};var yi=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function Ad(n){return n.fields.find(e=>e.kind===2)}function tr(n){return n.fields.filter(e=>e.kind!==2)}yi.UNKNOWN_ID=-1;var fi=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var go=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,dt.min())}};function Nw(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=V.fromTimestamp(r===1e9?new le(t+1,0):new le(t,r));return new dt(i,I.empty(),e)}function Ow(n){return new dt(n.readTime,n.key,-1)}var dt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(V.min(),I.empty(),-1)}static max(){return new n(V.max(),I.empty(),-1)}};function yp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=I.comparator(n.documentKey,e.documentKey),t!==0?t:F(n.largestBatchId,e.largestBatchId))}var Fw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Vu=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Ln(n){return m(this,null,function*(){if(n.code!==g.FAILED_PRECONDITION||n.message!==Fw)throw n;v("LocalStore","Unexpectedly lost primary lease")})}var p=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&C(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Mu=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Ae,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ar(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=vp(r.target.error);this.V.reject(new ar(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new ar(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(v("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Sd(t)}},Dn=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(rs())===12.2&&me("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return v("SimpleDb","Removing database:",e),nr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!sa())return!1;if(n.C())return!0;let e=rs(),t=n.S(e),r=0<t&&t<10,i=Lw(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.v)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){return m(this,null,function*(){return this.db||(v("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new ar(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new y(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new y(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new ar(e,o))},i.onupgradeneeded=s=>{v("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{v("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return m(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=Mu.open(this.db,e,s?"readonly":"readwrite",r),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),p.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(v("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Lw(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Cd=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return nr(this.B.delete())}},ar=class extends y{constructor(e,t){super(g.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Un(n){return n.name==="IndexedDbTransactionError"}var Sd=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(v("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(v("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),nr(r)}add(e){return v("SimpleDb","ADD",this.store.name,e,e),nr(this.store.add(e))}get(e){return nr(this.store.get(e)).next(t=>(t===void 0&&(t=null),v("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return v("SimpleDb","DELETE",this.store.name,e),nr(this.store.delete(e))}count(){return v("SimpleDb","COUNT",this.store.name),nr(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new p((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(a,u)=>{o.push(u)}).next(()=>o)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new p((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){v("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new p((r,i)=>{t.onerror=s=>{let o=vp(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){let r=[];return new p((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new Cd(a),c=t(a.primaryKey,a.value,u);if(c instanceof p){let l=c.catch(h=>(u.done(),p.reject(h)));r.push(l)}u.isDone?i():u.K===null?a.continue():a.continue(u.K)}}).next(()=>p.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function nr(n){return new p((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=vp(r.target.error);t(i)}})}var M_=!1;function vp(n){let e=Dn.S(rs());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return M_||(M_=!0,setTimeout(()=>{throw r},0)),r}}return n}var bd=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){v("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>m(this,null,function*(){this.task=null;try{v("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Un(t)?v("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield Ln(t)}yield this.X(6e4)}))}},Rd=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return m(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,s=!0;return p.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return v("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(v("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=Ow(s);yp(o,r)>0&&(r=o)}),new dt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var nt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function Fo(n){return n==null}function mo(n){return n===0&&1/n==-1/0}function Uw(n){return typeof n=="number"&&Number.isInteger(n)&&!mo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function ze(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=k_(e)),e=cb(n.get(t),e);return k_(e)}function cb(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function k_(n){return n+""}function Ot(n){let e=n.length;if(D(e>=2),e===2)return D(n.charAt(0)===""&&n.charAt(1)===""),K.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&C(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:C()}s=o+2}return new K(r)}var N_=["userId","batchId"];function Tu(n,e){return[n,ze(e)]}function jw(n,e,t){return[n,ze(e),t]}var lb={},hb=["prefixPath","collectionGroup","readTime","documentId"],db=["prefixPath","collectionGroup","documentId"],fb=["collectionGroup","readTime","prefixPath","documentId"],pb=["canonicalId","targetId"],gb=["targetId","path"],mb=["path","targetId"],yb=["collectionId","parent"],vb=["indexId","uid"],_b=["uid","sequenceNumber"],wb=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Eb=["indexId","uid","orderedDocumentKey"],Ib=["userId","collectionPath","documentId"],Tb=["userId","collectionPath","largestBatchId"],Ab=["userId","collectionGroup","largestBatchId"],Bw=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Cb=[...Bw,"documentOverlays"],qw=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],$w=qw,zw=[...$w,"indexConfiguration","indexState","indexEntries"],Sb=zw;var yo=class extends Vu{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function Me(n,e){let t=T(n);return Dn.F(t._e,e)}function O_(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function _r(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Gw(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ie=class n{constructor(e,t){this.comparator=e,this.root=t||Lt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Lt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Lt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new di(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new di(this.root,e,this.comparator,!1)}getReverseIterator(){return new di(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new di(this.root,e,this.comparator,!0)}},di=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Lt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw C();let e=this.left.check();if(e!==this.right.check())throw C();return e+(this.isRed()?0:1)}};Lt.EMPTY=null,Lt.RED=!0,Lt.BLACK=!1;Lt.EMPTY=new class{constructor(){this.size=0}get key(){throw C()}get value(){throw C()}get color(){throw C()}get left(){throw C()}get right(){throw C()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Lt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var te=class n{constructor(e){this.comparator=e,this.data=new ie(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ku(this.data.getIterator())}getIteratorFrom(e){return new ku(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},ku=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function ri(n){return n.hasNext()?n.getNext():void 0}var rt=class n{constructor(e){this.fields=e,e.sort(ye.comparator)}static empty(){return new n([])}unionWith(e){let t=new te(ye.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return mi(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Nu=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function Kw(){return typeof atob<"u"}var Ve=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Nu("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return F(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ve.EMPTY_BYTE_STRING=new Ve("");var bb=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function en(n){if(D(!!n),typeof n=="string"){let e=0,t=bb.exec(n);if(D(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:de(n.seconds),nanos:de(n.nanos)}}function de(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Pn(n){return typeof n=="string"?Ve.fromBase64String(n):Ve.fromUint8Array(n)}function Cc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function _p(n){let e=n.mapValue.fields.__previous_value__;return Cc(e)?_p(e):e}function vo(n){let e=en(n.mapValue.fields.__local_write_time__.timestampValue);return new le(e.seconds,e.nanos)}var Dd=class{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},xn=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Sn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Au={nullValue:"NULL_VALUE"};function ur(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Cc(n)?4:Hw(n)?9007199254740991:10:C()}function Bt(n,e){if(n===e)return!0;let t=ur(n);if(t!==ur(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return vo(n).isEqual(vo(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=en(i.timestampValue),a=en(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Pn(i.bytesValue).isEqual(Pn(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return de(i.geoPointValue.latitude)===de(s.geoPointValue.latitude)&&de(i.geoPointValue.longitude)===de(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return de(i.integerValue)===de(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=de(i.doubleValue),a=de(s.doubleValue);return o===a?mo(o)===mo(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return mi(n.arrayValue.values||[],e.arrayValue.values||[],Bt);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(O_(o)!==O_(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!Bt(o[u],a[u])))return!1;return!0}(n,e);default:return C()}}function _o(n,e){return(n.values||[]).find(t=>Bt(t,e))!==void 0}function Vn(n,e){if(n===e)return 0;let t=ur(n),r=ur(e);if(t!==r)return F(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return F(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=de(s.integerValue||s.doubleValue),u=de(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return F_(n.timestampValue,e.timestampValue);case 4:return F_(vo(n),vo(e));case 5:return F(n.stringValue,e.stringValue);case 6:return function(s,o){let a=Pn(s),u=Pn(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let l=F(a[c],u[c]);if(l!==0)return l}return F(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=F(de(s.latitude),de(o.latitude));return a!==0?a:F(de(s.longitude),de(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){let a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){let l=Vn(a[c],u[c]);if(l)return l}return F(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===Sn.mapValue&&o===Sn.mapValue)return 0;if(s===Sn.mapValue)return 1;if(o===Sn.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){let d=F(u[h],l[h]);if(d!==0)return d;let f=Vn(a[u[h]],c[l[h]]);if(f!==0)return f}return F(u.length,l.length)}(n.mapValue,e.mapValue);default:throw C()}}function F_(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return F(n,e);let t=en(n),r=en(e),i=F(t.seconds,r.seconds);return i!==0?i:F(t.nanos,r.nanos)}function vi(n){return Pd(n)}function Pd(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=en(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Pn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return I.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Pd(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Pd(t.fields[o])}`;return i+"}"}(n.mapValue):C()}function cr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function xd(n){return!!n&&"integerValue"in n}function wo(n){return!!n&&"arrayValue"in n}function L_(n){return!!n&&"nullValue"in n}function U_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Cu(n){return!!n&&"mapValue"in n}function co(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return _r(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=co(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=co(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Hw(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function Rb(n){return"nullValue"in n?Au:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?cr(xn.empty(),I.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:C()}function Db(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?cr(xn.empty(),I.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Sn:C()}function j_(n,e){let t=Vn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function B_(n,e){let t=Vn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Be=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Cu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=co(t)}setAll(e){let t=ye.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=co(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Cu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Bt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Cu(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){_r(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(co(this.value))}};function Ww(n){let e=[];return _r(n.fields,(t,r)=>{let i=new ye([t]);if(Cu(r)){let s=Ww(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new rt(e)}var Ce=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,V.min(),V.min(),V.min(),Be.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,V.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,V.min(),V.min(),Be.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,V.min(),V.min(),Be.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(V.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Be.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Be.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=V.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var qt=class{constructor(e,t){this.position=e,this.inclusive=t}};function q_(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=I.comparator(I.fromName(o.referenceValue),t.key):r=Vn(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function $_(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Bt(n.position[t],e.position[t]))return!1;return!0}var lr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Pb(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Ou=class{},$=class n extends Ou{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new kd(e,t,r):t==="array-contains"?new Fd(e,r):t==="in"?new Fu(e,r):t==="not-in"?new Ld(e,r):t==="array-contains-any"?new Ud(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Nd(e,r):new Od(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Vn(t,this.value)):t!==null&&ur(this.value)===ur(t)&&this.matchesComparison(Vn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return C()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},X=class n extends Ou{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return _i(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function _i(n){return n.op==="and"}function Vd(n){return n.op==="or"}function wp(n){return Qw(n)&&_i(n)}function Qw(n){for(let e of n.filters)if(e instanceof X)return!1;return!0}function Md(n){if(n instanceof $)return n.field.canonicalString()+n.op.toString()+vi(n.value);if(wp(n))return n.filters.map(e=>Md(e)).join(",");{let e=n.filters.map(t=>Md(t)).join(",");return`${n.op}(${e})`}}function Yw(n,e){return n instanceof $?function(r,i){return i instanceof $&&r.op===i.op&&r.field.isEqual(i.field)&&Bt(r.value,i.value)}(n,e):n instanceof X?function(r,i){return i instanceof X&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&Yw(o,i.filters[a]),!0):!1}(n,e):void C()}function Jw(n,e){let t=n.filters.concat(e);return X.create(t,n.op)}function Xw(n){return n instanceof $?function(t){return`${t.field.canonicalString()} ${t.op} ${vi(t.value)}`}(n):n instanceof X?function(t){return t.op.toString()+" {"+t.getFilters().map(Xw).join(" ,")+"}"}(n):"Filter"}var kd=class extends ${constructor(e,t,r){super(e,t,r),this.key=I.fromName(r.referenceValue)}matches(e){let t=I.comparator(e.key,this.key);return this.matchesComparison(t)}},Nd=class extends ${constructor(e,t){super(e,"in",t),this.keys=Zw("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Od=class extends ${constructor(e,t){super(e,"not-in",t),this.keys=Zw("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Zw(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>I.fromName(r.referenceValue))}var Fd=class extends ${constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return wo(t)&&_o(t.arrayValue,this.value)}},Fu=class extends ${constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&_o(this.value.arrayValue,t)}},Ld=class extends ${constructor(e,t){super(e,"not-in",t)}matches(e){if(_o(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!_o(this.value.arrayValue,t)}},Ud=class extends ${constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!wo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>_o(this.value.arrayValue,r))}};var jd=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function Bd(n,e=null,t=[],r=[],i=null,s=null,o=null){return new jd(n,e,t,r,i,s,o)}function hr(n){let e=T(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Md(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Fo(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>vi(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>vi(r)).join(",")),e.ue=t}return e.ue}function Lo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Pb(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Yw(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!$_(n.startAt,e.startAt)&&$_(n.endAt,e.endAt)}function Lu(n){return I.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Uu(n,e){return n.filters.filter(t=>t instanceof $&&t.field.isEqual(e))}function z_(n,e,t){let r=Au,i=!0;for(let s of Uu(n,e)){let o=Au,a=!0;switch(s.op){case"<":case"<=":o=Rb(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Au}j_({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];j_({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function G_(n,e,t){let r=Sn,i=!0;for(let s of Uu(n,e)){let o=Sn,a=!0;switch(s.op){case">=":case">":o=Db(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Sn}B_({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];B_({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var Tt=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function eE(n,e,t,r,i,s,o,a){return new Tt(n,e,t,r,i,s,o,a)}function ki(n){return new Tt(n)}function K_(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Ep(n){return n.collectionGroup!==null}function pi(n){let e=T(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new te(ye.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new lr(s,r))}),t.has(ye.keyField().canonicalString())||e.ce.push(new lr(ye.keyField(),r))}return e.ce}function Ge(n){let e=T(n);return e.le||(e.le=xb(e,pi(n))),e.le}function xb(n,e){if(n.limitType==="F")return Bd(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new lr(i.field,s)});let t=n.endAt?new qt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new qt(n.startAt.position,n.startAt.inclusive):null;return Bd(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function qd(n,e){let t=n.filters.concat([e]);return new Tt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function ju(n,e,t){return new Tt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Uo(n,e){return Lo(Ge(n),Ge(e))&&n.limitType===e.limitType}function tE(n){return`${hr(Ge(n))}|lt:${n.limitType}`}function ui(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Xw(i)).join(", ")}]`),Fo(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>vi(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>vi(i)).join(",")),`Target(${r})`}(Ge(n))}; limitType=${n.limitType})`}function jo(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):I.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of pi(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,u){let c=q_(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,pi(r),i)||r.endAt&&!function(o,a,u){let c=q_(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,pi(r),i))}(n,e)}function nE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function rE(n){return(e,t)=>{let r=!1;for(let i of pi(n)){let s=Vb(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Vb(n,e,t){let r=n.field.isKeyField()?I.comparator(e.key,t.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?Vn(u,c):C()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return C()}}var $t=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){_r(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return Gw(this.inner)}size(){return this.innerSize}};var Mb=new ie(I.comparator);function Je(){return Mb}var iE=new ie(I.comparator);function ao(...n){let e=iE;for(let t of n)e=e.insert(t.key,t);return e}function sE(n){let e=iE;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ft(){return lo()}function oE(){return lo()}function lo(){return new $t(n=>n.toString(),(n,e)=>n.isEqual(e))}var kb=new ie(I.comparator),Nb=new te(I.comparator);function L(...n){let e=Nb;for(let t of n)e=e.add(t);return e}var Ob=new te(F);function Ip(){return Ob}function aE(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:mo(e)?"-0":e}}function uE(n){return{integerValue:""+n}}function cE(n,e){return Uw(e)?uE(e):aE(n,e)}var wi=class{constructor(){this._=void 0}};function Fb(n,e,t){return n instanceof Mn?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Cc(s)&&(s=_p(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof tn?hE(n,e):n instanceof nn?dE(n,e):function(i,s){let o=lE(i,s),a=H_(o)+H_(i.Pe);return xd(o)&&xd(i.Pe)?uE(a):aE(i.serializer,a)}(n,e)}function Lb(n,e,t){return n instanceof tn?hE(n,e):n instanceof nn?dE(n,e):t}function lE(n,e){return n instanceof kn?function(r){return xd(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Mn=class extends wi{},tn=class extends wi{constructor(e){super(),this.elements=e}};function hE(n,e){let t=fE(e);for(let r of n.elements)t.some(i=>Bt(i,r))||t.push(r);return{arrayValue:{values:t}}}var nn=class extends wi{constructor(e){super(),this.elements=e}};function dE(n,e){let t=fE(e);for(let r of n.elements)t=t.filter(i=>!Bt(i,r));return{arrayValue:{values:t}}}var kn=class extends wi{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function H_(n){return de(n.integerValue||n.doubleValue)}function fE(n){return wo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var dr=class{constructor(e,t){this.field=e,this.transform=t}};function Ub(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof tn&&i instanceof tn||r instanceof nn&&i instanceof nn?mi(r.elements,i.elements,Bt):r instanceof kn&&i instanceof kn?Bt(r.Pe,i.Pe):r instanceof Mn&&i instanceof Mn}(n.transform,e.transform)}var $d=class{constructor(e,t){this.version=e,this.transformResults=t}},fe=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Su(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Ei=class{};function pE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new On(n.key,fe.none()):new Nn(n.key,n.data,fe.none());{let t=n.data,r=Be.empty(),i=new te(ye.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new At(n.key,r,new rt(i.toArray()),fe.none())}}function jb(n,e,t){n instanceof Nn?function(i,s,o){let a=i.value.clone(),u=Q_(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof At?function(i,s,o){if(!Su(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=Q_(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(gE(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function ho(n,e,t,r){return n instanceof Nn?function(s,o,a,u){if(!Su(s.precondition,o))return a;let c=s.value.clone(),l=Y_(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof At?function(s,o,a,u){if(!Su(s.precondition,o))return a;let c=Y_(s.fieldTransforms,u,o),l=o.data;return l.setAll(gE(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(s,o,a){return Su(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function Bb(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=lE(r.transform,i||null);s!=null&&(t===null&&(t=Be.empty()),t.set(r.field,s))}return t||null}function W_(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&mi(r,i,(s,o)=>Ub(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Nn=class extends Ei{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},At=class extends Ei{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function gE(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Q_(n,e,t){let r=new Map;D(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Lb(o,a,t[i]))}return r}function Y_(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,Fb(s,o,e))}return r}var On=class extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Eo=class extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Io=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&jb(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=ho(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=ho(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=oE();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let u=pE(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(V.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),L())}isEqual(e){return this.batchId===e.batchId&&mi(this.mutations,e.mutations,(t,r)=>W_(t,r))&&mi(this.baseMutations,e.baseMutations,(t,r)=>W_(t,r))}},zd=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){D(e.mutations.length===r.length);let i=function(){return kb}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var To=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Gd=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ee,G;function mE(n){switch(n){default:return C();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function yE(n){if(n===void 0)return me("GRPC error has no .code"),g.UNKNOWN;switch(n){case Ee.OK:return g.OK;case Ee.CANCELLED:return g.CANCELLED;case Ee.UNKNOWN:return g.UNKNOWN;case Ee.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case Ee.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case Ee.INTERNAL:return g.INTERNAL;case Ee.UNAVAILABLE:return g.UNAVAILABLE;case Ee.UNAUTHENTICATED:return g.UNAUTHENTICATED;case Ee.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case Ee.NOT_FOUND:return g.NOT_FOUND;case Ee.ALREADY_EXISTS:return g.ALREADY_EXISTS;case Ee.PERMISSION_DENIED:return g.PERMISSION_DENIED;case Ee.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case Ee.ABORTED:return g.ABORTED;case Ee.OUT_OF_RANGE:return g.OUT_OF_RANGE;case Ee.UNIMPLEMENTED:return g.UNIMPLEMENTED;case Ee.DATA_LOSS:return g.DATA_LOSS;default:return C()}}(G=Ee||(Ee={}))[G.OK=0]="OK",G[G.CANCELLED=1]="CANCELLED",G[G.UNKNOWN=2]="UNKNOWN",G[G.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",G[G.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",G[G.NOT_FOUND=5]="NOT_FOUND",G[G.ALREADY_EXISTS=6]="ALREADY_EXISTS",G[G.PERMISSION_DENIED=7]="PERMISSION_DENIED",G[G.UNAUTHENTICATED=16]="UNAUTHENTICATED",G[G.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",G[G.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",G[G.ABORTED=10]="ABORTED",G[G.OUT_OF_RANGE=11]="OUT_OF_RANGE",G[G.UNIMPLEMENTED=12]="UNIMPLEMENTED",G[G.INTERNAL=13]="INTERNAL",G[G.UNAVAILABLE=14]="UNAVAILABLE",G[G.DATA_LOSS=15]="DATA_LOSS";var J_=null;function vE(){return new TextEncoder}var qb=new Zn([4294967295,4294967295],0);function X_(n){let e=vE().encode(n),t=new x_;return t.update(e),new Uint8Array(t.digest())}function Z_(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Zn([t,r],0),new Zn([i,s],0)]}var Kd=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new or(`Invalid padding: ${t}`);if(r<0)throw new or(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new or(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new or(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Zn.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(Zn.fromNumber(r)));return i.compare(qb)===1&&(i=new Zn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=X_(e),[r,i]=Z_(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=X_(e),[r,i]=Z_(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},or=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ao=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Co.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(V.min(),i,new ie(F),Je(),L())}},Co=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,L(),L(),L())}};var gi=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},Bu=class{constructor(e,t){this.targetId=e,this.me=t}},qu=class{constructor(e,t,r=Ve.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},$u=class{constructor(){this.fe=0,this.ge=tw(),this.pe=Ve.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=L(),t=L(),r=L();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:C()}}),new Co(this.pe,this.ye,e,t,r)}ve(){this.we=!1,this.ge=tw()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,D(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Hd=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Je(),this.qe=ew(),this.Qe=new ie(F)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:C()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(Lu(s))if(r===0){let o=new I(s.path);this.Ue(t,o,Ce.newNoDocument(o,V.min()))}else D(r===1);else{let o=this.Ye(t);if(o!==r){let a=this.Ze(e),u=a?this.Xe(a,e,o):1;if(u!==0){this.je(t);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}J_?.et(function(l,h,d,f,E){var w,_,x,O,b,j;let B={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},W=h.unchangedNames;return W&&(B.bloomFilter={applied:E===0,hashCount:(w=W?.hashCount)!==null&&w!==void 0?w:0,bitmapLength:(O=(x=(_=W?.bits)===null||_===void 0?void 0:_.bitmap)===null||x===void 0?void 0:x.length)!==null&&O!==void 0?O:0,padding:(j=(b=W?.bits)===null||b===void 0?void 0:b.padding)!==null&&j!==void 0?j:0,mightContain:_e=>{var bt;return(bt=f?.mightContain(_e))!==null&&bt!==void 0&&bt}}),B}(o,e.me,this.Le.tt(),a,u))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=Pn(r).toUint8Array()}catch(u){if(u instanceof Nu)return ht("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Kd(o,i,s)}catch(u){return ht(u instanceof or?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&Lu(a.target)){let u=new I(a.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,Ce.newNoDocument(u,e))}s.be&&(t.set(o,s.Ce()),s.ve())}});let r=L();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Je(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new Ao(e,t,this.Qe,this.ke,r);return this.ke=Je(),this.qe=ew(),this.Qe=new ie(F),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new $u,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new te(F),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||v("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new $u),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function ew(){return new ie(I.comparator)}function tw(){return new ie(I.comparator)}var $b={asc:"ASCENDING",desc:"DESCENDING"},zb={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Gb={and:"AND",or:"OR"},Wd=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Qd(n,e){return n.useProto3Json||Fo(e)?e:{value:e}}function Ii(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function _E(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Kb(n,e){return Ii(n,e.toTimestamp())}function ve(n){return D(!!n),V.fromTimestamp(function(t){let r=en(t);return new le(r.seconds,r.nanos)}(n))}function Tp(n,e){return Yd(n,e).canonicalString()}function Yd(n,e){let t=function(i){return new K(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function wE(n){let e=K.fromString(n);return D(PE(e)),e}function So(n,e){return Tp(n.databaseId,e.path)}function Ut(n,e){let t=wE(e);if(t.get(1)!==n.databaseId.projectId)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new I(TE(t))}function EE(n,e){return Tp(n.databaseId,e)}function IE(n){let e=wE(n);return e.length===4?K.emptyPath():TE(e)}function Jd(n){return new K(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function TE(n){return D(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function nw(n,e,t){return{name:So(n,e),fields:t.value.mapValue.fields}}function AE(n,e,t){let r=Ut(n,e.name),i=ve(e.updateTime),s=e.createTime?ve(e.createTime):V.min(),o=new Be({mapValue:{fields:e.fields}}),a=Ce.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Hb(n,e){return"found"in e?function(r,i){D(!!i.found),i.found.name,i.found.updateTime;let s=Ut(r,i.found.name),o=ve(i.found.updateTime),a=i.found.createTime?ve(i.found.createTime):V.min(),u=new Be({mapValue:{fields:i.found.fields}});return Ce.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){D(!!i.missing),D(!!i.readTime);let s=Ut(r,i.missing),o=ve(i.readTime);return Ce.newNoDocument(s,o)}(n,e):C()}function Wb(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:C()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(D(l===void 0||typeof l=="string"),Ve.fromBase64String(l||"")):(D(l===void 0||l instanceof Buffer||l instanceof Uint8Array),Ve.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){let l=c.code===void 0?g.UNKNOWN:yE(c.code);return new y(l,c.message||"")}(o);t=new qu(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Ut(n,r.document.name),s=ve(r.document.updateTime),o=r.document.createTime?ve(r.document.createTime):V.min(),a=new Be({mapValue:{fields:r.document.fields}}),u=Ce.newFoundDocument(i,s,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];t=new gi(c,l,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Ut(n,r.document),s=r.readTime?ve(r.readTime):V.min(),o=Ce.newNoDocument(i,s),a=r.removedTargetIds||[];t=new gi([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Ut(n,r.document),s=r.removedTargetIds||[];t=new gi([],s,i,null)}else{if(!("filter"in e))return C();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Gd(i,s),a=r.targetId;t=new Bu(a,o)}}return t}function bo(n,e){let t;if(e instanceof Nn)t={update:nw(n,e.key,e.value)};else if(e instanceof On)t={delete:So(n,e.key)};else if(e instanceof At)t={update:nw(n,e.key,e.data),updateMask:eR(e.fieldMask)};else{if(!(e instanceof Eo))return C();t={verify:So(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Mn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof tn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof nn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof kn)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw C()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:Kb(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:C()}(n,e.precondition)),t}function Xd(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?fe.updateTime(ve(s.updateTime)):s.exists!==void 0?fe.exists(s.exists):fe.none()}(e.currentDocument):fe.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)D(a.setToServerValue==="REQUEST_TIME"),u=new Mn;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];u=new tn(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];u=new nn(l)}else"increment"in a?u=new kn(o,a.increment):C();let c=ye.fromServerFormat(a.fieldPath);return new dr(c,u)}(n,i)):[];if(e.update){e.update.name;let i=Ut(n,e.update.name),s=new Be({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let c=u.fieldPaths||[];return new rt(c.map(l=>ye.fromServerFormat(l)))}(e.updateMask);return new At(i,s,o,t,r)}return new Nn(i,s,t,r)}if(e.delete){let i=Ut(n,e.delete);return new On(i,t)}if(e.verify){let i=Ut(n,e.verify);return new Eo(i,t)}return C()}function Qb(n,e){return n&&n.length>0?(D(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?ve(i.updateTime):ve(s);return o.isEqual(V.min())&&(o=ve(s)),new $d(o,i.transformResults||[])}(t,e))):[]}function CE(n,e){return{documents:[EE(n,e.path)]}}function SE(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=EE(n,i);let s=function(c){if(c.length!==0)return DE(X.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(l=>function(d){return{field:ci(d.field),direction:Jb(d.dir)}}(l))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Qd(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:i}}function bE(n){let e=IE(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){D(r===1);let l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){let d=RE(h);return d instanceof X&&wp(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(d=>function(E){return new lr(li(E.field),function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction))}(d))}(t.orderBy));let a=null;t.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,Fo(d)?null:d}(t.limit));let u=null;t.startAt&&(u=function(h){let d=!!h.before,f=h.values||[];return new qt(f,d)}(t.startAt));let c=null;return t.endAt&&(c=function(h){let d=!h.before,f=h.values||[];return new qt(f,d)}(t.endAt)),eE(e,i,o,s,a,"F",u,c)}function Yb(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return C()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function RE(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=li(t.unaryFilter.field);return $.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=li(t.unaryFilter.field);return $.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=li(t.unaryFilter.field);return $.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=li(t.unaryFilter.field);return $.create(o,"!=",{nullValue:"NULL_VALUE"});default:return C()}}(n):n.fieldFilter!==void 0?function(t){return $.create(li(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return C()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return X.create(t.compositeFilter.filters.map(r=>RE(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return C()}}(t.compositeFilter.op))}(n):C()}function Jb(n){return $b[n]}function Xb(n){return zb[n]}function Zb(n){return Gb[n]}function ci(n){return{fieldPath:n.canonicalString()}}function li(n){return ye.fromServerFormat(n.fieldPath)}function DE(n){return n instanceof $?function(t){if(t.op==="=="){if(U_(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NAN"}};if(L_(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(U_(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NOT_NAN"}};if(L_(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ci(t.field),op:Xb(t.op),value:t.value}}}(n):n instanceof X?function(t){let r=t.getFilters().map(i=>DE(i));return r.length===1?r[0]:{compositeFilter:{op:Zb(t.op),filters:r}}}(n):C()}function eR(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function PE(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ti=class n{constructor(e,t,r,i,s=V.min(),o=V.min(),a=Ve.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var zu=class{constructor(e){this.ut=e}};function tR(n,e){let t;if(e.document)t=AE(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=I.fromSegments(e.noDocument.path),i=pr(e.noDocument.readTime);t=Ce.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return C();{let r=I.fromSegments(e.unknownDocument.path),i=pr(e.unknownDocument.version);t=Ce.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new le(i[0],i[1]);return V.fromTimestamp(s)}(e.readTime)),t}function rw(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Gu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:So(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Ii(s,o.version.toTimestamp()),createTime:Ii(s,o.createTime.toTimestamp())}}(n.ut,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:fr(e.version)};else{if(!e.isUnknownDocument())return C();r.unknownDocument={path:t.path.toArray(),version:fr(e.version)}}return r}function Gu(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function fr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function pr(n){let e=new le(n.seconds,n.nanoseconds);return V.fromTimestamp(e)}function rr(n,e){let t=(e.baseMutations||[]).map(s=>Xd(n.ut,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Xd(n.ut,s)),i=le.fromMillis(e.localWriteTimeMs);return new Io(e.batchId,i,t,r)}function uo(n){let e=pr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?pr(n.lastLimboFreeSnapshotVersion):V.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return D(s.documents.length===1),Ge(ki(IE(s.documents[0])))}(n.query):function(s){return Ge(bE(s))}(n.query),new Ti(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ve.fromBase64String(n.resumeToken))}function xE(n,e){let t=fr(e.snapshotVersion),r=fr(e.lastLimboFreeSnapshotVersion),i;i=Lu(e.target)?CE(n.ut,e.target):SE(n.ut,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:hr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Ap(n){let e=bE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ju(e,e.limit,"L"):e}function fd(n,e){return new To(e.largestBatchId,Xd(n.ut,e.overlayMutation))}function iw(n,e){let t=e.path.lastSegment();return[n,ze(e.path.popLast()),t]}function sw(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:fr(r.readTime),documentKey:ze(r.documentKey.path),largestBatchId:r.largestBatchId}}var Zd=class{getBundleMetadata(e,t){return ow(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:pr(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return ow(e).put(function(i){return{bundleId:i.id,createTime:fr(ve(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return aw(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:Ap(s.bundledQuery),readTime:pr(s.readTime)}}(r)})}saveNamedQuery(e,t){return aw(e).put(function(i){return{name:i.name,readTime:fr(ve(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function ow(n){return Me(n,"bundles")}function aw(n){return Me(n,"namedQueries")}var Ku=class n{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return ro(e).get(iw(this.userId,t)).next(r=>r?fd(this.serializer,r):null)}getOverlays(e,t){let r=Ft();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new To(t,o);i.push(this.lt(e,a))}),p.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(ze(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(ro(e).j("collectionPathOverlayIndex",a))}),p.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Ft(),s=ze(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ro(e).U("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=fd(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Ft(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ro(e).J({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{let h=fd(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}lt(e,t){return ro(e).put(function(i,s,o){let[a,u,c]=iw(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:bo(i.ut,o.mutation)}}(this.serializer,this.userId,t))}};function ro(n){return Me(n,"documentOverlays")}var Xt=class{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(de(e.integerValue));else if("doubleValue"in e){let r=de(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),mo(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Tt(t,20),typeof r=="string"&&(r=en(r)),t.dt(`${r.seconds||""}`),t.Et(r.nanos||0)}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(Pn(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?Hw(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):C()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){let r=e.fields||{};this.Tt(t,55);for(let i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){let r=e.values||[];this.Tt(t,50);for(let i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),I.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}};Xt.St=new Xt;function nR(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function uw(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=nR(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var ef=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{let i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){let t=this.Lt(e),r=uw(t);this.Bt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){let t=this.Lt(e),r=uw(t);this.Bt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Bt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Lt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){let t=255&e;t===0?(this.Qt(0),this.Qt(255)):t===255?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){let t=255&e;t===0?(this.$t(0),this.$t(255)):t===255?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Bt(1),this.buffer[this.position++]=e}$t(e){this.Bt(1),this.buffer[this.position++]=~e}Bt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},tf=class{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}},nf=class{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}},ir=class{constructor(){this.Wt=new ef,this.Gt=new tf(this.Wt),this.zt=new nf(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return e===0?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}};var sr=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function In(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=cw(n.arrayValue,e.arrayValue),t!==0?t:(t=cw(n.directionalValue,e.directionalValue),t!==0?t:I.comparator(n.documentKey,e.documentKey)))}function cw(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Hu=class{constructor(e){this.Jt=new te((t,r)=>ye.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(let t of e.filters){let r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(D(e.collectionGroup===this.collectionId),this.Xt)return!1;let t=Ad(e);if(t!==void 0&&!this.tn(t))return!1;let r=tr(e),i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){let a=this.Jt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.nn(a,u)||!this.rn(this.Yt[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Yt.length||!this.rn(this.Yt[o++],a))return!1}return!0}sn(){if(this.Xt)return null;let e=new te(ye.comparator),t=[];for(let r of this.Zt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new fi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new fi(r.field,0))}for(let r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new fi(r.field,r.dir==="asc"?0:1)));return new yi(yi.UNKNOWN_ID,this.collectionId,t,go.empty())}tn(e){for(let t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function VE(n){var e,t;if(D(n instanceof $||n instanceof X),n instanceof $){if(n instanceof Fu){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>$.create(n.field,"==",s)))||[];return X.create(i,"or")}return n}let r=n.filters.map(i=>VE(i));return X.create(r,n.op)}function rR(n){if(n.getFilters().length===0)return[];let e=of(VE(n));return D(ME(e)),rf(e)||sf(e)?[e]:e.getFilters()}function rf(n){return n instanceof $}function sf(n){return n instanceof X&&wp(n)}function ME(n){return rf(n)||sf(n)||function(t){if(t instanceof X&&Vd(t)){for(let r of t.getFilters())if(!rf(r)&&!sf(r))return!1;return!0}return!1}(n)}function of(n){if(D(n instanceof $||n instanceof X),n instanceof $)return n;if(n.filters.length===1)return of(n.filters[0]);let e=n.filters.map(r=>of(r)),t=X.create(e,n.op);return t=Wu(t),ME(t)?t:(D(t instanceof X),D(_i(t)),D(t.filters.length>1),t.filters.reduce((r,i)=>Cp(r,i)))}function Cp(n,e){let t;return D(n instanceof $||n instanceof X),D(e instanceof $||e instanceof X),t=n instanceof $?e instanceof $?function(i,s){return X.create([i,s],"and")}(n,e):lw(n,e):e instanceof $?lw(e,n):function(i,s){if(D(i.filters.length>0&&s.filters.length>0),_i(i)&&_i(s))return Jw(i,s.getFilters());let o=Vd(i)?i:s,a=Vd(i)?s:i,u=o.filters.map(c=>Cp(c,a));return X.create(u,"or")}(n,e),Wu(t)}function lw(n,e){if(_i(e))return Jw(e,n.getFilters());{let t=e.filters.map(r=>Cp(n,r));return X.create(t,"or")}}function Wu(n){if(D(n instanceof $||n instanceof X),n instanceof $)return n;let e=n.getFilters();if(e.length===1)return Wu(e[0]);if(Qw(n))return n;let t=e.map(i=>Wu(i)),r=[];return t.forEach(i=>{i instanceof $?r.push(i):i instanceof X&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:X.create(r,n.op)}var af=class{constructor(){this.on=new Ro}addToCollectionParentIndex(e,t){return this.on.add(t),p.resolve()}getCollectionParents(e,t){return p.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return p.resolve()}deleteFieldIndex(e,t){return p.resolve()}deleteAllFieldIndexes(e){return p.resolve()}createTargetIndexes(e,t){return p.resolve()}getDocumentsMatchingTarget(e,t){return p.resolve(null)}getIndexType(e,t){return p.resolve(0)}getFieldIndexes(e,t){return p.resolve([])}getNextCollectionGroupToUpdate(e){return p.resolve(null)}getMinOffset(e,t){return p.resolve(dt.min())}getMinOffsetFromCollectionGroup(e,t){return p.resolve(dt.min())}updateCollectionGroup(e,t,r){return p.resolve()}updateIndexEntries(e,t){return p.resolve()}},Ro=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new te(K.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new te(K.comparator)).toArray()}};var _u=new Uint8Array(0),uf=class{constructor(e,t){this.databaseId=t,this._n=new Ro,this.an=new $t(r=>hr(r),(r,i)=>Lo(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});let s={collectionId:r,parent:ze(i)};return hw(e).put(s)}return p.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[kw(t),""],!1,!0);return hw(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Ot(o.parent))}return r})}addFieldIndex(e,t){let r=io(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=si(e);return s.next(a=>{o.put(sw(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=io(e),i=si(e),s=ii(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=io(e),r=ii(e),i=si(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return p.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Hu(r).sn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=ii(e),i=!0,s=new Map;return p.forEach(this.un(t),o=>this.cn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=L(),a=[];return p.forEach(s,(u,c)=>{v("IndexedDbIndexManager",`Using index ${function(b){return`id=${b.indexId}|cg=${b.collectionGroup}|f=${b.fields.map(j=>`${j.fieldPath}:${j.kind}`).join(",")}`}(u)} to execute ${hr(t)}`);let l=function(b,j){let B=Ad(j);if(B===void 0)return null;for(let W of Uu(b,B.fieldPath))switch(W.op){case"array-contains-any":return W.value.arrayValue.values||[];case"array-contains":return[W.value]}return null}(c,u),h=function(b,j){let B=new Map;for(let W of tr(j))for(let _e of Uu(b,W.fieldPath))switch(_e.op){case"==":case"in":B.set(W.fieldPath.canonicalString(),_e.value);break;case"not-in":case"!=":return B.set(W.fieldPath.canonicalString(),_e.value),Array.from(B.values())}return null}(c,u),d=function(b,j){let B=[],W=!0;for(let _e of tr(j)){let bt=_e.kind===0?z_(b,_e.fieldPath,b.startAt):G_(b,_e.fieldPath,b.startAt);B.push(bt.value),W&&(W=bt.inclusive)}return new qt(B,W)}(c,u),f=function(b,j){let B=[],W=!0;for(let _e of tr(j)){let bt=_e.kind===0?G_(b,_e.fieldPath,b.endAt):z_(b,_e.fieldPath,b.endAt);B.push(bt.value),W&&(W=bt.inclusive)}return new qt(B,W)}(c,u),E=this.ln(u,c,d),w=this.ln(u,c,f),_=this.hn(u,c,h),x=this.Pn(u.indexId,l,E,d.inclusive,w,f.inclusive,_);return p.forEach(x,O=>r.G(O,t.limit).next(b=>{b.forEach(j=>{let B=I.fromSegments(j.documentKey);o.has(B)||(o=o.add(B),a.push(B))})}))}).next(()=>a)}return p.resolve(null)})}un(e){let t=this.an.get(e);return t||(e.filters.length===0?t=[e]:t=rR(X.create(e.filters,"and")).map(r=>Bd(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,o,a){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),c=u/(t!=null?t.length:1),l=[];for(let h=0;h<u;++h){let d=t?this.In(t[h/c]):_u,f=this.Tn(e,d,r[h%c],i),E=this.En(e,d,s[h%c],o),w=a.map(_=>this.Tn(e,d,_,!0));l.push(...this.createRange(f,E,w))}return l}Tn(e,t,r,i){let s=new sr(e,I.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){let s=new sr(e,I.empty(),t,r);return i?s.Ht():s}cn(e,t){let r=new Hu(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.en(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.un(t);return p.forEach(i,s=>this.cn(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new te(ye.comparator),l=!1;for(let h of u.filters)for(let d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:c=c.add(d.field));for(let h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}dn(e,t){let r=new ir;for(let i of tr(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.jt(i.kind);Xt.St.ht(s,o)}return r.Ut()}In(e){let t=new ir;return Xt.St.ht(e,t.jt(0)),t.Ut()}An(e,t){let r=new ir;return Xt.St.ht(cr(this.databaseId,t),r.jt(function(s){let o=tr(s);return o.length===0?0:o[o.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(r===null)return[];let i=[];i.push(new ir);let s=0;for(let o of tr(e)){let a=r[s++];for(let u of i)if(this.Rn(t,o.fieldPath)&&wo(a))i=this.Vn(i,o,a);else{let c=u.jt(o.kind);Xt.St.ht(a,c)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new ir;u.seed(a.Ut()),Xt.St.ht(o,u.jt(t.kind)),s.push(u)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof $&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=io(e),i=si(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{let o=[];return p.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){let d=h?new go(h.sequenceNumber,new dt(pr(h.readTime),new I(Ot(h.documentKey)),h.largestBatchId)):go.empty(),f=l.fields.map(([E,w])=>new fi(ye.fromServerFormat(E),w));return new yi(l.indexId,l.collectionGroup,f,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:F(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=io(e),s=si(e);return this.fn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>p.forEach(a,u=>s.put(sw(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return p.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?p.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),p.forEach(a,u=>this.gn(e,i,u).next(c=>{let l=this.pn(s,u);return c.isEqual(l)?p.resolve():this.yn(e,s,u,c,l)}))))})}wn(e,t,r,i){return ii(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return ii(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){let i=ii(e),s=new te(In);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(o,a)=>{s=s.add(new sr(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}pn(e,t){let r=new te(In),i=this.dn(t,e);if(i==null)return r;let s=Ad(t);if(s!=null){let o=e.data.field(s.fieldPath);if(wo(o))for(let a of o.arrayValue.values||[])r=r.add(new sr(t.indexId,e.key,this.In(a),i))}else r=r.add(new sr(t.indexId,e.key,_u,i));return r}yn(e,t,r,i,s){v("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,c,l,h,d){let f=u.getIterator(),E=c.getIterator(),w=ri(f),_=ri(E);for(;w||_;){let x=!1,O=!1;if(w&&_){let b=l(w,_);b<0?O=!0:b>0&&(x=!0)}else w!=null?O=!0:x=!0;x?(h(_),_=ri(E)):O?(d(w),w=ri(f)):(w=ri(f),_=ri(E))}}(i,s,In,a=>{o.push(this.wn(e,t,r,a))},a=>{o.push(this.Sn(e,t,r,a))}),p.waitFor(o)}fn(e){let t=1;return si(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>In(o,a)).filter((o,a,u)=>!a||In(o,u[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=In(o,e),u=In(o,t);if(a===0)i[0]=e.Ht();else if(a>0&&u<0)i.push(o),i.push(o.Ht());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.bn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,_u,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,_u,[]];s.push(IDBKeyRange.bound(a,u))}return s}bn(e,t){return In(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(dw)}getMinOffset(e,t){return p.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||C())).next(dw)}};function hw(n){return Me(n,"collectionParents")}function ii(n){return Me(n,"indexEntries")}function io(n){return Me(n,"indexConfiguration")}function si(n){return Me(n,"indexState")}function dw(n){D(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;yp(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new dt(e.readTime,e.documentKey,t)}var fw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},lt=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function kE(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,u=r.J({range:o},(l,h,d)=>(a++,d.delete()));s.push(u.next(()=>{D(a===1)}));let c=[];for(let l of t.mutations){let h=jw(e,l.key.path,t.batchId);s.push(i.delete(h)),c.push(l.key)}return p.waitFor(s).next(()=>c)}function Qu(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw C();e=n.noDocument}return JSON.stringify(e).length}lt.DEFAULT_COLLECTION_PERCENTILE=10,lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lt.DEFAULT=new lt(41943040,lt.DEFAULT_COLLECTION_PERCENTILE,lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lt.DISABLED=new lt(-1,0,0);var Yu=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){D(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Tn(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=hi(e),o=Tn(e);return o.add({}).next(a=>{D(typeof a=="number");let u=new Io(a,t,r,i),c=function(f,E,w){let _=w.baseMutations.map(O=>bo(f.ut,O)),x=w.mutations.map(O=>bo(f.ut,O));return{userId:E,batchId:w.batchId,localWriteTimeMs:w.localWriteTime.toMillis(),baseMutations:_,mutations:x}}(this.serializer,this.userId,u),l=[],h=new te((d,f)=>F(d.canonicalString(),f.canonicalString()));for(let d of i){let f=jw(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(s.put(f,lb))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.Dn[a]=u.keys()}),p.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return Tn(e).get(t).next(r=>r?(D(r.userId===this.userId),rr(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?p.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Tn(e).J({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(D(a.batchId>=r),s=rr(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Tn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Tn(e).U("userMutationsIndex",t).next(r=>r.map(i=>rr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Tu(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return hi(e).J({range:i},(o,a,u)=>{let[c,l,h]=o,d=Ot(l);if(c===this.userId&&t.path.isEqual(d))return Tn(e).get(h).next(f=>{if(!f)throw C();D(f.userId===this.userId),s.push(rr(this.serializer,f))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new te(F),i=[];return t.forEach(s=>{let o=Tu(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=hi(e).J({range:a},(c,l,h)=>{let[d,f,E]=c,w=Ot(f);d===this.userId&&s.path.isEqual(w)?r=r.add(E):h.done()});i.push(u)}),p.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Tu(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new te(F);return hi(e).J({range:o},(u,c,l)=>{let[h,d,f]=u,E=Ot(d);h===this.userId&&r.isPrefixOf(E)?E.length===i&&(a=a.add(f)):l.done()}).next(()=>this.vn(e,a))}vn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Tn(e).get(s).next(o=>{if(o===null)throw C();D(o.userId===this.userId),r.push(rr(this.serializer,o))}))}),p.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return kE(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),p.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return p.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return hi(e).J({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=Ot(s[1]);i.push(u)}else a.done()}).next(()=>{D(i.length===0)})})}containsKey(e,t){return NE(e,this.userId,t)}Mn(e){return OE(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function NE(n,e,t){let r=Tu(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return hi(n).J({range:s,H:!0},(a,u,c)=>{let[l,h,d]=a;l===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function Tn(n){return Me(n,"mutations")}function hi(n){return Me(n,"documentMutations")}function OE(n){return Me(n,"mutationQueues")}var Ai=class n{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new n(0)}static Nn(){return new n(-1)}};var cf=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next(t=>{let r=new Ai(t.highestTargetId);return t.highestTargetId=r.next(),this.Bn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ln(e).next(t=>V.fromTimestamp(new le(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ln(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Ln(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Bn(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Ln(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Bn(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>oi(e).delete(t.targetId)).next(()=>this.Ln(e)).next(r=>(D(r.targetCount>0),r.targetCount-=1,this.Bn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return oi(e).J((o,a)=>{let u=uo(a);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>p.waitFor(s)).next(()=>i)}forEachTarget(e,t){return oi(e).J((r,i)=>{let s=uo(i);t(s)})}Ln(e){return pw(e).get("targetGlobalKey").next(t=>(D(t!==null),t))}Bn(e,t){return pw(e).put("targetGlobalKey",t)}kn(e,t){return oi(e).put(xE(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Ln(e).next(t=>t.targetCount)}getTargetData(e,t){let r=hr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return oi(e).J({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=uo(a);Lo(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=An(e);return t.forEach(o=>{let a=ze(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),p.waitFor(i)}removeMatchingKeys(e,t,r){let i=An(e);return p.forEach(t,s=>{let o=ze(s.path);return p.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=An(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=An(e),s=L();return i.J({range:r,H:!0},(o,a,u)=>{let c=Ot(o[1]),l=new I(c);s=s.add(l)}).next(()=>s)}containsKey(e,t){let r=ze(t.path),i=IDBKeyRange.bound([r],[kw(r)],!1,!0),s=0;return An(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}ot(e,t){return oi(e).get(t).next(r=>r?uo(r):null)}};function oi(n){return Me(n,"targets")}function pw(n){return Me(n,"targetGlobal")}function An(n){return Me(n,"targetDocuments")}function gw([n,e],[t,r]){let i=F(n,t);return i===0?F(e,r):i}var lf=class{constructor(e){this.Qn=e,this.buffer=new te(gw),this.Kn=0}$n(){return++this.Kn}Un(e){let t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();gw(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},hf=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return this.Wn!==null}Gn(e){v("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>m(this,null,function*(){this.Wn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Un(t)?v("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Ln(t)}yield this.Gn(3e5)}))}},df=class{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return p.resolve(nt.oe);let r=new lf(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(v("LruGarbageCollector","Garbage collection skipped; disabled"),p.resolve(fw)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),fw):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,o,a,u,c,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(v("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),ai()<=Pt.DEBUG&&v("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${h} documents in `+(c-u)+`ms
Total Duration: ${c-l}ms`),p.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}};function iR(n,e){return new df(n,e)}var ff=class{constructor(e,t){this.db=e,this.garbageCollector=iR(this,t)}jn(e){let t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return wu(e,r)}removeReference(e,t,r){return wu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return wu(e,t)}Xn(e,t){return function(i,s){let o=!1;return OE(i).Y(a=>NE(i,a,s).next(u=>(u&&(o=!0),p.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Zn(e,(o,a)=>{if(a<=t){let u=this.Xn(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,V.min()),An(e).delete(function(h){return[0,ze(h.path)]}(o))))});i.push(u)}}).next(()=>p.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return wu(e,t)}Zn(e,t){let r=An(e),i,s=nt.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==nt.oe&&t(new I(Ot(i)),s),s=c,i=u):s=nt.oe}).next(()=>{s!==nt.oe&&t(new I(Ot(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function wu(n,e){return An(n).put(function(r,i){return{targetId:0,path:ze(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var Ju=class{constructor(){this.changes=new $t(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ce.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?p.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var pf=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return er(e).put(r)}removeEntry(e,t,r){return er(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Gu(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=Ce.newInvalidDocument(t);return er(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(so(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:Ce.newInvalidDocument(t)};return er(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(so(t))},(i,s)=>{r={document:this.tr(t,s),size:Qu(s)}}).next(()=>r)}getEntries(e,t){let r=Je();return this.rr(e,t,(i,s)=>{let o=this.tr(i,s);r=r.insert(i,o)}).next(()=>r)}ir(e,t){let r=Je(),i=new ie(I.comparator);return this.rr(e,t,(s,o)=>{let a=this.tr(s,o);r=r.insert(s,a),i=i.insert(s,Qu(o))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return p.resolve();let i=new te(vw);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(so(i.first()),so(i.last())),o=i.getIterator(),a=o.getNext();return er(e).J({index:"documentKeyIndex",range:s},(u,c,l)=>{let h=I.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&vw(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.$(so(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Gu(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return er(e).U(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=Je();for(let h of c){let d=this.tr(I.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(jo(t,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(e,t,r,i){let s=Je(),o=yw(t,r),a=yw(t,dt.max());return er(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{let h=this.tr(I.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new gf(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return mw(e).get("remoteDocumentGlobalKey").next(t=>(D(!!t),t))}er(e,t){return mw(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){let r=tR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(V.min())))return r}return Ce.newInvalidDocument(e)}};function FE(n){return new pf(n)}var gf=class extends Ju{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new $t(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new te((s,o)=>F(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,a.readTime)),o.isValidDocument()){let u=rw(this._r.serializer,o);i=i.add(s.path.popLast());let c=Qu(u);r+=c-a.size,t.push(this._r.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){let u=rw(this._r.serializer,o.convertToNoDocument(V.min()));t.push(this._r.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),p.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,o)=>{this.ar.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function mw(n){return Me(n,"remoteDocumentGlobal")}function er(n){return Me(n,"remoteDocumentsV14")}function so(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function yw(n,e){let t=e.documentKey.path.toArray();return[n,Gu(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function vw(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=F(t[s],r[s]),i)return i;return i=F(t.length,r.length),i||(i=F(t[t.length-2],r[r.length-2]),i||F(t[t.length-1],r[r.length-1]))}var mf=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Xu=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&ho(r.mutation,i,rt.empty(),le.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,L()).next(()=>r))}getLocalViewOfDocuments(e,t,r=L()){let i=Ft();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=ao();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Ft();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,L()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Je(),o=lo(),a=function(){return lo()}();return t.forEach((u,c)=>{let l=r.get(c.key);i.has(c.key)&&(l===void 0||l.mutation instanceof At)?s=s.insert(c.key,c):l!==void 0?(o.set(c.key,l.mutation.getFieldMask()),ho(l.mutation,c,l.mutation.getFieldMask(),le.now())):o.set(c.key,rt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new mf(l,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){let r=lo(),i=new ie((o,a)=>o-a),s=L();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=t.get(u);if(c===null)return;let l=r.get(u)||rt.empty();l=a.applyToLocalView(c,l),r.set(u,l);let h=(i.get(a.batchId)||L()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,l=u.value,h=oE();l.forEach(d=>{if(!s.has(d)){let f=pE(t.get(d),r.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return p.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return I.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ep(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):p.resolve(Ft()),a=-1,u=s;return o.next(c=>p.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?p.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,L())).next(l=>({batchId:a,changes:sE(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new I(t)).next(r=>{let i=ao();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=ao();return this.indexManager.getCollectionParents(e,s).next(a=>p.forEach(a,u=>{let c=function(h,d){return new Tt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{let l=c.getKey();o.get(l)===null&&(o=o.insert(l,Ce.newInvalidDocument(l)))});let a=ao();return o.forEach((u,c)=>{let l=s.get(u);l!==void 0&&ho(l.mutation,c,rt.empty(),le.now()),jo(t,c)&&(a=a.insert(u,c))}),a})}};var yf=class{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return p.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,function(i){return{id:i.id,version:i.version,createTime:ve(i.createTime)}}(t)),p.resolve()}getNamedQuery(e,t){return p.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,function(i){return{name:i.name,query:Ap(i.bundledQuery),readTime:ve(i.readTime)}}(t)),p.resolve()}};var vf=class{constructor(){this.overlays=new ie(I.comparator),this.lr=new Map}getOverlay(e,t){return p.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Ft();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),p.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),p.resolve()}getOverlaysForCollection(e,t,r){let i=Ft(),s=t.length+1,o=new I(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return p.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ie((c,l)=>c-l),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=s.get(c.largestBatchId);l===null&&(l=Ft(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}let a=Ft(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return p.resolve(a)}lt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new To(t,r));let s=this.lr.get(t);s===void 0&&(s=L(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}};var Do=class{constructor(){this.hr=new te(Ie.Pr),this.Ir=new te(Ie.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){let r=new Ie(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new Ie(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){let t=new I(new K([])),r=new Ie(t,e),i=new Ie(t,e+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){let t=new I(new K([])),r=new Ie(t,e),i=new Ie(t,e+1),s=L();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Ie(e,0),r=this.hr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Ie=class{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return I.comparator(e.key,t.key)||F(e.gr,t.gr)}static Tr(e,t){return F(e.gr,t.gr)||I.comparator(e.key,t.key)}};var _f=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new te(Ie.Pr)}checkEmpty(e){return p.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Io(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.yr=this.yr.add(new Ie(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return p.resolve(o)}lookupMutationBatch(e,t){return p.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Sr(r),s=i<0?0:i;return p.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return p.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(e){return p.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Ie(t,0),i=new Ie(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{let a=this.wr(o.gr);s.push(a)}),p.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new te(F);return t.forEach(i=>{let s=new Ie(i,0),o=new Ie(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],a=>{r=r.add(a.gr)})}),p.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;I.isDocumentKey(s)||(s=s.child(""));let o=new Ie(new I(s),0),a=new te(F);return this.yr.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.gr)),!0)},o),p.resolve(this.br(a))}br(e){let t=[];return e.forEach(r=>{let i=this.wr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){D(this.Dr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.yr;return p.forEach(t.mutations,i=>{let s=new Ie(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){let r=new Ie(t,0),i=this.yr.firstAfterOrEqual(r);return p.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,p.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}wr(e){let t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var wf=class{constructor(e){this.Cr=e,this.docs=function(){return new ie(I.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return p.resolve(r?r.document.mutableCopy():Ce.newInvalidDocument(t))}getEntries(e,t){let r=Je();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ce.newInvalidDocument(i))}),p.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Je(),o=t.path,a=new I(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||yp(Ow(l),r)<=0||(i.has(l.key)||jo(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return p.resolve(s)}getAllFromCollectionGroup(e,t,r,i){C()}vr(e,t){return p.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Ef(this)}getSize(e){return p.resolve(this.size)}},Ef=class extends Ju{constructor(e){super(),this._r=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),p.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}};var If=class{constructor(e){this.persistence=e,this.Fr=new $t(t=>hr(t),Lo),this.lastRemoteSnapshotVersion=V.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Do,this.targetCount=0,this.Nr=Ai.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),p.resolve()}getLastRemoteSnapshotVersion(e){return p.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return p.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),p.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),p.resolve()}kn(e){this.Fr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Nr=new Ai(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,p.resolve()}updateTargetData(e,t){return this.kn(t),p.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,p.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),p.waitFor(s).next(()=>i)}getTargetCount(e){return p.resolve(this.targetCount)}getTargetData(e,t){let r=this.Fr.get(t)||null;return p.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),p.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),p.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),p.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Or.mr(t);return p.resolve(r)}containsKey(e,t){return p.resolve(this.Or.containsKey(t))}};var Zu=class{constructor(e,t){this.Lr={},this.overlays={},this.Br=new nt(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new If(this),this.indexManager=new af,this.remoteDocumentCache=function(i){return new wf(i)}(r=>this.referenceDelegate.Qr(r)),this.serializer=new zu(t),this.Kr=new yf(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new vf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Lr[e.toKey()];return r||(r=new _f(t,this.referenceDelegate),this.Lr[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){v("MemoryPersistence","Starting transaction:",e);let i=new Tf(this.Br.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return p.or(Object.values(this.Lr).map(r=>()=>r.containsKey(e,t)))}},Tf=class extends Vu{constructor(e){super(),this.currentSequenceNumber=e}},ec=class n{constructor(e){this.persistence=e,this.Gr=new Do,this.zr=null}static jr(e){return new n(e)}get Hr(){if(this.zr)return this.zr;throw C()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),p.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),p.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),p.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return p.forEach(this.Hr,r=>{let i=I.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,V.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return p.or([()=>p.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}};var Af=class{constructor(e){this.serializer=e}O(e,t,r,i){let s=new Mu("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",N_,{unique:!0}),u.createObjectStore("documentMutations")}(e),_w(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=p.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),_w(e)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:V.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",N_,{unique:!0});let h=c.store("mutations"),d=l.map(f=>h.put(f));return p.waitFor(d)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.Zr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(o=o.next(()=>this.ei(s))),r<8&&i>=8&&(o=o.next(()=>this.ti(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.ni(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:Ib});c.createIndex("collectionPathOverlayIndex",Tb,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",Ab,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:hb});c.createIndex("documentKeyIndex",db),c.createIndex("collectionGroupIndex",fb)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ii(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:vb}).createIndex("sequenceNumberIndex",_b,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:wb}).createIndex("documentKeyIndex",Eb,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),o}Xr(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=Qu(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>p.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>p.forEach(a,u=>{D(u.userId===s.userId);let c=rr(this.serializer,u);return kE(e,s.userId,c).next(()=>{})}))}))}ei(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,a)=>{let u=new K(o),c=function(h){return[0,ze(h)]}(u);s.push(t.get(c).next(l=>l?p.resolve():(h=>t.put({targetId:0,path:ze(h),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>p.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:yb});let r=t.store("collectionParents"),i=new Ro,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:ze(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let u=new K(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],c)=>{let l=Ot(a);return s(l.popLast())}))}ni(e){let t=e.store("targets");return t.J((r,i)=>{let s=uo(i),o=xE(this.serializer,s);return t.put(o)})}ri(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{let a=t.store("remoteDocumentsV14"),u=function(h){return h.document?new I(K.fromString(h.document.name).popFirst(5)):h.noDocument?I.fromSegments(h.noDocument.path):h.unknownDocument?I.fromSegments(h.unknownDocument.path):C()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>p.waitFor(i))}ii(e,t){let r=t.store("mutations"),i=FE(this.serializer),s=new Zu(ec.jr,this.serializer.ut);return r.U().next(o=>{let a=new Map;return o.forEach(u=>{var c;let l=(c=a.get(u.userId))!==null&&c!==void 0?c:L();rr(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),p.forEach(a,(u,c)=>{let l=new Te(c),h=Ku.ct(this.serializer,l),d=s.getIndexManager(l),f=Yu.ct(l,this.serializer,d,s.referenceDelegate);return new Xu(i,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new yo(t,nt.oe),u).next()})})}};function _w(n){n.createObjectStore("targetDocuments",{keyPath:gb}).createIndex("documentTargetsIndex",mb,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",pb,{unique:!0}),n.createObjectStore("targetGlobal")}var pd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Cf=class n{constructor(e,t,r,i,s,o,a,u,c,l,h=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=o,this.document=a,this.oi=c,this._i=l,this.ai=h,this.Br=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=d=>Promise.resolve(),!n.D())throw new y(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ff(this,i),this.Ii=t+"main",this.serializer=new zu(u),this.Ti=new Dn(this.Ii,this.ai,new Af(this.serializer)),this.qr=new cf(this.referenceDelegate,this.serializer),this.remoteDocumentCache=FE(this.serializer),this.Kr=new Zd,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,l===!1&&me("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,pd);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Br=new nt(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){return this.Pi=t=>m(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(t=>m(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget(()=>m(this,null,function*(){this.started&&(yield this.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Eu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if(Un(e))return v("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return v("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return oo(e).get("owner").next(t=>p.resolve(this.wi(t)))}Si(e){return Eu(e).delete(this.clientId)}bi(){return m(this,null,function*(){if(this.isPrimary&&!this.Di(this.hi,18e5)){this.hi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=Me(t,"clientMetadata");return r.U().next(i=>{let s=this.Ci(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return p.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ei)for(let t of e)this.Ei.removeItem(this.vi(t.clientId))}})}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?p.resolve(!0):oo(e).get("owner").next(t=>{if(t!==null&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,pd);return!1}}return!(!this.networkEnabled||!this.inForeground)||Eu(e).U().next(r=>this.Ci(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&v("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return m(this,null,function*(){this.kr=!1,this.Mi(),this.li&&(this.li.cancel(),this.li=null),this.xi(),this.Oi(),yield this.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new yo(e,nt.oe);return this.pi(t).next(()=>this.Si(t))}),this.Ti.close(),this.Ni()})}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",e=>Eu(e).U().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return Yu.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new uf(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return Ku.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){v("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===16?Sb:u===15?zw:u===14?$w:u===13?qw:u===12?Cb:u===11?Bw:void C()}(this.ai),o;return this.Ti.runTransaction(e,i,s,a=>(o=new yo(a,this.Br?this.Br.next():nt.oe),t==="readwrite-primary"?this.fi(o).next(u=>!!u||this.gi(o)).next(u=>{if(!u)throw me(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new y(g.FAILED_PRECONDITION,Fw);return r(o)}).next(u=>this.yi(o).next(()=>u)):this.Bi(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Bi(e){return oo(e).get("owner").next(t=>{if(t!==null&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new y(g.FAILED_PRECONDITION,pd)})}yi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return oo(e).put("owner",t)}static D(){return Dn.D()}pi(e){let t=oo(e);return t.get("owner").next(r=>this.wi(r)?(v("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):p.resolve())}Di(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(me(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ai(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground=this.document.visibilityState==="visible")}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ui=()=>{this.Mi();let t=/(?:Version|Mobile)\/1[456]/;sl()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{let r=((t=this.Ei)===null||t===void 0?void 0:t.getItem(this.vi(e)))!==null;return v("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return me("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){me("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function oo(n){return Me(n,"owner")}function Eu(n){return Me(n,"clientMetadata")}function Sp(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var Sf=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=L(),i=L();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var bf=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var tc=class{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=function(){return sl()?8:Lw(rs())>0?6:4}()}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.zi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new bf;return this.Hi(e,t,o).next(a=>{if(s.result=a,this.$i)return this.Ji(e,t,o,a.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(ai()<=Pt.DEBUG&&v("QueryEngine","SDK will not create cache indexes for query:",ui(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),p.resolve()):(ai()<=Pt.DEBUG&&v("QueryEngine","Query:",ui(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(ai()<=Pt.DEBUG&&v("QueryEngine","The SDK decides to create cache indexes for query:",ui(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ge(t))):p.resolve())}zi(e,t){if(K_(t))return p.resolve(null);let r=Ge(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ju(t,null,"F"),r=Ge(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=L(...s);return this.Gi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{let c=this.Yi(t,a);return this.Zi(t,c,o,u.readTime)?this.zi(e,ju(t,null,"F")):this.Xi(e,c,t,u)}))})))}ji(e,t,r,i){return K_(t)||i.isEqual(V.min())?p.resolve(null):this.Gi.getDocuments(e,r).next(s=>{let o=this.Yi(t,s);return this.Zi(t,o,r,i)?p.resolve(null):(ai()<=Pt.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ui(t)),this.Xi(e,o,t,Nw(i,-1)).next(a=>a))})}Yi(e,t){let r=new te(rE(e));return t.forEach((i,s)=>{jo(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return ai()<=Pt.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",ui(t)),this.Gi.getDocumentsMatchingQuery(e,t,dt.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Rf=class{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new ie(F),this.ns=new $t(s=>hr(s),Lo),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Xu(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}};function LE(n,e,t,r){return new Rf(n,e,t,r)}function UE(n,e){return m(this,null,function*(){let t=T(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=L();for(let c of i){o.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}for(let c of s){a.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({_s:c,removedBatchIds:o,addedBatchIds:a}))})})})}function sR(n,e){let t=T(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){let h=c.batch,d=h.keys(),f=p.resolve();return d.forEach(E=>{f=f.next(()=>l.getEntry(u,E)).next(w=>{let _=c.docVersions.get(E);D(_!==null),w.version.compareTo(_)<0&&(h.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),l.addEntry(w)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=L();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function jE(n){let e=T(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function oR(n,e){let t=T(n),r=e.snapshotVersion,i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;let a=[];e.targetChanges.forEach((l,h)=>{let d=i.get(h);if(!d)return;a.push(t.qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.qr.addMatchingKeys(s,l.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?f=f.withResumeToken(Ve.EMPTY_BYTE_STRING,V.min()).withLastLimboFreeSnapshotVersion(V.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,r)),i=i.insert(h,f),function(w,_,x){return w.resumeToken.approximateByteSize()===0||_.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0}(d,f,l)&&a.push(t.qr.updateTargetData(s,f))});let u=Je(),c=L();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(BE(s,o,e.documentUpdates).next(l=>{u=l.us,c=l.cs})),!r.isEqual(V.min())){let l=t.qr.getLastRemoteSnapshotVersion(s).next(h=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return p.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.ts=i,s))}function BE(n,e,t){let r=L(),i=L();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Je();return t.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(V.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):v("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{us:o,cs:i}})}function aR(n,e){let t=T(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Ci(n,e){let t=T(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,p.resolve(i)):t.qr.allocateTargetId(r).next(o=>(i=new Ti(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}function Si(n,e,t){return m(this,null,function*(){let r=T(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Un(o))throw o;v("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)})}function nc(n,e,t){let r=T(n),i=V.min(),s=L();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){let h=T(u),d=h.ns.get(l);return d!==void 0?p.resolve(h.ts.get(d)):h.qr.getTargetData(c,l)}(r,o,Ge(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.es.getDocumentsMatchingQuery(o,e,t?i:V.min(),t?s:L())).next(a=>(zE(r,nE(e),a),{documents:a,ls:s})))}function qE(n,e){let t=T(n),r=T(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function $E(n,e){let t=T(n),r=t.rs.get(e)||V.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,Nw(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(zE(t,e,i),i))}function zE(n,e,t){let r=n.rs.get(e)||V.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}function uR(n,e,t,r){return m(this,null,function*(){let i=T(n),s=L(),o=Je();for(let c of t){let l=e.hs(c.metadata.name);c.document&&(s=s.add(l));let h=e.Ps(c);h.setReadTime(e.Is(c.metadata.readTime)),o=o.insert(l,h)}let a=i.ss.newChangeBuffer({trackRemovals:!0}),u=yield Ci(i,function(l){return Ge(ki(K.fromString(`__bundle__/docs/${l}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>BE(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.us,l.cs)).next(()=>l.us)))})}function cR(r,i){return m(this,arguments,function*(n,e,t=L()){let s=yield Ci(n,Ge(Ap(e.bundledQuery))),o=T(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=ve(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.Kr.saveNamedQuery(a,e);let c=s.withResumeToken(Ve.EMPTY_BYTE_STRING,u);return o.ts=o.ts.insert(c.targetId,c),o.qr.updateTargetData(a,c).next(()=>o.qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.qr.addMatchingKeys(a,t,s.targetId)).next(()=>o.Kr.saveNamedQuery(a,e))})})}function ww(n,e){return`firestore_clients_${n}_${e}`}function Ew(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function gd(n,e){return`firestore_targets_${n}_${e}`}var rc=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new y(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(me("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},fo=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new y(r.error.code,r.error.message))),s?new n(e,r.state,i):(me("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},ic=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Ip();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Uw(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(me("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Df=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(me("SharedClientState",`Failed to parse online state: ${e}`),null)}},Po=class{constructor(){this.activeTargetIds=Ip()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},po=class{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new ie(F),this.started=!1,this.ps=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=ww(this.persistenceKey,this.Rs),this.ws=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.gs=this.gs.insert(this.Rs,new Po),this.Ss=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Cs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.vs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}start(){return m(this,null,function*(){let e=yield this.syncEngine.Li();for(let r of e){if(r===this.Rs)continue;let i=this.getItem(ww(this.persistenceKey,r));if(i){let s=ic.Ts(r,i);s&&(this.gs=this.gs.insert(s.clientId,s))}}this.Fs();let t=this.storage.getItem(this.Cs);if(t){let r=this.Ms(t);r&&this.xs(r)}for(let r of this.ps)this.fs(r);this.ps=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Ls(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(gd(this.persistenceKey,e));if(r){let i=fo.Ts(e,r);i&&(t=i.state)}}return this.Bs.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Bs.As(e),this.Fs()}isLocalQueryTarget(e){return this.Bs.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(gd(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Ls(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return v("SharedClientState","READ",e,t),t}setItem(e,t){v("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){v("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){let t=e;if(t.storageArea===this.storage){if(v("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ys)return void me("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable(()=>m(this,null,function*(){if(this.started){if(t.key!==null){if(this.Ss.test(t.key)){if(t.newValue==null){let r=this.Ks(t.key);return this.$s(r,null)}{let r=this.Us(t.key,t.newValue);if(r)return this.$s(r.clientId,r)}}else if(this.bs.test(t.key)){if(t.newValue!==null){let r=this.Ws(t.key,t.newValue);if(r)return this.Gs(r)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){let r=this.zs(t.key,t.newValue);if(r)return this.js(r)}}else if(t.key===this.Cs){if(t.newValue!==null){let r=this.Ms(t.newValue);if(r)return this.xs(r)}}else if(t.key===this.ws){let r=function(s){let o=nt.oe;if(s!=null)try{let a=JSON.parse(s);D(typeof a=="number"),o=a}catch(a){me("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==nt.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.vs){let r=this.Hs(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.Js(i)))}}}else this.ps.push(t)}))}}get Bs(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Bs.Es())}Ns(e,t,r){let i=new rc(this.currentUser,e,t,r),s=Ew(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Ls(e){let t=Ew(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){let t={clientId:this.Rs,onlineState:e};this.storage.setItem(this.Cs,JSON.stringify(t))}ks(e,t,r){let i=gd(this.persistenceKey,e),s=new fo(e,t,r);this.setItem(i,s.Es())}Qs(e){let t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){let t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){let r=this.Ks(e);return ic.Ts(r,t)}Ws(e,t){let r=this.bs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return rc.Ts(new Te(s),i,t)}zs(e,t){let r=this.Ds.exec(e),i=Number(r[1]);return fo.Ts(i,t)}Ms(e){return Df.Ts(e)}Hs(e){return JSON.parse(e)}Gs(e){return m(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Ys(e.batchId,e.state,e.error);v("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){let r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.Xs(o,a).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=Ip();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},sc=class{constructor(){this.eo=new Po,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new Po,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Pf=class{ro(e){}shutdown(){}};var oc=class{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ao)e(0)}_o(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ao)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Iu=null;function md(){return Iu===null?Iu=function(){return 268435456+Math.round(2147483648*Math.random())}():Iu++,"0x"+Iu.toString(16)}var lR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var xf=class{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}Eo(e){this.Ao=e}onMessage(e){this.Ro=e}close(){this.lo()}send(e){this.co(e)}Vo(){this.Po()}mo(){this.To()}fo(e){this.Ao(e)}po(e){this.Ro(e)}};var je="WebChannelConnection",Vf=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.yo=r+"://"+t.host,this.wo=`projects/${i}/databases/${s}`,this.So=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get bo(){return!1}Do(t,r,i,s,o){let a=md(),u=this.Co(t,r.toUriEncodedString());v("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(c,s,o),this.Fo(t,u,c,i).then(l=>(v("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw ht("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}Mo(t,r,i,s,o,a){return this.Do(t,r,i,s,o)}vo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Mi}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}Co(t,r){let i=lR[t];return`${this.yo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Fo(e,t,r,i){let s=md();return new Promise((o,a)=>{let u=new P_;u.setWithCredentials(!0),u.listenOnce(b_.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case vu.NO_ERROR:let l=u.getResponseJson();v(je,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case vu.TIMEOUT:v(je,`RPC '${e}' ${s} timed out`),a(new y(g.DEADLINE_EXCEEDED,"Request time out"));break;case vu.HTTP_ERROR:let h=u.getStatus();if(v(je,`RPC '${e}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);let f=d?.error;if(f&&f.status&&f.message){let E=function(_){let x=_.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(x)>=0?x:g.UNKNOWN}(f.status);a(new y(E,f.message))}else a(new y(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new y(g.UNAVAILABLE,"Connection failed."));break;default:C()}}finally{v(je,`RPC '${e}' ${s} completed.`)}});let c=JSON.stringify(i);v(je,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}xo(e,t,r){let i=md(),s=[this.yo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=C_(),a=S_(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new D_({})),this.vo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let l=s.join("");v(je,`Creating RPC '${e}' stream ${i}: ${l}`,u);let h=o.createWebChannel(l,u),d=!1,f=!1,E=new xf({co:_=>{f?v(je,`Not sending because RPC '${e}' stream ${i} is closed:`,_):(d||(v(je,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),v(je,`RPC '${e}' stream ${i} sending:`,_),h.send(_))},lo:()=>h.close()}),w=(_,x,O)=>{_.listen(x,b=>{try{O(b)}catch(j){setTimeout(()=>{throw j},0)}})};return w(h,no.EventType.OPEN,()=>{f||(v(je,`RPC '${e}' stream ${i} transport opened.`),E.Vo())}),w(h,no.EventType.CLOSE,()=>{f||(f=!0,v(je,`RPC '${e}' stream ${i} transport closed`),E.fo())}),w(h,no.EventType.ERROR,_=>{f||(f=!0,ht(je,`RPC '${e}' stream ${i} transport errored:`,_),E.fo(new y(g.UNAVAILABLE,"The operation could not be completed")))}),w(h,no.EventType.MESSAGE,_=>{var x;if(!f){let O=_.data[0];D(!!O);let b=O,j=b.error||((x=b[0])===null||x===void 0?void 0:x.error);if(j){v(je,`RPC '${e}' stream ${i} received error:`,j);let B=j.status,W=function(p0){let hg=Ee[p0];if(hg!==void 0)return yE(hg)}(B),_e=j.message;W===void 0&&(W=g.INTERNAL,_e="Unknown error status: "+B+" with message "+j.message),f=!0,E.fo(new y(W,_e)),h.close()}else v(je,`RPC '${e}' stream ${i} received:`,O),E.po(O)}}),w(a,R_.STAT_EVENT,_=>{_.stat===dd.PROXY?v(je,`RPC '${e}' stream ${i} detected buffering proxy`):_.stat===dd.NOPROXY&&v(je,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{E.mo()},0),E}};function GE(){return typeof window<"u"?window:null}function bu(){return typeof document<"u"?document:null}function Bo(n){return new Wd(n,!0)}var xo=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Oo=r,this.No=i,this.Lo=s,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(e){this.cancel();let t=Math.floor(this.Bo+this.$o()),r=Math.max(0,Date.now()-this.qo),i=Math.max(0,t-r);i>0&&v("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Bo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.qo=Date.now(),e())),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){this.ko!==null&&(this.ko.skipDelay(),this.ko=null)}cancel(){this.ko!==null&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}};var ac=class{constructor(e,t,r,i,s,o,a,u){this.si=e,this.Wo=r,this.Go=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new xo(e,t)}Yo(){return this.state===1||this.state===5||this.Zo()}Zo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Xo()}stop(){return m(this,null,function*(){this.Yo()&&(yield this.close(0))})}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&this.jo===null&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,()=>this.n_()))}r_(e){this.i_(),this.stream.send(e)}n_(){return m(this,null,function*(){if(this.Zo())return this.close(0)})}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}close(e,t){return m(this,null,function*(){this.i_(),this.s_(),this.Jo.cancel(),this.zo++,e!==4?this.Jo.reset():t&&t.code===g.RESOURCE_EXHAUSTED?(me(t.toString()),me("Using maximum backoff delay to prevent overloading the backend."),this.Jo.Qo()):t&&t.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.o_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Eo(t)})}o_(){}auth(){this.state=1;let e=this.__(this.zo),t=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.zo===t&&this.a_(r,i)},r=>{e(()=>{let i=new y(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.u_(i)})})}a_(e,t){let r=this.__(this.zo);this.stream=this.c_(e,t),this.stream.ho(()=>{r(()=>this.listener.ho())}),this.stream.Io(()=>{r(()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,()=>(this.Zo()&&(this.state=3),Promise.resolve())),this.listener.Io()))}),this.stream.Eo(i=>{r(()=>this.u_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Xo(){this.state=5,this.Jo.Ko(()=>m(this,null,function*(){this.state=0,this.start()}))}u_(e){return v("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}__(e){return t=>{this.si.enqueueAndForget(()=>this.zo===e?t():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Mf=class extends ac{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}c_(e,t){return this.connection.xo("Listen",e,t)}onMessage(e){this.Jo.reset();let t=Wb(this.serializer,e),r=function(s){if(!("targetChange"in s))return V.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?V.min():o.readTime?ve(o.readTime):V.min()}(e);return this.listener.l_(t,r)}h_(e){let t={};t.database=Jd(this.serializer),t.addTarget=function(s,o){let a,u=o.target;if(a=Lu(u)?{documents:CE(s,u)}:{query:SE(s,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=_E(s,o.resumeToken);let c=Qd(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(V.min())>0){a.readTime=Ii(s,o.snapshotVersion.toTimestamp());let c=Qd(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);let r=Yb(this.serializer,e);r&&(t.labels=r),this.r_(t)}P_(e){let t={};t.database=Jd(this.serializer),t.removeTarget=e,this.r_(t)}},kf=class extends ac{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.I_=!1}get T_(){return this.I_}start(){this.I_=!1,this.lastStreamToken=void 0,super.start()}o_(){this.I_&&this.E_([])}c_(e,t){return this.connection.xo("Write",e,t)}onMessage(e){if(D(!!e.streamToken),this.lastStreamToken=e.streamToken,this.I_){this.Jo.reset();let t=Qb(e.writeResults,e.commitTime),r=ve(e.commitTime);return this.listener.d_(r,t)}return D(!e.writeResults||e.writeResults.length===0),this.I_=!0,this.listener.A_()}R_(){let e={};e.database=Jd(this.serializer),this.r_(e)}E_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>bo(this.serializer,r))};this.r_(t)}};var Nf=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.V_=!1}m_(){if(this.V_)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}Do(e,t,r,i){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Do(e,Yd(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(g.UNKNOWN,s.toString())})}Mo(e,t,r,i,s){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Mo(e,Yd(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new y(g.UNKNOWN,o.toString())})}terminate(){this.V_=!0,this.connection.terminate()}};var Of=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,e==="Online"&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(me(t),this.y_=!1):v("OnlineStateTracker",t)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var Ff=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.ro(o=>{r.enqueueAndForget(()=>m(this,null,function*(){jn(this)&&(v("RemoteStore","Restarting streams for network reachability change."),yield function(u){return m(this,null,function*(){let c=T(u);c.M_.add(4),yield Ni(c),c.N_.set("Unknown"),c.M_.delete(4),yield qo(c)})}(this))}))}),this.N_=new Of(r,i)}};function qo(n){return m(this,null,function*(){if(jn(n))for(let e of n.x_)yield e(!0)})}function Ni(n){return m(this,null,function*(){for(let e of n.x_)yield e(!1)})}function Sc(n,e){let t=T(n);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),Dp(t)?Rp(t):Fi(t).Zo()&&bp(t,e))}function bi(n,e){let t=T(n),r=Fi(t);t.F_.delete(e),r.Zo()&&KE(t,e),t.F_.size===0&&(r.Zo()?r.t_():jn(t)&&t.N_.set("Unknown"))}function bp(n,e){if(n.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(V.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Fi(n).h_(e)}function KE(n,e){n.L_.xe(e),Fi(n).P_(e)}function Rp(n){n.L_=new Hd({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.F_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Fi(n).start(),n.N_.w_()}function Dp(n){return jn(n)&&!Fi(n).Yo()&&n.F_.size>0}function jn(n){return T(n).M_.size===0}function HE(n){n.L_=void 0}function hR(n){return m(this,null,function*(){n.N_.set("Online")})}function dR(n){return m(this,null,function*(){n.F_.forEach((e,t)=>{bp(n,e)})})}function fR(n,e){return m(this,null,function*(){HE(n),Dp(n)?(n.N_.D_(e),Rp(n)):n.N_.set("Unknown")})}function pR(n,e,t){return m(this,null,function*(){if(n.N_.set("Online"),e instanceof qu&&e.state===2&&e.cause)try{yield function(i,s){return m(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.F_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.F_.delete(a),i.L_.removeTarget(a))})}(n,e)}catch(r){v("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield uc(n,r)}else if(e instanceof gi?n.L_.Ke(e):e instanceof Bu?n.L_.He(e):n.L_.We(e),!t.isEqual(V.min()))try{let r=yield jE(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.L_.rt(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let l=s.F_.get(c);l&&s.F_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let l=s.F_.get(u);if(!l)return;s.F_.set(u,l.withResumeToken(Ve.EMPTY_BYTE_STRING,l.snapshotVersion)),KE(s,u);let h=new Ti(l.target,u,c,l.sequenceNumber);bp(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){v("RemoteStore","Failed to raise snapshot:",r),yield uc(n,r)}})}function uc(n,e,t){return m(this,null,function*(){if(!Un(e))throw e;n.M_.add(1),yield Ni(n),n.N_.set("Offline"),t||(t=()=>jE(n.localStore)),n.asyncQueue.enqueueRetryable(()=>m(this,null,function*(){v("RemoteStore","Retrying IndexedDB access"),yield t(),n.M_.delete(1),yield qo(n)}))})}function WE(n,e){return e().catch(t=>uc(n,t,e))}function Oi(n){return m(this,null,function*(){let e=T(n),t=Fn(e),r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;gR(e);)try{let i=yield aR(e.localStore,r);if(i===null){e.v_.length===0&&t.t_();break}r=i.batchId,mR(e,i)}catch(i){yield uc(e,i)}QE(e)&&YE(e)})}function gR(n){return jn(n)&&n.v_.length<10}function mR(n,e){n.v_.push(e);let t=Fn(n);t.Zo()&&t.T_&&t.E_(e.mutations)}function QE(n){return jn(n)&&!Fn(n).Yo()&&n.v_.length>0}function YE(n){Fn(n).start()}function yR(n){return m(this,null,function*(){Fn(n).R_()})}function vR(n){return m(this,null,function*(){let e=Fn(n);for(let t of n.v_)e.E_(t.mutations)})}function _R(n,e,t){return m(this,null,function*(){let r=n.v_.shift(),i=zd.from(r,e,t);yield WE(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Oi(n)})}function wR(n,e){return m(this,null,function*(){e&&Fn(n).T_&&(yield function(r,i){return m(this,null,function*(){if(function(o){return mE(o)&&o!==g.ABORTED}(i.code)){let s=r.v_.shift();Fn(r).e_(),yield WE(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Oi(r)}})}(n,e)),QE(n)&&YE(n)})}function Iw(n,e){return m(this,null,function*(){let t=T(n);t.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");let r=jn(t);t.M_.add(3),yield Ni(t),r&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield qo(t)})}function Lf(n,e){return m(this,null,function*(){let t=T(n);e?(t.M_.delete(2),yield qo(t)):e||(t.M_.add(2),yield Ni(t),t.N_.set("Unknown"))})}function Fi(n){return n.B_||(n.B_=function(t,r,i){let s=T(t);return s.m_(),new Mf(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:hR.bind(null,n),Io:dR.bind(null,n),Eo:fR.bind(null,n),l_:pR.bind(null,n)}),n.x_.push(e=>m(this,null,function*(){e?(n.B_.e_(),Dp(n)?Rp(n):n.N_.set("Unknown")):(yield n.B_.stop(),HE(n))}))),n.B_}function Fn(n){return n.k_||(n.k_=function(t,r,i){let s=T(t);return s.m_(),new kf(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:()=>Promise.resolve(),Io:yR.bind(null,n),Eo:wR.bind(null,n),A_:vR.bind(null,n),d_:_R.bind(null,n)}),n.x_.push(e=>m(this,null,function*(){e?(n.k_.e_(),yield Oi(n)):(yield n.k_.stop(),n.v_.length>0&&(v("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))}))),n.k_}var Uf=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ae,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new y(g.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Li(n,e){if(me("AsyncQueue",`${e}: ${n}`),Un(n))return new y(g.UNAVAILABLE,`${e}: ${n}`);throw n}var cc=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||I.comparator(t.key,r.key):(t,r)=>I.comparator(t.key,r.key),this.keyedMap=ao(),this.sortedSet=new ie(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var lc=class{constructor(){this.q_=new ie(I.comparator)}track(e){let t=e.doc.key,r=this.q_.get(t);r?e.type!==0&&r.type===3?this.q_=this.q_.insert(t,e):e.type===3&&r.type!==1?this.q_=this.q_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.q_=this.q_.remove(t):e.type===1&&r.type===2?this.q_=this.q_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):C():this.q_=this.q_.insert(t,e)}Q_(){let e=[];return this.q_.inorderTraversal((t,r)=>{e.push(r)}),e}},Ri=class n{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,cc.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Uo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var jf=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}},Bf=class{constructor(){this.queries=new $t(e=>tE(e),Uo),this.onlineState="Unknown",this.z_=new Set}};function Pp(n,e){return m(this,null,function*(){let t=T(n),r=3,i=e.query,s=t.queries.get(i);s?!s.W_()&&e.G_()&&(r=2):(s=new jf,r=e.G_()?0:1);try{switch(r){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=Li(o,`Initialization of query '${ui(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&Vp(t)})}function xp(n,e){return m(this,null,function*(){let t=T(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.U_.indexOf(e);o>=0&&(s.U_.splice(o,1),s.U_.length===0?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function ER(n,e){let t=T(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.U_)a.H_(i)&&(r=!0);o.K_=i}}r&&Vp(t)}function IR(n,e,t){let r=T(n),i=r.queries.get(e);if(i)for(let s of i.U_)s.onError(t);r.queries.delete(e)}function Vp(n){n.z_.forEach(e=>{e.next()})}var qf,Tw;(Tw=qf||(qf={})).J_="default",Tw.Cache="cache";var Vo=class{constructor(e,t,r){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Ri(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache||!this.G_())return!0;let r=t!=="Offline";return(!this.options.ra||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ea(e){if(e.docChanges.length>0)return!0;let t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}na(e){e=Ri.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==qf.Cache}};var $f=class{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}};var hc=class{constructor(e){this.serializer=e}hs(e){return Ut(this.serializer,e)}Ps(e){return e.metadata.exists?AE(this.serializer,e.document,!1):Ce.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return ve(e)}},zf=class{constructor(e,t,r){this.oa=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=JE(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;let r=K.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){let t=new Map,r=new hc(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.hs(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||L()).add(s);t.set(o,a)}}return t}complete(){return m(this,null,function*(){let e=yield uR(this.localStore,new hc(this.serializer),this.documents,this.oa.id),t=this.aa(this.documents);for(let r of this.queries)yield cR(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:e}})}};function JE(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var dc=class{constructor(e){this.key=e}},fc=class{constructor(e){this.key=e}},pc=class{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=L(),this.mutatedKeys=L(),this.Ia=rE(e),this.Ta=new cc(this.Ia)}get Ea(){return this.la}da(e,t){let r=t?t.Aa:new lc,i=t?t.Ta:this.Ta,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{let d=i.get(l),f=jo(this.query,h)?h:null,E=!!d&&this.mutatedKeys.has(d.key),w=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations),_=!1;d&&f?d.data.isEqual(f.data)?E!==w&&(r.track({type:3,doc:f}),_=!0):this.Ra(d,f)||(r.track({type:2,doc:f}),_=!0,(u&&this.Ia(f,u)>0||c&&this.Ia(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),_=!0):d&&!f&&(r.track({type:1,doc:d}),_=!0,(u||c)&&(a=!0)),_&&(f?(o=o.add(f),s=w?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Ta:o,Aa:r,Zi:a,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;let o=e.Aa.Q_();o.sort((l,h)=>function(f,E){let w=_=>{switch(_){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return C()}};return w(f)-w(E)}(l.type,h.type)||this.Ia(l.doc,h.doc)),this.Va(r),i=i!=null&&i;let a=t&&!i?this.ma():[],u=this.Pa.size===0&&this.current&&!i?1:0,c=u!==this.ha;return this.ha=u,o.length!==0||c?{snapshot:new Ri(this.query,e.Ta,s,o,e.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new lc,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];let e=this.Pa;this.Pa=L(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});let t=[];return e.forEach(r=>{this.Pa.has(r)||t.push(new fc(r))}),this.Pa.forEach(r=>{e.has(r)||t.push(new dc(r))}),t}pa(e){this.la=e.ls,this.Pa=L();let t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Ri.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},Gf=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Kf=class{constructor(e){this.key=e,this.wa=!1}},Hf=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new $t(a=>tE(a),Uo),this.Da=new Map,this.Ca=new Set,this.va=new ie(I.comparator),this.Fa=new Map,this.Ma=new Do,this.xa={},this.Oa=new Map,this.Na=Ai.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function TR(n,e,t=!0){return m(this,null,function*(){let r=bc(n),i,s=r.ba.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield XE(r,e,t,!0),i})}function AR(n,e){return m(this,null,function*(){let t=bc(n);yield XE(t,e,!0,!1)})}function XE(n,e,t,r){return m(this,null,function*(){let i=yield Ci(n.localStore,Ge(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield Mp(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Sc(n.remoteStore,i),a})}function Mp(n,e,t,r,i){return m(this,null,function*(){n.Ba=(h,d,f)=>function(w,_,x,O){return m(this,null,function*(){let b=_.view.da(x);b.Zi&&(b=yield nc(w.localStore,_.query,!1).then(({documents:_e})=>_.view.da(_e,b)));let j=O&&O.targetChanges.get(_.targetId),B=O&&O.targetMismatches.get(_.targetId)!=null,W=_.view.applyChanges(b,w.isPrimaryClient,j,B);return Wf(w,_.targetId,W.fa),W.snapshot})}(n,h,d,f);let s=yield nc(n.localStore,e,!0),o=new pc(e,s.ls),a=o.da(s.documents),u=Co.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,u);Wf(n,t,c.fa);let l=new Gf(e,t,o);return n.ba.set(e,l),n.Da.has(t)?n.Da.get(t).push(e):n.Da.set(t,[e]),c.snapshot})}function CR(n,e,t){return m(this,null,function*(){let r=T(n),i=r.ba.get(e),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter(o=>!Uo(o,e))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Si(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&bi(r.remoteStore,i.targetId),Di(r,i.targetId)}).catch(Ln))):(Di(r,i.targetId),yield Si(r.localStore,i.targetId,!0))})}function SR(n,e){return m(this,null,function*(){let t=T(n),r=t.ba.get(e),i=t.Da.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),bi(t.remoteStore,r.targetId))})}function bR(n,e,t){return m(this,null,function*(){let r=Fp(n);try{let i=yield function(o,a){let u=T(o),c=le.now(),l=a.reduce((f,E)=>f.add(E.key),L()),h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",f=>{let E=Je(),w=L();return u.ss.getEntries(f,l).next(_=>{E=_,E.forEach((x,O)=>{O.isValidDocument()||(w=w.add(x))})}).next(()=>u.localDocuments.getOverlayedDocuments(f,E)).next(_=>{h=_;let x=[];for(let O of a){let b=Bb(O,h.get(O.key).overlayedDocument);b!=null&&x.push(new At(O.key,b,Ww(b.value.mapValue),fe.exists(!0)))}return u.mutationQueue.addMutationBatch(f,c,x,a)}).next(_=>{d=_;let x=_.applyToLocalDocumentSet(h,w);return u.documentOverlayCache.saveOverlays(f,_.batchId,x)})}).then(()=>({batchId:d.batchId,changes:sE(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.xa[o.currentUser.toKey()];c||(c=new ie(F)),c=c.insert(a,u),o.xa[o.currentUser.toKey()]=c}(r,i.batchId,t),yield on(r,i.changes),yield Oi(r.remoteStore)}catch(i){let s=Li(i,"Failed to persist write");t.reject(s)}})}function ZE(n,e){return m(this,null,function*(){let t=T(n);try{let r=yield oR(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Fa.get(s);o&&(D(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.wa=!0:i.modifiedDocuments.size>0?D(o.wa):i.removedDocuments.size>0&&(D(o.wa),o.wa=!1))}),yield on(t,r,e)}catch(r){yield Ln(r)}})}function Aw(n,e,t){let r=T(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.ba.forEach((s,o)=>{let a=o.view.j_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=T(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(let d of h.U_)d.j_(a)&&(c=!0)}),c&&Vp(u)}(r.eventManager,e),i.length&&r.Sa.l_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function RR(n,e,t){return m(this,null,function*(){let r=T(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Fa.get(e),s=i&&i.key;if(s){let o=new ie(I.comparator);o=o.insert(s,Ce.newNoDocument(s,V.min()));let a=L().add(s),u=new Ao(V.min(),new Map,new ie(F),o,a);yield ZE(r,u),r.va=r.va.remove(s),r.Fa.delete(e),Op(r)}else yield Si(r.localStore,e,!1).then(()=>Di(r,e,t)).catch(Ln)})}function DR(n,e){return m(this,null,function*(){let t=T(n),r=e.batch.batchId;try{let i=yield sR(t.localStore,e);Np(t,r,null),kp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield on(t,i)}catch(i){yield Ln(i)}})}function PR(n,e,t){return m(this,null,function*(){let r=T(n);try{let i=yield function(o,a){let u=T(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(D(h!==null),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);Np(r,e,t),kp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield on(r,i)}catch(i){yield Ln(i)}})}function xR(n,e){return m(this,null,function*(){let t=T(n);jn(t.remoteStore)||v("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=T(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===-1)return void e.resolve();let i=t.Oa.get(r)||[];i.push(e),t.Oa.set(r,i)}catch(r){let i=Li(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function kp(n,e){(n.Oa.get(e)||[]).forEach(t=>{t.resolve()}),n.Oa.delete(e)}function Np(n,e,t){let r=T(n),i=r.xa[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.xa[r.currentUser.toKey()]=i}}function Di(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Da.get(e))n.ba.delete(r),t&&n.Sa.ka(r,t);n.Da.delete(e),n.isPrimaryClient&&n.Ma.Rr(e).forEach(r=>{n.Ma.containsKey(r)||eI(n,r)})}function eI(n,e){n.Ca.delete(e.path.canonicalString());let t=n.va.get(e);t!==null&&(bi(n.remoteStore,t),n.va=n.va.remove(e),n.Fa.delete(t),Op(n))}function Wf(n,e,t){for(let r of t)r instanceof dc?(n.Ma.addReference(r.key,e),VR(n,r)):r instanceof fc?(v("SyncEngine","Document no longer in limbo: "+r.key),n.Ma.removeReference(r.key,e),n.Ma.containsKey(r.key)||eI(n,r.key)):C()}function VR(n,e){let t=e.key,r=t.path.canonicalString();n.va.get(t)||n.Ca.has(r)||(v("SyncEngine","New document in limbo: "+t),n.Ca.add(r),Op(n))}function Op(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){let e=n.Ca.values().next().value;n.Ca.delete(e);let t=new I(K.fromString(e)),r=n.Na.next();n.Fa.set(r,new Kf(t)),n.va=n.va.insert(t,r),Sc(n.remoteStore,new Ti(Ge(ki(t.path)),r,"TargetPurposeLimboResolution",nt.oe))}}function on(n,e,t){return m(this,null,function*(){let r=T(n),i=[],s=[],o=[];r.ba.isEmpty()||(r.ba.forEach((a,u)=>{o.push(r.Ba(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let l=Sf.Qi(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.Sa.l_(i),yield function(u,c){return m(this,null,function*(){let l=T(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>p.forEach(c,d=>p.forEach(d.ki,f=>l.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>p.forEach(d.qi,f=>l.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!Un(h))throw h;v("LocalStore","Failed to update sequence numbers: "+h)}for(let h of c){let d=h.targetId;if(!h.fromCache){let f=l.ts.get(d),E=f.snapshotVersion,w=f.withLastLimboFreeSnapshotVersion(E);l.ts=l.ts.insert(d,w)}}})}(r.localStore,s))})}function MR(n,e){return m(this,null,function*(){let t=T(n);if(!t.currentUser.isEqual(e)){v("SyncEngine","User change. New user:",e.toKey());let r=yield UE(t.localStore,e);t.currentUser=e,function(s,o){s.Oa.forEach(a=>{a.forEach(u=>{u.reject(new y(g.CANCELLED,o))})}),s.Oa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield on(t,r._s)}})}function kR(n,e){let t=T(n),r=t.Fa.get(e);if(r&&r.wa)return L().add(r.key);{let i=L(),s=t.Da.get(e);if(!s)return i;for(let o of s){let a=t.ba.get(o);i=i.unionWith(a.view.Ea)}return i}}function NR(n,e){return m(this,null,function*(){let t=T(n),r=yield nc(t.localStore,e.query,!0),i=e.view.pa(r);return t.isPrimaryClient&&Wf(t,e.targetId,i.fa),i})}function OR(n,e){return m(this,null,function*(){let t=T(n);return $E(t.localStore,e).then(r=>on(t,r))})}function FR(n,e,t,r){return m(this,null,function*(){let i=T(n),s=yield function(a,u){let c=T(a),l=T(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.Cn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):p.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield Oi(i.remoteStore):t==="acknowledged"||t==="rejected"?(Np(i,e,r||null),kp(i,e),function(a,u){T(T(a).mutationQueue).Fn(u)}(i.localStore,e)):C(),yield on(i,s)):v("SyncEngine","Cannot apply mutation batch with id: "+e)})}function LR(n,e){return m(this,null,function*(){let t=T(n);if(bc(t),Fp(t),e===!0&&t.La!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Cw(t,r.toArray());t.La=!0,yield Lf(t.remoteStore,!0);for(let s of i)Sc(t.remoteStore,s)}else if(e===!1&&t.La!==!1){let r=[],i=Promise.resolve();t.Da.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Di(t,o),Si(t.localStore,o,!0))),bi(t.remoteStore,o)}),yield i,yield Cw(t,r),function(o){let a=T(o);a.Fa.forEach((u,c)=>{bi(a.remoteStore,c)}),a.Ma.Vr(),a.Fa=new Map,a.va=new ie(I.comparator)}(t),t.La=!1,yield Lf(t.remoteStore,!1)}})}function Cw(n,e,t){return m(this,null,function*(){let r=T(n),i=[],s=[];for(let o of e){let a,u=r.Da.get(o);if(u&&u.length!==0){a=yield Ci(r.localStore,Ge(u[0]));for(let c of u){let l=r.ba.get(c),h=yield NR(r,l);h.snapshot&&s.push(h.snapshot)}}else{let c=yield qE(r.localStore,o);a=yield Ci(r.localStore,c),yield Mp(r,tI(c),o,!1,a.resumeToken)}i.push(a)}return r.Sa.l_(s),i})}function tI(n){return eE(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function UR(n){return function(t){return T(T(t).persistence).Li()}(T(n).localStore)}function jR(n,e,t,r){return m(this,null,function*(){let i=T(n);if(i.La)return void v("SyncEngine","Ignoring unexpected query state notification.");let s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield $E(i.localStore,nE(s[0])),a=Ao.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ve.EMPTY_BYTE_STRING);yield on(i,o,a);break}case"rejected":yield Si(i.localStore,e,!0),Di(i,e,r);break;default:C()}})}function BR(n,e,t){return m(this,null,function*(){let r=bc(n);if(r.La){for(let i of e){if(r.Da.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){v("SyncEngine","Adding an already active target "+i);continue}let s=yield qE(r.localStore,i),o=yield Ci(r.localStore,s);yield Mp(r,tI(s),o.targetId,!1,o.resumeToken),Sc(r.remoteStore,o)}for(let i of t)r.Da.has(i)&&(yield Si(r.localStore,i,!1).then(()=>{bi(r.remoteStore,i),Di(r,i)}).catch(Ln))}})}function bc(n){let e=T(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=ZE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=kR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=RR.bind(null,e),e.Sa.l_=ER.bind(null,e.eventManager),e.Sa.ka=IR.bind(null,e.eventManager),e}function Fp(n){let e=T(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=DR.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=PR.bind(null,e),e}function qR(n,e,t){let r=T(n);(function(s,o,a){return m(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(f,E){let w=T(f),_=ve(E.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",x=>w.Kr.getBundleMetadata(x,E.id)).then(x=>!!x&&x.createTime.compareTo(_)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(f){return{taskState:"Success",documentsLoaded:f.totalDocuments,bytesLoaded:f.totalBytes,totalDocuments:f.totalDocuments,totalBytes:f.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(JE(u));let c=new zf(u,s.localStore,o.serializer),l=yield o.qa();for(;l;){let d=yield c._a(l);d&&a._updateProgress(d),l=yield o.qa()}let h=yield c.complete();return yield on(s,h.ca,void 0),yield function(f,E){let w=T(f);return w.persistence.runTransaction("Save bundle","readwrite",_=>w.Kr.saveBundleMetadata(_,E))}(s.localStore,u),a._completeWith(h.progress),Promise.resolve(h.ua)}catch(u){return ht("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var Mo=class{constructor(){this.synchronizeTabs=!1}initialize(e){return m(this,null,function*(){this.serializer=Bo(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return LE(this.persistence,new tc,e.initialUser,this.serializer)}createPersistence(e){return new Zu(ec.jr,this.serializer)}createSharedClientState(e){return new sc}terminate(){return m(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var gc=class n extends Mo{constructor(e,t,r){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return m(this,null,function*(){yield Bc(n.prototype,this,"initialize").call(this,e),yield this.Qa.initialize(this,e),yield Fp(this.Qa.syncEngine),yield Oi(this.Qa.remoteStore),yield this.persistence.mi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return LE(this.persistence,new tc,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new hf(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new Rd(t,this.persistence);return new bd(e.asyncQueue,r)}createPersistence(e){let t=Sp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?lt.withCacheSize(this.cacheSizeBytes):lt.DEFAULT;return new Cf(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,GE(),bu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new sc}},Qf=class n extends gc{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return m(this,null,function*(){yield Bc(n.prototype,this,"initialize").call(this,e);let t=this.Qa.syncEngine;this.sharedClientState instanceof po&&(this.sharedClientState.syncEngine={Ys:FR.bind(null,t),Zs:jR.bind(null,t),Xs:BR.bind(null,t),Li:UR.bind(null,t),Js:OR.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.mi(r=>m(this,null,function*(){yield LR(this.Qa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=GE();if(!po.D(t))throw new y(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Sp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new po(t,e.asyncQueue,r,e.clientId,e.initialUser)}},ko=class{initialize(e,t){return m(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Aw(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=MR.bind(null,this.syncEngine),yield Lf(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Bf}()}createDatastore(e){let t=Bo(e.databaseInfo.databaseId),r=function(s){return new Vf(s)}(e.databaseInfo);return function(s,o,a,u){return new Nf(s,o,a,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new Ff(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Aw(this.syncEngine,t,0),function(){return oc.D()?new oc:new Pf}())}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){let h=new Hf(i,s,o,a,u,c);return l&&(h.La=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return m(this,null,function*(){var e;yield function(r){return m(this,null,function*(){let i=T(r);v("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield Ni(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function Sw(n,e=10240){let t=0;return{read(){return m(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return m(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Pi=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):me("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var Yf=class{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new Ae,this.buffer=new Uint8Array,this.Wa=function(){return new TextDecoder("utf-8")}(),this.Ga().then(r=>{r&&r.sa()?this.metadata.resolve(r.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.ia)}`))},r=>this.metadata.reject(r))}close(){return this.Ua.cancel()}getMetadata(){return m(this,null,function*(){return this.metadata.promise})}qa(){return m(this,null,function*(){return yield this.getMetadata(),this.Ga()})}Ga(){return m(this,null,function*(){let e=yield this.za();if(e===null)return null;let t=this.Wa.decode(e),r=Number(t);isNaN(r)&&this.ja(`length string (${t}) is not valid number`);let i=yield this.Ha(r);return new $f(JSON.parse(i),e.length+r)})}Ja(){return this.buffer.findIndex(e=>e===123)}za(){return m(this,null,function*(){for(;this.Ja()<0&&!(yield this.Ya()););if(this.buffer.length===0)return null;let e=this.Ja();e<0&&this.ja("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Ha(e){return m(this,null,function*(){for(;this.buffer.length<e;)(yield this.Ya())&&this.ja("Reached the end of bundle when more is expected.");let t=this.Wa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){return m(this,null,function*(){let e=yield this.Ua.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Jf=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return m(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new y(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return m(this,null,function*(){let o=T(i),a={documents:s.map(h=>So(o.serializer,h))},u=yield o.Mo("BatchGetDocuments",o.serializer.databaseId,K.emptyPath(),a,s.length),c=new Map;u.forEach(h=>{let d=Hb(o.serializer,h);c.set(d.key.toString(),d)});let l=[];return s.forEach(h=>{let d=c.get(h.toString());D(!!d),l.push(d)}),l})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new On(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return m(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=I.fromPath(r);this.mutations.push(new Eo(i,this.precondition(i)))}),yield function(r,i){return m(this,null,function*(){let s=T(r),o={writes:i.map(a=>bo(s.serializer,a))};yield s.Do("Commit",s.serializer.databaseId,K.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw C();t=V.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new y(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(V.min())?fe.exists(!1):fe.updateTime(t):fe.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(V.min()))throw new y(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return fe.updateTime(t)}return fe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Xf=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Za=r.maxAttempts,this.Jo=new xo(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Jo.Ko(()=>m(this,null,function*(){let e=new Jf(this.datastore),t=this.tu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.nu(i)}))}).catch(r=>{this.nu(r)})}))}tu(e){try{let t=this.updateFunction(e);return!Fo(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!mE(t)}return!1}};var Zf=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Te.UNAUTHENTICATED,this.clientId=Pu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>m(this,null,function*(){v("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(v("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ae;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Li(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Ru(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>m(this,null,function*(){r.isEqual(i)||(yield UE(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function ep(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Lp(n);v("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Iw(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Iw(e.remoteStore,i)),n._onlineComponents=e})}function nI(n){return n.name==="FirebaseError"?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function Lp(n){return m(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){v("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ru(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!nI(t))throw t;ht("Error using user provided cache. Falling back to memory cache: "+t),yield Ru(n,new Mo)}}else v("FirestoreClient","Using default OfflineComponentProvider"),yield Ru(n,new Mo);return n._offlineComponents})}function Rc(n){return m(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(v("FirestoreClient","Using user provided OnlineComponentProvider"),yield ep(n,n._uninitializedComponentsProvider._online)):(v("FirestoreClient","Using default OnlineComponentProvider"),yield ep(n,new ko))),n._onlineComponents})}function rI(n){return Lp(n).then(e=>e.persistence)}function Up(n){return Lp(n).then(e=>e.localStore)}function iI(n){return Rc(n).then(e=>e.remoteStore)}function jp(n){return Rc(n).then(e=>e.syncEngine)}function $R(n){return Rc(n).then(e=>e.datastore)}function xi(n){return m(this,null,function*(){let e=yield Rc(n),t=e.eventManager;return t.onListen=TR.bind(null,e.syncEngine),t.onUnlisten=CR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=AR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=SR.bind(null,e.syncEngine),t})}function zR(n){return n.asyncQueue.enqueue(()=>m(this,null,function*(){let e=yield rI(n),t=yield iI(n);return e.setNetworkEnabled(!0),function(i){let s=T(i);return s.M_.delete(0),qo(s)}(t)}))}function GR(n){return n.asyncQueue.enqueue(()=>m(this,null,function*(){let e=yield rI(n),t=yield iI(n);return e.setNetworkEnabled(!1),function(i){return m(this,null,function*(){let s=T(i);s.M_.add(0),yield Ni(s),s.N_.set("Offline")})}(t)}))}function KR(n,e){let t=new Ae;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s,o){return m(this,null,function*(){try{let a=yield function(c,l){let h=T(c);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new y(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=Li(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield Up(n),e,t)})),t.promise}function sI(n,e,t={}){let r=new Ae;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(s,o,a,u,c){let l=new Pi({next:d=>{o.enqueueAndForget(()=>xp(s,h));let f=d.docs.has(a);!f&&d.fromCache?c.reject(new y(g.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&u&&u.source==="server"?c.reject(new y(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Vo(ki(a.path),l,{includeMetadataChanges:!0,ra:!0});return Pp(s,h)}(yield xi(n),n.asyncQueue,e,t,r)})),r.promise}function HR(n,e){let t=new Ae;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s,o){return m(this,null,function*(){try{let a=yield nc(i,s,!0),u=new pc(s,a.ls),c=u.da(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){let u=Li(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield Up(n),e,t)})),t.promise}function oI(n,e,t={}){let r=new Ae;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(s,o,a,u,c){let l=new Pi({next:d=>{o.enqueueAndForget(()=>xp(s,h)),d.fromCache&&u.source==="server"?c.reject(new y(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Vo(a,l,{includeMetadataChanges:!0,ra:!0});return Pp(s,h)}(yield xi(n),n.asyncQueue,e,t,r)})),r.promise}function WR(n,e){let t=new Pi(e);return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s){T(i).z_.add(s),s.next()}(yield xi(n),t)})),()=>{t.$a(),n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s){T(i).z_.delete(s)}(yield xi(n),t)}))}}function QR(n,e,t,r){let i=function(o,a){let u;return u=typeof o=="string"?vE().encode(o):o,function(l,h){return new Yf(l,h)}(function(l,h){if(l instanceof Uint8Array)return Sw(l,h);if(l instanceof ArrayBuffer)return Sw(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,Bo(e));n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){qR(yield jp(n),i,r)}))}function YR(n,e){return n.asyncQueue.enqueue(()=>m(this,null,function*(){return function(r,i){let s=T(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Kr.getNamedQuery(o,i))}(yield Up(n),e)}))}function aI(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var bw=new Map;function Bp(n,e,t){if(!t)throw new y(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function qp(n,e,t,r){if(e===!0&&r===!0)throw new y(g.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Rw(n){if(!I.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Dw(n){if(I.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Dc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":C()}function H(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new y(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Dc(n);throw new y(g.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function uI(n,e){if(e<=0)throw new y(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var mc=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new y(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new y(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}qp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=aI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},gr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new mc({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new mc(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new yd;switch(r.type){case"firstParty":return new Ed(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new y(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=bw.get(t);r&&(v("ComponentProvider","Removing Datastore"),bw.delete(t),r.terminate())}(this),Promise.resolve()}};function cI(n,e,t,r={}){var i;let s=(n=H(n,gr))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&ht("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=Te.MOCK_USER;else{a=fm(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new y(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Te(c)}n._authCredentials=new vd(new Du(a,u))}}var Oe=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ne=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new jt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},jt=class n extends Oe{constructor(e,t,r){super(e,t,ki(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ne(this.firestore,null,new I(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function $p(n,e,...t){if(n=ce(n),Bp("collection","path",e),n instanceof gr){let r=K.fromString(e,...t);return Dw(r),new jt(n,null,r)}{if(!(n instanceof ne||n instanceof jt))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(K.fromString(e,...t));return Dw(r),new jt(n.firestore,null,r)}}function lI(n,e){if(n=H(n,gr),Bp("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Oe(n,null,function(r){return new Tt(K.emptyPath(),r)}(e))}function $o(n,e,...t){if(n=ce(n),arguments.length===1&&(e=Pu.newId()),Bp("doc","path",e),n instanceof gr){let r=K.fromString(e,...t);return Rw(r),new ne(n,null,new I(r))}{if(!(n instanceof ne||n instanceof jt))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(K.fromString(e,...t));return Rw(r),new ne(n.firestore,n instanceof jt?n.converter:null,new I(r))}}function zp(n,e){return n=ce(n),e=ce(e),(n instanceof ne||n instanceof jt)&&(e instanceof ne||e instanceof jt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Gp(n,e){return n=ce(n),e=ce(e),n instanceof Oe&&e instanceof Oe&&n.firestore===e.firestore&&Uo(n._query,e._query)&&n.converter===e.converter}var tp=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new xo(this,"async_queue_retry"),this.hu=()=>{let t=bu();t&&v("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Jo.Uo()};let e=bu();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;let t=bu();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});let t=new Ae;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){return m(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Jo.reset()}catch(e){if(!Un(e))throw e;v("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Jo.Ko(()=>this.Tu())}})}Iu(e){let t=this.iu.then(()=>(this.uu=!0,e().catch(r=>{this.au=r,this.uu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw me("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.uu=!1,r))));return this.iu=t,t}enqueueAfterDelay(e,t,r){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);let i=Uf.createAndSchedule(this,e,t,r,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&C()}verifyOperationInProgress(){}du(){return m(this,null,function*(){let e;do e=this.iu,yield e;while(e!==this.iu)})}Au(e){for(let t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this._u)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){let t=this._u.indexOf(e);this._u.splice(t,1)}};function np(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var rp=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ae,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var hI=-1,oe=class extends gr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new tp}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||dI(this),this._firestoreClient.terminate()}};function Se(n){return n._firestoreClient||dI(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function dI(n){var e,t,r;let i=n._freezeSettings(),s=function(a,u,c,l){return new Dd(a,u,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,aI(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Zf(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function fI(n,e){II(n=H(n,oe));let t=Se(n);if(t._uninitializedComponentsProvider)throw new y(g.FAILED_PRECONDITION,"SDK cache is already specified.");ht("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new ko;return gI(t,i,new gc(i,r.cacheSizeBytes,e?.forceOwnership))}function pI(n){II(n=H(n,oe));let e=Se(n);if(e._uninitializedComponentsProvider)throw new y(g.FAILED_PRECONDITION,"SDK cache is already specified.");ht("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new ko;return gI(e,r,new Qf(r,t.cacheSizeBytes))}function gI(n,e,t){let r=new Ae;return n.asyncQueue.enqueue(()=>m(this,null,function*(){try{yield Ru(n,t),yield ep(n,e),r.resolve()}catch(i){let s=i;if(!nI(s))throw s;ht("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function mI(n){if(n._initialized&&!n._terminated)throw new y(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Ae;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{yield function(r){return m(this,null,function*(){if(!Dn.D())return Promise.resolve();let i=r+"main";yield Dn.delete(i)})}(Sp(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function yI(n){return function(t){let r=new Ae;return t.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return xR(yield jp(t),r)})),r.promise}(Se(n=H(n,oe)))}function vI(n){return zR(Se(n=H(n,oe)))}function _I(n){return GR(Se(n=H(n,oe)))}function wI(n,e){let t=Se(n=H(n,oe)),r=new rp;return QR(t,n._databaseId,e,r),r}function EI(n,e){return YR(Se(n=H(n,oe)),e).then(t=>t?new Oe(n,null,t.query):null)}function II(n){if(n._initialized||n._terminated)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var zt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ve.fromBase64String(e))}catch(t){throw new y(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ve.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Ct=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new y(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ye(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var rn=class{constructor(e){this._methodName=e}};var mr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new y(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new y(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return F(this._lat,e._lat)||F(this._long,e._long)}};var JR=/^__.*__$/,ip=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new At(e,this.data,this.fieldMask,t,this.fieldTransforms):new Nn(e,this.data,t,this.fieldTransforms)}},yc=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new At(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function TI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw C()}}var vc=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.wu(e),i}Su(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return _c(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(e.length===0)throw this.Du("Document fields must not be empty");if(TI(this.fu)&&JR.test(e))throw this.Du('Document fields cannot begin and end with "__"')}},sp=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Bo(e)}Fu(e,t,r,i=!1){return new vc({fu:e,methodName:t,vu:r,path:ye.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function wr(n){let e=n._freezeSettings(),t=Bo(n._databaseId);return new sp(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Pc(n,e,t,r,i,s={}){let o=n.Fu(s.merge||s.mergeFields?2:0,e,t,i);Wp("Data must be an object, but it was:",o,r);let a=SI(r,o),u,c;if(s.merge)u=new rt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let h of s.mergeFields){let d=lp(e,h,t);if(!o.contains(d))throw new y(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);RI(l,d)||l.push(d)}u=new rt(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new ip(new Be(a),u,c)}var No=class n extends rn{_toFieldTransform(e){if(e.fu!==2)throw e.fu===1?e.Du(`${this._methodName}() can only appear at the top level of your update data`):e.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function AI(n,e,t){return new vc({fu:3,vu:e.settings.vu,methodName:n._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var op=class n extends rn{_toFieldTransform(e){return new dr(e.path,new Mn)}isEqual(e){return e instanceof n}},ap=class n extends rn{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=AI(this,e,!0),r=this.Mu.map(s=>Er(s,t)),i=new tn(r);return new dr(e.path,i)}isEqual(e){return e instanceof n&&ol(this.Mu,e.Mu)}},up=class n extends rn{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=AI(this,e,!0),r=this.Mu.map(s=>Er(s,t)),i=new nn(r);return new dr(e.path,i)}isEqual(e){return e instanceof n&&ol(this.Mu,e.Mu)}},cp=class n extends rn{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){let t=new kn(e.serializer,cE(e.serializer,this.xu));return new dr(e.path,t)}isEqual(e){return e instanceof n&&this.xu===e.xu}};function Kp(n,e,t,r){let i=n.Fu(1,e,t);Wp("Data must be an object, but it was:",i,r);let s=[],o=Be.empty();_r(r,(u,c)=>{let l=Qp(e,u,t);c=ce(c);let h=i.Su(l);if(c instanceof No)s.push(l);else{let d=Er(c,h);d!=null&&(s.push(l),o.set(l,d))}});let a=new rt(s);return new yc(o,a,i.fieldTransforms)}function Hp(n,e,t,r,i,s){let o=n.Fu(1,e,t),a=[lp(e,r,t)],u=[i];if(s.length%2!=0)throw new y(g.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(lp(e,s[d])),u.push(s[d+1]);let c=[],l=Be.empty();for(let d=a.length-1;d>=0;--d)if(!RI(c,a[d])){let f=a[d],E=u[d];E=ce(E);let w=o.Su(f);if(E instanceof No)c.push(f);else{let _=Er(E,w);_!=null&&(c.push(f),l.set(f,_))}}let h=new rt(c);return new yc(l,h,o.fieldTransforms)}function CI(n,e,t,r=!1){return Er(t,n.Fu(r?4:3,e))}function Er(n,e){if(bI(n=ce(n)))return Wp("Unsupported field value:",e,n),SI(n,e);if(n instanceof rn)return function(r,i){if(!TI(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.yu&&e.fu!==4)throw e.Du("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=Er(a,i.bu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ce(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return cE(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=le.fromDate(r);return{timestampValue:Ii(i.serializer,s)}}if(r instanceof le){let s=new le(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ii(i.serializer,s)}}if(r instanceof mr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof zt)return{bytesValue:_E(i.serializer,r._byteString)};if(r instanceof ne){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Du(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Tp(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${Dc(r)}`)}(n,e)}function SI(n,e){let t={};return Gw(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):_r(n,(r,i)=>{let s=Er(i,e.pu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function bI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof le||n instanceof mr||n instanceof zt||n instanceof ne||n instanceof rn)}function Wp(n,e,t){if(!bI(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=Dc(t);throw r==="an object"?e.Du(n+" a custom object"):e.Du(n+" "+r)}}function lp(n,e,t){if((e=ce(e))instanceof Ct)return e._internalPath;if(typeof e=="string")return Qp(n,e);throw _c("Field path arguments must be of type string or ",n,!1,void 0,t)}var XR=new RegExp("[~\\*/\\[\\]]");function Qp(n,e,t){if(e.search(XR)>=0)throw _c(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ct(...e.split("."))._internalPath}catch{throw _c(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function _c(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new y(g.INVALID_ARGUMENT,a+n+u)}function RI(n,e){return n.some(t=>t.isEqual(e))}var yr=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ne(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new hp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(xc("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},hp=class extends yr{data(){return super.data()}};function xc(n,e){return typeof e=="string"?Qp(n,e):e instanceof Ct?e._internalPath:e._delegate._internalPath}function DI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new y(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Oo=class{},vr=class extends Oo{};function an(n,e,...t){let r=[];e instanceof Oo&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof dp).length,a=s.filter(u=>u instanceof wc).length;if(o>1||o>0&&a>0)throw new y(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var wc=class n extends vr{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return UI(e._query,t),new Oe(e.firestore,e.converter,qd(e._query,t))}_parse(e){let t=wr(e.firestore);return function(s,o,a,u,c,l,h){let d;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new y(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){xw(h,l);let f=[];for(let E of h)f.push(Pw(u,s,E));d={arrayValue:{values:f}}}else d=Pw(u,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||xw(h,l),d=CI(a,o,h,l==="in"||l==="not-in");return $.create(c,l,d)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function PI(n,e,t){let r=e,i=xc("where",n);return wc._create(i,r,t)}var dp=class n extends Oo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:X.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)UI(o,u),o=qd(o,u)}(e._query,t),new Oe(e.firestore,e.converter,qd(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var fp=class n extends vr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new lr(s,o)}(e._query,this._field,this._direction);return new Oe(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Tt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function xI(n,e="asc"){let t=e,r=xc("orderBy",n);return fp._create(r,t)}var Ec=class n extends vr{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Oe(e.firestore,e.converter,ju(e._query,this._limit,this._limitType))}};function VI(n){return uI("limit",n),Ec._create("limit",n,"F")}function MI(n){return uI("limitToLast",n),Ec._create("limitToLast",n,"L")}var Ic=class n extends vr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=LI(e,this.type,this._docOrFields,this._inclusive);return new Oe(e.firestore,e.converter,function(i,s){return new Tt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function kI(...n){return Ic._create("startAt",n,!0)}function NI(...n){return Ic._create("startAfter",n,!1)}var Tc=class n extends vr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=LI(e,this.type,this._docOrFields,this._inclusive);return new Oe(e.firestore,e.converter,function(i,s){return new Tt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function OI(...n){return Tc._create("endBefore",n,!1)}function FI(...n){return Tc._create("endAt",n,!0)}function LI(n,e,t,r){if(t[0]=ce(t[0]),t[0]instanceof yr)return function(s,o,a,u,c){if(!u)throw new y(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let h of pi(s))if(h.field.isKeyField())l.push(cr(o,u.key));else{let d=u.data.field(h.field);if(Cc(d))throw new y(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){let f=h.field.canonicalString();throw new y(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}l.push(d)}return new qt(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=wr(n.firestore);return function(o,a,u,c,l,h){let d=o.explicitOrderBy;if(l.length>d.length)throw new y(g.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let f=[];for(let E=0;E<l.length;E++){let w=l[E];if(d[E].field.isKeyField()){if(typeof w!="string")throw new y(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof w}`);if(!Ep(o)&&w.indexOf("/")!==-1)throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${w}' contains a slash.`);let _=o.path.child(K.fromString(w));if(!I.isDocumentKey(_))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${_}' is not because it contains an odd number of segments.`);let x=new I(_);f.push(cr(a,x))}else{let _=CI(u,c,w);f.push(_)}}return new qt(f,h)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Pw(n,e,t){if(typeof(t=ce(t))=="string"){if(t==="")throw new y(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ep(e)&&t.indexOf("/")!==-1)throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(K.fromString(t));if(!I.isDocumentKey(r))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return cr(n,new I(r))}if(t instanceof ne)return cr(n,t._key);throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Dc(t)}.`)}function xw(n,e){if(!Array.isArray(n)||n.length===0)throw new y(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function UI(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new y(g.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new y(g.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Vi=class{convertValue(e,t="none"){switch(ur(e)){case 0:return null;case 1:return e.booleanValue;case 2:return de(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Pn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw C()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return _r(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new mr(de(e.latitude),de(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=_p(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(vo(e));default:return null}}convertTimestamp(e){let t=en(e);return new le(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=K.fromString(e);D(PE(r));let i=new xn(r.get(1),r.get(3)),s=new I(r.popFirst(5));return i.isEqual(t)||me(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Vc(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var pp=class extends Vi{constructor(e){super(),this.firestore=e}convertBytes(e){return new zt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ne(this.firestore,null,t)}};var Zt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},ft=class extends yr{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new bn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(xc("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},bn=class extends ft{data(e={}){return super.data(e)}},St=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Zt(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new bn(this._firestore,this._userDataWriter,r.key,r,new Zt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new y(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new bn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Zt(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new bn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Zt(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,l=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:ZR(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function ZR(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return C()}}function Yp(n,e){return n instanceof ft&&e instanceof ft?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof St&&e instanceof St&&n._firestore===e._firestore&&Gp(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function jI(n){n=H(n,ne);let e=H(n.firestore,oe);return sI(Se(e),n._key).then(t=>eg(e,n,t))}var sn=class extends Vi{constructor(e){super(),this.firestore=e}convertBytes(e){return new zt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ne(this.firestore,null,t)}};function BI(n){n=H(n,ne);let e=H(n.firestore,oe),t=Se(e),r=new sn(e);return KR(t,n._key).then(i=>new ft(e,r,n._key,i,new Zt(i!==null&&i.hasLocalMutations,!0),n.converter))}function qI(n){n=H(n,ne);let e=H(n.firestore,oe);return sI(Se(e),n._key,{source:"server"}).then(t=>eg(e,n,t))}function $I(n){n=H(n,Oe);let e=H(n.firestore,oe),t=Se(e),r=new sn(e);return DI(n._query),oI(t,n._query).then(i=>new St(e,r,n,i))}function zI(n){n=H(n,Oe);let e=H(n.firestore,oe),t=Se(e),r=new sn(e);return HR(t,n._query).then(i=>new St(e,r,n,i))}function GI(n){n=H(n,Oe);let e=H(n.firestore,oe),t=Se(e),r=new sn(e);return oI(t,n._query,{source:"server"}).then(i=>new St(e,r,n,i))}function Jp(n,e,t){n=H(n,ne);let r=H(n.firestore,oe),i=Vc(n.converter,e,t);return Ui(r,[Pc(wr(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,fe.none())])}function Xp(n,e,t,...r){n=H(n,ne);let i=H(n.firestore,oe),s=wr(i),o;return o=typeof(e=ce(e))=="string"||e instanceof Ct?Hp(s,"updateDoc",n._key,e,t,r):Kp(s,"updateDoc",n._key,e),Ui(i,[o.toMutation(n._key,fe.exists(!0))])}function KI(n){return Ui(H(n.firestore,oe),[new On(n._key,fe.none())])}function HI(n,e){let t=H(n.firestore,oe),r=$o(n),i=Vc(n.converter,e);return Ui(t,[Pc(wr(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,fe.exists(!1))]).then(()=>r)}function Zp(n,...e){var t,r,i;n=ce(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||np(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(np(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let u,c,l;if(n instanceof ne)c=H(n.firestore,oe),l=ki(n._key.path),u={next:h=>{e[o]&&e[o](eg(c,n,h))},error:e[o+1],complete:e[o+2]};else{let h=H(n,Oe);c=H(h.firestore,oe),l=h._query;let d=new sn(c);u={next:f=>{e[o]&&e[o](new St(c,d,h,f))},error:e[o+1],complete:e[o+2]},DI(n._query)}return function(d,f,E,w){let _=new Pi(w),x=new Vo(f,_,E);return d.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return Pp(yield xi(d),x)})),()=>{_.$a(),d.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return xp(yield xi(d),x)}))}}(Se(c),l,a,u)}function WI(n,e){return WR(Se(n=H(n,oe)),np(e)?e:{next:e})}function Ui(n,e){return function(r,i){let s=new Ae;return r.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return bR(yield jp(r),i,s)})),s.promise}(Se(n),e)}function eg(n,e,t){let r=t.docs.get(e._key),i=new sn(n);return new ft(n,i,e._key,r,new Zt(t.hasPendingWrites,t.fromCache),e.converter)}var eD={maxAttempts:5};var Ac=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=wr(e)}set(e,t,r){this._verifyNotCommitted();let i=Cn(e,this._firestore),s=Vc(i.converter,t,r),o=Pc(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,fe.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Cn(e,this._firestore),o;return o=typeof(t=ce(t))=="string"||t instanceof Ct?Hp(this._dataReader,"WriteBatch.update",s._key,t,r,i):Kp(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,fe.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Cn(e,this._firestore);return this._mutations=this._mutations.concat(new On(t._key,fe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Cn(n,e){if((n=ce(n)).firestore!==e)throw new y(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var gp=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=wr(t)}get(t){let r=Cn(t,this._firestore),i=new pp(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return C();let o=s[0];if(o.isFoundDocument())return new yr(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new yr(this._firestore,i,r._key,null,r.converter);throw C()})}set(t,r,i){let s=Cn(t,this._firestore),o=Vc(s.converter,r,i),a=Pc(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=Cn(t,this._firestore),a;return a=typeof(r=ce(r))=="string"||r instanceof Ct?Hp(this._dataReader,"Transaction.update",o._key,r,i,s):Kp(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=Cn(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Cn(e,this._firestore),r=new sn(this._firestore);return super.get(e).then(i=>new ft(this._firestore,r,t._key,i._document,new Zt(!1,!1),t.converter))}};function QI(n,e,t){n=H(n,oe);let r=Object.assign(Object.assign({},eD),t);return function(s){if(s.maxAttempts<1)throw new y(g.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new Ae;return s.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let c=yield $R(s);new Xf(s.asyncQueue,c,a,o,u).Xa()})),u.promise}(Se(n),i=>e(new gp(n,i)),r)}function YI(){return new No("deleteField")}function JI(){return new op("serverTimestamp")}function XI(...n){return new ap("arrayUnion",n)}function ZI(...n){return new up("arrayRemove",n)}function e0(n){return new cp("increment",n)}(function(e,t=!0){(function(i){Mi=i})(mm),is(new zn("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new oe(new _d(r.getProvider("auth-internal")),new Td(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new y(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xn(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),fn(V_,"4.6.1",e),fn(V_,"4.6.1","esm2017")})();var tD="@firebase/firestore-compat",nD="0.3.30";function og(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function t0(){if(typeof Uint8Array>"u")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function n0(){if(!Kw())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Mc=class n{constructor(e){this._delegate=e}static fromBase64String(e){return n0(),new n(zt.fromBase64String(e))}static fromUint8Array(e){return t0(),new n(zt.fromUint8Array(e))}toBase64(){return n0(),this._delegate.toBase64()}toUint8Array(){return t0(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function tg(n){return rD(n,["next","error","complete"])}function rD(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var ng=class{enableIndexedDbPersistence(e,t){return fI(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return pI(e._delegate)}clearIndexedDbPersistence(e){return mI(e._delegate)}},kc=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof xn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&ht("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){cI(this._delegate,e,t,r)}enableNetwork(){return vI(this._delegate)}disableNetwork(){return _I(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,qp("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return yI(this._delegate)}onSnapshotsInSync(e){return WI(this._delegate,e)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new qi(this,$p(this._delegate,e))}catch(t){throw Ke(t,"collection()","Firestore.collection()")}}doc(e){try{return new Gt(this,$o(this._delegate,e))}catch(t){throw Ke(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Cr(this,lI(this._delegate,e))}catch(t){throw Ke(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return QI(this._delegate,t=>e(new Nc(this,t)))}batch(){return Se(this._delegate),new Oc(new Ac(this._delegate,e=>Ui(this._delegate,e)))}loadBundle(e){return wI(this._delegate,e)}namedQuery(e){return EI(this._delegate,e).then(t=>t?new Cr(this,t):null)}},ji=class extends Vi{constructor(e){super(),this.firestore=e}convertBytes(e){return new Mc(new zt(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Gt.forKey(t,this.firestore,null)}};function iD(n){Vw(n)}var Nc=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ji(e)}get(e){let t=Ir(e);return this._delegate.get(t).then(r=>new Tr(this._firestore,new ft(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Ir(e);return r?(og("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Ir(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Ir(e);return this._delegate.delete(t),this}},Oc=class{constructor(e){this._delegate=e}set(e,t,r){let i=Ir(e);return r?(og("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Ir(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Ir(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Bi=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new bn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Ar(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new ji(e),t),i.set(t,s)),s}};Bi.INSTANCES=new WeakMap;var Gt=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ji(e)}static forPath(e,t,r){if(e.length%2!==0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new ne(t._delegate,r,new I(e)))}static forKey(e,t,r){return new n(t,new ne(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new qi(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new qi(this.firestore,$p(this._delegate,e))}catch(t){throw Ke(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ce(e),e instanceof ne?zp(this._delegate,e):!1}set(e,t){t=og("DocumentReference.set",t);try{return t?Jp(this._delegate,e,t):Jp(this._delegate,e)}catch(r){throw Ke(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?Xp(this._delegate,e):Xp(this._delegate,e,t,...r)}catch(i){throw Ke(i,"updateDoc()","DocumentReference.update()")}}delete(){return KI(this._delegate)}onSnapshot(...e){let t=r0(e),r=i0(e,i=>new Tr(this.firestore,new ft(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Zp(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=BI(this._delegate):e?.source==="server"?t=qI(this._delegate):t=jI(this._delegate),t.then(r=>new Tr(this.firestore,new ft(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Bi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ke(n,e,t){return n.message=n.message.replace(e,t),n}function r0(n){for(let e of n)if(typeof e=="object"&&!tg(e))return e;return{}}function i0(n,e){var t,r;let i;return tg(n[0])?i=n[0]:tg(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Tr=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Gt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Yp(this._delegate,e._delegate)}},Ar=class extends Tr{data(e){let t=this._delegate.data(e);return this._delegate._converter||Mw(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Cr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ji(e)}where(e,t,r){try{return new n(this.firestore,an(this._delegate,PI(e,t,r)))}catch(i){throw Ke(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,an(this._delegate,xI(e,t)))}catch(r){throw Ke(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,an(this._delegate,VI(e)))}catch(t){throw Ke(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,an(this._delegate,MI(e)))}catch(t){throw Ke(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,an(this._delegate,kI(...e)))}catch(t){throw Ke(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,an(this._delegate,NI(...e)))}catch(t){throw Ke(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,an(this._delegate,OI(...e)))}catch(t){throw Ke(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,an(this._delegate,FI(...e)))}catch(t){throw Ke(t,"endAt()","Query.endAt()")}}isEqual(e){return Gp(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=zI(this._delegate):e?.source==="server"?t=GI(this._delegate):t=$I(this._delegate),t.then(r=>new zo(this.firestore,new St(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=r0(e),r=i0(e,i=>new zo(this.firestore,new St(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Zp(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Bi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},rg=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Ar(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},zo=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Cr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Ar(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new rg(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Ar(this._firestore,r))})}isEqual(e){return Yp(this._delegate,e._delegate)}},qi=class n extends Cr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Gt(this.firestore,e):null}doc(e){try{return e===void 0?new Gt(this.firestore,$o(this._delegate)):new Gt(this.firestore,$o(this._delegate,e))}catch(t){throw Ke(t,"doc()","CollectionReference.doc()")}}add(e){return HI(this._delegate,e).then(t=>new Gt(this.firestore,t))}isEqual(e){return zp(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Bi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ir(n){return H(n,ne)}var ig=class n{constructor(...e){this._delegate=new Ct(...e)}static documentId(){return new n(ye.keyField().canonicalString())}isEqual(e){return e=ce(e),e instanceof Ct?this._delegate._internalPath.isEqual(e._internalPath):!1}};var sg=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=JI();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=YI();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=XI(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=ZI(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=e0(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var sD={Firestore:kc,GeoPoint:mr,Timestamp:le,Blob:Mc,Transaction:Nc,WriteBatch:Oc,DocumentReference:Gt,DocumentSnapshot:Tr,Query:Cr,QueryDocumentSnapshot:Ar,QuerySnapshot:zo,CollectionReference:qi,FieldPath:ig,FieldValue:sg,setLogLevel:iD,CACHE_SIZE_UNLIMITED:hI};function oD(n,e){n.INTERNAL.registerComponent(new zn("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},sD)))}function aD(n){oD(n,(e,t)=>new kc(e,t,new ng)),n.registerVersion(tD,nD)}aD(Qe);function uD(n,e=Go){return new Sr(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function s0(n,e){return uD(n,e)}function cD(n,e){return s0(n,e).pipe(xr(void 0),Wo(),N(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function cg(n,e){return s0(n,e).pipe(N(t=>({payload:t,type:"query"})))}var Fc=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=u0(r,t);return new Uc(i,s,this.afs)}snapshotChanges(){return cD(this.ref,this.afs.schedulers.outsideAngular).pipe(Ye)}valueChanges(e={}){return this.snapshotChanges().pipe(N(({payload:t})=>e.idField?ee(S({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Z(this.ref.get(e)).pipe(Ye)}};function Lc(n,e){return cg(n,e).pipe(xr(void 0),Wo(),N(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{let c=s.find(h=>h.doc.ref.isEqual(a.ref)),l=r?.payload.docs.find(h=>h.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&l&&JSON.stringify(l.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function o0(n,e,t){return Lc(n,t).pipe(Pr((r,i)=>lD(r,i.map(s=>s.payload),e),[]),Eg(),N(r=>r.map(i=>({type:i.type,payload:i}))))}function lD(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=hD(n,r))}),n}function ag(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function hD(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return ag(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return ag(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return ag(n,e.oldIndex,1);break}return n}function a0(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Uc=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Lc(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(N(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(xr(void 0),Wo(),st(([r,i])=>i.length>0||!r),N(([,r])=>r),Ye)}auditTrail(e){return this.stateChanges(e).pipe(Pr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=a0(e);return o0(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ye)}valueChanges(e={}){return cg(this.query,this.afs.schedulers.outsideAngular).pipe(N(t=>t.payload.docs.map(r=>e.idField?ee(S({},r.data()),{[e.idField]:r.id}):r.data())),Ye)}get(e){return Z(this.query.get(e)).pipe(Ye)}add(e){return this.ref.add(e)}doc(e){return new Fc(this.ref.doc(e),this.afs)}},ug=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Lc(this.query,this.afs.schedulers.outsideAngular).pipe(Ye):Lc(this.query,this.afs.schedulers.outsideAngular).pipe(N(t=>t.filter(r=>e.indexOf(r.type)>-1)),st(t=>t.length>0),Ye)}auditTrail(e){return this.stateChanges(e).pipe(Pr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=a0(e);return o0(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ye)}valueChanges(e={}){return cg(this.query,this.afs.schedulers.outsideAngular).pipe(N(r=>r.payload.docs.map(i=>e.idField?S({[e.idField]:i.id},i.data()):i.data())),Ye)}get(e){return Z(this.query.get(e)).pipe(Ye)}},dD=new q("angularfire2.enableFirestorePersistence"),fD=new q("angularfire2.firestore.persistenceSettings"),pD=new q("angularfire2.firestore.settings"),gD=new q("angularfire2.firestore.use-emulator");function u0(n,e=t=>t){return{query:e(n),ref:n}}var $i=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,u,c,l,h,d,f,E,w,_,x,O){this.schedulers=u;let b=Ms(t,a,r),j=l;h&&Eh(b,a,d,E,w,_,f,x),[this.firestore,this.persistenceEnabled$]=$a(`${b.name}.firestore`,"AngularFirestore",b.name,()=>{let B=a.runOutsideAngular(()=>b.firestore());if(s&&B.settings(s),j&&B.useEmulator(...j),i&&!$n(o)){let W=()=>{try{return Z(B.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(_e){return typeof console<"u"&&console.warn(_e),P(!1)}};return[B,a.runOutsideAngular(W)]}else return[B,P(!1)]},[s,j,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=u0(i,r),a=this.schedulers.ngZone.run(()=>s);return new Uc(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new ug(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new Fc(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(R(Qr),R(Yr,8),R(dD,8),R(pD,8),R(mt),R(ge),R(ja),R(fD,8),R(gD,8),R(Ih,8),R(gh,8),R(mh,8),R(yh,8),R(vh,8),R(_h,8),R(wh,8),R(Wn,8))};static \u0275prov=z({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var jc=(()=>{let e=class e{constructor(r){this.firestore=r}setCollection(r){this.collection=this.firestore.collection(r)}getDocuments(){if(!this.collection)throw new Error("Collection path not set.");return this.collection.snapshotChanges().pipe(N(r=>r.map(i=>{let s=i.payload.doc.data(),o=i.payload.doc.id;return ee(S({},s),{id:o})})),pt(r=>{throw console.error("Error obtaining data from Firestore:",r),r}))}addDocument(r){return Z(this.collection.add(r)).pipe(pe(i=>this.collection.doc(i.id).valueChanges()))}updateDocument(r,i){return Z(this.collection.doc(r).update(i)).pipe(pt(s=>{throw console.error("Error updating document in Firestore:",s),s}))}deleteDocument(r){return Z(this.collection.doc(r).delete()).pipe(pt(i=>{throw console.error("Error deleting document from Firestore:",i),i}))}getDocumentById(r){return this.collection.doc(r).get().pipe(pe(i=>{if(i.exists){let s=i.data();return P(s)}else return console.error("Document with provided ID does not exist:",r),P(void 0)}),pt(i=>{throw console.error("Error getting document by ID:",i),i}))}};e.\u0275fac=function(i){return new(i||e)(R($i))},e.\u0275prov=z({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var c0=(()=>{let e=class e{imageLoaded(){console.log("La imagen ha sido cargada.")}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Re({type:e,selectors:[["shared-image-perfil"]],decls:2,vars:0,consts:[[1,"flex","justify-center","mx-3","rounded-xl"],["src","https://firebasestorage.googleapis.com/v0/b/portfolio-549f8.appspot.com/o/portfolio%2Fperfil.jpeg?alt=media&token=5913f7c4-163a-4e4e-8663-977507603d90","alt","Profile Picture",1,"w-16","sm:w-56","md:w-48","lg:w-64","h-auto","rounded-xl","object-cover",3,"load"]],template:function(i,s){i&1&&(se(0,"div",0)(1,"img",1),Ht("load",function(){return s.imageLoaded()}),ue()())},styles:["[_nghost-%COMP%]{display:block}"]});let n=e;return n})();var l0=(()=>{let e=class e{constructor(){this.description=""}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Re({type:e,selectors:[["share-descriptions"]],inputs:{description:"description"},decls:2,vars:1,consts:[[1,"text-slate-300","text-md","mx-4","mt-2","text-center"]],template:function(i,s){i&1&&(se(0,"p",0),at(1),ue()),i&2&&(we(),Wt(" ",s.description,`
`))}});let n=e;return n})();var h0=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Re({type:e,selectors:[["shared-title"]],inputs:{name:"name",university_title:"university_title"},decls:4,vars:2,consts:[[1,"text-center","font-bold","text-2xl","mt-4","mx-3"],[1,"text-center","font-semibold","text-xl","mt-1","mx-3"]],template:function(i,s){i&1&&(se(0,"p",0),at(1),ue(),se(2,"p",1),at(3),ue()),i&2&&(we(),Wt(" ",s.name,`
`),we(2),Wt(" ",s.university_title,`
`))}});let n=e;return n})();var d0=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Re({type:e,selectors:[["shared-social-networks"]],decls:6,vars:0,consts:[[1,"flex","justify-center"],[1,"flex","space-x-16"],["href","https://github.com/maxpoblete2905","target","_blank",1,"hover:text-blue-500","transition","duration-300","transform","hover:scale-110"],["src","https://firebasestorage.googleapis.com/v0/b/portfolio-549f8.appspot.com/o/portfolio%2Fgithub.png?alt=media&token=d64c46a0-e694-466c-8adb-24df0abe4f2c","alt","img-codepen",1,"w-8","h-8"],["href","https://www.linkedin.com/in/max-esteban-poblete-pizarro-9979811bb/","target","_blank",1,"hover:text-blue-500","transition","duration-300","transform","hover:scale-110"],["src","https://firebasestorage.googleapis.com/v0/b/portfolio-549f8.appspot.com/o/portfolio%2Flinkedin.png?alt=media&token=e7220f70-edfa-4b1c-855d-5c68c95dd0d0","alt","img-codepen",1,"w-8","h-8"]],template:function(i,s){i&1&&(se(0,"div",0)(1,"div",1)(2,"a",2),ot(3,"img",3),ue(),se(4,"a",4),ot(5,"img",5),ue()()())}});let n=e;return n})();function wD(n,e){if(n&1&&(se(0,"li",5),ot(1,"i"),se(2,"p",6),at(3),ue()()),n&2){let t=e.$implicit;yt("routerLink",t.route),we(),qg("mr-2 ",t.icon,""),we(2),Wt(" ",t.name," ")}}function ED(n,e){if(n&1&&(se(0,"li",7),ot(1,"i"),ue()),n&2){let t=e.$implicit;yt("routerLink",t.route),we(),Bg(t.icon)}}var f0=(()=>{let e=class e{constructor(){this.images=["assets/perfil.jpeg","assets/perfil.jpeg","assets/perfil.jpeg"],this.sections=[{route:"projects",name:"Proyectos",icon:"fas fa-code"},{route:"skills",name:"Habilidades",icon:"fas fa-pencil-alt"},{route:"education",name:"Educaci\xF3n",icon:"fas fa-graduation-cap"},{route:"contact",name:"Contactos",icon:"fas fa-envelope"}]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Re({type:e,selectors:[["shared-menu"]],decls:5,vars:2,consts:[[1,"mx-3"],[1,"hidden","sm:flex","flex-col"],["routerLinkActive","text-blue-400","class","flex items-center cursor-pointer border-b-2 ml-4 mt-4",3,"routerLink",4,"ngFor","ngForOf"],[1,"sm:hidden","flex","justify-center","gap-5"],["routerLinkActive","text-blue-400","class","cursor-pointer ml-4 mt-4 flex",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","text-blue-400",1,"flex","items-center","cursor-pointer","border-b-2","ml-4","mt-4",3,"routerLink"],[1,"text-lg"],["routerLinkActive","text-blue-400",1,"cursor-pointer","ml-4","mt-4","flex",3,"routerLink"]],template:function(i,s){i&1&&(se(0,"div",0)(1,"ul",1),Ji(2,wD,4,5,"li",2),ue(),se(3,"ul",3),Ji(4,ED,2,4,"li",4),ue()()),i&2&&(we(2),yt("ngForOf",s.sections),we(2),yt("ngForOf",s.sections))},dependencies:[ra,Ca,dy]});let n=e;return n})();var SV=(()=>{let e=class e{constructor(r){this.firestore=r,this.images=["assets/perfil.jpeg","assets/perfil.jpeg","assets/perfil.jpeg"],this.name="",this.description="",this.university_title="",this.update="",this.sections=[{route:"projects",name:"Proyectos",icon:"fas fa-code"},{route:"skills",name:"Habilidades",icon:"fas fa-pencil-alt"},{route:"experience",name:"Experiencia",icon:"fas fa-briefcase"},{route:"education",name:"Educaci\xF3n",icon:"fas fa-graduation-cap"},{route:"contact",name:"Contactos",icon:"fas fa-envelope"}],this.firestoreService=new jc(this.firestore),this.firestoreService.setCollection("personal-information")}ngOnInit(){this.firestoreService.getDocuments().subscribe({next:r=>{this.name=r[0].name.toUpperCase(),this.description=r[0].description,this.university_title=r[0].university_title,this.update=r[0].update},error:r=>{console.error("Error loading projects:",r)}})}};e.\u0275fac=function(i){return new(i||e)(Q($i))},e.\u0275cmp=Re({type:e,selectors:[["shared-sidebar"]],decls:6,vars:3,consts:[[1,"flex","flex-col","sm:min-h-screen","sm:h-56","lg:h-full","pb-3"],[3,"name","university_title"],[3,"description"],[1,"hidden","md:block","mt-auto"]],template:function(i,s){i&1&&(se(0,"div",0),ot(1,"shared-title",1)(2,"shared-image-perfil")(3,"share-descriptions",2)(4,"shared-menu")(5,"shared-social-networks",3),ue()),i&2&&(we(),yt("name",s.name)("university_title",s.university_title),we(2),yt("description",s.description))},dependencies:[c0,l0,h0,d0,f0]});let n=e;return n})();var RV=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Re({type:e,selectors:[["shared-head"]],inputs:{title:"title"},decls:4,vars:1,consts:[[1,"background-class","py-4","m-3","mt-0","rounded-b-xl","text-center","sticky","top-0","z-10"],[1,"mx-auto","items-center"],[1,"text-lg","font-semibold","text-center"]],template:function(i,s){i&1&&(se(0,"header",0)(1,"div",1)(2,"p",2),at(3),ue()()()),i&2&&(we(3),Wg(s.title.toUpperCase()))}});let n=e;return n})();function TD(n,e){if(n&1){let t=$g();se(0,"div",3),Ht("click",function(){let i=bg(t).$implicit,s=zg();return Rg(s.realizarAccion(i.label,i.value))}),ot(1,"img",4),se(2,"span"),at(3),ue()()}if(n&2){let t=e.$implicit;we(),yt("src",t.icon,Vg),we(2),Wt("",t.value," ")}}var MV=(()=>{let e=class e{constructor(r){this.firestore=r,this.personalInformation=[],this.firestoreService=new jc(this.firestore),this.firestoreService.setCollection("contact-Information")}ngOnInit(){this.firestoreService.getDocuments().subscribe({next:r=>{this.personalInformation=r},error:r=>{console.error("Error loading projects:",r)}})}realizarAccion(r,i){switch(r){case"phone":window.location.href=`tel:+${i}`;break;case"whatsapp":window.open("https://web.whatsapp.com/","_blank");break;case"email":window.location.href=`mailto:${i}`;break}}};e.\u0275fac=function(i){return new(i||e)(Q($i))},e.\u0275cmp=Re({type:e,selectors:[["shared-contact-information"]],decls:4,vars:1,consts:[[1,"bg-blue-950","shadow-lg","rounded-lg","p-6","mb-5"],[1,"text-xl","font-semibold","mb-4"],["class","flex items-center mb-4 cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"flex","items-center","mb-4","cursor-pointer",3,"click"],["alt","",1,"h-8","w-8","mr-5",3,"src"]],template:function(i,s){i&1&&(se(0,"div",0)(1,"h2",1),at(2,"Informaci\xF3n de Contacto"),ue(),Ji(3,TD,4,2,"div",2),ue()),i&2&&(we(3),yt("ngForOf",s.personalInformation))},dependencies:[ra]});let n=e;return n})();var iM=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=We({type:e}),e.\u0275inj=He({imports:[ia,my,Wy]});let n=e;return n})();export{vm as a,HD as b,WD as c,Hn as d,hT as e,Qt as f,Ca as g,my as h,Ix as i,Fx as j,$i as k,jc as l,RV as m,Ry as n,yy as o,PP as p,xP as q,MP as r,mC as s,vC as t,EC as u,kP as v,Wy as w,MV as x,SV as y,iM as z};
