import{b as th,c as eh,d as nh,e as ch,f as lh,g as Ot,h as hh,i as dh,j as fh,l as mh,m as gh,n as ph,o as yh,p as _h,q as wh,r as vh,s as Ih,t as Eh,v as Lt,w as Th}from"./chunk-5QGJRSSB.js";import{d as Jl,e as Xl,f as Zl,g as Qi,i as Ho}from"./chunk-S3TLFR22.js";import{c as rh,d as Rr,e as Yo,f as ih,g as sh,i as Jo,j as tt,k as Wi,l as Jt,m as oh,n as ah,o as uh,q as Xo,r as Zo}from"./chunk-EE22SPCH.js";import{$a as fe,Aa as Rn,E as Gl,Ga as Kl,Hb as xn,Ib as Hl,J as Bi,K as Ui,Kb as Yl,M as ji,N as Ar,Na as $e,Pa as ct,Qa as $l,Ra as Ki,Sa as k,T as Gi,Ta as N,U as Sr,Ua as X,W as Pr,Wa as $i,Y as ut,_a as G,ab as Qe,c as Ul,ca as Dt,cb as Ql,da as br,db as Wl,h as jl,m as de,n as bn,r as Nt,ta as zl,wa as zi,y as Wo,z as Tr,za as W}from"./chunk-CPNZBFNH.js";import{a as Pn,b as Er,e as Qo,f as p}from"./chunk-CQCHLVVT.js";var Sh=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=Dt({type:t,selectors:[["portfolio-layout-page"]],decls:9,vars:0,consts:[[1,"grid","grid-cols-1","sm:grid-cols-12","h-screen"],[1,"sm:col-span-3","p-0","h-full","flex","flex-col"],[1,"text-center","font-bold","text-3xl","mt-4","mb-3"],[1,"flex-grow"],[1,"sm:col-span-9","p-0","h-full","bg-slate-300","text-white"]],template:function(i,s){i&1&&(k(0,"div",0)(1,"div",1)(2,"p",2),G(3,"MAX POBLETE"),N(),X(4,"shared-image-perfil")(5,"share-descriptions")(6,"shared-sidebar",3),N(),k(7,"div",4),X(8,"router-outlet"),N()())},dependencies:[Xl,th,eh,nh]});let n=t;return n})();var Fp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Kt={},T,Ia=Ia||{},C=Fp||self;function us(n){var t=typeof n;return t=t!="object"?t:n?Array.isArray(n)?"array":t:"null",t=="array"||t=="object"&&typeof n.length=="number"}function jr(n){var t=typeof n;return t=="object"&&n!=null||t=="function"}function Mp(n){return Object.prototype.hasOwnProperty.call(n,ta)&&n[ta]||(n[ta]=++Op)}var ta="closure_uid_"+(1e9*Math.random()>>>0),Op=0;function Lp(n,t,e){return n.call.apply(n.bind,arguments)}function qp(n,t,e){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(t,i)}}return function(){return n.apply(t,arguments)}}function Tt(n,t,e){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Tt=Lp:Tt=qp,Tt.apply(null,arguments)}function Hi(n,t){var e=Array.prototype.slice.call(arguments,1);return function(){var r=e.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function yt(n,t){function e(){}e.prototype=t.prototype,n.$=t.prototype,n.prototype=new e,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return t.prototype[i].apply(r,o)}}function Pe(){this.s=this.s,this.o=this.o}var Bp=0;Pe.prototype.s=!1;Pe.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),Bp!=0)&&Mp(this)};Pe.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Lh=Array.prototype.indexOf?function(n,t){return Array.prototype.indexOf.call(n,t,void 0)}:function(n,t){if(typeof n=="string")return typeof t!="string"||t.length!=1?-1:n.indexOf(t,0);for(let e=0;e<n.length;e++)if(e in n&&n[e]===t)return e;return-1};function Ea(n){let t=n.length;if(0<t){let e=Array(t);for(let r=0;r<t;r++)e[r]=n[r];return e}return[]}function Ph(n,t){for(let e=1;e<arguments.length;e++){let r=arguments[e];if(us(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function At(n,t){this.type=n,this.g=this.target=t,this.defaultPrevented=!1}At.prototype.h=function(){this.defaultPrevented=!0};var Up=function(){if(!C.addEventListener||!Object.defineProperty)return!1;var n=!1,t=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let e=()=>{};C.addEventListener("test",e,t),C.removeEventListener("test",e,t)}catch{}return n}();function kr(n){return/^[\s\xa0]*$/.test(n)}function cs(){var n=C.navigator;return n&&(n=n.userAgent)?n:""}function Zt(n){return cs().indexOf(n)!=-1}function Ta(n){return Ta[" "](n),n}Ta[" "]=function(){};function jp(n,t){var e=Cy;return Object.prototype.hasOwnProperty.call(e,n)?e[n]:e[n]=t(n)}var Gp=Zt("Opera"),Nn=Zt("Trident")||Zt("MSIE"),qh=Zt("Edge"),sa=qh||Nn,Bh=Zt("Gecko")&&!(cs().toLowerCase().indexOf("webkit")!=-1&&!Zt("Edge"))&&!(Zt("Trident")||Zt("MSIE"))&&!Zt("Edge"),zp=cs().toLowerCase().indexOf("webkit")!=-1&&!Zt("Edge");function Uh(){var n=C.document;return n?n.documentMode:void 0}var oa;t:{if(Yi="",Ji=function(){var n=cs();if(Bh)return/rv:([^\);]+)(\)|;)/.exec(n);if(qh)return/Edge\/([\d\.]+)/.exec(n);if(Nn)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(zp)return/WebKit\/(\S+)/.exec(n);if(Gp)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),Ji&&(Yi=Ji?Ji[1]:""),Nn&&(Xi=Uh(),Xi!=null&&Xi>parseFloat(Yi))){oa=String(Xi);break t}oa=Yi}var Yi,Ji,Xi,aa;C.document&&Nn?(ea=Uh(),aa=ea||parseInt(oa,10)||void 0):aa=void 0;var ea,Kp=aa;function Fr(n,t){if(At.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var e=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=t,t=n.relatedTarget){if(Bh){t:{try{Ta(t.nodeName);var i=!0;break t}catch{}i=!1}i||(t=null)}}else e=="mouseover"?t=n.fromElement:e=="mouseout"&&(t=n.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:$p[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Fr.$.h.call(this)}}yt(Fr,At);var $p={2:"touch",3:"pen",4:"mouse"};Fr.prototype.h=function(){Fr.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Gr="closure_listenable_"+(1e6*Math.random()|0),Qp=0;function Wp(n,t,e,r,i){this.listener=n,this.proxy=null,this.src=t,this.type=e,this.capture=!!r,this.la=i,this.key=++Qp,this.fa=this.ia=!1}function ls(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Aa(n,t,e){for(let r in n)t.call(e,n[r],r,n)}function Hp(n,t){for(let e in n)t.call(void 0,n[e],e,n)}function jh(n){let t={};for(let e in n)t[e]=n[e];return t}var bh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Gh(n,t){let e,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(e in r)n[e]=r[e];for(let s=0;s<bh.length;s++)e=bh[s],Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}}function hs(n){this.src=n,this.g={},this.h=0}hs.prototype.add=function(n,t,e,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=ca(n,t,r,i);return-1<o?(t=n[o],e||(t.ia=!1)):(t=new Wp(t,this.src,s,!!r,i),t.ia=e,n.push(t)),t};function ua(n,t){var e=t.type;if(e in n.g){var r=n.g[e],i=Lh(r,t),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(ls(t),n.g[e].length==0&&(delete n.g[e],n.h--))}}function ca(n,t,e,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==t&&s.capture==!!e&&s.la==r)return i}return-1}var Sa="closure_lm_"+(1e6*Math.random()|0),na={};function zh(n,t,e,r,i){if(r&&r.once)return $h(n,t,e,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)zh(n,t[s],e,r,i);return null}return e=Ra(e),n&&n[Gr]?n.O(t,e,jr(r)?!!r.capture:!!r,i):Kh(n,t,e,!1,r,i)}function Kh(n,t,e,r,i,s){if(!t)throw Error("Invalid event type");var o=jr(i)?!!i.capture:!!i,a=ba(n);if(a||(n[Sa]=a=new hs(n)),e=a.add(t,e,r,o,s),e.proxy)return e;if(r=Yp(),e.proxy=r,r.src=n,r.listener=e,n.addEventListener)Up||(i=o),i===void 0&&(i=!1),n.addEventListener(t.toString(),r,i);else if(n.attachEvent)n.attachEvent(Wh(t.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return e}function Yp(){function n(e){return t.call(n.src,n.listener,e)}let t=Jp;return n}function $h(n,t,e,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)$h(n,t[s],e,r,i);return null}return e=Ra(e),n&&n[Gr]?n.P(t,e,jr(r)?!!r.capture:!!r,i):Kh(n,t,e,!0,r,i)}function Qh(n,t,e,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Qh(n,t[s],e,r,i);else r=jr(r)?!!r.capture:!!r,e=Ra(e),n&&n[Gr]?(n=n.i,t=String(t).toString(),t in n.g&&(s=n.g[t],e=ca(s,e,r,i),-1<e&&(ls(s[e]),Array.prototype.splice.call(s,e,1),s.length==0&&(delete n.g[t],n.h--)))):n&&(n=ba(n))&&(t=n.g[t.toString()],n=-1,t&&(n=ca(t,e,r,i)),(e=-1<n?t[n]:null)&&Pa(e))}function Pa(n){if(typeof n!="number"&&n&&!n.fa){var t=n.src;if(t&&t[Gr])ua(t.i,n);else{var e=n.type,r=n.proxy;t.removeEventListener?t.removeEventListener(e,r,n.capture):t.detachEvent?t.detachEvent(Wh(e),r):t.addListener&&t.removeListener&&t.removeListener(r),(e=ba(t))?(ua(e,n),e.h==0&&(e.src=null,t[Sa]=null)):ls(n)}}}function Wh(n){return n in na?na[n]:na[n]="on"+n}function Jp(n,t){if(n.fa)n=!0;else{t=new Fr(t,this);var e=n.listener,r=n.la||n.src;n.ia&&Pa(n),n=e.call(r,t)}return n}function ba(n){return n=n[Sa],n instanceof hs?n:null}var ra="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ra(n){return typeof n=="function"?n:(n[ra]||(n[ra]=function(t){return n.handleEvent(t)}),n[ra])}function pt(){Pe.call(this),this.i=new hs(this),this.S=this,this.J=null}yt(pt,Pe);pt.prototype[Gr]=!0;pt.prototype.removeEventListener=function(n,t,e,r){Qh(this,n,t,e,r)};function It(n,t){var e,r=n.J;if(r)for(e=[];r;r=r.J)e.push(r);if(n=n.S,r=t.type||t,typeof t=="string")t=new At(t,n);else if(t instanceof At)t.target=t.target||n;else{var i=t;t=new At(r,n),Gh(t,i)}if(i=!0,e)for(var s=e.length-1;0<=s;s--){var o=t.g=e[s];i=Zi(o,r,!0,t)&&i}if(o=t.g=n,i=Zi(o,r,!0,t)&&i,i=Zi(o,r,!1,t)&&i,e)for(s=0;s<e.length;s++)o=t.g=e[s],i=Zi(o,r,!1,t)&&i}pt.prototype.N=function(){if(pt.$.N.call(this),this.i){var n=this.i,t;for(t in n.g){for(var e=n.g[t],r=0;r<e.length;r++)ls(e[r]);delete n.g[t],n.h--}}this.J=null};pt.prototype.O=function(n,t,e,r){return this.i.add(String(n),t,!1,e,r)};pt.prototype.P=function(n,t,e,r){return this.i.add(String(n),t,!0,e,r)};function Zi(n,t,e,r){if(t=n.i.g[String(t)],!t)return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==e){var a=o.listener,u=o.la||o.src;o.ia&&ua(n.i,o),i=a.call(u,r)!==!1&&i}}return i&&!r.defaultPrevented}var xa=C.JSON.stringify,la=class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}};function Xp(){var n=Ca;let t=null;return n.g&&(t=n.g,n.g=n.g.next,n.g||(n.h=null),t.next=null),t}var ha=class{constructor(){this.h=this.g=null}add(t,e){let r=Hh.get();r.set(t,e),this.h?this.h.next=r:this.g=r,this.h=r}},Hh=new la(()=>new da,n=>n.reset()),da=class{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}};function Zp(n){var t=1;n=n.split(":");let e=[];for(;0<t&&n.length;)e.push(n.shift()),t--;return n.length&&e.push(n.join(":")),e}function ty(n){C.setTimeout(()=>{throw n},0)}var Mr,Or=!1,Ca=new ha,Yh=()=>{let n=C.Promise.resolve(void 0);Mr=()=>{n.then(ey)}},ey=()=>{for(var n;n=Xp();){try{n.h.call(n.g)}catch(e){ty(e)}var t=Hh;t.j(n),100>t.h&&(t.h++,n.next=t.g,t.g=n)}Or=!1};function ds(n,t){pt.call(this),this.h=n||1,this.g=t||C,this.j=Tt(this.qb,this),this.l=Date.now()}yt(ds,pt);T=ds.prototype;T.ga=!1;T.T=null;T.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),It(this,"tick"),this.ga&&(Da(this),this.start()))}};T.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Da(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}T.N=function(){ds.$.N.call(this),Da(this),delete this.g};function Va(n,t,e){if(typeof n=="function")e&&(n=Tt(n,e));else if(n&&typeof n.handleEvent=="function")n=Tt(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:C.setTimeout(n,t||0)}function Jh(n){n.g=Va(()=>{n.g=null,n.i&&(n.i=!1,Jh(n))},n.j);let t=n.h;n.h=null,n.m.apply(null,t)}var fa=class extends Pe{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Jh(this)}N(){super.N(),this.g&&(C.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Lr(n){Pe.call(this),this.h=n,this.g={}}yt(Lr,Pe);var Rh=[];function Xh(n,t,e,r){Array.isArray(e)||(e&&(Rh[0]=e.toString()),e=Rh);for(var i=0;i<e.length;i++){var s=zh(t,e[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Zh(n){Aa(n.g,function(t,e){this.g.hasOwnProperty(e)&&Pa(t)},n),n.g={}}Lr.prototype.N=function(){Lr.$.N.call(this),Zh(this)};Lr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function fs(){this.g=!0}fs.prototype.Ea=function(){this.g=!1};function ny(n,t,e,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+c+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+`
`+e+`
`+o})}function ry(n,t,e,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+`
`+e+`
`+s+" "+o})}function Dn(n,t,e,r){n.info(function(){return"XMLHTTP TEXT ("+t+"): "+sy(n,e)+(r?" "+r:"")})}function iy(n,t){n.info(function(){return"TIMEOUT: "+t})}fs.prototype.info=function(){};function sy(n,t){if(!n.g)return t;if(!t)return null;try{var e=JSON.parse(t);if(e){for(n=0;n<e.length;n++)if(Array.isArray(e[n])){var r=e[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return xa(e)}catch{return t}}var Je={},xh=null;function ms(){return xh=xh||new pt}Je.Ta="serverreachability";function td(n){At.call(this,Je.Ta,n)}yt(td,At);function qr(n){let t=ms();It(t,new td(t))}Je.STAT_EVENT="statevent";function ed(n,t){At.call(this,Je.STAT_EVENT,n),this.stat=t}yt(ed,At);function bt(n){let t=ms();It(t,new ed(t,n))}Je.Ua="timingevent";function nd(n,t){At.call(this,Je.Ua,n),this.size=t}yt(nd,At);function zr(n,t){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return C.setTimeout(function(){n()},t)}var gs={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},rd={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Na(){}Na.prototype.h=null;function Ch(n){return n.h||(n.h=n.i())}function id(){}var Kr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ka(){At.call(this,"d")}yt(ka,At);function Fa(){At.call(this,"c")}yt(Fa,At);var ma;function ps(){}yt(ps,Na);ps.prototype.g=function(){return new XMLHttpRequest};ps.prototype.i=function(){return{}};ma=new ps;function $r(n,t,e,r){this.l=n,this.j=t,this.m=e,this.W=r||1,this.U=new Lr(this),this.P=oy,n=sa?125:void 0,this.V=new ds(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new sd}function sd(){this.i=null,this.g="",this.h=!1}var oy=45e3,od={},ga={};T=$r.prototype;T.setTimeout=function(n){this.P=n};function pa(n,t,e){n.L=1,n.A=_s(ge(t)),n.u=e,n.S=!0,ad(n,null)}function ad(n,t){n.G=Date.now(),Qr(n),n.B=ge(n.A);var e=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),gd(e.i,"t",r),n.o=0,e=n.l.J,n.h=new sd,n.g=Md(n.l,e?t:null,!n.u),0<n.O&&(n.M=new fa(Tt(n.Pa,n,n.g),n.O)),Xh(n.U,n.g,"readystatechange",n.nb),t=n.I?jh(n.I):{},n.u?(n.v||(n.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,t)):(n.v="GET",n.g.ha(n.B,n.v,null,t)),qr(),ny(n.j,n.v,n.B,n.m,n.W,n.u)}T.nb=function(n){n=n.target;let t=this.M;t&&te(n)==3?t.l():this.Pa(n)};T.Pa=function(n){try{if(n==this.g)t:{let l=te(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||sa||this.g&&(this.h.h||this.g.ja()||kh(this.g)))){this.J||l!=4||t==7||(t==8||0>=h?qr(3):qr(2)),ys(this);var e=this.g.da();this.ca=e;e:if(ud(this)){var r=kh(this.g);n="";var i=r.length,s=te(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){We(this),Nr(this);var o="";break e}this.h.i=new C.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,n+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=e==200,ry(this.j,this.v,this.B,this.m,this.W,l,e),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!kr(a)){var c=a;break e}}c=null}if(e=c)Dn(this.j,this.m,e,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ya(this,e);else{this.i=!1,this.s=3,bt(12),We(this),Nr(this);break t}}this.S?(cd(this,l,o),sa&&this.i&&l==3&&(Xh(this.U,this.V,"tick",this.mb),this.V.start())):(Dn(this.j,this.m,o,null),ya(this,o)),l==4&&We(this),this.i&&!this.J&&(l==4?Vd(this.l,this):(this.i=!1,Qr(this)))}else by(this.g),e==400&&0<o.indexOf("Unknown SID")?(this.s=3,bt(12)):(this.s=0,bt(13)),We(this),Nr(this)}}}catch{}finally{}};function ud(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function cd(n,t,e){let r=!0,i;for(;!n.J&&n.o<e.length;)if(i=ay(n,e),i==ga){t==4&&(n.s=4,bt(14),r=!1),Dn(n.j,n.m,null,"[Incomplete Response]");break}else if(i==od){n.s=4,bt(15),Dn(n.j,n.m,e,"[Invalid Chunk]"),r=!1;break}else Dn(n.j,n.m,i,null),ya(n,i);ud(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),t!=4||e.length!=0||n.h.h||(n.s=1,bt(16),r=!1),n.i=n.i&&r,r?0<e.length&&!n.ba&&(n.ba=!0,t=n.l,t.g==n&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+e.length),Ua(t),t.M=!0,bt(11))):(Dn(n.j,n.m,e,"[Invalid Chunked Response]"),We(n),Nr(n))}T.mb=function(){if(this.g){var n=te(this.g),t=this.g.ja();this.o<t.length&&(ys(this),cd(this,n,t),this.i&&n!=4&&Qr(this))}};function ay(n,t){var e=n.o,r=t.indexOf(`
`,e);return r==-1?ga:(e=Number(t.substring(e,r)),isNaN(e)?od:(r+=1,r+e>t.length?ga:(t=t.slice(r,r+e),n.o=r+e,t)))}T.cancel=function(){this.J=!0,We(this)};function Qr(n){n.Y=Date.now()+n.P,ld(n,n.P)}function ld(n,t){if(n.C!=null)throw Error("WatchDog timer not null");n.C=zr(Tt(n.lb,n),t)}function ys(n){n.C&&(C.clearTimeout(n.C),n.C=null)}T.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(iy(this.j,this.B),this.L!=2&&(qr(),bt(17)),We(this),this.s=2,Nr(this)):ld(this,this.Y-n)};function Nr(n){n.l.H==0||n.J||Vd(n.l,n)}function We(n){ys(n);var t=n.M;t&&typeof t.sa=="function"&&t.sa(),n.M=null,Da(n.V),Zh(n.U),n.g&&(t=n.g,n.g=null,t.abort(),t.sa())}function ya(n,t){try{var e=n.l;if(e.H!=0&&(e.g==n||_a(e.i,n))){if(!n.K&&_a(e.i,n)&&e.H==3){try{var r=e.Ja.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){t:if(!e.u){if(e.g)if(e.g.G+3e3<n.G)is(e),Is(e);else break t;Ba(e),bt(18)}}else e.Fa=i[1],0<e.Fa-e.V&&37500>i[2]&&e.G&&e.A==0&&!e.v&&(e.v=zr(Tt(e.ib,e),6e3));if(1>=_d(e.i)&&e.oa){try{e.oa()}catch{}e.oa=void 0}}else He(e,11)}else if((n.K||e.g==n)&&is(e),!kr(t))for(i=e.Ja.g.parse(t),t=0;t<i.length;t++){let c=i[t];if(e.V=c[0],c=c[1],e.H==2)if(c[0]=="c"){e.K=c[1],e.pa=c[2];let l=c[3];l!=null&&(e.ra=l,e.l.info("VER="+e.ra));let h=c[4];h!=null&&(e.Ga=h,e.l.info("SVER="+e.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,e.L=r,e.l.info("backChannelRequestTimeoutMs_="+r)),r=e;let m=n.g;if(m){let A=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(A){var s=r.i;s.g||A.indexOf("spdy")==-1&&A.indexOf("quic")==-1&&A.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Ma(s,s.h),s.h=null))}if(r.F){let w=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;w&&(r.Da=w,H(r.I,r.F,w))}}e.H=3,e.h&&e.h.Ba(),e.ca&&(e.S=Date.now()-n.G,e.l.info("Handshake RTT: "+e.S+"ms")),r=e;var o=n;if(r.wa=Fd(r,r.J?r.pa:null,r.Y),o.K){wd(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(ys(a),Qr(a)),r.g=o}else Cd(r);0<e.j.length&&Es(e)}else c[0]!="stop"&&c[0]!="close"||He(e,7);else e.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?He(e,7):qa(e):c[0]!="noop"&&e.h&&e.h.Aa(c),e.A=0)}}qr(4)}catch{}}function uy(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(us(n)){for(var t=[],e=n.length,r=0;r<e;r++)t.push(n[r]);return t}t=[],e=0;for(r in n)t[e++]=n[r];return t}function cy(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(us(n)||typeof n=="string"){var t=[];n=n.length;for(var e=0;e<n;e++)t.push(e);return t}t=[],e=0;for(let r in n)t[e++]=r;return t}}}function hd(n,t){if(n.forEach&&typeof n.forEach=="function")n.forEach(t,void 0);else if(us(n)||typeof n=="string")Array.prototype.forEach.call(n,t,void 0);else for(var e=cy(n),r=uy(n),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],e&&e[s],n)}var dd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ly(n,t){if(n){n=n.split("&");for(var e=0;e<n.length;e++){var r=n[e].indexOf("="),i=null;if(0<=r){var s=n[e].substring(0,r);i=n[e].substring(r+1)}else s=n[e];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Ye(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Ye){this.h=n.h,ns(this,n.j),this.s=n.s,this.g=n.g,rs(this,n.m),this.l=n.l;var t=n.i,e=new Br;e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),Dh(this,e),this.o=n.o}else n&&(t=String(n).match(dd))?(this.h=!1,ns(this,t[1]||"",!0),this.s=Dr(t[2]||""),this.g=Dr(t[3]||"",!0),rs(this,t[4]),this.l=Dr(t[5]||"",!0),Dh(this,t[6]||"",!0),this.o=Dr(t[7]||"")):(this.h=!1,this.i=new Br(null,this.h))}Ye.prototype.toString=function(){var n=[],t=this.j;t&&n.push(Vr(t,Vh,!0),":");var e=this.g;return(e||t=="file")&&(n.push("//"),(t=this.s)&&n.push(Vr(t,Vh,!0),"@"),n.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e=this.m,e!=null&&n.push(":",String(e))),(e=this.l)&&(this.g&&e.charAt(0)!="/"&&n.push("/"),n.push(Vr(e,e.charAt(0)=="/"?fy:dy,!0))),(e=this.i.toString())&&n.push("?",e),(e=this.o)&&n.push("#",Vr(e,gy)),n.join("")};function ge(n){return new Ye(n)}function ns(n,t,e){n.j=e?Dr(t,!0):t,n.j&&(n.j=n.j.replace(/:$/,""))}function rs(n,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);n.m=t}else n.m=null}function Dh(n,t,e){t instanceof Br?(n.i=t,py(n.i,n.h)):(e||(t=Vr(t,my)),n.i=new Br(t,n.h))}function H(n,t,e){n.i.set(t,e)}function _s(n){return H(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Dr(n,t){return n?t?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Vr(n,t,e){return typeof n=="string"?(n=encodeURI(n).replace(t,hy),e&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function hy(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var Vh=/[#\/\?@]/g,dy=/[#\?:]/g,fy=/[#\?]/g,my=/[#\?@]/g,gy=/#/g;function Br(n,t){this.h=this.g=null,this.i=n||null,this.j=!!t}function be(n){n.g||(n.g=new Map,n.h=0,n.i&&ly(n.i,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}T=Br.prototype;T.add=function(n,t){be(this),this.i=null,n=kn(this,n);var e=this.g.get(n);return e||this.g.set(n,e=[]),e.push(t),this.h+=1,this};function fd(n,t){be(n),t=kn(n,t),n.g.has(t)&&(n.i=null,n.h-=n.g.get(t).length,n.g.delete(t))}function md(n,t){return be(n),t=kn(n,t),n.g.has(t)}T.forEach=function(n,t){be(this),this.g.forEach(function(e,r){e.forEach(function(i){n.call(t,i,r,this)},this)},this)};T.ta=function(){be(this);let n=Array.from(this.g.values()),t=Array.from(this.g.keys()),e=[];for(let r=0;r<t.length;r++){let i=n[r];for(let s=0;s<i.length;s++)e.push(t[r])}return e};T.Z=function(n){be(this);let t=[];if(typeof n=="string")md(this,n)&&(t=t.concat(this.g.get(kn(this,n))));else{n=Array.from(this.g.values());for(let e=0;e<n.length;e++)t=t.concat(n[e])}return t};T.set=function(n,t){return be(this),this.i=null,n=kn(this,n),md(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[t]),this.h+=1,this};T.get=function(n,t){return n?(n=this.Z(n),0<n.length?String(n[0]):t):t};function gd(n,t,e){fd(n,t),0<e.length&&(n.i=null,n.g.set(kn(n,t),Ea(e)),n.h+=e.length)}T.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],t=Array.from(this.g.keys());for(var e=0;e<t.length;e++){var r=t[e];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function kn(n,t){return t=String(t),n.j&&(t=t.toLowerCase()),t}function py(n,t){t&&!n.j&&(be(n),n.i=null,n.g.forEach(function(e,r){var i=r.toLowerCase();r!=i&&(fd(this,r),gd(this,i,e))},n)),n.j=t}var yy=class{constructor(n,t){this.g=n,this.map=t}};function pd(n){this.l=n||_y,C.PerformanceNavigationTiming?(n=C.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(C.g&&C.g.Ka&&C.g.Ka()&&C.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var _y=10;function yd(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function _d(n){return n.h?1:n.g?n.g.size:0}function _a(n,t){return n.h?n.h==t:n.g?n.g.has(t):!1}function Ma(n,t){n.g?n.g.add(t):n.h=t}function wd(n,t){n.h&&n.h==t?n.h=null:n.g&&n.g.has(t)&&n.g.delete(t)}pd.prototype.cancel=function(){if(this.i=vd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function vd(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let t=n.i;for(let e of n.g.values())t=t.concat(e.F);return t}return Ea(n.i)}var wy=class{stringify(n){return C.JSON.stringify(n,void 0)}parse(n){return C.JSON.parse(n,void 0)}};function vy(){this.g=new wy}function Iy(n,t,e){let r=e||"";try{hd(n,function(i,s){let o=i;jr(i)&&(o=xa(i)),t.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Ey(n,t){let e=new fs;if(C.Image){let r=new Image;r.onload=Hi(ts,e,r,"TestLoadImage: loaded",!0,t),r.onerror=Hi(ts,e,r,"TestLoadImage: error",!1,t),r.onabort=Hi(ts,e,r,"TestLoadImage: abort",!1,t),r.ontimeout=Hi(ts,e,r,"TestLoadImage: timeout",!1,t),C.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else t(!1)}function ts(n,t,e,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function Wr(n){this.l=n.ec||null,this.j=n.ob||!1}yt(Wr,Na);Wr.prototype.g=function(){return new ws(this.l,this.j)};Wr.prototype.i=function(n){return function(){return n}}({});function ws(n,t){pt.call(this),this.F=n,this.u=t,this.m=void 0,this.readyState=Oa,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}yt(ws,pt);var Oa=0;T=ws.prototype;T.open=function(n,t){if(this.readyState!=Oa)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=t,this.readyState=1,Ur(this)};T.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(t.body=n),(this.F||C).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))};T.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Hr(this)),this.readyState=Oa};T.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Ur(this)),this.g&&(this.readyState=3,Ur(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof C.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Id(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function Id(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}T.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var t=n.value?n.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!n.done}))&&(this.response=this.responseText+=t)}n.done?Hr(this):Ur(this),this.readyState==3&&Id(this)}};T.Za=function(n){this.g&&(this.response=this.responseText=n,Hr(this))};T.Ya=function(n){this.g&&(this.response=n,Hr(this))};T.ka=function(){this.g&&Hr(this)};function Hr(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Ur(n)}T.setRequestHeader=function(n,t){this.v.append(n,t)};T.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};T.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],t=this.h.entries();for(var e=t.next();!e.done;)e=e.value,n.push(e[0]+": "+e[1]),e=t.next();return n.join(`\r
`)};function Ur(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(ws.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var Ty=C.JSON.parse;function et(n){pt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Ed,this.L=this.M=!1}yt(et,pt);var Ed="",Ay=/^https?$/i,Sy=["POST","PUT"];T=et.prototype;T.Oa=function(n){this.M=n};T.ha=function(n,t,e,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);t=t?t.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ma.g(),this.C=this.u?Ch(this.u):Ch(ma),this.g.onreadystatechange=Tt(this.La,this);try{this.G=!0,this.g.open(t,String(n),!0),this.G=!1}catch(s){Nh(this,s);return}if(n=e||"",e=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)e.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())e.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(e.keys()).find(s=>s.toLowerCase()=="content-type"),i=C.FormData&&n instanceof C.FormData,!(0<=Lh(Sy,t))||r||i||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of e)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Sd(this),0<this.B&&((this.L=Py(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Tt(this.ua,this)):this.A=Va(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Nh(this,s)}};function Py(n){return Nn&&typeof n.timeout=="number"&&n.ontimeout!==void 0}T.ua=function(){typeof Ia<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,It(this,"timeout"),this.abort(8))};function Nh(n,t){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=t,n.m=5,Td(n),vs(n)}function Td(n){n.F||(n.F=!0,It(n,"complete"),It(n,"error"))}T.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,It(this,"complete"),It(this,"abort"),vs(this))};T.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),vs(this,!0)),et.$.N.call(this)};T.La=function(){this.s||(this.G||this.v||this.l?Ad(this):this.kb())};T.kb=function(){Ad(this)};function Ad(n){if(n.h&&typeof Ia<"u"&&(!n.C[1]||te(n)!=4||n.da()!=2)){if(n.v&&te(n)==4)Va(n.La,0,n);else if(It(n,"readystatechange"),te(n)==4){n.h=!1;try{let o=n.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break t;default:t=!1}var e;if(!(e=t)){var r;if(r=o===0){var i=String(n.I).match(dd)[1]||null;!i&&C.self&&C.self.location&&(i=C.self.location.protocol.slice(0,-1)),r=!Ay.test(i?i.toLowerCase():"")}e=r}if(e)It(n,"complete"),It(n,"success");else{n.m=6;try{var s=2<te(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Td(n)}}finally{vs(n)}}}}function vs(n,t){if(n.g){Sd(n);let e=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,t||It(n,"ready");try{e.onreadystatechange=r}catch{}}}function Sd(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(C.clearTimeout(n.A),n.A=null)}T.isActive=function(){return!!this.g};function te(n){return n.g?n.g.readyState:0}T.da=function(){try{return 2<te(this)?this.g.status:-1}catch{return-1}};T.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};T.Wa=function(n){if(this.g){var t=this.g.responseText;return n&&t.indexOf(n)==0&&(t=t.substring(n.length)),Ty(t)}};function kh(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Ed:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function by(n){let t={};n=(n.g&&2<=te(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(kr(n[r]))continue;var e=Zp(n[r]);let i=e[0];if(e=e[1],typeof e!="string")continue;e=e.trim();let s=t[i]||[];t[i]=s,s.push(e)}Hp(t,function(r){return r.join(", ")})}T.Ia=function(){return this.m};T.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Pd(n){let t="";return Aa(n,function(e,r){t+=r,t+=":",t+=e,t+=`\r
`}),t}function La(n,t,e){t:{for(r in e){var r=!1;break t}r=!0}r||(e=Pd(e),typeof n=="string"?e!=null&&encodeURIComponent(String(e)):H(n,t,e))}function xr(n,t,e){return e&&e.internalChannelParams&&e.internalChannelParams[n]||t}function bd(n){this.Ga=0,this.j=[],this.l=new fs,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=xr("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=xr("baseRetryDelayMs",5e3,n),this.hb=xr("retryDelaySeedMs",1e4,n),this.eb=xr("forwardChannelMaxRetries",2,n),this.xa=xr("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new pd(n&&n.concurrentRequestLimit),this.Ja=new vy,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}T=bd.prototype;T.ra=8;T.H=1;function qa(n){if(Rd(n),n.H==3){var t=n.W++,e=ge(n.I);if(H(e,"SID",n.K),H(e,"RID",t),H(e,"TYPE","terminate"),Yr(n,e),t=new $r(n,n.l,t),t.L=2,t.A=_s(ge(e)),e=!1,C.navigator&&C.navigator.sendBeacon)try{e=C.navigator.sendBeacon(t.A.toString(),"")}catch{}!e&&C.Image&&(new Image().src=t.A,e=!0),e||(t.g=Md(t.l,null),t.g.ha(t.A)),t.G=Date.now(),Qr(t)}kd(n)}function Is(n){n.g&&(Ua(n),n.g.cancel(),n.g=null)}function Rd(n){Is(n),n.u&&(C.clearTimeout(n.u),n.u=null),is(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&C.clearTimeout(n.m),n.m=null)}function Es(n){if(!yd(n.i)&&!n.m){n.m=!0;var t=n.Na;Mr||Yh(),Or||(Mr(),Or=!0),Ca.add(t,n),n.C=0}}function Ry(n,t){return _d(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=t.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=zr(Tt(n.Na,n,t),Nd(n,n.C)),n.C++,!0)}T.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new $r(this,this.l,n),s=this.s;if(this.U&&(s?(s=jh(s),Gh(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)t:{for(var t=0,e=0;e<this.j.length;e++){e:{var r=this.j[e];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break e}r=void 0}if(r===void 0)break;if(t+=r,4096<t){t=e;break t}if(t===4096||e===this.j.length-1){t=e+1;break t}}t=1e3}else t=1e3;t=xd(this,i,t),e=ge(this.I),H(e,"RID",n),H(e,"CVER",22),this.F&&H(e,"X-HTTP-Session-Id",this.F),Yr(this,e),s&&(this.O?t="headers="+encodeURIComponent(String(Pd(s)))+"&"+t:this.o&&La(e,this.o,s)),Ma(this.i,i),this.bb&&H(e,"TYPE","init"),this.P?(H(e,"$req",t),H(e,"SID","null"),i.aa=!0,pa(i,e,null)):pa(i,e,t),this.H=2}}else this.H==3&&(n?Fh(this,n):this.j.length==0||yd(this.i)||Fh(this))};function Fh(n,t){var e;t?e=t.m:e=n.W++;let r=ge(n.I);H(r,"SID",n.K),H(r,"RID",e),H(r,"AID",n.V),Yr(n,r),n.o&&n.s&&La(r,n.o,n.s),e=new $r(n,n.l,e,n.C+1),n.o===null&&(e.I=n.s),t&&(n.j=t.F.concat(n.j)),t=xd(n,e,1e3),e.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Ma(n.i,e),pa(e,r,t)}function Yr(n,t){n.na&&Aa(n.na,function(e,r){H(t,r,e)}),n.h&&hd({},function(e,r){H(t,r,e)})}function xd(n,t,e){e=Math.min(n.j.length,e);var r=n.h?Tt(n.h.Va,n.h,n):null;t:{var i=n.j;let s=-1;for(;;){let o=["count="+e];s==-1?0<e?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<e;u++){let c=i[u].g,l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{Iy(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break t}}}return n=n.j.splice(0,e),t.F=n,r}function Cd(n){if(!n.g&&!n.u){n.ba=1;var t=n.Ma;Mr||Yh(),Or||(Mr(),Or=!0),Ca.add(t,n),n.A=0}}function Ba(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=zr(Tt(n.Ma,n),Nd(n,n.A)),n.A++,!0)}T.Ma=function(){if(this.u=null,Dd(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=zr(Tt(this.jb,this),n)}};T.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,bt(10),Is(this),Dd(this))};function Ua(n){n.B!=null&&(C.clearTimeout(n.B),n.B=null)}function Dd(n){n.g=new $r(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var t=ge(n.wa);H(t,"RID","rpc"),H(t,"SID",n.K),H(t,"AID",n.V),H(t,"CI",n.G?"0":"1"),!n.G&&n.qa&&H(t,"TO",n.qa),H(t,"TYPE","xmlhttp"),Yr(n,t),n.o&&n.s&&La(t,n.o,n.s),n.L&&n.g.setTimeout(n.L);var e=n.g;n=n.pa,e.L=1,e.A=_s(ge(t)),e.u=null,e.S=!0,ad(e,n)}T.ib=function(){this.v!=null&&(this.v=null,Is(this),Ba(this),bt(19))};function is(n){n.v!=null&&(C.clearTimeout(n.v),n.v=null)}function Vd(n,t){var e=null;if(n.g==t){is(n),Ua(n),n.g=null;var r=2}else if(_a(n.i,t))e=t.F,wd(n.i,t),r=1;else return;if(n.H!=0){if(t.i)if(r==1){e=t.u?t.u.length:0,t=Date.now()-t.G;var i=n.C;r=ms(),It(r,new nd(r,e)),Es(n)}else Cd(n);else if(i=t.s,i==3||i==0&&0<t.ca||!(r==1&&Ry(n,t)||r==2&&Ba(n)))switch(e&&0<e.length&&(t=n.i,t.i=t.i.concat(e)),i){case 1:He(n,5);break;case 4:He(n,10);break;case 3:He(n,6);break;default:He(n,2)}}}function Nd(n,t){let e=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(e*=2),e*t}function He(n,t){if(n.l.info("Error code "+t),t==2){var e=null;n.h&&(e=null);var r=Tt(n.pb,n);e||(e=new Ye("//www.google.com/images/cleardot.gif"),C.location&&C.location.protocol=="http"||ns(e,"https"),_s(e)),Ey(e.toString(),r)}else bt(2);n.H=0,n.h&&n.h.za(t),kd(n),Rd(n)}T.pb=function(n){n?(this.l.info("Successfully pinged google.com"),bt(2)):(this.l.info("Failed to ping google.com"),bt(1))};function kd(n){if(n.H=0,n.ma=[],n.h){let t=vd(n.i);(t.length!=0||n.j.length!=0)&&(Ph(n.ma,t),Ph(n.ma,n.j),n.i.i.length=0,Ea(n.j),n.j.length=0),n.h.ya()}}function Fd(n,t,e){var r=e instanceof Ye?ge(e):new Ye(e);if(r.g!="")t&&(r.g=t+"."+r.g),rs(r,r.m);else{var i=C.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new Ye(null);r&&ns(s,r),t&&(s.g=t),i&&rs(s,i),e&&(s.l=e),r=s}return e=n.F,t=n.Da,e&&t&&H(r,e,t),H(r,"VER",n.ra),Yr(n,r),r}function Md(n,t,e){if(t&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return t=n.Ha&&!n.va?new et(new Wr({ob:e})):new et(n.va),t.Oa(n.J),t}T.isActive=function(){return!!this.h&&this.h.isActive(this)};function Od(){}T=Od.prototype;T.Ba=function(){};T.Aa=function(){};T.za=function(){};T.ya=function(){};T.isActive=function(){return!0};T.Va=function(){};function ss(){if(Nn&&!(10<=Number(Kp)))throw Error("Environmental error: no available transport.")}ss.prototype.g=function(n,t){return new kt(n,t)};function kt(n,t){pt.call(this),this.g=new bd(t),this.l=n,this.h=t&&t.messageUrlParams||null,n=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(n?n["X-WebChannel-Content-Type"]=t.messageContentType:n={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(n?n["X-WebChannel-Client-Profile"]=t.Ca:n={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=n,(n=t&&t.cc)&&!kr(n)&&(this.g.o=n),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!kr(t)&&(this.g.F=t,n=this.h,n!==null&&t in n&&(n=this.h,t in n&&delete n[t])),this.j=new Fn(this)}yt(kt,pt);kt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,t=this.l,e=this.h||void 0;bt(0),n.Y=t,n.na=e||{},n.G=n.aa,n.I=Fd(n,null,n.Y),Es(n)};kt.prototype.close=function(){qa(this.g)};kt.prototype.u=function(n){var t=this.g;if(typeof n=="string"){var e={};e.__data__=n,n=e}else this.v&&(e={},e.__data__=xa(n),n=e);t.j.push(new yy(t.fb++,n)),t.H==3&&Es(t)};kt.prototype.N=function(){this.g.h=null,delete this.j,qa(this.g),delete this.g,kt.$.N.call(this)};function Ld(n){ka.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var t=n.__sm__;if(t){t:{for(let e in t){n=e;break t}n=void 0}(this.i=n)&&(n=this.i,t=t!==null&&n in t?t[n]:void 0),this.data=t}else this.data=n}yt(Ld,ka);function qd(){Fa.call(this),this.status=1}yt(qd,Fa);function Fn(n){this.g=n}yt(Fn,Od);Fn.prototype.Ba=function(){It(this.g,"a")};Fn.prototype.Aa=function(n){It(this.g,new Ld(n))};Fn.prototype.za=function(n){It(this.g,new qd)};Fn.prototype.ya=function(){It(this.g,"b")};function xy(){this.blockSize=-1}function zt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}yt(zt,xy);zt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function ia(n,t,e){e||(e=0);var r=Array(16);if(typeof t=="string")for(var i=0;16>i;++i)r[i]=t.charCodeAt(e++)|t.charCodeAt(e++)<<8|t.charCodeAt(e++)<<16|t.charCodeAt(e++)<<24;else for(i=0;16>i;++i)r[i]=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;t=n.g[0],e=n.g[1],i=n.g[2];var s=n.g[3],o=t+(s^e&(i^s))+r[0]+3614090360&4294967295;t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[1]+3905402710&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[3]+3250441966&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(s^e&(i^s))+r[4]+4118548399&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[5]+1200080426&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[7]+4249261313&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(s^e&(i^s))+r[8]+1770035416&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[9]+2336552879&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[11]+2304563134&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(s^e&(i^s))+r[12]+1804603682&4294967295,t=e+(o<<7&4294967295|o>>>25),o=s+(i^t&(e^i))+r[13]+4254626195&4294967295,s=t+(o<<12&4294967295|o>>>20),o=i+(e^s&(t^e))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=e+(t^i&(s^t))+r[15]+1236535329&4294967295,e=i+(o<<22&4294967295|o>>>10),o=t+(i^s&(e^i))+r[1]+4129170786&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[6]+3225465664&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[0]+3921069994&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(e^i))+r[5]+3593408605&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[10]+38016083&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[4]+3889429448&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(e^i))+r[9]+568446438&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[14]+3275163606&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[8]+1163531501&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(i^s&(e^i))+r[13]+2850285829&4294967295,t=e+(o<<5&4294967295|o>>>27),o=s+(e^i&(t^e))+r[2]+4243563512&4294967295,s=t+(o<<9&4294967295|o>>>23),o=i+(t^e&(s^t))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=e+(s^t&(i^s))+r[12]+2368359562&4294967295,e=i+(o<<20&4294967295|o>>>12),o=t+(e^i^s)+r[5]+4294588738&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[8]+2272392833&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[14]+4259657740&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(e^i^s)+r[1]+2763975236&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[4]+1272893353&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[10]+3200236656&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(e^i^s)+r[13]+681279174&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[0]+3936430074&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[6]+76029189&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(e^i^s)+r[9]+3654602809&4294967295,t=e+(o<<4&4294967295|o>>>28),o=s+(t^e^i)+r[12]+3873151461&4294967295,s=t+(o<<11&4294967295|o>>>21),o=i+(s^t^e)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=e+(i^s^t)+r[2]+3299628645&4294967295,e=i+(o<<23&4294967295|o>>>9),o=t+(i^(e|~s))+r[0]+4096336452&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[7]+1126891415&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[5]+4237533241&4294967295,e=i+(o<<21&4294967295|o>>>11),o=t+(i^(e|~s))+r[12]+1700485571&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[3]+2399980690&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[1]+2240044497&4294967295,e=i+(o<<21&4294967295|o>>>11),o=t+(i^(e|~s))+r[8]+1873313359&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[15]+4264355552&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[13]+1309151649&4294967295,e=i+(o<<21&4294967295|o>>>11),o=t+(i^(e|~s))+r[4]+4149444226&4294967295,t=e+(o<<6&4294967295|o>>>26),o=s+(e^(t|~i))+r[11]+3174756917&4294967295,s=t+(o<<10&4294967295|o>>>22),o=i+(t^(s|~e))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=e+(s^(i|~t))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+t&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}zt.prototype.j=function(n,t){t===void 0&&(t=n.length);for(var e=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(i==0)for(;s<=e;)ia(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<t;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){ia(this,r),i=0;break}}else for(;s<t;)if(r[i++]=n[s++],i==this.blockSize){ia(this,r),i=0;break}}this.h=i,this.i+=t};zt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var t=1;t<n.length-8;++t)n[t]=0;var e=8*this.i;for(t=n.length-8;t<n.length;++t)n[t]=e&255,e/=256;for(this.j(n),n=Array(16),t=e=0;4>t;++t)for(var r=0;32>r;r+=8)n[e++]=this.g[t]>>>r&255;return n};function z(n,t){this.h=t;for(var e=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==t||(e[i]=s,r=!1)}this.g=e}var Cy={};function ja(n){return-128<=n&&128>n?jp(n,function(t){return new z([t|0],0>t?-1:0)}):new z([n|0],0>n?-1:0)}function ee(n){if(isNaN(n)||!isFinite(n))return Vn;if(0>n)return vt(ee(-n));for(var t=[],e=1,r=0;n>=e;r++)t[r]=n/e|0,e*=wa;return new z(t,0)}function Bd(n,t){if(n.length==0)throw Error("number format error: empty string");if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(n.charAt(0)=="-")return vt(Bd(n.substring(1),t));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var e=ee(Math.pow(t,8)),r=Vn,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),t);8>s?(s=ee(Math.pow(t,s)),r=r.R(s).add(ee(o))):(r=r.R(e),r=r.add(ee(o)))}return r}var wa=4294967296,Vn=ja(0),va=ja(1),Mh=ja(16777216);T=z.prototype;T.ea=function(){if(qt(this))return-vt(this).ea();for(var n=0,t=1,e=0;e<this.g.length;e++){var r=this.D(e);n+=(0<=r?r:wa+r)*t,t*=wa}return n};T.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(me(this))return"0";if(qt(this))return"-"+vt(this).toString(n);for(var t=ee(Math.pow(n,6)),e=this,r="";;){var i=as(e,t).g;e=os(e,i.R(t));var s=((0<e.g.length?e.g[0]:e.h)>>>0).toString(n);if(e=i,me(e))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};T.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function me(n){if(n.h!=0)return!1;for(var t=0;t<n.g.length;t++)if(n.g[t]!=0)return!1;return!0}function qt(n){return n.h==-1}T.X=function(n){return n=os(this,n),qt(n)?-1:me(n)?0:1};function vt(n){for(var t=n.g.length,e=[],r=0;r<t;r++)e[r]=~n.g[r];return new z(e,~n.h).add(va)}T.abs=function(){return qt(this)?vt(this):this};T.add=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0,i=0;i<=t;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,e[i]=o<<16|s}return new z(e,e[e.length-1]&-2147483648?-1:0)};function os(n,t){return n.add(vt(t))}T.R=function(n){if(me(this)||me(n))return Vn;if(qt(this))return qt(n)?vt(this).R(vt(n)):vt(vt(this).R(n));if(qt(n))return vt(this.R(vt(n)));if(0>this.X(Mh)&&0>n.X(Mh))return ee(this.ea()*n.ea());for(var t=this.g.length+n.g.length,e=[],r=0;r<2*t;r++)e[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,u=n.D(i)&65535;e[2*r+2*i]+=o*u,es(e,2*r+2*i),e[2*r+2*i+1]+=s*u,es(e,2*r+2*i+1),e[2*r+2*i+1]+=o*a,es(e,2*r+2*i+1),e[2*r+2*i+2]+=s*a,es(e,2*r+2*i+2)}for(r=0;r<t;r++)e[r]=e[2*r+1]<<16|e[2*r];for(r=t;r<2*t;r++)e[r]=0;return new z(e,0)};function es(n,t){for(;(n[t]&65535)!=n[t];)n[t+1]+=n[t]>>>16,n[t]&=65535,t++}function Cr(n,t){this.g=n,this.h=t}function as(n,t){if(me(t))throw Error("division by zero");if(me(n))return new Cr(Vn,Vn);if(qt(n))return t=as(vt(n),t),new Cr(vt(t.g),vt(t.h));if(qt(t))return t=as(n,vt(t)),new Cr(vt(t.g),t.h);if(30<n.g.length){if(qt(n)||qt(t))throw Error("slowDivide_ only works with positive integers.");for(var e=va,r=t;0>=r.X(n);)e=Oh(e),r=Oh(r);var i=Cn(e,1),s=Cn(r,1);for(r=Cn(r,2),e=Cn(e,2);!me(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(e),s=o),r=Cn(r,1),e=Cn(e,1)}return t=os(n,i.R(t)),new Cr(i,t)}for(i=Vn;0<=n.X(t);){for(e=Math.max(1,Math.floor(n.ea()/t.ea())),r=Math.ceil(Math.log(e)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=ee(e),o=s.R(t);qt(o)||0<o.X(n);)e-=r,s=ee(e),o=s.R(t);me(s)&&(s=va),i=i.add(s),n=os(n,o)}return new Cr(i,n)}T.gb=function(n){return as(this,n).h};T.and=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)&n.D(r);return new z(e,this.h&n.h)};T.or=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)|n.D(r);return new z(e,this.h|n.h)};T.xor=function(n){for(var t=Math.max(this.g.length,n.g.length),e=[],r=0;r<t;r++)e[r]=this.D(r)^n.D(r);return new z(e,this.h^n.h)};function Oh(n){for(var t=n.g.length+1,e=[],r=0;r<t;r++)e[r]=n.D(r)<<1|n.D(r-1)>>>31;return new z(e,n.h)}function Cn(n,t){var e=t>>5;t%=32;for(var r=n.g.length-e,i=[],s=0;s<r;s++)i[s]=0<t?n.D(s+e)>>>t|n.D(s+e+1)<<32-t:n.D(s+e);return new z(i,n.h)}ss.prototype.createWebChannel=ss.prototype.g;kt.prototype.send=kt.prototype.u;kt.prototype.open=kt.prototype.m;kt.prototype.close=kt.prototype.close;gs.NO_ERROR=0;gs.TIMEOUT=8;gs.HTTP_ERROR=6;rd.COMPLETE="complete";id.EventType=Kr;Kr.OPEN="a";Kr.CLOSE="b";Kr.ERROR="c";Kr.MESSAGE="d";pt.prototype.listen=pt.prototype.O;et.prototype.listenOnce=et.prototype.P;et.prototype.getLastError=et.prototype.Sa;et.prototype.getLastErrorCode=et.prototype.Ia;et.prototype.getStatus=et.prototype.da;et.prototype.getResponseJson=et.prototype.Wa;et.prototype.getResponseText=et.prototype.ja;et.prototype.send=et.prototype.ha;et.prototype.setWithCredentials=et.prototype.Oa;zt.prototype.digest=zt.prototype.l;zt.prototype.reset=zt.prototype.reset;zt.prototype.update=zt.prototype.j;z.prototype.add=z.prototype.add;z.prototype.multiply=z.prototype.R;z.prototype.modulo=z.prototype.gb;z.prototype.compare=z.prototype.X;z.prototype.toNumber=z.prototype.ea;z.prototype.toString=z.prototype.toString;z.prototype.getBits=z.prototype.D;z.fromNumber=ee;z.fromString=Bd;var Ud=Kt.createWebChannelTransport=function(){return new ss},jd=Kt.getStatEventTarget=function(){return ms()},Ts=Kt.ErrorCode=gs,Gd=Kt.EventType=rd,zd=Kt.Event=Je,Ga=Kt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Jw=Kt.FetchXmlHttpFactory=Wr,Jr=Kt.WebChannel=id,Kd=Kt.XhrIo=et,$d=Kt.Md5=zt,Xe=Kt.Integer=z;var Qd="@firebase/firestore";var dt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};dt.UNAUTHENTICATED=new dt(null),dt.GOOGLE_CREDENTIALS=new dt("google-credentials-uid"),dt.FIRST_PARTY=new dt("first-party-uid"),dt.MOCK_USER=new dt("mock-user");var dr="10.11.0";var ke=new oh("@firebase/firestore");function Bn(){return ke.logLevel}function Wf(n){ke.setLogLevel(n)}function _(n,...t){if(ke.logLevel<=Jt.DEBUG){let e=t.map($c);ke.debug(`Firestore (${dr}): ${n}`,...e)}}function it(n,...t){if(ke.logLevel<=Jt.ERROR){let e=t.map($c);ke.error(`Firestore (${dr}): ${n}`,...e)}}function Ut(n,...t){if(ke.logLevel<=Jt.WARN){let e=t.map($c);ke.warn(`Firestore (${dr}): ${n}`,...e)}}function $c(n){if(typeof n=="string")return n;try{return function(e){return JSON.stringify(e)}(n)}catch{return n}}function S(n="Unexpected state"){let t=`FIRESTORE (${dr}) INTERNAL ASSERTION FAILED: `+n;throw it(t),new Error(t)}function P(n,t){n||S()}function Hf(n,t){n||S()}function E(n,t){return n}var g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},y=class extends sh{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ft=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var ks=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Wa=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(dt.UNAUTHENTICATED))}shutdown(){}},Ha=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Ya=class{constructor(t){this.t=t,this.currentUser=dt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let r=this.i,i=u=>this.i!==r?(r=this.i,e(u)):Promise.resolve(),s=new ft;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ft,t.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;t.enqueueRetryable(()=>p(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ft)}},0),o()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(P(typeof r.accessToken=="string"),new ks(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return P(t===null||typeof t=="string"),new dt(t)}},Ja=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r,this.type="FirstParty",this.user=dt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Xa=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r}getToken(){return Promise.resolve(new Ja(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(dt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Za=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},tu=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){let r=s=>{s.error!=null&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,_("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>r(s))};let i=s=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(P(typeof e.token=="string"),this.R=e.token,new Za(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function Dy(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}var Fs=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,r="";for(;r.length<20;){let i=Dy(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<e&&(r+=t.charAt(i[s]%t.length))}return r}};function D(n,t){return n<t?-1:n>t?1:0}function Hn(n,t,e){return n.length===t.length&&n.every((r,i)=>e(r,t[i]))}function Yf(n){return n+"\0"}var Z=class n{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new y(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new y(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor(1e6*(t-1e3*e));return new n(e,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?D(this.nanoseconds,t.nanoseconds):D(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var b=class n{constructor(t){this.timestamp=t}static fromTimestamp(t){return new n(t)}static min(){return new n(new Z(0,0))}static max(){return new n(new Z(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ms=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&S(),r===void 0?r=t.length-e:r>t.length-e&&S(),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let i=0;i<r;i++){let s=t.get(i),o=e.get(i);if(s<o)return-1;if(s>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},L=class n extends Ms{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(i=>i.length>0))}return new n(e)}static emptyPath(){return new n([])}},Vy=/^[_a-zA-Z][_a-zA-Z0-9]*$/,st=class n extends Ms{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return Vy.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(t){let e=[],r="",i=0,s=()=>{if(r.length===0)throw new y(g.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},o=!1;for(;i<t.length;){let a=t[i];if(a==="\\"){if(i+1===t.length)throw new y(g.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let u=t[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new y(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new y(g.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var I=class n{constructor(t){this.path=t}static fromPath(t){return new n(L.fromString(t))}static fromName(t){return new n(L.fromString(t).popFirst(5))}static empty(){return new n(L.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&L.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return L.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new L(t.slice()))}};var Yn=class{constructor(t,e,r,i){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=i}};function eu(n){return n.fields.find(t=>t.kind===2)}function tn(n){return n.fields.filter(t=>t.kind!==2)}Yn.UNKNOWN_ID=-1;var $n=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var ci=class n{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new n(0,jt.min())}};function Jf(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=b.fromTimestamp(r===1e9?new Z(e+1,0):new Z(e,r));return new jt(i,I.empty(),t)}function Xf(n){return new jt(n.readTime,n.key,-1)}var jt=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(b.min(),I.empty(),-1)}static max(){return new n(b.max(),I.empty(),-1)}};function Qc(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=I.comparator(n.documentKey,t.documentKey),e!==0?e:D(n.largestBatchId,t.largestBatchId))}var Zf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Os=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Ge(n){return p(this,null,function*(){if(n.code!==g.FAILED_PRECONDITION||n.message!==Zf)throw n;_("LocalStore","Unexpectedly lost primary lease")})}var f=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(r,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let i=0,s=0,o=!1;t.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&e()},u=>r(u))}),o=!0,s===i&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(i=>i?n.resolve(i):r());return e}static forEach(t,e){let r=[];return t.forEach((i,s)=>{r.push(e.call(this,i,s))}),this.waitFor(r)}static mapArray(t,e){return new n((r,i)=>{let s=t.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;e(t[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(t,e){return new n((r,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):r()};s()})}};var Ls=class n{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new ft,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new an(t,e.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=Wc(r.target.error);this.V.reject(new an(t,i))}}static open(t,e,r,i){try{return new n(e,t.transaction(i,r))}catch(s){throw new an(e,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(_("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new ru(e)}},_e=class n{constructor(t,e,r){this.name=t,this.version=e,this.p=r,n.S(Rr())===12.2&&it("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return _("SimpleDb","Removing database:",t),en(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!ih())return!1;if(n.C())return!0;let t=Rr(),e=n.S(t),r=0<e&&e<10,i=n.v(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||s)}static C(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.F)==="YES"}static M(t,e){return t.store(e)}static S(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(t){let e=t.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(t){return p(this,null,function*(){return this.db||(_("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;e(o)},i.onblocked=()=>{r(new an(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new y(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new y(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new an(t,o))},i.onupgradeneeded=s=>{_("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.N(o,i.transaction,s.oldVersion,this.version).next(()=>{_("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.L&&(this.db.onversionchange=e=>this.L(e)),this.db})}B(t){this.L=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,r,i){return p(this,null,function*(){let s=e==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(t);let a=Ls.open(this.db,t,s?"readonly":"readwrite",r),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),f.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(_("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}},nu=class{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return en(this.k.delete())}},an=class extends y{constructor(t,e){super(g.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function ze(n){return n.name==="IndexedDbTransactionError"}var ru=class{constructor(t){this.store=t}put(t,e){let r;return e!==void 0?(_("SimpleDb","PUT",this.store.name,t,e),r=this.store.put(e,t)):(_("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),en(r)}add(t){return _("SimpleDb","ADD",this.store.name,t,t),en(this.store.add(t))}get(t){return en(this.store.get(t)).next(e=>(e===void 0&&(e=null),_("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return _("SimpleDb","DELETE",this.store.name,t),en(this.store.delete(t))}count(){return _("SimpleDb","COUNT",this.store.name),en(this.store.count())}W(t,e){let r=this.options(t,e),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new f((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.G(s,(a,u)=>{o.push(u)}).next(()=>o)}}j(t,e){let r=this.store.getAll(t,e===null?void 0:e);return new f((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(t,e){_("SimpleDb","DELETE ALL",this.store.name);let r=this.options(t,e);r.J=!1;let i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(t,e){let r;e?r=t:(r={},e=t);let i=this.cursor(r);return this.G(i,e)}Z(t){let e=this.cursor({});return new f((r,i)=>{e.onerror=s=>{let o=Wc(s.target.error);i(o)},e.onsuccess=s=>{let o=s.target.result;o?t(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(t,e){let r=[];return new f((i,s)=>{t.onerror=o=>{s(o.target.error)},t.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new nu(a),c=e(a.primaryKey,a.value,u);if(c instanceof f){let l=c.catch(h=>(u.done(),f.reject(h)));r.push(l)}u.isDone?i():u.$===null?a.continue():a.continue(u.$)}}).next(()=>f.waitFor(r))}options(t,e){let r;return t!==void 0&&(typeof t=="string"?r=t:e=t),{index:r,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let r=this.store.index(t.index);return t.J?r.openKeyCursor(t.range,e):r.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function en(n){return new f((t,e)=>{n.onsuccess=r=>{let i=r.target.result;t(i)},n.onerror=r=>{let i=Wc(r.target.error);e(i)}})}var Wd=!1;function Wc(n){let t=_e.S(Rr());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(e)>=0){let r=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Wd||(Wd=!0,setTimeout(()=>{throw r},0)),r}}return n}var iu=class{constructor(t,e){this.asyncQueue=t,this.X=e,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ee(t){_("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>p(this,null,function*(){this.task=null;try{_("IndexBackfiller",`Documents written: ${yield this.X.te()}`)}catch(e){ze(e)?_("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):yield Ge(e)}yield this.ee(6e4)}))}},su=class{constructor(t,e){this.localStore=t,this.persistence=e}te(t=50){return p(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.ne(e,t))})}ne(t,e){let r=new Set,i=e,s=!0;return f.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(o=>{if(o!==null&&!r.has(o))return _("IndexBackfiller",`Processing collection: ${o}`),this.re(t,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>e-i)}re(t,e,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(t,o).next(()=>this.ie(i,s)).next(a=>(_("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(t,e,a))).next(()=>o.size)}))}ie(t,e){let r=t;return e.changes.forEach((i,s)=>{let o=Xf(s);Qc(o,r)>0&&(r=o)}),new jt(r.readTime,r.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Ft=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.oe&&this.oe(e),e}}return n._e=-1,n})();function Di(n){return n==null}function li(n){return n===0&&1/n==-1/0}function tm(n){return typeof n=="number"&&Number.isInteger(n)&&!li(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Rt(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Hd(t)),t=Ny(n.get(e),t);return Hd(t)}function Ny(n,t){let e=t,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function Hd(n){return n+""}function ne(n){let t=n.length;if(P(t>=2),t===2)return P(n.charAt(0)===""&&n.charAt(1)===""),L.emptyPath();let e=t-2,r=[],i="";for(let s=0;s<t;){let o=n.indexOf("",s);switch((o<0||o>e)&&S(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:S()}s=o+2}return new L(r)}var Yd=["userId","batchId"];function Rs(n,t){return[n,Rt(t)]}function em(n,t,e){return[n,Rt(t),e]}var ky={},Fy=["prefixPath","collectionGroup","readTime","documentId"],My=["prefixPath","collectionGroup","documentId"],Oy=["collectionGroup","readTime","prefixPath","documentId"],Ly=["canonicalId","targetId"],qy=["targetId","path"],By=["path","targetId"],Uy=["collectionId","parent"],jy=["indexId","uid"],Gy=["uid","sequenceNumber"],zy=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ky=["indexId","uid","orderedDocumentKey"],$y=["userId","collectionPath","documentId"],Qy=["userId","collectionPath","largestBatchId"],Wy=["userId","collectionGroup","largestBatchId"],nm=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Hy=[...nm,"documentOverlays"],rm=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],im=rm,sm=[...im,"indexConfiguration","indexState","indexEntries"],Yy=sm;var hi=class extends Os{constructor(t,e){super(),this.ae=t,this.currentSequenceNumber=e}};function wt(n,t){let e=E(n);return _e.M(e.ae,t)}function Jd(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function wn(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function om(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var Y=class n{constructor(t,e){this.comparator=t,this.root=e||ie.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ie.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ie.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(t,r.key);if(i===0)return e+r.left.size;i<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Kn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Kn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Kn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Kn(this.root,t,this.comparator,!0)}},Kn=class{constructor(t,e,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?r(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},ie=class n{constructor(t,e,r,i,s){this.key=t,this.value=e,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,i,s){return new n(t??this.key,e??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let i=this,s=r(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,r),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw S();let t=this.left.check();if(t!==this.right.check())throw S();return t+(this.isRed()?0:1)}};ie.EMPTY=null,ie.RED=!0,ie.BLACK=!1;ie.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(t,e,r,i,s){return this}insert(t,e,r){return new ie(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var $=class n{constructor(t){this.comparator=t,this.data=new Y(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new qs(this.data.getIterator())}getIteratorFrom(t){return new qs(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},qs=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Mn(n){return n.hasNext()?n.getNext():void 0}var Mt=class n{constructor(t){this.fields=t,t.sort(st.comparator)}static empty(){return new n([])}unionWith(t){let e=new $(st.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Hn(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var Bs=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function am(){return typeof atob<"u"}var _t=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Bs("Invalid base64 string: "+s):s}}(t);return new n(e)}static fromUint8Array(t){let e=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return D(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};_t.EMPTY_BYTE_STRING=new _t("");var Jy=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function we(n){if(P(!!n),typeof n=="string"){let t=0,e=Jy.exec(n);if(P(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:nt(n.seconds),nanos:nt(n.nanos)}}function nt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Fe(n){return typeof n=="string"?_t.fromBase64String(n):_t.fromUint8Array(n)}function Do(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function Hc(n){let t=n.mapValue.fields.__previous_value__;return Do(t)?Hc(t):t}function di(n){let t=we(n.mapValue.fields.__local_write_time__.timestampValue);return new Z(t.seconds,t.nanos)}var ou=class{constructor(t,e,r,i,s,o,a,u,c){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},Me=class n{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var Ve={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},xs={nullValue:"NULL_VALUE"};function un(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Do(n)?4:um(n)?9007199254740991:10:S()}function ae(n,t){if(n===t)return!0;let e=un(n);if(e!==un(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return di(n).isEqual(di(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=we(i.timestampValue),a=we(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(i,s){return Fe(i.bytesValue).isEqual(Fe(s.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(i,s){return nt(i.geoPointValue.latitude)===nt(s.geoPointValue.latitude)&&nt(i.geoPointValue.longitude)===nt(s.geoPointValue.longitude)}(n,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return nt(i.integerValue)===nt(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=nt(i.doubleValue),a=nt(s.doubleValue);return o===a?li(o)===li(a):isNaN(o)&&isNaN(a)}return!1}(n,t);case 9:return Hn(n.arrayValue.values||[],t.arrayValue.values||[],ae);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(Jd(o)!==Jd(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!ae(o[u],a[u])))return!1;return!0}(n,t);default:return S()}}function fi(n,t){return(n.values||[]).find(e=>ae(e,t))!==void 0}function Oe(n,t){if(n===t)return 0;let e=un(n),r=un(t);if(e!==r)return D(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return D(n.booleanValue,t.booleanValue);case 2:return function(s,o){let a=nt(s.integerValue||s.doubleValue),u=nt(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,t);case 3:return Xd(n.timestampValue,t.timestampValue);case 4:return Xd(di(n),di(t));case 5:return D(n.stringValue,t.stringValue);case 6:return function(s,o){let a=Fe(s),u=Fe(o);return a.compareTo(u)}(n.bytesValue,t.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let l=D(a[c],u[c]);if(l!==0)return l}return D(a.length,u.length)}(n.referenceValue,t.referenceValue);case 8:return function(s,o){let a=D(nt(s.latitude),nt(o.latitude));return a!==0?a:D(nt(s.longitude),nt(o.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return function(s,o){let a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){let l=Oe(a[c],u[c]);if(l)return l}return D(a.length,u.length)}(n.arrayValue,t.arrayValue);case 10:return function(s,o){if(s===Ve.mapValue&&o===Ve.mapValue)return 0;if(s===Ve.mapValue)return 1;if(o===Ve.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){let d=D(u[h],l[h]);if(d!==0)return d;let m=Oe(a[u[h]],c[l[h]]);if(m!==0)return m}return D(u.length,l.length)}(n.mapValue,t.mapValue);default:throw S()}}function Xd(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return D(n,t);let e=we(n),r=we(t),i=D(e.seconds,r.seconds);return i!==0?i:D(e.nanos,r.nanos)}function Jn(n){return au(n)}function au(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(e){let r=we(e);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(e){return Fe(e).toBase64()}(n.bytesValue):"referenceValue"in n?function(e){return I.fromName(e).toString()}(n.referenceValue):"geoPointValue"in n?function(e){return`geo(${e.latitude},${e.longitude})`}(n.geoPointValue):"arrayValue"in n?function(e){let r="[",i=!0;for(let s of e.values||[])i?i=!1:r+=",",r+=au(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(e){let r=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${au(e.fields[o])}`;return i+"}"}(n.mapValue):S()}function cn(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function uu(n){return!!n&&"integerValue"in n}function mi(n){return!!n&&"arrayValue"in n}function Zd(n){return!!n&&"nullValue"in n}function tf(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Cs(n){return!!n&&"mapValue"in n}function ii(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return wn(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=ii(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=ii(n.arrayValue.values[e]);return t}return Object.assign({},n)}function um(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function Xy(n){return"nullValue"in n?xs:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?cn(Me.empty(),I.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:S()}function Zy(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?cn(Me.empty(),I.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Ve:S()}function ef(n,t){let e=Oe(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?-1:!n.inclusive&&t.inclusive?1:0}function nf(n,t){let e=Oe(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?1:!n.inclusive&&t.inclusive?-1:0}var Pt=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Cs(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ii(e)}setAll(t){let e=st.emptyPath(),r={},i=[];t.forEach((o,a)=>{if(!e.isImmediateParentOf(a)){let u=this.getFieldsMap(e);this.applyChanges(u,r,i),r={},i=[],e=a.popLast()}o?r[a.lastSegment()]=ii(o):i.push(a.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,r,i)}delete(t){let e=this.field(t.popLast());Cs(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ae(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let i=e.mapValue.fields[t.get(r)];Cs(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,r){wn(e,(i,s)=>t[i]=s);for(let i of r)delete t[i]}clone(){return new n(ii(this.value))}};function cm(n){let t=[];return wn(n.fields,(e,r)=>{let i=new st([e]);if(Cs(r)){let s=cm(r.mapValue).fields;if(s.length===0)t.push(i);else for(let o of s)t.push(i.child(o))}else t.push(i)}),new Mt(t)}var mt=class n{constructor(t,e,r,i,s,o,a){this.key=t,this.documentType=e,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(t){return new n(t,0,b.min(),b.min(),b.min(),Pt.empty(),0)}static newFoundDocument(t,e,r,i){return new n(t,1,e,b.min(),r,i,0)}static newNoDocument(t,e){return new n(t,2,e,b.min(),b.min(),Pt.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,b.min(),b.min(),Pt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(b.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Pt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Pt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=b.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ue=class{constructor(t,e){this.position=t,this.inclusive=e}};function rf(n,t,e){let r=0;for(let i=0;i<n.position.length;i++){let s=t[i],o=n.position[i];if(s.field.isKeyField()?r=I.comparator(I.fromName(o.referenceValue),e.key):r=Oe(o,e.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function sf(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!ae(n.position[e],t.position[e]))return!1;return!0}var ln=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function t_(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var Us=class{},M=class n extends Us{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new hu(t,e,r):e==="array-contains"?new mu(t,r):e==="in"?new js(t,r):e==="not-in"?new gu(t,r):e==="array-contains-any"?new pu(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new du(t,r):new fu(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Oe(e,this.value)):e!==null&&un(this.value)===un(e)&&this.matchesComparison(Oe(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return S()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},K=class n extends Us{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new n(t,e)}matches(t){return Xn(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function Xn(n){return n.op==="and"}function cu(n){return n.op==="or"}function Yc(n){return lm(n)&&Xn(n)}function lm(n){for(let t of n.filters)if(t instanceof K)return!1;return!0}function lu(n){if(n instanceof M)return n.field.canonicalString()+n.op.toString()+Jn(n.value);if(Yc(n))return n.filters.map(t=>lu(t)).join(",");{let t=n.filters.map(e=>lu(e)).join(",");return`${n.op}(${t})`}}function hm(n,t){return n instanceof M?function(r,i){return i instanceof M&&r.op===i.op&&r.field.isEqual(i.field)&&ae(r.value,i.value)}(n,t):n instanceof K?function(r,i){return i instanceof K&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&hm(o,i.filters[a]),!0):!1}(n,t):void S()}function dm(n,t){let e=n.filters.concat(t);return K.create(e,n.op)}function fm(n){return n instanceof M?function(e){return`${e.field.canonicalString()} ${e.op} ${Jn(e.value)}`}(n):n instanceof K?function(e){return e.op.toString()+" {"+e.getFilters().map(fm).join(" ,")+"}"}(n):"Filter"}var hu=class extends M{constructor(t,e,r){super(t,e,r),this.key=I.fromName(r.referenceValue)}matches(t){let e=I.comparator(t.key,this.key);return this.matchesComparison(e)}},du=class extends M{constructor(t,e){super(t,"in",e),this.keys=mm("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},fu=class extends M{constructor(t,e){super(t,"not-in",e),this.keys=mm("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function mm(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>I.fromName(r.referenceValue))}var mu=class extends M{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return mi(e)&&fi(e.arrayValue,this.value)}},js=class extends M{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&fi(this.value.arrayValue,e)}},gu=class extends M{constructor(t,e){super(t,"not-in",e)}matches(t){if(fi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!fi(this.value.arrayValue,e)}},pu=class extends M{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!mi(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>fi(this.value.arrayValue,r))}};var yu=class{constructor(t,e=null,r=[],i=[],s=null,o=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function _u(n,t=null,e=[],r=[],i=null,s=null,o=null){return new yu(n,t,e,r,i,s,o)}function hn(n){let t=E(n);if(t.ce===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>lu(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Di(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>Jn(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>Jn(r)).join(",")),t.ce=e}return t.ce}function Vi(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!t_(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!hm(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!sf(n.startAt,t.startAt)&&sf(n.endAt,t.endAt)}function Gs(n){return I.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function zs(n,t){return n.filters.filter(e=>e instanceof M&&e.field.isEqual(t))}function of(n,t,e){let r=xs,i=!0;for(let s of zs(n,t)){let o=xs,a=!0;switch(s.op){case"<":case"<=":o=Xy(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=xs}ef({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];ef({value:r,inclusive:i},{value:o,inclusive:e.inclusive})<0&&(r=o,i=e.inclusive);break}}return{value:r,inclusive:i}}function af(n,t,e){let r=Ve,i=!0;for(let s of zs(n,t)){let o=Ve,a=!0;switch(s.op){case">=":case">":o=Zy(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Ve}nf({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];nf({value:r,inclusive:i},{value:o,inclusive:e.inclusive})>0&&(r=o,i=e.inclusive);break}}return{value:r,inclusive:i}}var $t=class{constructor(t,e=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function gm(n,t,e,r,i,s,o,a){return new $t(n,t,e,r,i,s,o,a)}function fr(n){return new $t(n)}function uf(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Jc(n){return n.collectionGroup!==null}function Qn(n){let t=E(n);if(t.le===null){t.le=[];let e=new Set;for(let s of t.explicitOrderBy)t.le.push(s),e.add(s.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new $(st.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.le.push(new ln(s,r))}),e.has(st.keyField().canonicalString())||t.le.push(new ln(st.keyField(),r))}return t.le}function xt(n){let t=E(n);return t.he||(t.he=e_(t,Qn(n))),t.he}function e_(n,t){if(n.limitType==="F")return _u(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new ln(i.field,s)});let e=n.endAt?new ue(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ue(n.startAt.position,n.startAt.inclusive):null;return _u(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function wu(n,t){let e=n.filters.concat([t]);return new $t(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function Ks(n,t,e){return new $t(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function Ni(n,t){return Vi(xt(n),xt(t))&&n.limitType===t.limitType}function pm(n){return`${hn(xt(n))}|lt:${n.limitType}`}function Un(n){return`Query(target=${function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(i=>fm(i)).join(", ")}]`),Di(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(i=>Jn(i)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(i=>Jn(i)).join(",")),`Target(${r})`}(xt(n))}; limitType=${n.limitType})`}function ki(n,t){return t.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):I.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,t)&&function(r,i){for(let s of Qn(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,t)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,t)&&function(r,i){return!(r.startAt&&!function(o,a,u){let c=rf(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,Qn(r),i)||r.endAt&&!function(o,a,u){let c=rf(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,Qn(r),i))}(n,t)}function ym(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function _m(n){return(t,e)=>{let r=!1;for(let i of Qn(n)){let s=n_(i,t,e);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function n_(n,t,e){let r=n.field.isKeyField()?I.comparator(t.key,e.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?Oe(u,c):S()}(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return S()}}var ce=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),i=this.inner[r];if(i===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[e]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(t){wn(this.inner,(e,r)=>{for(let[i,s]of r)t(i,s)})}isEmpty(){return om(this.inner)}size(){return this.innerSize}};var r_=new Y(I.comparator);function Vt(){return r_}var wm=new Y(I.comparator);function ni(...n){let t=wm;for(let e of n)t=t.insert(e.key,e);return t}function vm(n){let t=wm;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function re(){return si()}function Im(){return si()}function si(){return new ce(n=>n.toString(),(n,t)=>n.isEqual(t))}var i_=new Y(I.comparator),s_=new $(I.comparator);function V(...n){let t=s_;for(let e of n)t=t.add(e);return t}var o_=new $(D);function Xc(){return o_}function Em(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:li(t)?"-0":t}}function Tm(n){return{integerValue:""+n}}function Am(n,t){return tm(t)?Tm(t):Em(n,t)}var Zn=class{constructor(){this._=void 0}};function a_(n,t,e){return n instanceof Le?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Do(s)&&(s=Hc(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(e,t):n instanceof ve?Pm(n,t):n instanceof Ie?bm(n,t):function(i,s){let o=Sm(i,s),a=cf(o)+cf(i.Ie);return uu(o)&&uu(i.Ie)?Tm(a):Em(i.serializer,a)}(n,t)}function u_(n,t,e){return n instanceof ve?Pm(n,t):n instanceof Ie?bm(n,t):e}function Sm(n,t){return n instanceof qe?function(r){return uu(r)||function(s){return!!s&&"doubleValue"in s}(r)}(t)?t:{integerValue:0}:null}var Le=class extends Zn{},ve=class extends Zn{constructor(t){super(),this.elements=t}};function Pm(n,t){let e=Rm(t);for(let r of n.elements)e.some(i=>ae(i,r))||e.push(r);return{arrayValue:{values:e}}}var Ie=class extends Zn{constructor(t){super(),this.elements=t}};function bm(n,t){let e=Rm(t);for(let r of n.elements)e=e.filter(i=>!ae(i,r));return{arrayValue:{values:e}}}var qe=class extends Zn{constructor(t,e){super(),this.serializer=t,this.Ie=e}};function cf(n){return nt(n.integerValue||n.doubleValue)}function Rm(n){return mi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var dn=class{constructor(t,e){this.field=t,this.transform=e}};function c_(n,t){return n.field.isEqual(t.field)&&function(r,i){return r instanceof ve&&i instanceof ve||r instanceof Ie&&i instanceof Ie?Hn(r.elements,i.elements,ae):r instanceof qe&&i instanceof qe?ae(r.Ie,i.Ie):r instanceof Le&&i instanceof Le}(n.transform,t.transform)}var vu=class{constructor(t,e){this.version=t,this.transformResults=e}},rt=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Ds(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var tr=class{};function xm(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Ue(n.key,rt.none()):new Be(n.key,n.data,rt.none());{let e=n.data,r=Pt.empty(),i=new $(st.comparator);for(let s of t.fields)if(!i.has(s)){let o=e.field(s);o===null&&s.length>1&&(s=s.popLast(),o=e.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Qt(n.key,r,new Mt(i.toArray()),rt.none())}}function l_(n,t,e){n instanceof Be?function(i,s,o){let a=i.value.clone(),u=hf(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,t,e):n instanceof Qt?function(i,s,o){if(!Ds(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=hf(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(Cm(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,t,e):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,e)}function oi(n,t,e,r){return n instanceof Be?function(s,o,a,u){if(!Ds(s.precondition,o))return a;let c=s.value.clone(),l=df(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,t,e,r):n instanceof Qt?function(s,o,a,u){if(!Ds(s.precondition,o))return a;let c=df(s.fieldTransforms,u,o),l=o.data;return l.setAll(Cm(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,t,e,r):function(s,o,a){return Ds(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,t,e)}function h_(n,t){let e=null;for(let r of n.fieldTransforms){let i=t.data.field(r.field),s=Sm(r.transform,i||null);s!=null&&(e===null&&(e=Pt.empty()),e.set(r.field,s))}return e||null}function lf(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Hn(r,i,(s,o)=>c_(s,o))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var Be=class extends tr{constructor(t,e,r,i=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Qt=class extends tr{constructor(t,e,r,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Cm(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function hf(n,t,e){let r=new Map;P(n.length===e.length);for(let i=0;i<e.length;i++){let s=n[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,u_(o,a,e[i]))}return r}function df(n,t,e){let r=new Map;for(let i of n){let s=i.transform,o=e.data.field(i.field);r.set(i.field,a_(s,o,t))}return r}var Ue=class extends tr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},gi=class extends tr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var pi=class{constructor(t,e,r,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&l_(s,t,r[i])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=oi(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=oi(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=Im();return this.mutations.forEach(i=>{let s=t.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=e.has(i.key)?null:a;let u=xm(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(b.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),V())}isEqual(t){return this.batchId===t.batchId&&Hn(this.mutations,t.mutations,(e,r)=>lf(e,r))&&Hn(this.baseMutations,t.baseMutations,(e,r)=>lf(e,r))}},Iu=class n{constructor(t,e,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=i}static from(t,e,r){P(t.mutations.length===r.length);let i=function(){return i_}(),s=t.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(t,e,r,i)}};var yi=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Eu=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var lt,O;function Dm(n){switch(n){default:return S();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function Vm(n){if(n===void 0)return it("GRPC error has no .code"),g.UNKNOWN;switch(n){case lt.OK:return g.OK;case lt.CANCELLED:return g.CANCELLED;case lt.UNKNOWN:return g.UNKNOWN;case lt.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case lt.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case lt.INTERNAL:return g.INTERNAL;case lt.UNAVAILABLE:return g.UNAVAILABLE;case lt.UNAUTHENTICATED:return g.UNAUTHENTICATED;case lt.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case lt.NOT_FOUND:return g.NOT_FOUND;case lt.ALREADY_EXISTS:return g.ALREADY_EXISTS;case lt.PERMISSION_DENIED:return g.PERMISSION_DENIED;case lt.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case lt.ABORTED:return g.ABORTED;case lt.OUT_OF_RANGE:return g.OUT_OF_RANGE;case lt.UNIMPLEMENTED:return g.UNIMPLEMENTED;case lt.DATA_LOSS:return g.DATA_LOSS;default:return S()}}(O=lt||(lt={}))[O.OK=0]="OK",O[O.CANCELLED=1]="CANCELLED",O[O.UNKNOWN=2]="UNKNOWN",O[O.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",O[O.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",O[O.NOT_FOUND=5]="NOT_FOUND",O[O.ALREADY_EXISTS=6]="ALREADY_EXISTS",O[O.PERMISSION_DENIED=7]="PERMISSION_DENIED",O[O.UNAUTHENTICATED=16]="UNAUTHENTICATED",O[O.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",O[O.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",O[O.ABORTED=10]="ABORTED",O[O.OUT_OF_RANGE=11]="OUT_OF_RANGE",O[O.UNIMPLEMENTED=12]="UNIMPLEMENTED",O[O.INTERNAL=13]="INTERNAL",O[O.UNAVAILABLE=14]="UNAVAILABLE",O[O.DATA_LOSS=15]="DATA_LOSS";var ff=null;function Nm(){return new TextEncoder}var d_=new Xe([4294967295,4294967295],0);function mf(n){let t=Nm().encode(n),e=new $d;return e.update(t),new Uint8Array(e.digest())}function gf(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Xe([e,r],0),new Xe([i,s],0)]}var Tu=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new on(`Invalid padding: ${e}`);if(r<0)throw new on(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new on(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new on(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=Xe.fromNumber(this.Te)}de(t,e,r){let i=t.add(e.multiply(Xe.fromNumber(r)));return i.compare(d_)===1&&(i=new Xe([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;let e=mf(t),[r,i]=gf(e);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(t,e,r){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),o=new n(s,i,e);return r.forEach(a=>o.insert(a)),o}insert(t){if(this.Te===0)return;let e=mf(t),[r,i]=gf(e);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);this.Re(o)}}Re(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},on=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var _i=class n{constructor(t,e,r,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let i=new Map;return i.set(t,wi.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(b.min(),i,new Y(D),Vt(),V())}},wi=class n{constructor(t,e,r,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,V(),V(),V())}};var Wn=class{constructor(t,e,r,i){this.Ve=t,this.removedTargetIds=e,this.key=r,this.me=i}},$s=class{constructor(t,e){this.targetId=t,this.fe=e}},Qs=class{constructor(t,e,r=_t.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=i}},Ws=class{constructor(){this.ge=0,this.pe=yf(),this.ye=_t.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=V(),e=V(),r=V();return this.pe.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:r=r.add(i);break;default:S()}}),new wi(this.ye,this.we,t,e,r)}Fe(){this.Se=!1,this.pe=yf()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,P(this.ge>=0)}Le(){this.Se=!0,this.we=!0}},Au=class{constructor(t){this.Be=t,this.ke=new Map,this.qe=Vt(),this.Qe=pf(),this.Ke=new Y(D)}$e(t){for(let e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(let e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,e=>{let r=this.ze(e);switch(t.state){case 0:this.je(e)&&r.Ce(t.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(t.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(e);break;case 3:this.je(e)&&(r.Le(),r.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),r.Ce(t.resumeToken));break;default:S()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach((r,i)=>{this.je(i)&&e(i)})}Je(t){let e=t.targetId,r=t.fe.count,i=this.Ye(e);if(i){let s=i.target;if(Gs(s))if(r===0){let o=new I(s.path);this.We(e,o,mt.newNoDocument(o,b.min()))}else P(r===1);else{let o=this.Ze(e);if(o!==r){let a=this.Xe(t),u=a?this.et(a,t,o):1;if(u!==0){this.He(e);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,c)}ff?.tt(function(l,h,d,m,A){var w,v,R,F,x,U;let j={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},B=h.unchangedNames;return B&&(j.bloomFilter={applied:A===0,hashCount:(w=B?.hashCount)!==null&&w!==void 0?w:0,bitmapLength:(F=(R=(v=B?.bits)===null||v===void 0?void 0:v.bitmap)===null||R===void 0?void 0:R.length)!==null&&F!==void 0?F:0,padding:(U=(x=B?.bits)===null||x===void 0?void 0:x.padding)!==null&&U!==void 0?U:0,mightContain:at=>{var Yt;return(Yt=m?.mightContain(at))!==null&&Yt!==void 0&&Yt}}),j}(o,t.fe,this.Be.nt(),a,u))}}}}Xe(t){let e=t.fe.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=e,o,a;try{o=Fe(r).toUint8Array()}catch(u){if(u instanceof Bs)return Ut("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Tu(o,i,s)}catch(u){return Ut(u instanceof on?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Te===0?null:a}et(t,e,r){return e.fe.count===r-this.rt(t,e.targetId)?0:2}rt(t,e){let r=this.Be.getRemoteKeysForTarget(e),i=0;return r.forEach(s=>{let o=this.Be.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;t.mightContain(a)||(this.We(e,s,null),i++)}),i}it(t){let e=new Map;this.ke.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&Gs(a.target)){let u=new I(a.target.path);this.qe.get(u)!==null||this.st(o,u)||this.We(o,u,mt.newNoDocument(u,t))}s.De&&(e.set(o,s.ve()),s.Fe())}});let r=V();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Ye(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(t));let i=new _i(t,e,this.Ke,this.qe,r);return this.qe=Vt(),this.Qe=pf(),this.Ke=new Y(D),i}Ue(t,e){if(!this.je(t))return;let r=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,r),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,r){if(!this.je(t))return;let i=this.ze(t);this.st(t,e)?i.Me(e,1):i.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),r&&(this.qe=this.qe.insert(e,r))}removeTarget(t){this.ke.delete(t)}Ze(t){let e=this.ze(t).ve();return this.Be.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new Ws,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new $(D),this.Qe=this.Qe.insert(t,e)),e}je(t){let e=this.Ye(t)!==null;return e||_("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){let e=this.ke.get(t);return e&&e.be?null:this.Be._t(t)}He(t){this.ke.set(t,new Ws),this.Be.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}st(t,e){return this.Be.getRemoteKeysForTarget(t).has(e)}};function pf(){return new Y(I.comparator)}function yf(){return new Y(I.comparator)}var f_={asc:"ASCENDING",desc:"DESCENDING"},m_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},g_={and:"AND",or:"OR"},Su=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function Pu(n,t){return n.useProto3Json||Di(t)?t:{value:t}}function er(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function km(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function p_(n,t){return er(n,t.toTimestamp())}function ot(n){return P(!!n),b.fromTimestamp(function(e){let r=we(e);return new Z(r.seconds,r.nanos)}(n))}function Zc(n,t){return bu(n,t).canonicalString()}function bu(n,t){let e=function(i){return new L(["projects",i.projectId,"databases",i.database])}(n).child("documents");return t===void 0?e:e.child(t)}function Fm(n){let t=L.fromString(n);return P(Km(t)),t}function vi(n,t){return Zc(n.databaseId,t.path)}function se(n,t){let e=Fm(t);if(e.get(1)!==n.databaseId.projectId)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new y(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new I(Lm(e))}function Mm(n,t){return Zc(n.databaseId,t)}function Om(n){let t=Fm(n);return t.length===4?L.emptyPath():Lm(t)}function Ru(n){return new L(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Lm(n){return P(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function _f(n,t,e){return{name:vi(n,t),fields:e.value.mapValue.fields}}function qm(n,t,e){let r=se(n,t.name),i=ot(t.updateTime),s=t.createTime?ot(t.createTime):b.min(),o=new Pt({mapValue:{fields:t.fields}}),a=mt.newFoundDocument(r,i,s,o);return e&&a.setHasCommittedMutations(),e?a.setHasCommittedMutations():a}function y_(n,t){return"found"in t?function(r,i){P(!!i.found),i.found.name,i.found.updateTime;let s=se(r,i.found.name),o=ot(i.found.updateTime),a=i.found.createTime?ot(i.found.createTime):b.min(),u=new Pt({mapValue:{fields:i.found.fields}});return mt.newFoundDocument(s,o,a,u)}(n,t):"missing"in t?function(r,i){P(!!i.missing),P(!!i.readTime);let s=se(r,i.missing),o=ot(i.readTime);return mt.newNoDocument(s,o)}(n,t):S()}function __(n,t){let e;if("targetChange"in t){t.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:S()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(P(l===void 0||typeof l=="string"),_t.fromBase64String(l||"")):(P(l===void 0||l instanceof Buffer||l instanceof Uint8Array),_t.fromUint8Array(l||new Uint8Array))}(n,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(c){let l=c.code===void 0?g.UNKNOWN:Vm(c.code);return new y(l,c.message||"")}(o);e=new Qs(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=se(n,r.document.name),s=ot(r.document.updateTime),o=r.document.createTime?ot(r.document.createTime):b.min(),a=new Pt({mapValue:{fields:r.document.fields}}),u=mt.newFoundDocument(i,s,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];e=new Wn(c,l,u.key,u)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=se(n,r.document),s=r.readTime?ot(r.readTime):b.min(),o=mt.newNoDocument(i,s),a=r.removedTargetIds||[];e=new Wn([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=se(n,r.document),s=r.removedTargetIds||[];e=new Wn([],s,i,null)}else{if(!("filter"in t))return S();{t.filter;let r=t.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Eu(i,s),a=r.targetId;e=new $s(a,o)}}return e}function Ii(n,t){let e;if(t instanceof Be)e={update:_f(n,t.key,t.value)};else if(t instanceof Ue)e={delete:vi(n,t.key)};else if(t instanceof Qt)e={update:_f(n,t.key,t.data),updateMask:A_(t.fieldMask)};else{if(!(t instanceof gi))return S();e={verify:vi(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Le)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ve)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ie)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof qe)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw S()}(0,r))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:p_(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:S()}(n,t.precondition)),e}function xu(n,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?rt.updateTime(ot(s.updateTime)):s.exists!==void 0?rt.exists(s.exists):rt.none()}(t.currentDocument):rt.none(),r=t.updateTransforms?t.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)P(a.setToServerValue==="REQUEST_TIME"),u=new Le;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];u=new ve(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];u=new Ie(l)}else"increment"in a?u=new qe(o,a.increment):S();let c=st.fromServerFormat(a.fieldPath);return new dn(c,u)}(n,i)):[];if(t.update){t.update.name;let i=se(n,t.update.name),s=new Pt({mapValue:{fields:t.update.fields}});if(t.updateMask){let o=function(u){let c=u.fieldPaths||[];return new Mt(c.map(l=>st.fromServerFormat(l)))}(t.updateMask);return new Qt(i,s,o,e,r)}return new Be(i,s,e,r)}if(t.delete){let i=se(n,t.delete);return new Ue(i,e)}if(t.verify){let i=se(n,t.verify);return new gi(i,e)}return S()}function w_(n,t){return n&&n.length>0?(P(t!==void 0),n.map(e=>function(i,s){let o=i.updateTime?ot(i.updateTime):ot(s);return o.isEqual(b.min())&&(o=ot(s)),new vu(o,i.transformResults||[])}(e,t))):[]}function Bm(n,t){return{documents:[Mm(n,t.path)]}}function Um(n,t){let e={structuredQuery:{}},r=t.path,i;t.collectionGroup!==null?(i=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=Mm(n,i);let s=function(c){if(c.length!==0)return zm(K.create(c,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(l=>function(d){return{field:jn(d.field),direction:I_(d.dir)}}(l))}(t.orderBy);o&&(e.structuredQuery.orderBy=o);let a=Pu(n,t.limit);return a!==null&&(e.structuredQuery.limit=a),t.startAt&&(e.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(t.endAt)),{ut:e,parent:i}}function jm(n){let t=Om(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,i=null;if(r>0){P(r===1);let l=e.from[0];l.allDescendants?i=l.collectionId:t=t.child(l.collectionId)}let s=[];e.where&&(s=function(h){let d=Gm(h);return d instanceof K&&Yc(d)?d.getFilters():[d]}(e.where));let o=[];e.orderBy&&(o=function(h){return h.map(d=>function(A){return new ln(Gn(A.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(A.direction))}(d))}(e.orderBy));let a=null;e.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,Di(d)?null:d}(e.limit));let u=null;e.startAt&&(u=function(h){let d=!!h.before,m=h.values||[];return new ue(m,d)}(e.startAt));let c=null;return e.endAt&&(c=function(h){let d=!h.before,m=h.values||[];return new ue(m,d)}(e.endAt)),gm(t,i,o,s,a,"F",u,c)}function v_(n,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Gm(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=Gn(e.unaryFilter.field);return M.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Gn(e.unaryFilter.field);return M.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Gn(e.unaryFilter.field);return M.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Gn(e.unaryFilter.field);return M.create(o,"!=",{nullValue:"NULL_VALUE"});default:return S()}}(n):n.fieldFilter!==void 0?function(e){return M.create(Gn(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return K.create(e.compositeFilter.filters.map(r=>Gm(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return S()}}(e.compositeFilter.op))}(n):S()}function I_(n){return f_[n]}function E_(n){return m_[n]}function T_(n){return g_[n]}function jn(n){return{fieldPath:n.canonicalString()}}function Gn(n){return st.fromServerFormat(n.fieldPath)}function zm(n){return n instanceof M?function(e){if(e.op==="=="){if(tf(e.value))return{unaryFilter:{field:jn(e.field),op:"IS_NAN"}};if(Zd(e.value))return{unaryFilter:{field:jn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(tf(e.value))return{unaryFilter:{field:jn(e.field),op:"IS_NOT_NAN"}};if(Zd(e.value))return{unaryFilter:{field:jn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:jn(e.field),op:E_(e.op),value:e.value}}}(n):n instanceof K?function(e){let r=e.getFilters().map(i=>zm(i));return r.length===1?r[0]:{compositeFilter:{op:T_(e.op),filters:r}}}(n):S()}function A_(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Km(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var nr=class n{constructor(t,e,r,i,s=b.min(),o=b.min(),a=_t.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Hs=class{constructor(t){this.ct=t}};function S_(n,t){let e;if(t.document)e=qm(n.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let r=I.fromSegments(t.noDocument.path),i=mn(t.noDocument.readTime);e=mt.newNoDocument(r,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return S();{let r=I.fromSegments(t.unknownDocument.path),i=mn(t.unknownDocument.version);e=mt.newUnknownDocument(r,i)}}return t.readTime&&e.setReadTime(function(i){let s=new Z(i[0],i[1]);return b.fromTimestamp(s)}(t.readTime)),e}function wf(n,t){let e=t.key,r={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Ys(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(s,o){return{name:vi(s,o.key),fields:o.data.value.mapValue.fields,updateTime:er(s,o.version.toTimestamp()),createTime:er(s,o.createTime.toTimestamp())}}(n.ct,t);else if(t.isNoDocument())r.noDocument={path:e.path.toArray(),readTime:fn(t.version)};else{if(!t.isUnknownDocument())return S();r.unknownDocument={path:e.path.toArray(),version:fn(t.version)}}return r}function Ys(n){let t=n.toTimestamp();return[t.seconds,t.nanoseconds]}function fn(n){let t=n.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function mn(n){let t=new Z(n.seconds,n.nanoseconds);return b.fromTimestamp(t)}function nn(n,t){let e=(t.baseMutations||[]).map(s=>xu(n.ct,s));for(let s=0;s<t.mutations.length-1;++s){let o=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let a=t.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let r=t.mutations.map(s=>xu(n.ct,s)),i=Z.fromMillis(t.localWriteTimeMs);return new pi(t.batchId,i,e,r)}function ri(n){let t=mn(n.readTime),e=n.lastLimboFreeSnapshotVersion!==void 0?mn(n.lastLimboFreeSnapshotVersion):b.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return P(s.documents.length===1),xt(fr(Om(s.documents[0])))}(n.query):function(s){return xt(jm(s))}(n.query),new nr(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,t,e,_t.fromBase64String(n.resumeToken))}function $m(n,t){let e=fn(t.snapshotVersion),r=fn(t.lastLimboFreeSnapshotVersion),i;i=Gs(t.target)?Bm(n.ct,t.target):Um(n.ct,t.target).ut;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:hn(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function tl(n){let t=jm({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ks(t,t.limit,"L"):t}function za(n,t){return new yi(t.largestBatchId,xu(n.ct,t.overlayMutation))}function vf(n,t){let e=t.path.lastSegment();return[n,Rt(t.path.popLast()),e]}function If(n,t,e,r){return{indexId:n,uid:t,sequenceNumber:e,readTime:fn(r.readTime),documentKey:Rt(r.documentKey.path),largestBatchId:r.largestBatchId}}var Cu=class{getBundleMetadata(t,e){return Ef(t).get(e).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:mn(s.createTime),version:s.version}}(r)})}saveBundleMetadata(t,e){return Ef(t).put(function(i){return{bundleId:i.id,createTime:fn(ot(i.createTime)),version:i.version}}(e))}getNamedQuery(t,e){return Tf(t).get(e).next(r=>{if(r)return function(s){return{name:s.name,query:tl(s.bundledQuery),readTime:mn(s.readTime)}}(r)})}saveNamedQuery(t,e){return Tf(t).put(function(i){return{name:i.name,readTime:fn(ot(i.readTime)),bundledQuery:i.bundledQuery}}(e))}};function Ef(n){return wt(n,"bundles")}function Tf(n){return wt(n,"namedQueries")}var Js=class n{constructor(t,e){this.serializer=t,this.userId=e}static lt(t,e){let r=e.uid||"";return new n(t,r)}getOverlay(t,e){return Xr(t).get(vf(this.userId,e)).next(r=>r?za(this.serializer,r):null)}getOverlays(t,e){let r=re();return f.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){let i=[];return r.forEach((s,o)=>{let a=new yi(e,o);i.push(this.ht(t,a))}),f.waitFor(i)}removeOverlaysForBatchId(t,e,r){let i=new Set;e.forEach(o=>i.add(Rt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Xr(t).H("collectionPathOverlayIndex",a))}),f.waitFor(s)}getOverlaysForCollection(t,e,r){let i=re(),s=Rt(e),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Xr(t).W("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=za(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(t,e,r,i){let s=re(),o,a=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Xr(t).Y({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{let h=za(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}ht(t,e){return Xr(t).put(function(i,s,o){let[a,u,c]=vf(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Ii(i.ct,o.mutation)}}(this.serializer,this.userId,e))}};function Xr(n){return wt(n,"documentOverlays")}var pe=class{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(nt(t.integerValue));else if("doubleValue"in t){let r=nt(t.doubleValue);isNaN(r)?this.Et(e,13):(this.Et(e,15),li(r)?e.dt(0):e.dt(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Et(e,20),typeof r=="string"&&(r=we(r)),e.At(`${r.seconds||""}`),e.dt(r.nanos||0)}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(Fe(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Et(e,45),e.dt(r.latitude||0),e.dt(r.longitude||0)}else"mapValue"in t?um(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):S()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){let r=t.fields||{};this.Et(e,55);for(let i of Object.keys(r))this.Rt(i,e),this.It(r[i],e)}wt(t,e){let r=t.values||[];this.Et(e,50);for(let i of r)this.It(i,e)}gt(t,e){this.Et(e,37),I.fromName(t).path.forEach(r=>{this.Et(e,60),this.St(r,e)})}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}};pe.bt=new pe;function P_(n){if(n===0)return 8;let t=0;return!(n>>4)&&(t+=4,n<<=4),!(n>>6)&&(t+=2,n<<=2),!(n>>7)&&(t+=1),t}function Af(n){let t=64-function(r){let i=0;for(let s=0;s<8;++s){let o=P_(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(t/8)}var Du=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.Ct(r.value),r=e.next();this.vt()}Ft(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.Mt(r.value),r=e.next();this.xt()}Ot(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.Ct(r);else if(r<2048)this.Ct(960|r>>>6),this.Ct(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.Ct(480|r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r);else{let i=e.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{let i=e.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(t){let e=this.Bt(t),r=Af(e);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=255&e[i]}qt(t){let e=this.Bt(t),r=Af(e);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(t){this.kt(t.length),this.buffer.set(t,this.position),this.position+=t.length}Wt(){return this.buffer.slice(0,this.position)}Bt(t){let e=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(t),r=(128&e[0])!=0;e[0]^=r?255:128;for(let i=1;i<e.length;++i)e[i]^=r?255:0;return e}Ct(t){let e=255&t;e===0?(this.Kt(0),this.Kt(255)):e===255?(this.Kt(255),this.Kt(0)):this.Kt(e)}Mt(t){let e=255&t;e===0?(this.Ut(0),this.Ut(255)):e===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(t){this.kt(1),this.buffer[this.position++]=t}Ut(t){this.kt(1),this.buffer[this.position++]=~t}kt(t){let e=t+this.position;if(e<=this.buffer.length)return;let r=2*this.buffer.length;r<e&&(r=e);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Vu=class{constructor(t){this.Gt=t}ft(t){this.Gt.Dt(t)}At(t){this.Gt.Ot(t)}dt(t){this.Gt.Lt(t)}Tt(){this.Gt.Qt()}},Nu=class{constructor(t){this.Gt=t}ft(t){this.Gt.Ft(t)}At(t){this.Gt.Nt(t)}dt(t){this.Gt.qt(t)}Tt(){this.Gt.$t()}},rn=class{constructor(){this.Gt=new Du,this.zt=new Vu(this.Gt),this.jt=new Nu(this.Gt)}seed(t){this.Gt.seed(t)}Ht(t){return t===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var sn=class n{constructor(t,e,r,i){this.indexId=t,this.documentKey=e,this.arrayValue=r,this.directionalValue=i}Jt(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,r=new Uint8Array(e);return r.set(this.directionalValue,0),e!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Re(n,t){let e=n.indexId-t.indexId;return e!==0?e:(e=Sf(n.arrayValue,t.arrayValue),e!==0?e:(e=Sf(n.directionalValue,t.directionalValue),e!==0?e:I.comparator(n.documentKey,t.documentKey)))}function Sf(n,t){for(let e=0;e<n.length&&e<t.length;++e){let r=n[e]-t[e];if(r!==0)return r}return n.length-t.length}var Xs=class{constructor(t){this.Yt=new $((e,r)=>st.comparator(e.field,r.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.Zt=t.orderBy,this.Xt=[];for(let e of t.filters){let r=e;r.isInequality()?this.Yt=this.Yt.add(r):this.Xt.push(r)}}get en(){return this.Yt.size>1}tn(t){if(P(t.collectionGroup===this.collectionId),this.en)return!1;let e=eu(t);if(e!==void 0&&!this.nn(e))return!1;let r=tn(t),i=new Set,s=0,o=0;for(;s<r.length&&this.nn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Yt.size>0){let a=this.Yt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.rn(a,u)||!this.sn(this.Zt[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Zt.length||!this.sn(this.Zt[o++],a))return!1}return!0}on(){if(this.en)return null;let t=new $(st.comparator),e=[];for(let r of this.Xt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")e.push(new $n(r.field,2));else{if(t.has(r.field))continue;t=t.add(r.field),e.push(new $n(r.field,0))}for(let r of this.Zt)r.field.isKeyField()||t.has(r.field)||(t=t.add(r.field),e.push(new $n(r.field,r.dir==="asc"?0:1)));return new Yn(Yn.UNKNOWN_ID,this.collectionId,e,ci.empty())}nn(t){for(let e of this.Xt)if(this.rn(e,t))return!0;return!1}rn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let r=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===r}sn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function Qm(n){var t,e;if(P(n instanceof M||n instanceof K),n instanceof M){if(n instanceof js){let i=((e=(t=n.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>M.create(n.field,"==",s)))||[];return K.create(i,"or")}return n}let r=n.filters.map(i=>Qm(i));return K.create(r,n.op)}function b_(n){if(n.getFilters().length===0)return[];let t=Mu(Qm(n));return P(Wm(t)),ku(t)||Fu(t)?[t]:t.getFilters()}function ku(n){return n instanceof M}function Fu(n){return n instanceof K&&Yc(n)}function Wm(n){return ku(n)||Fu(n)||function(e){if(e instanceof K&&cu(e)){for(let r of e.getFilters())if(!ku(r)&&!Fu(r))return!1;return!0}return!1}(n)}function Mu(n){if(P(n instanceof M||n instanceof K),n instanceof M)return n;if(n.filters.length===1)return Mu(n.filters[0]);let t=n.filters.map(r=>Mu(r)),e=K.create(t,n.op);return e=Zs(e),Wm(e)?e:(P(e instanceof K),P(Xn(e)),P(e.filters.length>1),e.filters.reduce((r,i)=>el(r,i)))}function el(n,t){let e;return P(n instanceof M||n instanceof K),P(t instanceof M||t instanceof K),e=n instanceof M?t instanceof M?function(i,s){return K.create([i,s],"and")}(n,t):Pf(n,t):t instanceof M?Pf(t,n):function(i,s){if(P(i.filters.length>0&&s.filters.length>0),Xn(i)&&Xn(s))return dm(i,s.getFilters());let o=cu(i)?i:s,a=cu(i)?s:i,u=o.filters.map(c=>el(c,a));return K.create(u,"or")}(n,t),Zs(e)}function Pf(n,t){if(Xn(t))return dm(t,n.getFilters());{let e=t.filters.map(r=>el(n,r));return K.create(e,"or")}}function Zs(n){if(P(n instanceof M||n instanceof K),n instanceof M)return n;let t=n.getFilters();if(t.length===1)return Zs(t[0]);if(lm(n))return n;let e=t.map(i=>Zs(i)),r=[];return e.forEach(i=>{i instanceof M?r.push(i):i instanceof K&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:K.create(r,n.op)}var Ou=class{constructor(){this._n=new Ei}addToCollectionParentIndex(t,e){return this._n.add(e),f.resolve()}getCollectionParents(t,e){return f.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return f.resolve()}deleteFieldIndex(t,e){return f.resolve()}deleteAllFieldIndexes(t){return f.resolve()}createTargetIndexes(t,e){return f.resolve()}getDocumentsMatchingTarget(t,e){return f.resolve(null)}getIndexType(t,e){return f.resolve(0)}getFieldIndexes(t,e){return f.resolve([])}getNextCollectionGroupToUpdate(t){return f.resolve(null)}getMinOffset(t,e){return f.resolve(jt.min())}getMinOffsetFromCollectionGroup(t,e){return f.resolve(jt.min())}updateCollectionGroup(t,e,r){return f.resolve()}updateIndexEntries(t,e){return f.resolve()}},Ei=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e]||new $(L.comparator),s=!i.has(r);return this.index[e]=i.add(r),s}has(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e];return i&&i.has(r)}getEntries(t){return(this.index[t]||new $(L.comparator)).toArray()}};var As=new Uint8Array(0),Lu=class{constructor(t,e){this.databaseId=e,this.an=new Ei,this.un=new ce(r=>hn(r),(r,i)=>Vi(r,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.an.has(e)){let r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this.an.add(e)});let s={collectionId:r,parent:Rt(i)};return bf(t).put(s)}return f.resolve()}getCollectionParents(t,e){let r=[],i=IDBKeyRange.bound([e,""],[Yf(e),""],!1,!0);return bf(t).W(i).next(s=>{for(let o of s){if(o.collectionId!==e)break;r.push(ne(o.parent))}return r})}addFieldIndex(t,e){let r=Zr(t),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(e);delete i.indexId;let s=r.add(i);if(e.indexState){let o=Ln(t);return s.next(a=>{o.put(If(a,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let r=Zr(t),i=Ln(t),s=On(t);return r.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=Zr(t),r=On(t),i=Ln(t);return e.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(t,e){return f.forEach(this.cn(e),r=>this.getIndexType(t,r).next(i=>{if(i===0||i===1){let s=new Xs(r).on();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let r=On(t),i=!0,s=new Map;return f.forEach(this.cn(e),o=>this.ln(t,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=V(),a=[];return f.forEach(s,(u,c)=>{_("IndexedDbIndexManager",`Using index ${function(x){return`id=${x.indexId}|cg=${x.collectionGroup}|f=${x.fields.map(U=>`${U.fieldPath}:${U.kind}`).join(",")}`}(u)} to execute ${hn(e)}`);let l=function(x,U){let j=eu(U);if(j===void 0)return null;for(let B of zs(x,j.fieldPath))switch(B.op){case"array-contains-any":return B.value.arrayValue.values||[];case"array-contains":return[B.value]}return null}(c,u),h=function(x,U){let j=new Map;for(let B of tn(U))for(let at of zs(x,B.fieldPath))switch(at.op){case"==":case"in":j.set(B.fieldPath.canonicalString(),at.value);break;case"not-in":case"!=":return j.set(B.fieldPath.canonicalString(),at.value),Array.from(j.values())}return null}(c,u),d=function(x,U){let j=[],B=!0;for(let at of tn(U)){let Yt=at.kind===0?of(x,at.fieldPath,x.startAt):af(x,at.fieldPath,x.startAt);j.push(Yt.value),B&&(B=Yt.inclusive)}return new ue(j,B)}(c,u),m=function(x,U){let j=[],B=!0;for(let at of tn(U)){let Yt=at.kind===0?af(x,at.fieldPath,x.endAt):of(x,at.fieldPath,x.endAt);j.push(Yt.value),B&&(B=Yt.inclusive)}return new ue(j,B)}(c,u),A=this.hn(u,c,d),w=this.hn(u,c,m),v=this.Pn(u,c,h),R=this.In(u.indexId,l,A,d.inclusive,w,m.inclusive,v);return f.forEach(R,F=>r.j(F,e.limit).next(x=>{x.forEach(U=>{let j=I.fromSegments(U.documentKey);o.has(j)||(o=o.add(j),a.push(j))})}))}).next(()=>a)}return f.resolve(null)})}cn(t){let e=this.un.get(t);return e||(t.filters.length===0?e=[t]:e=b_(K.create(t.filters,"and")).map(r=>_u(t.path,t.collectionGroup,t.orderBy,r.getFilters(),t.limit,t.startAt,t.endAt)),this.un.set(t,e),e)}In(t,e,r,i,s,o,a){let u=(e!=null?e.length:1)*Math.max(r.length,s.length),c=u/(e!=null?e.length:1),l=[];for(let h=0;h<u;++h){let d=e?this.Tn(e[h/c]):As,m=this.En(t,d,r[h%c],i),A=this.dn(t,d,s[h%c],o),w=a.map(v=>this.En(t,d,v,!0));l.push(...this.createRange(m,A,w))}return l}En(t,e,r,i){let s=new sn(t,I.empty(),e,r);return i?s:s.Jt()}dn(t,e,r,i){let s=new sn(t,I.empty(),e,r);return i?s.Jt():s}ln(t,e){let r=new Xs(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let o=null;for(let a of s)r.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(t,e){let r=2,i=this.cn(e);return f.forEach(i,s=>this.ln(t,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new $(st.comparator),l=!1;for(let h of u.filters)for(let d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:c=c.add(d.field));for(let h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(e)&&i.length>1&&r===2?1:r)}An(t,e){let r=new rn;for(let i of tn(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let o=r.Ht(i.kind);pe.bt.Pt(s,o)}return r.Wt()}Tn(t){let e=new rn;return pe.bt.Pt(t,e.Ht(0)),e.Wt()}Rn(t,e){let r=new rn;return pe.bt.Pt(cn(this.databaseId,e),r.Ht(function(s){let o=tn(s);return o.length===0?0:o[o.length-1].kind}(t))),r.Wt()}Pn(t,e,r){if(r===null)return[];let i=[];i.push(new rn);let s=0;for(let o of tn(t)){let a=r[s++];for(let u of i)if(this.Vn(e,o.fieldPath)&&mi(a))i=this.mn(i,o,a);else{let c=u.Ht(o.kind);pe.bt.Pt(a,c)}}return this.fn(i)}hn(t,e,r){return this.Pn(t,e,r.position)}fn(t){let e=[];for(let r=0;r<t.length;++r)e[r]=t[r].Wt();return e}mn(t,e,r){let i=[...t],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new rn;u.seed(a.Wt()),pe.bt.Pt(o,u.Ht(e.kind)),s.push(u)}return s}Vn(t,e){return!!t.filters.find(r=>r instanceof M&&r.field.isEqual(e)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(t,e){let r=Zr(t),i=Ln(t);return(e?r.W("collectionGroupIndex",IDBKeyRange.bound(e,e)):r.W()).next(s=>{let o=[];return f.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){let d=h?new ci(h.sequenceNumber,new jt(mn(h.readTime),new I(ne(h.documentKey)),h.largestBatchId)):ci.empty(),m=l.fields.map(([A,w])=>new $n(st.fromServerFormat(A),w));return new Yn(l.indexId,l.collectionGroup,m,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:D(r.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,r){let i=Zr(t),s=Ln(t);return this.gn(t).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(a=>f.forEach(a,u=>s.put(If(u.indexId,this.uid,o,r)))))}updateIndexEntries(t,e){let r=new Map;return f.forEach(e,(i,s)=>{let o=r.get(i.collectionGroup);return(o?f.resolve(o):this.getFieldIndexes(t,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),f.forEach(a,u=>this.pn(t,i,u).next(c=>{let l=this.yn(s,u);return c.isEqual(l)?f.resolve():this.wn(t,s,u,c,l)}))))})}Sn(t,e,r,i){return On(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(r,e.key),documentKey:e.key.path.toArray()})}bn(t,e,r,i){return On(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(r,e.key),e.key.path.toArray()])}pn(t,e,r){let i=On(t),s=new $(Re);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.Rn(r,e)])},(o,a)=>{s=s.add(new sn(r.indexId,e,a.arrayValue,a.directionalValue))}).next(()=>s)}yn(t,e){let r=new $(Re),i=this.An(e,t);if(i==null)return r;let s=eu(e);if(s!=null){let o=t.data.field(s.fieldPath);if(mi(o))for(let a of o.arrayValue.values||[])r=r.add(new sn(e.indexId,t.key,this.Tn(a),i))}else r=r.add(new sn(e.indexId,t.key,As,i));return r}wn(t,e,r,i,s){_("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let o=[];return function(u,c,l,h,d){let m=u.getIterator(),A=c.getIterator(),w=Mn(m),v=Mn(A);for(;w||v;){let R=!1,F=!1;if(w&&v){let x=l(w,v);x<0?F=!0:x>0&&(R=!0)}else w!=null?F=!0:R=!0;R?(h(v),v=Mn(A)):F?(d(w),w=Mn(m)):(w=Mn(m),v=Mn(A))}}(i,s,Re,a=>{o.push(this.Sn(t,e,r,a))},a=>{o.push(this.bn(t,e,r,a))}),f.waitFor(o)}gn(t){let e=1;return Ln(t).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,r){r=r.sort((o,a)=>Re(o,a)).filter((o,a,u)=>!a||Re(o,u[a-1])!==0);let i=[];i.push(t);for(let o of r){let a=Re(o,t),u=Re(o,e);if(a===0)i[0]=t.Jt();else if(a>0&&u<0)i.push(o),i.push(o.Jt());else if(u>0)break}i.push(e);let s=[];for(let o=0;o<i.length;o+=2){if(this.Dn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,As,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,As,[]];s.push(IDBKeyRange.bound(a,u))}return s}Dn(t,e){return Re(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Rf)}getMinOffset(t,e){return f.mapArray(this.cn(e),r=>this.ln(t,r).next(i=>i||S())).next(Rf)}};function bf(n){return wt(n,"collectionParents")}function On(n){return wt(n,"indexEntries")}function Zr(n){return wt(n,"indexConfiguration")}function Ln(n){return wt(n,"indexState")}function Rf(n){P(n.length!==0);let t=n[0].indexState.offset,e=t.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Qc(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new jt(t.readTime,t.documentKey,e)}var xf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Bt=class n{constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function Hm(n,t,e){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(e.batchId),a=0,u=r.Y({range:o},(l,h,d)=>(a++,d.delete()));s.push(u.next(()=>{P(a===1)}));let c=[];for(let l of e.mutations){let h=em(t,l.key.path,e.batchId);s.push(i.delete(h)),c.push(l.key)}return f.waitFor(s).next(()=>c)}function to(n){if(!n)return 0;let t;if(n.document)t=n.document;else if(n.unknownDocument)t=n.unknownDocument;else{if(!n.noDocument)throw S();t=n.noDocument}return JSON.stringify(t).length}Bt.DEFAULT_COLLECTION_PERCENTILE=10,Bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Bt.DEFAULT=new Bt(41943040,Bt.DEFAULT_COLLECTION_PERCENTILE,Bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Bt.DISABLED=new Bt(-1,0,0);var eo=class n{constructor(t,e,r,i){this.userId=t,this.serializer=e,this.indexManager=r,this.referenceDelegate=i,this.Cn={}}static lt(t,e,r,i){P(t.uid!=="");let s=t.isAuthenticated()?t.uid:"";return new n(s,e,r,i)}checkEmpty(t){let e=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return xe(t).Y({index:"userMutationsIndex",range:r},(i,s,o)=>{e=!1,o.done()}).next(()=>e)}addMutationBatch(t,e,r,i){let s=zn(t),o=xe(t);return o.add({}).next(a=>{P(typeof a=="number");let u=new pi(a,e,r,i),c=function(m,A,w){let v=w.baseMutations.map(F=>Ii(m.ct,F)),R=w.mutations.map(F=>Ii(m.ct,F));return{userId:A,batchId:w.batchId,localWriteTimeMs:w.localWriteTime.toMillis(),baseMutations:v,mutations:R}}(this.serializer,this.userId,u),l=[],h=new $((d,m)=>D(d.canonicalString(),m.canonicalString()));for(let d of i){let m=em(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(s.put(m,ky))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(t,d))}),t.addOnCommittedListener(()=>{this.Cn[a]=u.keys()}),f.waitFor(l).next(()=>u)})}lookupMutationBatch(t,e){return xe(t).get(e).next(r=>r?(P(r.userId===this.userId),nn(this.serializer,r)):null)}vn(t,e){return this.Cn[e]?f.resolve(this.Cn[e]):this.lookupMutationBatch(t,e).next(r=>{if(r){let i=r.keys();return this.Cn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return xe(t).Y({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(P(a.batchId>=r),s=nn(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return xe(t).Y({index:"userMutationsIndex",range:e,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return xe(t).W("userMutationsIndex",e).next(r=>r.map(i=>nn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let r=Rs(this.userId,e.path),i=IDBKeyRange.lowerBound(r),s=[];return zn(t).Y({range:i},(o,a,u)=>{let[c,l,h]=o,d=ne(l);if(c===this.userId&&e.path.isEqual(d))return xe(t).get(h).next(m=>{if(!m)throw S();P(m.userId===this.userId),s.push(nn(this.serializer,m))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new $(D),i=[];return e.forEach(s=>{let o=Rs(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=zn(t).Y({range:a},(c,l,h)=>{let[d,m,A]=c,w=ne(m);d===this.userId&&s.path.isEqual(w)?r=r.add(A):h.done()});i.push(u)}),f.waitFor(i).next(()=>this.Fn(t,r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,i=r.length+1,s=Rs(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new $(D);return zn(t).Y({range:o},(u,c,l)=>{let[h,d,m]=u,A=ne(d);h===this.userId&&r.isPrefixOf(A)?A.length===i&&(a=a.add(m)):l.done()}).next(()=>this.Fn(t,a))}Fn(t,e){let r=[],i=[];return e.forEach(s=>{i.push(xe(t).get(s).next(o=>{if(o===null)throw S();P(o.userId===this.userId),r.push(nn(this.serializer,o))}))}),f.waitFor(i).next(()=>r)}removeMutationBatch(t,e){return Hm(t.ae,this.userId,e).next(r=>(t.addOnCommittedListener(()=>{this.Mn(e.batchId)}),f.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}Mn(t){delete this.Cn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return f.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return zn(t).Y({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=ne(s[1]);i.push(u)}else a.done()}).next(()=>{P(i.length===0)})})}containsKey(t,e){return Ym(t,this.userId,e)}xn(t){return Jm(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function Ym(n,t,e){let r=Rs(t,e.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return zn(n).Y({range:s,J:!0},(a,u,c)=>{let[l,h,d]=a;l===t&&h===i&&(o=!0),c.done()}).next(()=>o)}function xe(n){return wt(n,"mutations")}function zn(n){return wt(n,"documentMutations")}function Jm(n){return wt(n,"mutationQueues")}var rr=class n{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new n(0)}static Ln(){return new n(-1)}};var qu=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.Bn(t).next(e=>{let r=new rr(e.highestTargetId);return e.highestTargetId=r.next(),this.kn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Bn(t).next(e=>b.fromTimestamp(new Z(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Bn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,r){return this.Bn(t).next(i=>(i.highestListenSequenceNumber=e,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.kn(t,i)))}addTargetData(t,e){return this.qn(t,e).next(()=>this.Bn(t).next(r=>(r.targetCount+=1,this.Qn(e,r),this.kn(t,r))))}updateTargetData(t,e){return this.qn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>qn(t).delete(e.targetId)).next(()=>this.Bn(t)).next(r=>(P(r.targetCount>0),r.targetCount-=1,this.kn(t,r)))}removeTargets(t,e,r){let i=0,s=[];return qn(t).Y((o,a)=>{let u=ri(a);u.sequenceNumber<=e&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(t,u)))}).next(()=>f.waitFor(s)).next(()=>i)}forEachTarget(t,e){return qn(t).Y((r,i)=>{let s=ri(i);e(s)})}Bn(t){return Cf(t).get("targetGlobalKey").next(e=>(P(e!==null),e))}kn(t,e){return Cf(t).put("targetGlobalKey",e)}qn(t,e){return qn(t).put($m(this.serializer,e))}Qn(t,e){let r=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,r=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,r=!0),r}getTargetCount(t){return this.Bn(t).next(e=>e.targetCount)}getTargetData(t,e){let r=hn(e),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return qn(t).Y({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=ri(a);Vi(e,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(t,e,r){let i=[],s=Ce(t);return e.forEach(o=>{let a=Rt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(t,r,o))}),f.waitFor(i)}removeMatchingKeys(t,e,r){let i=Ce(t);return f.forEach(e,s=>{let o=Rt(s.path);return f.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(t,r,s)])})}removeMatchingKeysForTargetId(t,e){let r=Ce(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(t,e){let r=IDBKeyRange.bound([e],[e+1],!1,!0),i=Ce(t),s=V();return i.Y({range:r,J:!0},(o,a,u)=>{let c=ne(o[1]),l=new I(c);s=s.add(l)}).next(()=>s)}containsKey(t,e){let r=Rt(e.path),i=IDBKeyRange.bound([r],[Yf(r)],!1,!0),s=0;return Ce(t).Y({index:"documentTargetsIndex",J:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}_t(t,e){return qn(t).get(e).next(r=>r?ri(r):null)}};function qn(n){return wt(n,"targets")}function Cf(n){return wt(n,"targetGlobal")}function Ce(n){return wt(n,"targetDocuments")}function Df([n,t],[e,r]){let i=D(n,e);return i===0?D(t,r):i}var Bu=class{constructor(t){this.Kn=t,this.buffer=new $(Df),this.$n=0}Un(){return++this.$n}Wn(t){let e=[t,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();Df(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},Uu=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(t){_("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>p(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){ze(e)?_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield Ge(e)}yield this.zn(3e5)}))}},ju=class{constructor(t,e){this.jn=t,this.params=e}calculateTargetCount(t,e){return this.jn.Hn(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return f.resolve(Ft._e);let r=new Bu(e);return this.jn.forEachTarget(t,i=>r.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(t,i=>r.Wn(i))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.jn.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.jn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(_("LruGarbageCollector","Garbage collection skipped; disabled"),f.resolve(xf)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),xf):this.Yn(t,e))}getCacheSize(t){return this.jn.getCacheSize(t)}Yn(t,e){let r,i,s,o,a,u,c,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(t,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(t,r,e))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(t,r))).next(h=>(c=Date.now(),Bn()<=Jt.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${h} documents in `+(c-u)+`ms
Total Duration: ${c-l}ms`),f.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}};function R_(n,t){return new ju(n,t)}var Gu=class{constructor(t,e){this.db=t,this.garbageCollector=R_(this,e)}Hn(t){let e=this.Zn(t);return this.db.getTargetCache().getTargetCount(t).next(r=>e.next(i=>r+i))}Zn(t){let e=0;return this.Jn(t,r=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Jn(t,e){return this.Xn(t,(r,i)=>e(i))}addReference(t,e,r){return Ss(t,r)}removeReference(t,e,r){return Ss(t,r)}removeTargets(t,e,r){return this.db.getTargetCache().removeTargets(t,e,r)}markPotentiallyOrphaned(t,e){return Ss(t,e)}er(t,e){return function(i,s){let o=!1;return Jm(i).Z(a=>Ym(i,a,s).next(u=>(u&&(o=!0),f.resolve(!u)))).next(()=>o)}(t,e)}removeOrphanedDocuments(t,e){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Xn(t,(o,a)=>{if(a<=e){let u=this.er(t,o).next(c=>{if(!c)return s++,r.getEntry(t,o).next(()=>(r.removeEntry(o,b.min()),Ce(t).delete(function(h){return[0,Rt(h.path)]}(o))))});i.push(u)}}).next(()=>f.waitFor(i)).next(()=>r.apply(t)).next(()=>s)}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,r)}updateLimboDocument(t,e){return Ss(t,e)}Xn(t,e){let r=Ce(t),i,s=Ft._e;return r.Y({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==Ft._e&&e(new I(ne(i)),s),s=c,i=u):s=Ft._e}).next(()=>{s!==Ft._e&&e(new I(ne(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Ss(n,t){return Ce(n).put(function(r,i){return{targetId:0,path:Rt(r.path),sequenceNumber:i}}(t,n.currentSequenceNumber))}var no=class{constructor(){this.changes=new ce(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,mt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?f.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var zu=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,r){return Ze(t).put(r)}removeEntry(t,e,r){return Ze(t).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Ys(o),a[a.length-1]]}(e,r))}updateMetadata(t,e){return this.getMetadata(t).next(r=>(r.byteSize+=e,this.tr(t,r)))}getEntry(t,e){let r=mt.newInvalidDocument(e);return Ze(t).Y({index:"documentKeyIndex",range:IDBKeyRange.only(ti(e))},(i,s)=>{r=this.nr(e,s)}).next(()=>r)}rr(t,e){let r={size:0,document:mt.newInvalidDocument(e)};return Ze(t).Y({index:"documentKeyIndex",range:IDBKeyRange.only(ti(e))},(i,s)=>{r={document:this.nr(e,s),size:to(s)}}).next(()=>r)}getEntries(t,e){let r=Vt();return this.ir(t,e,(i,s)=>{let o=this.nr(i,s);r=r.insert(i,o)}).next(()=>r)}sr(t,e){let r=Vt(),i=new Y(I.comparator);return this.ir(t,e,(s,o)=>{let a=this.nr(s,o);r=r.insert(s,a),i=i.insert(s,to(o))}).next(()=>({documents:r,_r:i}))}ir(t,e,r){if(e.isEmpty())return f.resolve();let i=new $(kf);e.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(ti(i.first()),ti(i.last())),o=i.getIterator(),a=o.getNext();return Ze(t).Y({index:"documentKeyIndex",range:s},(u,c,l)=>{let h=I.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&kf(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.U(ti(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(t,e,r,i,s){let o=e.path,a=[o.popLast().toArray(),o.lastSegment(),Ys(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ze(t).W(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=Vt();for(let h of c){let d=this.nr(I.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(ki(e,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(t,e,r,i){let s=Vt(),o=Nf(e,r),a=Nf(e,jt.max());return Ze(t).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{let h=this.nr(I.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(t){return new Ku(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Vf(t).get("remoteDocumentGlobalKey").next(e=>(P(!!e),e))}tr(t,e){return Vf(t).put("remoteDocumentGlobalKey",e)}nr(t,e){if(e){let r=S_(this.serializer,e);if(!(r.isNoDocument()&&r.version.isEqual(b.min())))return r}return mt.newInvalidDocument(t)}};function Xm(n){return new zu(n)}var Ku=class extends no{constructor(t,e){super(),this.ar=t,this.trackRemovals=e,this.ur=new ce(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(t){let e=[],r=0,i=new $((s,o)=>D(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ur.get(s);if(e.push(this.ar.removeEntry(t,s,a.readTime)),o.isValidDocument()){let u=wf(this.ar.serializer,o);i=i.add(s.path.popLast());let c=to(u);r+=c-a.size,e.push(this.ar.addEntry(t,s,u))}else if(r-=a.size,this.trackRemovals){let u=wf(this.ar.serializer,o.convertToNoDocument(b.min()));e.push(this.ar.addEntry(t,s,u))}}),i.forEach(s=>{e.push(this.ar.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.ar.updateMetadata(t,r)),f.waitFor(e)}getFromCache(t,e){return this.ar.rr(t,e).next(r=>(this.ur.set(e,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(t,e){return this.ar.sr(t,e).next(({documents:r,_r:i})=>(i.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function Vf(n){return wt(n,"remoteDocumentGlobal")}function Ze(n){return wt(n,"remoteDocumentsV14")}function ti(n){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Nf(n,t){let e=t.documentKey.path.toArray();return[n,Ys(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function kf(n,t){let e=n.path.toArray(),r=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<r.length-2;++s)if(i=D(e[s],r[s]),i)return i;return i=D(e.length,r.length),i||(i=D(e[e.length-2],r[r.length-2]),i||D(e[e.length-1],r[r.length-1]))}var $u=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var ro=class{constructor(t,e,r,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=i}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(r=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(r!==null&&oi(r.mutation,i,Mt.empty(),Z.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,V()).next(()=>r))}getLocalViewOfDocuments(t,e,r=V()){let i=re();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,r).next(s=>{let o=ni();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){let r=re();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,V()))}populateOverlays(t,e,r){let i=[];return r.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((o,a)=>{e.set(o,a)})})}computeViews(t,e,r,i){let s=Vt(),o=si(),a=function(){return si()}();return e.forEach((u,c)=>{let l=r.get(c.key);i.has(c.key)&&(l===void 0||l.mutation instanceof Qt)?s=s.insert(c.key,c):l!==void 0?(o.set(c.key,l.mutation.getFieldMask()),oi(l.mutation,c,l.mutation.getFieldMask(),Z.now())):o.set(c.key,Mt.empty())}),this.recalculateAndSaveOverlays(t,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),e.forEach((c,l)=>{var h;return a.set(c,new $u(l,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(t,e){let r=si(),i=new Y((o,a)=>o-a),s=V();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=e.get(u);if(c===null)return;let l=r.get(u)||Mt.empty();l=a.applyToLocalView(c,l),r.set(u,l);let h=(i.get(a.batchId)||V()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,l=u.value,h=Im();l.forEach(d=>{if(!s.has(d)){let m=xm(e.get(d),r.get(d));m!==null&&h.set(d,m),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(t,c,h))}return f.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,i){return function(o){return I.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Jc(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,i):this.getDocumentsMatchingCollectionQuery(t,e,r,i)}getNextDocuments(t,e,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,i-s.size):f.resolve(re()),a=-1,u=s;return o.next(c=>f.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?f.resolve():this.remoteDocumentCache.getEntry(t,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(t,c,s)).next(()=>this.computeViews(t,u,c,V())).next(l=>({batchId:a,changes:vm(l)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new I(e)).next(r=>{let i=ni();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,r,i){let s=e.collectionGroup,o=ni();return this.indexManager.getCollectionParents(t,s).next(a=>f.forEach(a,u=>{let c=function(h,d){return new $t(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(e,u.child(s));return this.getDocumentsMatchingCollectionQuery(t,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,s,i))).next(o=>{s.forEach((u,c)=>{let l=c.getKey();o.get(l)===null&&(o=o.insert(l,mt.newInvalidDocument(l)))});let a=ni();return o.forEach((u,c)=>{let l=s.get(u);l!==void 0&&oi(l.mutation,c,Mt.empty(),Z.now()),ki(e,c)&&(a=a.insert(u,c))}),a})}};var Qu=class{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return f.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(i){return{id:i.id,version:i.version,createTime:ot(i.createTime)}}(e)),f.resolve()}getNamedQuery(t,e){return f.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(i){return{name:i.name,query:tl(i.bundledQuery),readTime:ot(i.readTime)}}(e)),f.resolve()}};var Wu=class{constructor(){this.overlays=new Y(I.comparator),this.hr=new Map}getOverlay(t,e){return f.resolve(this.overlays.get(e))}getOverlays(t,e){let r=re();return f.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((i,s)=>{this.ht(t,e,s)}),f.resolve()}removeOverlaysForBatchId(t,e,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),f.resolve()}getOverlaysForCollection(t,e,r){let i=re(),s=e.length+1,o=new I(e.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!e.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return f.resolve(i)}getOverlaysForCollectionGroup(t,e,r,i){let s=new Y((c,l)=>c-l),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===e&&c.largestBatchId>r){let l=s.get(c.largestBatchId);l===null&&(l=re(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}let a=re(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return f.resolve(a)}ht(t,e,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new yi(e,r));let s=this.hr.get(e);s===void 0&&(s=V(),this.hr.set(e,s)),this.hr.set(e,s.add(r.key))}};var Ti=class{constructor(){this.Pr=new $(ht.Ir),this.Tr=new $(ht.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){let r=new ht(t,e);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.Ar(new ht(t,e))}Rr(t,e){t.forEach(r=>this.removeReference(r,e))}Vr(t){let e=new I(new L([])),r=new ht(e,t),i=new ht(e,t+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(t=>this.Ar(t))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){let e=new I(new L([])),r=new ht(e,t),i=new ht(e,t+1),s=V();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(t){let e=new ht(t,0),r=this.Pr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},ht=class{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return I.comparator(t.key,e.key)||D(t.pr,e.pr)}static Er(t,e){return D(t.pr,e.pr)||I.comparator(t.key,e.key)}};var Hu=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new $(ht.Ir)}checkEmpty(t){return f.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new pi(s,e,r,i);this.mutationQueue.push(o);for(let a of i)this.wr=this.wr.add(new ht(a.key,s)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return f.resolve(o)}lookupMutationBatch(t,e){return f.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,i=this.br(r),s=i<0?0:i;return f.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return f.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(t){return f.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new ht(e,0),i=new ht(e,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{let a=this.Sr(o.pr);s.push(a)}),f.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new $(D);return e.forEach(i=>{let s=new ht(i,0),o=new ht(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),f.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,i=r.length+1,s=r;I.isDocumentKey(s)||(s=s.child(""));let o=new ht(new I(s),0),a=new $(D);return this.wr.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.pr)),!0)},o),f.resolve(this.Dr(a))}Dr(t){let e=[];return t.forEach(r=>{let i=this.Sr(r);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){P(this.Cr(e.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return f.forEach(e.mutations,i=>{let s=new ht(i.key,e.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.wr=r})}Mn(t){}containsKey(t,e){let r=new ht(e,0),i=this.wr.firstAfterOrEqual(r);return f.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,f.resolve()}Cr(t,e){return this.br(t)}br(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Sr(t){let e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Yu=class{constructor(t){this.vr=t,this.docs=function(){return new Y(I.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return f.resolve(r?r.document.mutableCopy():mt.newInvalidDocument(e))}getEntries(t,e){let r=Vt();return e.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():mt.newInvalidDocument(i))}),f.resolve(r)}getDocumentsMatchingQuery(t,e,r,i){let s=Vt(),o=e.path,a=new I(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Qc(Xf(l),r)<=0||(i.has(l.key)||ki(e,l))&&(s=s.insert(l.key,l.mutableCopy()))}return f.resolve(s)}getAllFromCollectionGroup(t,e,r,i){S()}Fr(t,e){return f.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new Ju(this)}getSize(t){return f.resolve(this.size)}},Ju=class extends no{constructor(t){super(),this.ar=t}applyChanges(t){let e=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?e.push(this.ar.addEntry(t,i)):this.ar.removeEntry(r)}),f.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}};var Xu=class{constructor(t){this.persistence=t,this.Mr=new ce(e=>hn(e),Vi),this.lastRemoteSnapshotVersion=b.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Ti,this.targetCount=0,this.Lr=rr.Nn()}forEachTarget(t,e){return this.Mr.forEach((r,i)=>e(i)),f.resolve()}getLastRemoteSnapshotVersion(t){return f.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return f.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Lr.next(),f.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.Or&&(this.Or=e),f.resolve()}qn(t){this.Mr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Lr=new rr(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,f.resolve()}updateTargetData(t,e){return this.qn(e),f.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,f.resolve()}removeTargets(t,e,r){let i=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=e&&r.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),f.waitFor(s).next(()=>i)}getTargetCount(t){return f.resolve(this.targetCount)}getTargetData(t,e){let r=this.Mr.get(e)||null;return f.resolve(r)}addMatchingKeys(t,e,r){return this.Nr.dr(e,r),f.resolve()}removeMatchingKeys(t,e,r){this.Nr.Rr(e,r);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(o=>{s.push(i.markPotentiallyOrphaned(t,o))}),f.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),f.resolve()}getMatchingKeysForTargetId(t,e){let r=this.Nr.gr(e);return f.resolve(r)}containsKey(t,e){return f.resolve(this.Nr.containsKey(e))}};var io=class{constructor(t,e){this.Br={},this.overlays={},this.kr=new Ft(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new Xu(this),this.indexManager=new Ou,this.remoteDocumentCache=function(i){return new Yu(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new Hs(e),this.$r=new Qu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Wu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.Br[t.toKey()];return r||(r=new Hu(e,this.referenceDelegate),this.Br[t.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,r){_("MemoryPersistence","Starting transaction:",t);let i=new Zu(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(t,e){return f.or(Object.values(this.Br).map(r=>()=>r.containsKey(t,e)))}},Zu=class extends Os{constructor(t){super(),this.currentSequenceNumber=t}},so=class n{constructor(t){this.persistence=t,this.zr=new Ti,this.jr=null}static Hr(t){return new n(t)}get Jr(){if(this.jr)return this.jr;throw S()}addReference(t,e,r){return this.zr.addReference(r,e),this.Jr.delete(r.toString()),f.resolve()}removeReference(t,e,r){return this.zr.removeReference(r,e),this.Jr.add(r.toString()),f.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),f.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(t,e))}Ur(){this.jr=new Set}Wr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return f.forEach(this.Jr,r=>{let i=I.fromPath(r);return this.Yr(t,i).next(s=>{s||e.removeEntry(i,b.min())})}).next(()=>(this.jr=null,e.apply(t)))}updateLimboDocument(t,e){return this.Yr(t,e).next(r=>{r?this.Jr.delete(e.toString()):this.Jr.add(e.toString())})}Kr(t){return 0}Yr(t,e){return f.or([()=>f.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}};var tc=class{constructor(t){this.serializer=t}N(t,e,r,i){let s=new Ls("createOrUpgrade",e);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(t),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Yd,{unique:!0}),u.createObjectStore("documentMutations")}(t),Ff(t),function(u){u.createObjectStore("remoteDocuments")}(t));let o=f.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(t),Ff(t)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:b.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").W().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Yd,{unique:!0});let h=c.store("mutations"),d=l.map(m=>h.put(m));return f.waitFor(d)})}(t,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),r<5&&i>=5&&(o=o.next(()=>this.Xr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(t),this.ei(s)))),r<7&&i>=7&&(o=o.next(()=>this.ti(s))),r<8&&i>=8&&(o=o.next(()=>this.ni(t,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(t)})),r<10&&i>=10&&(o=o.next(()=>this.ri(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:$y});c.createIndex("collectionPathOverlayIndex",Qy,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",Wy,{unique:!1})})(t)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:Fy});c.createIndex("documentKeyIndex",My),c.createIndex("collectionGroupIndex",Oy)}(t)).next(()=>this.ii(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.si(t,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:jy}).createIndex("sequenceNumberIndex",Gy,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:zy}).createIndex("documentKeyIndex",Ky,{unique:!1})}(t))),r<16&&i>=16&&(o=o.next(()=>{e.objectStore("indexState").clear()}).next(()=>{e.objectStore("indexEntries").clear()})),o}ei(t){let e=0;return t.store("remoteDocuments").Y((r,i)=>{e+=to(i)}).next(()=>{let r={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Xr(t){let e=t.store("mutationQueues"),r=t.store("mutations");return e.W().next(i=>f.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>f.forEach(a,u=>{P(u.userId===s.userId);let c=nn(this.serializer,u);return Hm(t,s.userId,c).next(()=>{})}))}))}ti(t){let e=t.store("targetDocuments"),r=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.Y((o,a)=>{let u=new L(o),c=function(h){return[0,Rt(h)]}(u);s.push(e.get(c).next(l=>l?f.resolve():(h=>e.put({targetId:0,path:Rt(h),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>f.waitFor(s))})}ni(t,e){t.createObjectStore("collectionParents",{keyPath:Uy});let r=e.store("collectionParents"),i=new Ei,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Rt(u)})}};return e.store("remoteDocuments").Y({J:!0},(o,a)=>{let u=new L(o);return s(u.popLast())}).next(()=>e.store("documentMutations").Y({J:!0},([o,a,u],c)=>{let l=ne(a);return s(l.popLast())}))}ri(t){let e=t.store("targets");return e.Y((r,i)=>{let s=ri(i),o=$m(this.serializer,s);return e.put(o)})}ii(t,e){let r=e.store("remoteDocuments"),i=[];return r.Y((s,o)=>{let a=e.store("remoteDocumentsV14"),u=function(h){return h.document?new I(L.fromString(h.document.name).popFirst(5)):h.noDocument?I.fromSegments(h.noDocument.path):h.unknownDocument?I.fromSegments(h.unknownDocument.path):S()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>f.waitFor(i))}si(t,e){let r=e.store("mutations"),i=Xm(this.serializer),s=new io(so.Hr,this.serializer.ct);return r.W().next(o=>{let a=new Map;return o.forEach(u=>{var c;let l=(c=a.get(u.userId))!==null&&c!==void 0?c:V();nn(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),f.forEach(a,(u,c)=>{let l=new dt(c),h=Js.lt(this.serializer,l),d=s.getIndexManager(l),m=eo.lt(l,this.serializer,d,s.referenceDelegate);return new ro(i,m,h,d).recalculateAndSaveOverlaysForDocumentKeys(new hi(e,Ft._e),u).next()})})}};function Ff(n){n.createObjectStore("targetDocuments",{keyPath:qy}).createIndex("documentTargetsIndex",By,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Ly,{unique:!0}),n.createObjectStore("targetGlobal")}var Ka="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ec=class n{constructor(t,e,r,i,s,o,a,u,c,l,h=16){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=r,this.oi=s,this.window=o,this.document=a,this._i=c,this.ai=l,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=d=>Promise.resolve(),!n.D())throw new y(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Gu(this,i),this.Ti=e+"main",this.serializer=new Hs(u),this.Ei=new _e(this.Ti,this.ui,new tc(this.serializer)),this.Qr=new qu(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Xm(this.serializer),this.$r=new Cu,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,l===!1&&it("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,Ka);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Qr.getHighestSequenceNumber(t))}).then(t=>{this.kr=new Ft(t,this._i)}).then(()=>{this.qr=!0}).catch(t=>(this.Ei&&this.Ei.close(),Promise.reject(t)))}fi(t){return this.Ii=e=>p(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ei.B(e=>p(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.oi.enqueueAndForget(()=>p(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Ps(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(t).next(e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(t)).next(e=>this.isPrimary&&!e?this.yi(t).next(()=>!1):!!e&&this.wi(t).next(()=>!0))).catch(t=>{if(ze(t))return _("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return _("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.oi.enqueueRetryable(()=>this.Ii(t)),this.isPrimary=t})}gi(t){return ei(t).get("owner").next(e=>f.resolve(this.Si(e)))}bi(t){return Ps(t).delete(this.clientId)}Di(){return p(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let r=wt(e,"clientMetadata");return r.W().next(i=>{let s=this.vi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return f.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.di)for(let e of t)this.di.removeItem(this.Fi(e.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(t){return!!t&&t.ownerId===this.clientId}pi(t){return this.ai?f.resolve(!0):ei(t).get("owner").next(e=>{if(e!==null&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)){if(this.Si(e)&&this.networkEnabled)return!0;if(!this.Si(e)){if(!e.allowTabSynchronization)throw new y(g.FAILED_PRECONDITION,Ka);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ps(t).W().next(r=>this.vi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&_("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return p(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new hi(t,Ft._e);return this.yi(e).next(()=>this.bi(e))}),this.Ei.close(),this.Li()})}vi(t,e){return t.filter(r=>this.Ci(r.updateTimeMs,e)&&!this.Mi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",t=>Ps(t).W().next(e=>this.vi(e,18e5).map(r=>r.clientId)))}get started(){return this.qr}getMutationQueue(t,e){return eo.lt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Lu(t,this.serializer.ct.databaseId)}getDocumentOverlayCache(t){return Js.lt(this.serializer,t)}getBundleCache(){return this.$r}runTransaction(t,e,r){_("IndexedDbPersistence","Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=function(u){return u===16?Yy:u===15?sm:u===14?im:u===13?rm:u===12?Hy:u===11?nm:void S()}(this.ui),o;return this.Ei.runTransaction(t,i,s,a=>(o=new hi(a,this.kr?this.kr.next():Ft._e),e==="readwrite-primary"?this.gi(o).next(u=>!!u||this.pi(o)).next(u=>{if(!u)throw it(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new y(g.FAILED_PRECONDITION,Zf);return r(o)}).next(u=>this.wi(o).next(()=>u)):this.ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ki(t){return ei(t).get("owner").next(e=>{if(e!==null&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new y(g.FAILED_PRECONDITION,Ka)})}wi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ei(t).put("owner",e)}static D(){return _e.D()}yi(t){let e=ei(t);return e.get("owner").next(r=>this.Si(r)?(_("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):f.resolve())}Ci(t,e){let r=Date.now();return!(t<r-e)&&(!(t>r)||(it(`Detected an update time that is in the future: ${t} > ${r}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.ci=()=>{this.xi();let e=/(?:Version|Mobile)\/1[456]/;Yo()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(t){var e;try{let r=((e=this.di)===null||e===void 0?void 0:e.getItem(this.Fi(t)))!==null;return _("IndexedDbPersistence",`Client '${t}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return it("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(t){it("Failed to set zombie client id.",t)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function ei(n){return wt(n,"owner")}function Ps(n){return wt(n,"clientMetadata")}function nl(n,t){let e=n.projectId;return n.isDefaultDatabase||(e+="."+n.database),"firestore/"+t+"/"+e+"/"}var nc=class n{constructor(t,e,r,i){this.targetId=t,this.fromCache=e,this.qi=r,this.Qi=i}static Ki(t,e){let r=V(),i=V();for(let s of e.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(t,e.fromCache,r,i)}};var rc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var oo=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return Yo()?8:_e.v(Rr())>0?6:4}()}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,r,i){let s={result:null};return this.ji(t,e).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(t,e,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new rc;return this.Ji(t,e,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(t,e,o,a.size)})}).next(()=>s.result)}Yi(t,e,r,i){return r.documentReadCount<this.Wi?(Bn()<=Jt.DEBUG&&_("QueryEngine","SDK will not create cache indexes for query:",Un(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),f.resolve()):(Bn()<=Jt.DEBUG&&_("QueryEngine","Query:",Un(e),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(Bn()<=Jt.DEBUG&&_("QueryEngine","The SDK decides to create cache indexes for query:",Un(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,xt(e))):f.resolve())}ji(t,e){if(uf(e))return f.resolve(null);let r=xt(e);return this.indexManager.getIndexType(t,r).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=Ks(e,null,"F"),r=xt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(s=>{let o=V(...s);return this.zi.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,r).next(u=>{let c=this.Zi(e,a);return this.Xi(e,c,o,u.readTime)?this.ji(t,Ks(e,null,"F")):this.es(t,c,e,u)}))})))}Hi(t,e,r,i){return uf(e)||i.isEqual(b.min())?f.resolve(null):this.zi.getDocuments(t,r).next(s=>{let o=this.Zi(e,s);return this.Xi(e,o,r,i)?f.resolve(null):(Bn()<=Jt.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Un(e)),this.es(t,o,e,Jf(i,-1)).next(a=>a))})}Zi(t,e){let r=new $(_m(t));return e.forEach((i,s)=>{ki(t,s)&&(r=r.add(s))}),r}Xi(t,e,r,i){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(t,e,r){return Bn()<=Jt.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",Un(e)),this.zi.getDocumentsMatchingQuery(t,e,jt.min(),r)}es(t,e,r,i){return this.zi.getDocumentsMatchingQuery(t,r,i).next(s=>(e.forEach(o=>{s=s.insert(o.key,o)}),s))}};var ic=class{constructor(t,e,r,i){this.persistence=t,this.ts=e,this.serializer=i,this.ns=new Y(D),this.rs=new ce(s=>hn(s),Vi),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(r)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new ro(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.ns))}};function Zm(n,t,e,r){return new ic(n,t,e,r)}function tg(n,t){return p(this,null,function*(){let e=E(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let i;return e.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,e._s(t),e.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=V();for(let c of i){o.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}for(let c of s){a.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}return e.localDocuments.getDocuments(r,u).next(c=>({us:c,removedBatchIds:o,addedBatchIds:a}))})})})}function x_(n,t){let e=E(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=t.batch.keys(),s=e.os.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){let h=c.batch,d=h.keys(),m=f.resolve();return d.forEach(A=>{m=m.next(()=>l.getEntry(u,A)).next(w=>{let v=c.docVersions.get(A);P(v!==null),w.version.compareTo(v)<0&&(h.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),l.addEntry(w)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(e,r,t,s).next(()=>s.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=V();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(t))).next(()=>e.localDocuments.getDocuments(r,i))})}function eg(n){let t=E(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Qr.getLastRemoteSnapshotVersion(e))}function C_(n,t){let e=E(n),r=t.snapshotVersion,i=e.ns;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=e.os.newChangeBuffer({trackRemovals:!0});i=e.ns;let a=[];t.targetChanges.forEach((l,h)=>{let d=i.get(h);if(!d)return;a.push(e.Qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>e.Qr.addMatchingKeys(s,l.addedDocuments,h)));let m=d.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(h)!==null?m=m.withResumeToken(_t.EMPTY_BYTE_STRING,b.min()).withLastLimboFreeSnapshotVersion(b.min()):l.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(l.resumeToken,r)),i=i.insert(h,m),function(w,v,R){return w.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:R.addedDocuments.size+R.modifiedDocuments.size+R.removedDocuments.size>0}(d,m,l)&&a.push(e.Qr.updateTargetData(s,m))});let u=Vt(),c=V();if(t.documentUpdates.forEach(l=>{t.resolvedLimboDocuments.has(l)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(ng(s,o,t.documentUpdates).next(l=>{u=l.cs,c=l.ls})),!r.isEqual(b.min())){let l=e.Qr.getLastRemoteSnapshotVersion(s).next(h=>e.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return f.waitFor(a).next(()=>o.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(e.ns=i,s))}function ng(n,t,e){let r=V(),i=V();return e.forEach(s=>r=r.add(s)),t.getEntries(n,r).next(s=>{let o=Vt();return e.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(b.min())?(t.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(t.addEntry(u),o=o.insert(a,u)):_("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{cs:o,ls:i}})}function D_(n,t){let e=E(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function ir(n,t){let e=E(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return e.Qr.getTargetData(r,t).next(s=>s?(i=s,f.resolve(i)):e.Qr.allocateTargetId(r).next(o=>(i=new nr(t,o,"TargetPurposeListen",r.currentSequenceNumber),e.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=e.ns.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.ns=e.ns.insert(r.targetId,r),e.rs.set(t,r.targetId)),r})}function sr(n,t,e){return p(this,null,function*(){let r=E(n),i=r.ns.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!ze(o))throw o;_("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.ns=r.ns.remove(t),r.rs.delete(i.target)})}function ao(n,t,e){let r=E(n),i=b.min(),s=V();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){let h=E(u),d=h.rs.get(l);return d!==void 0?f.resolve(h.ns.get(d)):h.Qr.getTargetData(c,l)}(r,o,xt(t)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,t,e?i:b.min(),e?s:V())).next(a=>(sg(r,ym(t),a),{documents:a,hs:s})))}function rg(n,t){let e=E(n),r=E(e.Qr),i=e.ns.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>r._t(s,t).next(o=>o?o.target:null))}function ig(n,t){let e=E(n),r=e.ss.get(t)||b.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.os.getAllFromCollectionGroup(i,t,Jf(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(sg(e,t,i),i))}function sg(n,t,e){let r=n.ss.get(t)||b.min();e.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.ss.set(t,r)}function V_(n,t,e,r){return p(this,null,function*(){let i=E(n),s=V(),o=Vt();for(let c of e){let l=t.Ps(c.metadata.name);c.document&&(s=s.add(l));let h=t.Is(c);h.setReadTime(t.Ts(c.metadata.readTime)),o=o.insert(l,h)}let a=i.os.newChangeBuffer({trackRemovals:!0}),u=yield ir(i,function(l){return xt(fr(L.fromString(`__bundle__/docs/${l}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>ng(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.Qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.Qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.cs,l.ls)).next(()=>l.cs)))})}function N_(r,i){return p(this,arguments,function*(n,t,e=V()){let s=yield ir(n,xt(tl(t.bundledQuery))),o=E(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=ot(t.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.$r.saveNamedQuery(a,t);let c=s.withResumeToken(_t.EMPTY_BYTE_STRING,u);return o.ns=o.ns.insert(c.targetId,c),o.Qr.updateTargetData(a,c).next(()=>o.Qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Qr.addMatchingKeys(a,e,s.targetId)).next(()=>o.$r.saveNamedQuery(a,t))})})}function Mf(n,t){return`firestore_clients_${n}_${t}`}function Of(n,t,e){let r=`firestore_mutations_${n}_${e}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function $a(n,t){return`firestore_targets_${n}_${t}`}var uo=class n{constructor(t,e,r,i){this.user=t,this.batchId=e,this.state=r,this.error=i}static Es(t,e,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new y(i.error.code,i.error.message))),o?new n(t,e,i.state,s):(it("SharedClientState",`Failed to parse mutation state for ID '${e}': ${r}`),null)}ds(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},ai=class n{constructor(t,e,r){this.targetId=t,this.state=e,this.error=r}static Es(t,e){let r=JSON.parse(e),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new y(r.error.code,r.error.message))),s?new n(t,r.state,i):(it("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}ds(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},co=class n{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Es(t,e){let r=JSON.parse(e),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Xc();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=tm(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(t,s):(it("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},sc=class n{constructor(t,e){this.clientId=t,this.onlineState=e}static Es(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new n(e.clientId,e.onlineState):(it("SharedClientState",`Failed to parse online state: ${t}`),null)}},Ai=class{constructor(){this.activeTargetIds=Xc()}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},ui=class{constructor(t,e,r,i,s){this.window=t,this.oi=e,this.persistenceKey=r,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new Y(D),this.started=!1,this.ys=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=Mf(this.persistenceKey,this.Vs),this.Ss=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new Ai),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Fs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(t){return!(!t||!t.localStorage)}start(){return p(this,null,function*(){let t=yield this.syncEngine.Bi();for(let r of t){if(r===this.Vs)continue;let i=this.getItem(Mf(this.persistenceKey,r));if(i){let s=co.Es(r,i);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let e=this.storage.getItem(this.vs);if(e){let r=this.xs(e);r&&this.Os(r)}for(let r of this.ys)this.gs(r);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.Ss,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(t){let e=!1;return this.ps.forEach((r,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.Ls(t,"pending")}updateMutationState(t,e,r){this.Ls(t,e,r),this.Bs(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){let r=this.storage.getItem($a(this.persistenceKey,t));if(r){let i=ai.Es(t,r);i&&(e=i.state)}}return this.ks.As(t),this.Ms(),e}removeLocalQueryTarget(t){this.ks.Rs(t),this.Ms()}isLocalQueryTarget(t){return this.ks.activeTargetIds.has(t)}clearQueryState(t){this.removeItem($a(this.persistenceKey,t))}updateQueryState(t,e,r){this.qs(t,e,r)}handleUserChange(t,e,r){e.forEach(i=>{this.Bs(i)}),this.currentUser=t,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.Qs(t)}notifyBundleLoaded(t){this.Ks(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return _("SharedClientState","READ",t,e),e}setItem(t,e){_("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){_("SharedClientState","REMOVE",t),this.storage.removeItem(t)}gs(t){let e=t;if(e.storageArea===this.storage){if(_("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ws)return void it("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>p(this,null,function*(){if(this.started){if(e.key!==null){if(this.bs.test(e.key)){if(e.newValue==null){let r=this.$s(e.key);return this.Us(r,null)}{let r=this.Ws(e.key,e.newValue);if(r)return this.Us(r.clientId,r)}}else if(this.Ds.test(e.key)){if(e.newValue!==null){let r=this.Gs(e.key,e.newValue);if(r)return this.zs(r)}}else if(this.Cs.test(e.key)){if(e.newValue!==null){let r=this.js(e.key,e.newValue);if(r)return this.Hs(r)}}else if(e.key===this.vs){if(e.newValue!==null){let r=this.xs(e.newValue);if(r)return this.Os(r)}}else if(e.key===this.Ss){let r=function(s){let o=Ft._e;if(s!=null)try{let a=JSON.parse(s);P(typeof a=="number"),o=a}catch(a){it("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(e.newValue);r!==Ft._e&&this.sequenceNumberHandler(r)}else if(e.key===this.Fs){let r=this.Js(e.newValue);yield Promise.all(r.map(i=>this.syncEngine.Ys(i)))}}}else this.ys.push(e)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(t,e,r){let i=new uo(this.currentUser,t,e,r),s=Of(this.persistenceKey,this.currentUser,t);this.setItem(s,i.ds())}Bs(t){let e=Of(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Qs(t){let e={clientId:this.Vs,onlineState:t};this.storage.setItem(this.vs,JSON.stringify(e))}qs(t,e,r){let i=$a(this.persistenceKey,t),s=new ai(t,e,r);this.setItem(i,s.ds())}Ks(t){let e=JSON.stringify(Array.from(t));this.setItem(this.Fs,e)}$s(t){let e=this.bs.exec(t);return e?e[1]:null}Ws(t,e){let r=this.$s(t);return co.Es(r,e)}Gs(t,e){let r=this.Ds.exec(t),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return uo.Es(new dt(s),i,e)}js(t,e){let r=this.Cs.exec(t),i=Number(r[1]);return ai.Es(i,e)}xs(t){return sc.Es(t)}Js(t){return JSON.parse(t)}zs(t){return p(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Zs(t.batchId,t.state,t.error);_("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}Hs(t){return this.syncEngine.Xs(t.targetId,t.state,t.error)}Us(t,e){let r=e?this.ps.insert(t,e):this.ps.remove(t),i=this.Ns(this.ps),s=this.Ns(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.eo(o,a).then(()=>{this.ps=r})}Os(t){this.ps.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Ns(t){let e=Xc();return t.forEach((r,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},lo=class{constructor(){this.no=new Ai,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,r){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new Ai,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var oc=class{io(t){}shutdown(){}};var ho=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.uo)t(0)}ao(){_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.uo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var bs=null;function Qa(){return bs===null?bs=function(){return 268435456+Math.round(2147483648*Math.random())}():bs++,"0x"+bs.toString(16)}var k_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var ac=class{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}};var St="WebChannelConnection",uc=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let r=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+e.host,this.po=`projects/${i}/databases/${s}`,this.yo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(e,r,i,s,o){let a=Qa(),u=this.bo(e,r.toUriEncodedString());_("RestConnection",`Sending RPC '${e}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,s,o),this.Co(e,u,c,i).then(l=>(_("RestConnection",`Received RPC '${e}' ${a}: `,l),l),l=>{throw Ut("RestConnection",`RPC '${e}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}vo(e,r,i,s,o,a){return this.So(e,r,i,s,o)}Do(e,r,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+dr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>e[o]=s),i&&i.headers.forEach((s,o)=>e[o]=s)}bo(e,r){let i=k_[e];return`${this.fo}/v1/${r}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,r,i){let s=Qa();return new Promise((o,a)=>{let u=new Kd;u.setWithCredentials(!0),u.listenOnce(Gd.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Ts.NO_ERROR:let l=u.getResponseJson();_(St,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(l)),o(l);break;case Ts.TIMEOUT:_(St,`RPC '${t}' ${s} timed out`),a(new y(g.DEADLINE_EXCEEDED,"Request time out"));break;case Ts.HTTP_ERROR:let h=u.getStatus();if(_(St,`RPC '${t}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);let m=d?.error;if(m&&m.status&&m.message){let A=function(v){let R=v.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(R)>=0?R:g.UNKNOWN}(m.status);a(new y(A,m.message))}else a(new y(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new y(g.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{_(St,`RPC '${t}' ${s} completed.`)}});let c=JSON.stringify(i);_(St,`RPC '${t}' ${s} sending request:`,i),u.send(e,"POST",c,r,15)})}Fo(t,e,r){let i=Qa(),s=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Ud(),a=jd(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,e,r),u.encodeInitMessageHeaders=!0;let l=s.join("");_(St,`Creating RPC '${t}' stream ${i}: ${l}`,u);let h=o.createWebChannel(l,u),d=!1,m=!1,A=new ac({lo:v=>{m?_(St,`Not sending because RPC '${t}' stream ${i} is closed:`,v):(d||(_(St,`Opening RPC '${t}' stream ${i} transport.`),h.open(),d=!0),_(St,`RPC '${t}' stream ${i} sending:`,v),h.send(v))},ho:()=>h.close()}),w=(v,R,F)=>{v.listen(R,x=>{try{F(x)}catch(U){setTimeout(()=>{throw U},0)}})};return w(h,Jr.EventType.OPEN,()=>{m||_(St,`RPC '${t}' stream ${i} transport opened.`)}),w(h,Jr.EventType.CLOSE,()=>{m||(m=!0,_(St,`RPC '${t}' stream ${i} transport closed`),A.Vo())}),w(h,Jr.EventType.ERROR,v=>{m||(m=!0,Ut(St,`RPC '${t}' stream ${i} transport errored:`,v),A.Vo(new y(g.UNAVAILABLE,"The operation could not be completed")))}),w(h,Jr.EventType.MESSAGE,v=>{var R;if(!m){let F=v.data[0];P(!!F);let x=F,U=x.error||((R=x[0])===null||R===void 0?void 0:R.error);if(U){_(St,`RPC '${t}' stream ${i} received error:`,U);let j=U.status,B=function(kp){let Bl=lt[kp];if(Bl!==void 0)return Vm(Bl)}(j),at=U.message;B===void 0&&(B=g.INTERNAL,at="Unknown error status: "+j+" with message "+U.message),m=!0,A.Vo(new y(B,at)),h.close()}else _(St,`RPC '${t}' stream ${i} received:`,F),A.mo(F)}}),w(a,zd.STAT_EVENT,v=>{v.stat===Ga.PROXY?_(St,`RPC '${t}' stream ${i} detected buffering proxy`):v.stat===Ga.NOPROXY&&_(St,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{A.Ro()},0),A}};function og(){return typeof window<"u"?window:null}function Vs(){return typeof document<"u"?document:null}function Fi(n){return new Su(n,!0)}var Si=class{constructor(t,e,r=1e3,i=1.5,s=6e4){this.oi=t,this.timerId=e,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();let e=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,e-r);i>0&&_("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),t())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Lo!==null&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){this.Lo!==null&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}};var fo=class{constructor(t,e,r,i,s,o,a,u){this.oi=t,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Si(t,e)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return p(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(t){this.n_(),this.stream.send(t)}e_(){return p(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(t,e){return p(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,t!==4?this.jo.reset():e&&e.code===g.RESOURCE_EXHAUSTED?(it(e.toString()),it("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.To(e)})}i_(){}auth(){this.state=1;let t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===e&&this.o_(r,i)},r=>{t(()=>{let i=new y(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(t,e){let r=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){this.state=5,this.jo.qo(()=>p(this,null,function*(){this.state=0,this.start()}))}__(t){return _("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget(()=>this.Wo===t?e():(_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},cc=class extends fo{constructor(t,e,r,i,s,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();let e=__(this.serializer,t),r=function(s){if(!("targetChange"in s))return b.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?b.min():o.readTime?ot(o.readTime):b.min()}(t);return this.listener.u_(e,r)}c_(t){let e={};e.database=Ru(this.serializer),e.addTarget=function(s,o){let a,u=o.target;if(a=Gs(u)?{documents:Bm(s,u)}:{query:Um(s,u).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=km(s,o.resumeToken);let c=Pu(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(b.min())>0){a.readTime=er(s,o.snapshotVersion.toTimestamp());let c=Pu(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,t);let r=v_(this.serializer,t);r&&(e.labels=r),this.t_(e)}l_(t){let e={};e.database=Ru(this.serializer),e.removeTarget=t,this.t_(e)}},lc=class extends fo{constructor(t,e,r,i,s,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,e){return this.connection.Fo("Write",t,e)}onMessage(t){if(P(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();let e=w_(t.writeResults,t.commitTime),r=ot(t.commitTime);return this.listener.T_(r,e)}return P(!t.writeResults||t.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){let t={};t.database=Ru(this.serializer),this.t_(t)}I_(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>Ii(this.serializer,r))};this.t_(e)}};var hc=class extends class{}{constructor(t,e,r,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(t,bu(e,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(g.UNKNOWN,s.toString())})}vo(t,e,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(t,bu(e,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new y(g.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var dc=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(t){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,t==="Online"&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(it(e),this.g_=!1):_("OnlineStateTracker",e)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var fc=class{constructor(t,e,r,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(o=>{r.enqueueAndForget(()=>p(this,null,function*(){Ke(this)&&(_("RemoteStore","Restarting streams for network reachability change."),yield function(u){return p(this,null,function*(){let c=E(u);c.v_.add(4),yield mr(c),c.x_.set("Unknown"),c.v_.delete(4),yield Mi(c)})}(this))}))}),this.x_=new dc(r,i)}};function Mi(n){return p(this,null,function*(){if(Ke(n))for(let t of n.F_)yield t(!0)})}function mr(n){return p(this,null,function*(){for(let t of n.F_)yield t(!1)})}function Vo(n,t){let e=E(n);e.C_.has(t.targetId)||(e.C_.set(t.targetId,t),sl(e)?il(e):pr(e).Jo()&&rl(e,t))}function or(n,t){let e=E(n),r=pr(e);e.C_.delete(t),r.Jo()&&ag(e,t),e.C_.size===0&&(r.Jo()?r.Xo():Ke(e)&&e.x_.set("Unknown"))}function rl(n,t){if(n.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(b.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}pr(n).c_(t)}function ag(n,t){n.O_.Oe(t),pr(n).l_(t)}function il(n){n.O_=new Au({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>n.C_.get(t)||null,nt:()=>n.datastore.serializer.databaseId}),pr(n).start(),n.x_.p_()}function sl(n){return Ke(n)&&!pr(n).Ho()&&n.C_.size>0}function Ke(n){return E(n).v_.size===0}function ug(n){n.O_=void 0}function F_(n){return p(this,null,function*(){n.C_.forEach((t,e)=>{rl(n,t)})})}function M_(n,t){return p(this,null,function*(){ug(n),sl(n)?(n.x_.S_(t),il(n)):n.x_.set("Unknown")})}function O_(n,t,e){return p(this,null,function*(){if(n.x_.set("Online"),t instanceof Qs&&t.state===2&&t.cause)try{yield function(i,s){return p(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.C_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.C_.delete(a),i.O_.removeTarget(a))})}(n,t)}catch(r){_("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield mo(n,r)}else if(t instanceof Wn?n.O_.$e(t):t instanceof $s?n.O_.Je(t):n.O_.Ge(t),!e.isEqual(b.min()))try{let r=yield eg(n.localStore);e.compareTo(r)>=0&&(yield function(s,o){let a=s.O_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let l=s.C_.get(c);l&&s.C_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let l=s.C_.get(u);if(!l)return;s.C_.set(u,l.withResumeToken(_t.EMPTY_BYTE_STRING,l.snapshotVersion)),ag(s,u);let h=new nr(l.target,u,c,l.sequenceNumber);rl(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,e))}catch(r){_("RemoteStore","Failed to raise snapshot:",r),yield mo(n,r)}})}function mo(n,t,e){return p(this,null,function*(){if(!ze(t))throw t;n.v_.add(1),yield mr(n),n.x_.set("Offline"),e||(e=()=>eg(n.localStore)),n.asyncQueue.enqueueRetryable(()=>p(this,null,function*(){_("RemoteStore","Retrying IndexedDB access"),yield e(),n.v_.delete(1),yield Mi(n)}))})}function cg(n,t){return t().catch(e=>mo(n,e,t))}function gr(n){return p(this,null,function*(){let t=E(n),e=je(t),r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;L_(t);)try{let i=yield D_(t.localStore,r);if(i===null){t.D_.length===0&&e.Xo();break}r=i.batchId,q_(t,i)}catch(i){yield mo(t,i)}lg(t)&&hg(t)})}function L_(n){return Ke(n)&&n.D_.length<10}function q_(n,t){n.D_.push(t);let e=je(n);e.Jo()&&e.P_&&e.I_(t.mutations)}function lg(n){return Ke(n)&&!je(n).Ho()&&n.D_.length>0}function hg(n){je(n).start()}function B_(n){return p(this,null,function*(){je(n).d_()})}function U_(n){return p(this,null,function*(){let t=je(n);for(let e of n.D_)t.I_(e.mutations)})}function j_(n,t,e){return p(this,null,function*(){let r=n.D_.shift(),i=Iu.from(r,t,e);yield cg(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield gr(n)})}function G_(n,t){return p(this,null,function*(){t&&je(n).P_&&(yield function(r,i){return p(this,null,function*(){if(function(o){return Dm(o)&&o!==g.ABORTED}(i.code)){let s=r.D_.shift();je(r).Zo(),yield cg(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield gr(r)}})}(n,t)),lg(n)&&hg(n)})}function Lf(n,t){return p(this,null,function*(){let e=E(n);e.asyncQueue.verifyOperationInProgress(),_("RemoteStore","RemoteStore received new credentials");let r=Ke(e);e.v_.add(3),yield mr(e),r&&e.x_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.v_.delete(3),yield Mi(e)})}function mc(n,t){return p(this,null,function*(){let e=E(n);t?(e.v_.delete(2),yield Mi(e)):t||(e.v_.add(2),yield mr(e),e.x_.set("Unknown"))})}function pr(n){return n.N_||(n.N_=function(e,r,i){let s=E(e);return s.R_(),new cc(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:F_.bind(null,n),To:M_.bind(null,n),u_:O_.bind(null,n)}),n.F_.push(t=>p(this,null,function*(){t?(n.N_.Zo(),sl(n)?il(n):n.x_.set("Unknown")):(yield n.N_.stop(),ug(n))}))),n.N_}function je(n){return n.L_||(n.L_=function(e,r,i){let s=E(e);return s.R_(),new lc(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:B_.bind(null,n),To:G_.bind(null,n),E_:U_.bind(null,n),T_:j_.bind(null,n)}),n.F_.push(t=>p(this,null,function*(){t?(n.L_.Zo(),yield gr(n)):(yield n.L_.stop(),n.D_.length>0&&(_("RemoteStore",`Stopping write stream with ${n.D_.length} pending writes`),n.D_=[]))}))),n.L_}var gc=class n{constructor(t,e,r,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ft,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,i,s){let o=Date.now()+r,a=new n(t,e,o,i,s);return a.start(r),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new y(g.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function yr(n,t){if(it("AsyncQueue",`${t}: ${n}`),ze(n))return new y(g.UNAVAILABLE,`${t}: ${n}`);throw n}var go=class n{constructor(t){this.comparator=t?(e,r)=>t(e,r)||I.comparator(e.key,r.key):(e,r)=>I.comparator(e.key,r.key),this.keyedMap=ni(),this.sortedSet=new Y(this.comparator)}static emptySet(t){return new n(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var po=class{constructor(){this.B_=new Y(I.comparator)}track(t){let e=t.doc.key,r=this.B_.get(e);r?t.type!==0&&r.type===3?this.B_=this.B_.insert(e,t):t.type===3&&r.type!==1?this.B_=this.B_.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.B_=this.B_.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.B_=this.B_.remove(e):t.type===1&&r.type===2?this.B_=this.B_.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):S():this.B_=this.B_.insert(e,t)}k_(){let t=[];return this.B_.inorderTraversal((e,r)=>{t.push(r)}),t}},ar=class n{constructor(t,e,r,i,s,o,a,u,c){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(t,e,r,i,s){let o=[];return e.forEach(a=>{o.push({type:0,doc:a})}),new n(t,e,go.emptySet(e),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ni(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==r[i].type||!e[i].doc.isEqual(r[i].doc))return!1;return!0}};var pc=class{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some(t=>t.U_())}},yc=class{constructor(){this.queries=new ce(t=>pm(t),Ni),this.onlineState="Unknown",this.W_=new Set}};function ol(n,t){return p(this,null,function*(){let e=E(n),r=3,i=t.query,s=e.queries.get(i);s?!s.K_()&&t.U_()&&(r=2):(s=new pc,r=t.U_()?0:1);try{switch(r){case 0:s.q_=yield e.onListen(i,!0);break;case 1:s.q_=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(o){let a=yr(o,`Initialization of query '${Un(t.query)}' failed`);return void t.onError(a)}e.queries.set(i,s),s.Q_.push(t),t.G_(e.onlineState),s.q_&&t.z_(s.q_)&&ul(e)})}function al(n,t){return p(this,null,function*(){let e=E(n),r=t.query,i=3,s=e.queries.get(r);if(s){let o=s.Q_.indexOf(t);o>=0&&(s.Q_.splice(o,1),s.Q_.length===0?i=t.U_()?0:1:!s.K_()&&t.U_()&&(i=2))}switch(i){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}})}function z_(n,t){let e=E(n),r=!1;for(let i of t){let s=i.query,o=e.queries.get(s);if(o){for(let a of o.Q_)a.z_(i)&&(r=!0);o.q_=i}}r&&ul(e)}function K_(n,t,e){let r=E(n),i=r.queries.get(t);if(i)for(let s of i.Q_)s.onError(e);r.queries.delete(t)}function ul(n){n.W_.forEach(t=>{t.next()})}var _c,qf;(qf=_c||(_c={})).j_="default",qf.Cache="cache";var Pi=class{constructor(t,e,r){this.query=t,this.H_=e,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=r||{}}z_(t){if(!this.options.includeMetadataChanges){let r=[];for(let i of t.docChanges)i.type!==3&&r.push(i);t=new ar(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.J_?this.Z_(t)&&(this.H_.next(t),e=!0):this.X_(t,this.onlineState)&&(this.ea(t),e=!0),this.Y_=t,e}onError(t){this.H_.error(t)}G_(t){this.onlineState=t;let e=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,t)&&(this.ea(this.Y_),e=!0),e}X_(t,e){if(!t.fromCache||!this.U_())return!0;let r=e!=="Offline";return(!this.options.ta||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Z_(t){if(t.docChanges.length>0)return!0;let e=this.Y_&&this.Y_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ea(t){t=ar.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.J_=!0,this.H_.next(t)}U_(){return this.options.source!==_c.Cache}};var wc=class{constructor(t,e){this.na=t,this.byteLength=e}ra(){return"metadata"in this.na}};var yo=class{constructor(t){this.serializer=t}Ps(t){return se(this.serializer,t)}Is(t){return t.metadata.exists?qm(this.serializer,t.document,!1):mt.newNoDocument(this.Ps(t.metadata.name),this.Ts(t.metadata.readTime))}Ts(t){return ot(t)}},vc=class{constructor(t,e,r){this.ia=t,this.localStore=e,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=dg(t)}sa(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.na.namedQuery)this.queries.push(t.na.namedQuery);else if(t.na.documentMetadata){this.documents.push({metadata:t.na.documentMetadata}),t.na.documentMetadata.exists||++e;let r=L.fromString(t.na.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else t.na.document&&(this.documents[this.documents.length-1].document=t.na.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}oa(t){let e=new Map,r=new yo(this.serializer);for(let i of t)if(i.metadata.queries){let s=r.Ps(i.metadata.name);for(let o of i.metadata.queries){let a=(e.get(o)||V()).add(s);e.set(o,a)}}return e}complete(){return p(this,null,function*(){let t=yield V_(this.localStore,new yo(this.serializer),this.documents,this.ia.id),e=this.oa(this.documents);for(let r of this.queries)yield N_(this.localStore,r,e.get(r.name));return this.progress.taskState="Success",{progress:this.progress,_a:this.collectionGroups,aa:t}})}};function dg(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var _o=class{constructor(t){this.key=t}},wo=class{constructor(t){this.key=t}},vo=class{constructor(t,e){this.query=t,this.ua=e,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=V(),this.mutatedKeys=V(),this.ha=_m(t),this.Pa=new go(this.ha)}get Ia(){return this.ua}Ta(t,e){let r=e?e.Ea:new po,i=e?e.Pa:this.Pa,s=e?e.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((l,h)=>{let d=i.get(l),m=ki(this.query,h)?h:null,A=!!d&&this.mutatedKeys.has(d.key),w=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations),v=!1;d&&m?d.data.isEqual(m.data)?A!==w&&(r.track({type:3,doc:m}),v=!0):this.da(d,m)||(r.track({type:2,doc:m}),v=!0,(u&&this.ha(m,u)>0||c&&this.ha(m,c)<0)&&(a=!0)):!d&&m?(r.track({type:0,doc:m}),v=!0):d&&!m&&(r.track({type:1,doc:d}),v=!0,(u||c)&&(a=!0)),v&&(m?(o=o.add(m),s=w?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Pa:o,Ea:r,Xi:a,mutatedKeys:s}}da(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,i){let s=this.Pa;this.Pa=t.Pa,this.mutatedKeys=t.mutatedKeys;let o=t.Ea.k_();o.sort((l,h)=>function(m,A){let w=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return w(m)-w(A)}(l.type,h.type)||this.ha(l.doc,h.doc)),this.Aa(r),i=i!=null&&i;let a=e&&!i?this.Ra():[],u=this.la.size===0&&this.current&&!i?1:0,c=u!==this.ca;return this.ca=u,o.length!==0||c?{snapshot:new ar(this.query,t.Pa,s,o,t.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),Va:a}:{Va:a}}G_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new po,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(t){return!this.ua.has(t)&&!!this.Pa.has(t)&&!this.Pa.get(t).hasLocalMutations}Aa(t){t&&(t.addedDocuments.forEach(e=>this.ua=this.ua.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.ua=this.ua.delete(e)),this.current=t.current)}Ra(){if(!this.current)return[];let t=this.la;this.la=V(),this.Pa.forEach(r=>{this.ma(r.key)&&(this.la=this.la.add(r.key))});let e=[];return t.forEach(r=>{this.la.has(r)||e.push(new wo(r))}),this.la.forEach(r=>{t.has(r)||e.push(new _o(r))}),e}fa(t){this.ua=t.hs,this.la=V();let e=this.Ta(t.documents);return this.applyChanges(e,!0)}ga(){return ar.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,this.ca===0,this.hasCachedResults)}},Ic=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},Ec=class{constructor(t){this.key=t,this.pa=!1}},Tc=class{constructor(t,e,r,i,s,o){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.ya={},this.wa=new ce(a=>pm(a),Ni),this.Sa=new Map,this.ba=new Set,this.Da=new Y(I.comparator),this.Ca=new Map,this.va=new Ti,this.Fa={},this.Ma=new Map,this.xa=rr.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return this.Oa===!0}};function $_(n,t,e=!0){return p(this,null,function*(){let r=No(n),i,s=r.wa.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ga()):i=yield fg(r,t,e,!0),i})}function Q_(n,t){return p(this,null,function*(){let e=No(n);yield fg(e,t,!0,!1)})}function fg(n,t,e,r){return p(this,null,function*(){let i=yield ir(n.localStore,xt(t)),s=i.targetId,o=e?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield cl(n,t,s,o==="current",i.resumeToken)),n.isPrimaryClient&&e&&Vo(n.remoteStore,i),a})}function cl(n,t,e,r,i){return p(this,null,function*(){n.Na=(h,d,m)=>function(w,v,R,F){return p(this,null,function*(){let x=v.view.Ta(R);x.Xi&&(x=yield ao(w.localStore,v.query,!1).then(({documents:at})=>v.view.Ta(at,x)));let U=F&&F.targetChanges.get(v.targetId),j=F&&F.targetMismatches.get(v.targetId)!=null,B=v.view.applyChanges(x,w.isPrimaryClient,U,j);return Ac(w,v.targetId,B.Va),B.snapshot})}(n,h,d,m);let s=yield ao(n.localStore,t,!0),o=new vo(t,s.hs),a=o.Ta(s.documents),u=wi.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,u);Ac(n,e,c.Va);let l=new Ic(t,e,o);return n.wa.set(t,l),n.Sa.has(e)?n.Sa.get(e).push(t):n.Sa.set(e,[t]),c.snapshot})}function W_(n,t,e){return p(this,null,function*(){let r=E(n),i=r.wa.get(t),s=r.Sa.get(i.targetId);if(s.length>1)return r.Sa.set(i.targetId,s.filter(o=>!Ni(o,t))),void r.wa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield sr(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),e&&or(r.remoteStore,i.targetId),ur(r,i.targetId)}).catch(Ge))):(ur(r,i.targetId),yield sr(r.localStore,i.targetId,!0))})}function H_(n,t){return p(this,null,function*(){let e=E(n),r=e.wa.get(t),i=e.Sa.get(r.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),or(e.remoteStore,r.targetId))})}function Y_(n,t,e){return p(this,null,function*(){let r=fl(n);try{let i=yield function(o,a){let u=E(o),c=Z.now(),l=a.reduce((m,A)=>m.add(A.key),V()),h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",m=>{let A=Vt(),w=V();return u.os.getEntries(m,l).next(v=>{A=v,A.forEach((R,F)=>{F.isValidDocument()||(w=w.add(R))})}).next(()=>u.localDocuments.getOverlayedDocuments(m,A)).next(v=>{h=v;let R=[];for(let F of a){let x=h_(F,h.get(F.key).overlayedDocument);x!=null&&R.push(new Qt(F.key,x,cm(x.value.mapValue),rt.exists(!0)))}return u.mutationQueue.addMutationBatch(m,c,R,a)}).next(v=>{d=v;let R=v.applyToLocalDocumentSet(h,w);return u.documentOverlayCache.saveOverlays(m,v.batchId,R)})}).then(()=>({batchId:d.batchId,changes:vm(h)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Fa[o.currentUser.toKey()];c||(c=new Y(D)),c=c.insert(a,u),o.Fa[o.currentUser.toKey()]=c}(r,i.batchId,e),yield Ae(r,i.changes),yield gr(r.remoteStore)}catch(i){let s=yr(i,"Failed to persist write");e.reject(s)}})}function mg(n,t){return p(this,null,function*(){let e=E(n);try{let r=yield C_(e.localStore,t);t.targetChanges.forEach((i,s)=>{let o=e.Ca.get(s);o&&(P(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.pa=!0:i.modifiedDocuments.size>0?P(o.pa):i.removedDocuments.size>0&&(P(o.pa),o.pa=!1))}),yield Ae(e,r,t)}catch(r){yield Ge(r)}})}function Bf(n,t,e){let r=E(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let i=[];r.wa.forEach((s,o)=>{let a=o.view.G_(t);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=E(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(let d of h.Q_)d.G_(a)&&(c=!0)}),c&&ul(u)}(r.eventManager,t),i.length&&r.ya.u_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function J_(n,t,e){return p(this,null,function*(){let r=E(n);r.sharedClientState.updateQueryState(t,"rejected",e);let i=r.Ca.get(t),s=i&&i.key;if(s){let o=new Y(I.comparator);o=o.insert(s,mt.newNoDocument(s,b.min()));let a=V().add(s),u=new _i(b.min(),new Map,new Y(D),o,a);yield mg(r,u),r.Da=r.Da.remove(s),r.Ca.delete(t),dl(r)}else yield sr(r.localStore,t,!1).then(()=>ur(r,t,e)).catch(Ge)})}function X_(n,t){return p(this,null,function*(){let e=E(n),r=t.batch.batchId;try{let i=yield x_(e.localStore,t);hl(e,r,null),ll(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),yield Ae(e,i)}catch(i){yield Ge(i)}})}function Z_(n,t,e){return p(this,null,function*(){let r=E(n);try{let i=yield function(o,a){let u=E(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(P(h!==null),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,t);hl(r,t,e),ll(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),yield Ae(r,i)}catch(i){yield Ge(i)}})}function tw(n,t){return p(this,null,function*(){let e=E(n);Ke(e.remoteStore)||_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=E(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(e.localStore);if(r===-1)return void t.resolve();let i=e.Ma.get(r)||[];i.push(t),e.Ma.set(r,i)}catch(r){let i=yr(r,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}})}function ll(n,t){(n.Ma.get(t)||[]).forEach(e=>{e.resolve()}),n.Ma.delete(t)}function hl(n,t,e){let r=E(n),i=r.Fa[r.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),r.Fa[r.currentUser.toKey()]=i}}function ur(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Sa.get(t))n.wa.delete(r),e&&n.ya.La(r,e);n.Sa.delete(t),n.isPrimaryClient&&n.va.Vr(t).forEach(r=>{n.va.containsKey(r)||gg(n,r)})}function gg(n,t){n.ba.delete(t.path.canonicalString());let e=n.Da.get(t);e!==null&&(or(n.remoteStore,e),n.Da=n.Da.remove(t),n.Ca.delete(e),dl(n))}function Ac(n,t,e){for(let r of e)r instanceof _o?(n.va.addReference(r.key,t),ew(n,r)):r instanceof wo?(_("SyncEngine","Document no longer in limbo: "+r.key),n.va.removeReference(r.key,t),n.va.containsKey(r.key)||gg(n,r.key)):S()}function ew(n,t){let e=t.key,r=e.path.canonicalString();n.Da.get(e)||n.ba.has(r)||(_("SyncEngine","New document in limbo: "+e),n.ba.add(r),dl(n))}function dl(n){for(;n.ba.size>0&&n.Da.size<n.maxConcurrentLimboResolutions;){let t=n.ba.values().next().value;n.ba.delete(t);let e=new I(L.fromString(t)),r=n.xa.next();n.Ca.set(r,new Ec(e)),n.Da=n.Da.insert(e,r),Vo(n.remoteStore,new nr(xt(fr(e.path)),r,"TargetPurposeLimboResolution",Ft._e))}}function Ae(n,t,e){return p(this,null,function*(){let r=E(n),i=[],s=[],o=[];r.wa.isEmpty()||(r.wa.forEach((a,u)=>{o.push(r.Na(u,t,e).then(c=>{if((c||e)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let l=nc.Ki(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.ya.u_(i),yield function(u,c){return p(this,null,function*(){let l=E(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>f.forEach(c,d=>f.forEach(d.qi,m=>l.persistence.referenceDelegate.addReference(h,d.targetId,m)).next(()=>f.forEach(d.Qi,m=>l.persistence.referenceDelegate.removeReference(h,d.targetId,m)))))}catch(h){if(!ze(h))throw h;_("LocalStore","Failed to update sequence numbers: "+h)}for(let h of c){let d=h.targetId;if(!h.fromCache){let m=l.ns.get(d),A=m.snapshotVersion,w=m.withLastLimboFreeSnapshotVersion(A);l.ns=l.ns.insert(d,w)}}})}(r.localStore,s))})}function nw(n,t){return p(this,null,function*(){let e=E(n);if(!e.currentUser.isEqual(t)){_("SyncEngine","User change. New user:",t.toKey());let r=yield tg(e.localStore,t);e.currentUser=t,function(s,o){s.Ma.forEach(a=>{a.forEach(u=>{u.reject(new y(g.CANCELLED,o))})}),s.Ma.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield Ae(e,r.us)}})}function rw(n,t){let e=E(n),r=e.Ca.get(t);if(r&&r.pa)return V().add(r.key);{let i=V(),s=e.Sa.get(t);if(!s)return i;for(let o of s){let a=e.wa.get(o);i=i.unionWith(a.view.Ia)}return i}}function iw(n,t){return p(this,null,function*(){let e=E(n),r=yield ao(e.localStore,t.query,!0),i=t.view.fa(r);return e.isPrimaryClient&&Ac(e,t.targetId,i.Va),i})}function sw(n,t){return p(this,null,function*(){let e=E(n);return ig(e.localStore,t).then(r=>Ae(e,r))})}function ow(n,t,e,r){return p(this,null,function*(){let i=E(n),s=yield function(a,u){let c=E(a),l=E(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.vn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):f.resolve(null)))}(i.localStore,t);s!==null?(e==="pending"?yield gr(i.remoteStore):e==="acknowledged"||e==="rejected"?(hl(i,t,r||null),ll(i,t),function(a,u){E(E(a).mutationQueue).Mn(u)}(i.localStore,t)):S(),yield Ae(i,s)):_("SyncEngine","Cannot apply mutation batch with id: "+t)})}function aw(n,t){return p(this,null,function*(){let e=E(n);if(No(e),fl(e),t===!0&&e.Oa!==!0){let r=e.sharedClientState.getAllActiveQueryTargets(),i=yield Uf(e,r.toArray());e.Oa=!0,yield mc(e.remoteStore,!0);for(let s of i)Vo(e.remoteStore,s)}else if(t===!1&&e.Oa!==!1){let r=[],i=Promise.resolve();e.Sa.forEach((s,o)=>{e.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(ur(e,o),sr(e.localStore,o,!0))),or(e.remoteStore,o)}),yield i,yield Uf(e,r),function(o){let a=E(o);a.Ca.forEach((u,c)=>{or(a.remoteStore,c)}),a.va.mr(),a.Ca=new Map,a.Da=new Y(I.comparator)}(e),e.Oa=!1,yield mc(e.remoteStore,!1)}})}function Uf(n,t,e){return p(this,null,function*(){let r=E(n),i=[],s=[];for(let o of t){let a,u=r.Sa.get(o);if(u&&u.length!==0){a=yield ir(r.localStore,xt(u[0]));for(let c of u){let l=r.wa.get(c),h=yield iw(r,l);h.snapshot&&s.push(h.snapshot)}}else{let c=yield rg(r.localStore,o);a=yield ir(r.localStore,c),yield cl(r,pg(c),o,!1,a.resumeToken)}i.push(a)}return r.ya.u_(s),i})}function pg(n){return gm(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function uw(n){return function(e){return E(E(e).persistence).Bi()}(E(n).localStore)}function cw(n,t,e,r){return p(this,null,function*(){let i=E(n);if(i.Oa)return void _("SyncEngine","Ignoring unexpected query state notification.");let s=i.Sa.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let o=yield ig(i.localStore,ym(s[0])),a=_i.createSynthesizedRemoteEventForCurrentChange(t,e==="current",_t.EMPTY_BYTE_STRING);yield Ae(i,o,a);break}case"rejected":yield sr(i.localStore,t,!0),ur(i,t,r);break;default:S()}})}function lw(n,t,e){return p(this,null,function*(){let r=No(n);if(r.Oa){for(let i of t){if(r.Sa.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){_("SyncEngine","Adding an already active target "+i);continue}let s=yield rg(r.localStore,i),o=yield ir(r.localStore,s);yield cl(r,pg(s),o.targetId,!1,o.resumeToken),Vo(r.remoteStore,o)}for(let i of e)r.Sa.has(i)&&(yield sr(r.localStore,i,!1).then(()=>{or(r.remoteStore,i),ur(r,i)}).catch(Ge))}})}function No(n){let t=E(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=mg.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=rw.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=J_.bind(null,t),t.ya.u_=z_.bind(null,t.eventManager),t.ya.La=K_.bind(null,t.eventManager),t}function fl(n){let t=E(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=X_.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Z_.bind(null,t),t}function hw(n,t,e){let r=E(n);(function(s,o,a){return p(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(m,A){let w=E(m),v=ot(A.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",R=>w.$r.getBundleMetadata(R,A.id)).then(R=>!!R&&R.createTime.compareTo(v)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(m){return{taskState:"Success",documentsLoaded:m.totalDocuments,bytesLoaded:m.totalBytes,totalDocuments:m.totalDocuments,totalBytes:m.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(dg(u));let c=new vc(u,s.localStore,o.serializer),l=yield o.Ba();for(;l;){let d=yield c.sa(l);d&&a._updateProgress(d),l=yield o.Ba()}let h=yield c.complete();return yield Ae(s,h.aa,void 0),yield function(m,A){let w=E(m);return w.persistence.runTransaction("Save bundle","readwrite",v=>w.$r.saveBundleMetadata(v,A))}(s.localStore,u),a._completeWith(h.progress),Promise.resolve(h._a)}catch(u){return Ut("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,t,e).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var bi=class{constructor(){this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){this.serializer=Fi(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return Zm(this.persistence,new oo,t.initialUser,this.serializer)}createPersistence(t){return new io(so.Hr,this.serializer)}createSharedClientState(t){return new lo}terminate(){return p(this,null,function*(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Io=class n extends bi{constructor(t,e,r){super(),this.ka=t,this.cacheSizeBytes=e,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){yield Qo(n.prototype,this,"initialize").call(this,t),yield this.ka.initialize(this,t),yield fl(this.ka.syncEngine),yield gr(this.ka.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(t){return Zm(this.persistence,new oo,t.initialUser,this.serializer)}createGarbageCollectionScheduler(t,e){let r=this.persistence.referenceDelegate.garbageCollector;return new Uu(r,t.asyncQueue,e)}createIndexBackfillerScheduler(t,e){let r=new su(e,this.persistence);return new iu(t.asyncQueue,r)}createPersistence(t){let e=nl(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Bt.withCacheSize(this.cacheSizeBytes):Bt.DEFAULT;return new ec(this.synchronizeTabs,e,t.clientId,r,t.asyncQueue,og(),Vs(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(t){return new lo}},Sc=class n extends Io{constructor(t,e){super(t,e,!1),this.ka=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return p(this,null,function*(){yield Qo(n.prototype,this,"initialize").call(this,t);let e=this.ka.syncEngine;this.sharedClientState instanceof ui&&(this.sharedClientState.syncEngine={Zs:ow.bind(null,e),Xs:cw.bind(null,e),eo:lw.bind(null,e),Bi:uw.bind(null,e),Ys:sw.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.fi(r=>p(this,null,function*(){yield aw(this.ka.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(t){let e=og();if(!ui.D(e))throw new y(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=nl(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new ui(e,t.asyncQueue,r,t.clientId,t.initialUser)}},Ri=class{initialize(t,e){return p(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Bf(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=nw.bind(null,this.syncEngine),yield mc(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new yc}()}createDatastore(t){let e=Fi(t.databaseInfo.databaseId),r=function(s){return new uc(s)}(t.databaseInfo);return function(s,o,a,u){return new hc(s,o,a,u)}(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return function(r,i,s,o,a){return new fc(r,i,s,o,a)}(this.localStore,this.datastore,t.asyncQueue,e=>Bf(this.syncEngine,e,0),function(){return ho.D()?new ho:new oc}())}createSyncEngine(t,e){return function(i,s,o,a,u,c,l){let h=new Tc(i,s,o,a,u,c);return l&&(h.Oa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return p(this,null,function*(){var t;yield function(r){return p(this,null,function*(){let i=E(r);_("RemoteStore","RemoteStore shutting down."),i.v_.add(5),yield mr(i),i.M_.shutdown(),i.x_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate()})}};function jf(n,t=10240){let e=0;return{read(){return p(this,null,function*(){if(e<n.byteLength){let i={value:n.slice(e,e+t),done:!1};return e+=t,i}return{done:!0}})},cancel(){return p(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var cr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.qa(this.observer.next,t)}error(t){this.observer.error?this.qa(this.observer.error,t):it("Uncaught Error in snapshot listener:",t.toString())}Qa(){this.muted=!0}qa(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}};var Pc=class{constructor(t,e){this.Ka=t,this.serializer=e,this.metadata=new ft,this.buffer=new Uint8Array,this.$a=function(){return new TextDecoder("utf-8")}(),this.Ua().then(r=>{r&&r.ra()?this.metadata.resolve(r.na.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.na)}`))},r=>this.metadata.reject(r))}close(){return this.Ka.cancel()}getMetadata(){return p(this,null,function*(){return this.metadata.promise})}Ba(){return p(this,null,function*(){return yield this.getMetadata(),this.Ua()})}Ua(){return p(this,null,function*(){let t=yield this.Wa();if(t===null)return null;let e=this.$a.decode(t),r=Number(e);isNaN(r)&&this.Ga(`length string (${e}) is not valid number`);let i=yield this.za(r);return new wc(JSON.parse(i),t.length+r)})}ja(){return this.buffer.findIndex(t=>t===123)}Wa(){return p(this,null,function*(){for(;this.ja()<0&&!(yield this.Ha()););if(this.buffer.length===0)return null;let t=this.ja();t<0&&this.Ga("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}za(t){return p(this,null,function*(){for(;this.buffer.length<t;)(yield this.Ha())&&this.Ga("Reached the end of bundle when more is expected.");let e=this.$a.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}Ga(t){throw this.Ka.cancel(),new Error(`Invalid bundle format: ${t}`)}Ha(){return p(this,null,function*(){let t=yield this.Ka.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var bc=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new y(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(i,s){return p(this,null,function*(){let o=E(i),a={documents:s.map(h=>vi(o.serializer,h))},u=yield o.vo("BatchGetDocuments",o.serializer.databaseId,L.emptyPath(),a,s.length),c=new Map;u.forEach(h=>{let d=y_(o.serializer,h);c.set(d.key.toString(),d)});let l=[];return s.forEach(h=>{let d=c.get(h.toString());P(!!d),l.push(d)}),l})}(this.datastore,t);return e.forEach(r=>this.recordVersion(r)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(t.toString())}delete(t){this.write(new Ue(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,r)=>{let i=I.fromPath(r);this.mutations.push(new gi(i,this.precondition(i)))}),yield function(r,i){return p(this,null,function*(){let s=E(r),o={writes:i.map(a=>Ii(s.serializer,a))};yield s.So("Commit",s.serializer.databaseId,L.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw S();e=b.min()}let r=this.readVersions.get(t.key.toString());if(r){if(!e.isEqual(r))throw new y(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(b.min())?rt.exists(!1):rt.updateTime(e):rt.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(b.min()))throw new y(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return rt.updateTime(e)}return rt.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var Rc=class{constructor(t,e,r,i,s){this.asyncQueue=t,this.datastore=e,this.options=r,this.updateFunction=i,this.deferred=s,this.Ja=r.maxAttempts,this.jo=new Si(this.asyncQueue,"transaction_retry")}Ya(){this.Ja-=1,this.Za()}Za(){this.jo.qo(()=>p(this,null,function*(){let t=new bc(this.datastore),e=this.Xa(t);e&&e.then(r=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.eu(i)}))}).catch(r=>{this.eu(r)})}))}Xa(t){try{let e=this.updateFunction(t);return!Di(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}eu(t){this.Ja>0&&this.tu(t)?(this.Ja-=1,this.asyncQueue.enqueueAndForget(()=>(this.Za(),Promise.resolve()))):this.deferred.reject(t)}tu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Dm(e)}return!1}};var xc=class{constructor(t,e,r,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=i,this.user=dt.UNAUTHENTICATED,this.clientId=Fs.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>p(this,null,function*(){_("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(_("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new ft;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=yr(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function Ns(n,t){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),_("FirestoreClient","Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(i=>p(this,null,function*(){r.isEqual(i)||(yield tg(t.localStore,i),r=i)})),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t})}function Cc(n,t){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield ml(n);_("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>Lf(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Lf(t.remoteStore,i)),n._onlineComponents=t})}function yg(n){return n.name==="FirebaseError"?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function ml(n){return p(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){_("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ns(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!yg(e))throw e;Ut("Error using user provided cache. Falling back to memory cache: "+e),yield Ns(n,new bi)}}else _("FirestoreClient","Using default OfflineComponentProvider"),yield Ns(n,new bi);return n._offlineComponents})}function ko(n){return p(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(_("FirestoreClient","Using user provided OnlineComponentProvider"),yield Cc(n,n._uninitializedComponentsProvider._online)):(_("FirestoreClient","Using default OnlineComponentProvider"),yield Cc(n,new Ri))),n._onlineComponents})}function _g(n){return ml(n).then(t=>t.persistence)}function gl(n){return ml(n).then(t=>t.localStore)}function wg(n){return ko(n).then(t=>t.remoteStore)}function pl(n){return ko(n).then(t=>t.syncEngine)}function dw(n){return ko(n).then(t=>t.datastore)}function lr(n){return p(this,null,function*(){let t=yield ko(n),e=t.eventManager;return e.onListen=$_.bind(null,t.syncEngine),e.onUnlisten=W_.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Q_.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=H_.bind(null,t.syncEngine),e})}function fw(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let t=yield _g(n),e=yield wg(n);return t.setNetworkEnabled(!0),function(i){let s=E(i);return s.v_.delete(0),Mi(s)}(e)}))}function mw(n){return n.asyncQueue.enqueue(()=>p(this,null,function*(){let t=yield _g(n),e=yield wg(n);return t.setNetworkEnabled(!1),function(i){return p(this,null,function*(){let s=E(i);s.v_.add(0),yield mr(s),s.x_.set("Offline")})}(e)}))}function gw(n,t){let e=new ft;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s,o){return p(this,null,function*(){try{let a=yield function(c,l){let h=E(c);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new y(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=yr(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield gl(n),t,e)})),e.promise}function vg(n,t,e={}){let r=new ft;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,a,u,c){let l=new cr({next:d=>{o.enqueueAndForget(()=>al(s,h));let m=d.docs.has(a);!m&&d.fromCache?c.reject(new y(g.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&d.fromCache&&u&&u.source==="server"?c.reject(new y(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Pi(fr(a.path),l,{includeMetadataChanges:!0,ta:!0});return ol(s,h)}(yield lr(n),n.asyncQueue,t,e,r)})),r.promise}function pw(n,t){let e=new ft;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s,o){return p(this,null,function*(){try{let a=yield ao(i,s,!0),u=new vo(s,a.hs),c=u.Ta(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){let u=yr(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield gl(n),t,e)})),e.promise}function Ig(n,t,e={}){let r=new ft;return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(s,o,a,u,c){let l=new cr({next:d=>{o.enqueueAndForget(()=>al(s,h)),d.fromCache&&u.source==="server"?c.reject(new y(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Pi(a,l,{includeMetadataChanges:!0,ta:!0});return ol(s,h)}(yield lr(n),n.asyncQueue,t,e,r)})),r.promise}function yw(n,t){let e=new cr(t);return n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s){E(i).W_.add(s),s.next()}(yield lr(n),e)})),()=>{e.Qa(),n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return function(i,s){E(i).W_.delete(s)}(yield lr(n),e)}))}}function _w(n,t,e,r){let i=function(o,a){let u;return u=typeof o=="string"?Nm().encode(o):o,function(l,h){return new Pc(l,h)}(function(l,h){if(l instanceof Uint8Array)return jf(l,h);if(l instanceof ArrayBuffer)return jf(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(e,Fi(t));n.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){hw(yield pl(n),i,r)}))}function ww(n,t){return n.asyncQueue.enqueue(()=>p(this,null,function*(){return function(r,i){let s=E(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,i))}(yield gl(n),t)}))}function Eg(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var Gf=new Map;function yl(n,t,e){if(!e)throw new y(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function _l(n,t,e,r){if(t===!0&&r===!0)throw new y(g.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function zf(n){if(!I.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Kf(n){if(I.isDocumentKey(n))throw new y(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Fo(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":S()}function q(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new y(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=Fo(n);throw new y(g.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function Tg(n,t){if(t<=0)throw new y(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${t}.`)}var Eo=class{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new y(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new y(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}_l("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Eg((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new y(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},gn=class{constructor(t,e,r,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Eo({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Eo(t),t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Wa;switch(r.type){case"firstParty":return new Xa(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new y(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let r=Gf.get(e);r&&(_("ComponentProvider","Removing Datastore"),Gf.delete(e),r.terminate())}(this),Promise.resolve()}};function Ag(n,t,e,r={}){var i;let s=(n=q(n,gn))._getSettings(),o=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Ut("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=dt.MOCK_USER;else{a=rh(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new y(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new dt(c)}n._authCredentials=new Ha(new ks(a,u))}}var Et=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},Q=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new oe(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}},oe=class n extends Et{constructor(t,e,r){super(t,e,fr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new Q(this.firestore,null,new I(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function wl(n,t,...e){if(n=tt(n),yl("collection","path",t),n instanceof gn){let r=L.fromString(t,...e);return Kf(r),new oe(n,null,r)}{if(!(n instanceof Q||n instanceof oe))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(L.fromString(t,...e));return Kf(r),new oe(n.firestore,null,r)}}function Sg(n,t){if(n=q(n,gn),yl("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new y(g.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Et(n,null,function(r){return new $t(L.emptyPath(),r)}(t))}function Oi(n,t,...e){if(n=tt(n),arguments.length===1&&(t=Fs.newId()),yl("doc","path",t),n instanceof gn){let r=L.fromString(t,...e);return zf(r),new Q(n,null,new I(r))}{if(!(n instanceof Q||n instanceof oe))throw new y(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(L.fromString(t,...e));return zf(r),new Q(n.firestore,n instanceof oe?n.converter:null,new I(r))}}function vl(n,t){return n=tt(n),t=tt(t),(n instanceof Q||n instanceof oe)&&(t instanceof Q||t instanceof oe)&&n.firestore===t.firestore&&n.path===t.path&&n.converter===t.converter}function Il(n,t){return n=tt(n),t=tt(t),n instanceof Et&&t instanceof Et&&n.firestore===t.firestore&&Ni(n._query,t._query)&&n.converter===t.converter}var Dc=class{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new Si(this,"async_queue_retry"),this.cu=()=>{let e=Vs();e&&_("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};let t=Vs();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.lu(),this.hu(t)}enterRestrictedMode(t){if(!this.iu){this.iu=!0,this.au=t||!1;let e=Vs();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.cu)}}enqueue(t){if(this.lu(),this.iu)return new Promise(()=>{});let e=new ft;return this.hu(()=>this.iu&&this.au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.ru.push(t),this.Pu()))}Pu(){return p(this,null,function*(){if(this.ru.length!==0){try{yield this.ru[0](),this.ru.shift(),this.jo.reset()}catch(t){if(!ze(t))throw t;_("AsyncQueue","Operation failed with retryable error: "+t)}this.ru.length>0&&this.jo.qo(()=>this.Pu())}})}hu(t){let e=this.nu.then(()=>(this._u=!0,t().catch(r=>{this.ou=r,this._u=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw it("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this._u=!1,r))));return this.nu=e,e}enqueueAfterDelay(t,e,r){this.lu(),this.uu.indexOf(t)>-1&&(e=0);let i=gc.createAndSchedule(this,t,e,r,s=>this.Iu(s));return this.su.push(i),i}lu(){this.ou&&S()}verifyOperationInProgress(){}Tu(){return p(this,null,function*(){let t;do t=this.nu,yield t;while(t!==this.nu)})}Eu(t){for(let e of this.su)if(e.timerId===t)return!0;return!1}du(t){return this.Tu().then(()=>{this.su.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.su)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tu()})}Au(t){this.uu.push(t)}Iu(t){let e=this.su.indexOf(t);this.su.splice(e,1)}};function Vc(n){return function(e,r){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Nc=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new ft,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,r){this._progressObserver={next:t,error:e,complete:r}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var Pg=-1,J=class extends gn{constructor(t,e,r,i){super(t,e,r,i),this.type="firestore",this._queue=function(){return new Dc}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||bg(this),this._firestoreClient.terminate()}};function gt(n){return n._firestoreClient||bg(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function bg(n){var t,e,r;let i=n._freezeSettings(),s=function(a,u,c,l){return new ou(a,u,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Eg(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new xc(n._authCredentials,n._appCheckCredentials,n._queue,s),!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Rg(n,t){Og(n=q(n,J));let e=gt(n);if(e._uninitializedComponentsProvider)throw new y(g.FAILED_PRECONDITION,"SDK cache is already specified.");Ut("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Ri;return Cg(e,i,new Io(i,r.cacheSizeBytes,t?.forceOwnership))}function xg(n){Og(n=q(n,J));let t=gt(n);if(t._uninitializedComponentsProvider)throw new y(g.FAILED_PRECONDITION,"SDK cache is already specified.");Ut("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings(),r=new Ri;return Cg(t,r,new Sc(r,e.cacheSizeBytes))}function Cg(n,t,e){let r=new ft;return n.asyncQueue.enqueue(()=>p(this,null,function*(){try{yield Ns(n,e),yield Cc(n,t),r.resolve()}catch(i){let s=i;if(!yg(s))throw s;Ut("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function Dg(n){if(n._initialized&&!n._terminated)throw new y(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new ft;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{yield function(r){return p(this,null,function*(){if(!_e.D())return Promise.resolve();let i=r+"main";yield _e.delete(i)})}(nl(n._databaseId,n._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function Vg(n){return function(e){let r=new ft;return e.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return tw(yield pl(e),r)})),r.promise}(gt(n=q(n,J)))}function Ng(n){return fw(gt(n=q(n,J)))}function kg(n){return mw(gt(n=q(n,J)))}function Fg(n,t){let e=gt(n=q(n,J)),r=new Nc;return _w(e,n._databaseId,t,r),r}function Mg(n,t){return ww(gt(n=q(n,J)),t).then(e=>e?new Et(n,null,e.query):null)}function Og(n){if(n._initialized||n._terminated)throw new y(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var le=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(_t.fromBase64String(t))}catch(e){throw new y(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(_t.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var Wt=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new y(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new st(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var Ee=class{constructor(t){this._methodName=t}};var pn=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new y(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new y(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return D(this._lat,t._lat)||D(this._long,t._long)}};var vw=/^__.*__$/,kc=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new Qt(t,this.data,this.fieldMask,e,this.fieldTransforms):new Be(t,this.data,e,this.fieldTransforms)}},To=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new Qt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function Lg(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}var Ao=class n{constructor(t,e,r,i,s,o){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ru(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.mu({path:r,gu:!1});return i.pu(t),i}yu(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.mu({path:r,gu:!1});return i.Ru(),i}wu(t){return this.mu({path:void 0,gu:!0})}Su(t){return So(t,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Ru(){if(this.path)for(let t=0;t<this.path.length;t++)this.pu(this.path.get(t))}pu(t){if(t.length===0)throw this.Su("Document fields must not be empty");if(Lg(this.Vu)&&vw.test(t))throw this.Su('Document fields cannot begin and end with "__"')}},Fc=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||Fi(t)}Cu(t,e,r,i=!1){return new Ao({Vu:t,methodName:e,Du:r,path:st.emptyPath(),gu:!1,bu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function vn(n){let t=n._freezeSettings(),e=Fi(n._databaseId);return new Fc(n._databaseId,!!t.ignoreUndefinedProperties,e)}function Mo(n,t,e,r,i,s={}){let o=n.Cu(s.merge||s.mergeFields?2:0,t,e,i);Al("Data must be an object, but it was:",o,r);let a=Ug(r,o),u,c;if(s.merge)u=new Mt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let h of s.mergeFields){let d=Bc(t,h,e);if(!o.contains(d))throw new y(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);Gg(l,d)||l.push(d)}u=new Mt(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new kc(new Pt(a),u,c)}var xi=class n extends Ee{_toFieldTransform(t){if(t.Vu!==2)throw t.Vu===1?t.Su(`${this._methodName}() can only appear at the top level of your update data`):t.Su(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function qg(n,t,e){return new Ao({Vu:3,Du:t.settings.Du,methodName:n._methodName,gu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var Mc=class n extends Ee{_toFieldTransform(t){return new dn(t.path,new Le)}isEqual(t){return t instanceof n}},Oc=class n extends Ee{constructor(t,e){super(t),this.vu=e}_toFieldTransform(t){let e=qg(this,t,!0),r=this.vu.map(s=>In(s,e)),i=new ve(r);return new dn(t.path,i)}isEqual(t){return t instanceof n&&Jo(this.vu,t.vu)}},Lc=class n extends Ee{constructor(t,e){super(t),this.vu=e}_toFieldTransform(t){let e=qg(this,t,!0),r=this.vu.map(s=>In(s,e)),i=new Ie(r);return new dn(t.path,i)}isEqual(t){return t instanceof n&&Jo(this.vu,t.vu)}},qc=class n extends Ee{constructor(t,e){super(t),this.Fu=e}_toFieldTransform(t){let e=new qe(t.serializer,Am(t.serializer,this.Fu));return new dn(t.path,e)}isEqual(t){return t instanceof n&&this.Fu===t.Fu}};function El(n,t,e,r){let i=n.Cu(1,t,e);Al("Data must be an object, but it was:",i,r);let s=[],o=Pt.empty();wn(r,(u,c)=>{let l=Sl(t,u,e);c=tt(c);let h=i.yu(l);if(c instanceof xi)s.push(l);else{let d=In(c,h);d!=null&&(s.push(l),o.set(l,d))}});let a=new Mt(s);return new To(o,a,i.fieldTransforms)}function Tl(n,t,e,r,i,s){let o=n.Cu(1,t,e),a=[Bc(t,r,e)],u=[i];if(s.length%2!=0)throw new y(g.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Bc(t,s[d])),u.push(s[d+1]);let c=[],l=Pt.empty();for(let d=a.length-1;d>=0;--d)if(!Gg(c,a[d])){let m=a[d],A=u[d];A=tt(A);let w=o.yu(m);if(A instanceof xi)c.push(m);else{let v=In(A,w);v!=null&&(c.push(m),l.set(m,v))}}let h=new Mt(c);return new To(l,h,o.fieldTransforms)}function Bg(n,t,e,r=!1){return In(e,n.Cu(r?4:3,t))}function In(n,t){if(jg(n=tt(n)))return Al("Unsupported field value:",t,n),Ug(n,t);if(n instanceof Ee)return function(r,i){if(!Lg(i.Vu))throw i.Su(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Su(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.gu&&t.Vu!==4)throw t.Su("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=In(a,i.wu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,t)}return function(r,i){if((r=tt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Am(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Z.fromDate(r);return{timestampValue:er(i.serializer,s)}}if(r instanceof Z){let s=new Z(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:er(i.serializer,s)}}if(r instanceof pn)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof le)return{bytesValue:km(i.serializer,r._byteString)};if(r instanceof Q){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Su(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Zc(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Su(`Unsupported field value: ${Fo(r)}`)}(n,t)}function Ug(n,t){let e={};return om(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):wn(n,(r,i)=>{let s=In(i,t.fu(r));s!=null&&(e[r]=s)}),{mapValue:{fields:e}}}function jg(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Z||n instanceof pn||n instanceof le||n instanceof Q||n instanceof Ee)}function Al(n,t,e){if(!jg(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){let r=Fo(e);throw r==="an object"?t.Su(n+" a custom object"):t.Su(n+" "+r)}}function Bc(n,t,e){if((t=tt(t))instanceof Wt)return t._internalPath;if(typeof t=="string")return Sl(n,t);throw So("Field path arguments must be of type string or ",n,!1,void 0,e)}var Iw=new RegExp("[~\\*/\\[\\]]");function Sl(n,t,e){if(t.search(Iw)>=0)throw So(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new Wt(...t.split("."))._internalPath}catch{throw So(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function So(n,t,e,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${t}() called with invalid data`;e&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new y(g.INVALID_ARGUMENT,a+n+u)}function Gg(n,t){return n.some(e=>e.isEqual(t))}var yn=class{constructor(t,e,r,i,s){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Q(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Uc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(Oo("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Uc=class extends yn{data(){return super.data()}};function Oo(n,t){return typeof t=="string"?Sl(n,t):t instanceof Wt?t._internalPath:t._delegate._internalPath}function zg(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new y(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ci=class{},_n=class extends Ci{};function Se(n,t,...e){let r=[];t instanceof Ci&&r.push(t),r=r.concat(e),function(s){let o=s.filter(u=>u instanceof jc).length,a=s.filter(u=>u instanceof Po).length;if(o>1||o>0&&a>0)throw new y(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Po=class n extends _n{constructor(t,e,r){super(),this._field=t,this._op=e,this._value=r,this.type="where"}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=this._parse(t);return tp(t._query,e),new Et(t.firestore,t.converter,wu(t._query,e))}_parse(t){let e=vn(t.firestore);return function(s,o,a,u,c,l,h){let d;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new y(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){Qf(h,l);let m=[];for(let A of h)m.push($f(u,s,A));d={arrayValue:{values:m}}}else d=$f(u,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||Qf(h,l),d=Bg(a,o,h,l==="in"||l==="not-in");return M.create(c,l,d)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function Kg(n,t,e){let r=t,i=Oo("where",n);return Po._create(i,r,e)}var jc=class n extends Ci{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new n(t,e)}_parse(t){let e=this._queryConstraints.map(r=>r._parse(t)).filter(r=>r.getFilters().length>0);return e.length===1?e[0]:K.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)tp(o,u),o=wu(o,u)}(t._query,e),new Et(t.firestore,t.converter,wu(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Gc=class n extends _n{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new n(t,e)}_apply(t){let e=function(i,s,o){if(i.startAt!==null)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new y(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ln(s,o)}(t._query,this._field,this._direction);return new Et(t.firestore,t.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new $t(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}};function $g(n,t="asc"){let e=t,r=Oo("orderBy",n);return Gc._create(r,e)}var bo=class n extends _n{constructor(t,e,r){super(),this.type=t,this._limit=e,this._limitType=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){return new Et(t.firestore,t.converter,Ks(t._query,this._limit,this._limitType))}};function Qg(n){return Tg("limit",n),bo._create("limit",n,"F")}function Wg(n){return Tg("limitToLast",n),bo._create("limitToLast",n,"L")}var Ro=class n extends _n{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=Zg(t,this.type,this._docOrFields,this._inclusive);return new Et(t.firestore,t.converter,function(i,s){return new $t(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(t._query,e))}};function Hg(...n){return Ro._create("startAt",n,!0)}function Yg(...n){return Ro._create("startAfter",n,!1)}var xo=class n extends _n{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=Zg(t,this.type,this._docOrFields,this._inclusive);return new Et(t.firestore,t.converter,function(i,s){return new $t(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(t._query,e))}};function Jg(...n){return xo._create("endBefore",n,!1)}function Xg(...n){return xo._create("endAt",n,!0)}function Zg(n,t,e,r){if(e[0]=tt(e[0]),e[0]instanceof yn)return function(s,o,a,u,c){if(!u)throw new y(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let h of Qn(s))if(h.field.isKeyField())l.push(cn(o,u.key));else{let d=u.data.field(h.field);if(Do(d))throw new y(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){let m=h.field.canonicalString();throw new y(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${m}' (used as the orderBy) does not exist.`)}l.push(d)}return new ue(l,c)}(n._query,n.firestore._databaseId,t,e[0]._document,r);{let i=vn(n.firestore);return function(o,a,u,c,l,h){let d=o.explicitOrderBy;if(l.length>d.length)throw new y(g.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let m=[];for(let A=0;A<l.length;A++){let w=l[A];if(d[A].field.isKeyField()){if(typeof w!="string")throw new y(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof w}`);if(!Jc(o)&&w.indexOf("/")!==-1)throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${w}' contains a slash.`);let v=o.path.child(L.fromString(w));if(!I.isDocumentKey(v))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${v}' is not because it contains an odd number of segments.`);let R=new I(v);m.push(cn(a,R))}else{let v=Bg(u,c,w);m.push(v)}}return new ue(m,h)}(n._query,n.firestore._databaseId,i,t,e,r)}}function $f(n,t,e){if(typeof(e=tt(e))=="string"){if(e==="")throw new y(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Jc(t)&&e.indexOf("/")!==-1)throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let r=t.path.child(L.fromString(e));if(!I.isDocumentKey(r))throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return cn(n,new I(r))}if(e instanceof Q)return cn(n,e._key);throw new y(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Fo(e)}.`)}function Qf(n,t){if(!Array.isArray(n)||n.length===0)throw new y(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function tp(n,t){let e=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new y(g.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new y(g.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var hr=class{convertValue(t,e="none"){switch(un(t)){case 0:return null;case 1:return t.booleanValue;case 2:return nt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Fe(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw S()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return wn(t,(i,s)=>{r[i]=this.convertValue(s,e)}),r}convertGeoPoint(t){return new pn(nt(t.latitude),nt(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=Hc(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(di(t));default:return null}}convertTimestamp(t){let e=we(t);return new Z(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=L.fromString(t);P(Km(r));let i=new Me(r.get(1),r.get(3)),s=new I(r.popFirst(5));return i.isEqual(e)||it(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function Lo(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var zc=class extends hr{constructor(t){super(),this.firestore=t}convertBytes(t){return new le(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new Q(this.firestore,null,e)}};var ye=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Gt=class extends yn{constructor(t,e,r,i,s,o){super(t,e,r,i,o),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Ne(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(Oo("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}},Ne=class extends Gt{data(t={}){return super.data(t)}},Ht=class{constructor(t,e,r,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new ye(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new Ne(this._firestore,this._userDataWriter,r.key,r,new ye(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new y(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new Ne(i._firestore,i._userDataWriter,a.doc.key,a.doc,new ye(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new Ne(i._firestore,i._userDataWriter,a.doc.key,a.doc,new ye(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,l=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:Ew(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function Ew(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function Pl(n,t){return n instanceof Gt&&t instanceof Gt?n._firestore===t._firestore&&n._key.isEqual(t._key)&&(n._document===null?t._document===null:n._document.isEqual(t._document))&&n._converter===t._converter:n instanceof Ht&&t instanceof Ht&&n._firestore===t._firestore&&Il(n.query,t.query)&&n.metadata.isEqual(t.metadata)&&n._snapshot.isEqual(t._snapshot)}function ep(n){n=q(n,Q);let t=q(n.firestore,J);return vg(gt(t),n._key).then(e=>Cl(t,n,e))}var Te=class extends hr{constructor(t){super(),this.firestore=t}convertBytes(t){return new le(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new Q(this.firestore,null,e)}};function np(n){n=q(n,Q);let t=q(n.firestore,J),e=gt(t),r=new Te(t);return gw(e,n._key).then(i=>new Gt(t,r,n._key,i,new ye(i!==null&&i.hasLocalMutations,!0),n.converter))}function rp(n){n=q(n,Q);let t=q(n.firestore,J);return vg(gt(t),n._key,{source:"server"}).then(e=>Cl(t,n,e))}function ip(n){n=q(n,Et);let t=q(n.firestore,J),e=gt(t),r=new Te(t);return zg(n._query),Ig(e,n._query).then(i=>new Ht(t,r,n,i))}function sp(n){n=q(n,Et);let t=q(n.firestore,J),e=gt(t),r=new Te(t);return pw(e,n._query).then(i=>new Ht(t,r,n,i))}function op(n){n=q(n,Et);let t=q(n.firestore,J),e=gt(t),r=new Te(t);return Ig(e,n._query,{source:"server"}).then(i=>new Ht(t,r,n,i))}function bl(n,t,e){n=q(n,Q);let r=q(n.firestore,J),i=Lo(n.converter,t,e);return _r(r,[Mo(vn(r),"setDoc",n._key,i,n.converter!==null,e).toMutation(n._key,rt.none())])}function Rl(n,t,e,...r){n=q(n,Q);let i=q(n.firestore,J),s=vn(i),o;return o=typeof(t=tt(t))=="string"||t instanceof Wt?Tl(s,"updateDoc",n._key,t,e,r):El(s,"updateDoc",n._key,t),_r(i,[o.toMutation(n._key,rt.exists(!0))])}function ap(n){return _r(q(n.firestore,J),[new Ue(n._key,rt.none())])}function up(n,t){let e=q(n.firestore,J),r=Oi(n),i=Lo(n.converter,t);return _r(e,[Mo(vn(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,rt.exists(!1))]).then(()=>r)}function xl(n,...t){var e,r,i;n=tt(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof t[o]!="object"||Vc(t[o])||(s=t[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Vc(t[o])){let h=t[o];t[o]=(e=h.next)===null||e===void 0?void 0:e.bind(h),t[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),t[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let u,c,l;if(n instanceof Q)c=q(n.firestore,J),l=fr(n._key.path),u={next:h=>{t[o]&&t[o](Cl(c,n,h))},error:t[o+1],complete:t[o+2]};else{let h=q(n,Et);c=q(h.firestore,J),l=h._query;let d=new Te(c);u={next:m=>{t[o]&&t[o](new Ht(c,d,h,m))},error:t[o+1],complete:t[o+2]},zg(n._query)}return function(d,m,A,w){let v=new cr(w),R=new Pi(m,v,A);return d.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return ol(yield lr(d),R)})),()=>{v.Qa(),d.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return al(yield lr(d),R)}))}}(gt(c),l,a,u)}function cp(n,t){return yw(gt(n=q(n,J)),Vc(t)?t:{next:t})}function _r(n,t){return function(r,i){let s=new ft;return r.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){return Y_(yield pl(r),i,s)})),s.promise}(gt(n),t)}function Cl(n,t,e){let r=e.docs.get(t._key),i=new Te(n);return new Gt(n,i,t._key,r,new ye(e.hasPendingWrites,e.fromCache),t.converter)}var Tw={maxAttempts:5};var Co=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=vn(t)}set(t,e,r){this._verifyNotCommitted();let i=De(t,this._firestore),s=Lo(i.converter,e,r),o=Mo(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,rt.none())),this}update(t,e,r,...i){this._verifyNotCommitted();let s=De(t,this._firestore),o;return o=typeof(e=tt(e))=="string"||e instanceof Wt?Tl(this._dataReader,"WriteBatch.update",s._key,e,r,i):El(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,rt.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=De(t,this._firestore);return this._mutations=this._mutations.concat(new Ue(e._key,rt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function De(n,t){if((n=tt(n)).firestore!==t)throw new y(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Kc=class extends class{constructor(e,r){this._firestore=e,this._transaction=r,this._dataReader=vn(e)}get(e){let r=De(e,this._firestore),i=new zc(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return S();let o=s[0];if(o.isFoundDocument())return new yn(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new yn(this._firestore,i,r._key,null,r.converter);throw S()})}set(e,r,i){let s=De(e,this._firestore),o=Lo(s.converter,r,i),a=Mo(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(e,r,i,...s){let o=De(e,this._firestore),a;return a=typeof(r=tt(r))=="string"||r instanceof Wt?Tl(this._dataReader,"Transaction.update",o._key,r,i,s):El(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(e){let r=De(e,this._firestore);return this._transaction.delete(r._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=De(t,this._firestore),r=new Te(this._firestore);return super.get(t).then(i=>new Gt(this._firestore,r,e._key,i._document,new ye(!1,!1),e.converter))}};function lp(n,t,e){n=q(n,J);let r=Object.assign(Object.assign({},Tw),e);return function(s){if(s.maxAttempts<1)throw new y(g.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new ft;return s.asyncQueue.enqueueAndForget(()=>p(this,null,function*(){let c=yield dw(s);new Rc(s.asyncQueue,c,a,o,u).Ya()})),u.promise}(gt(n),i=>t(new Kc(n,i)),r)}function hp(){return new xi("deleteField")}function dp(){return new Mc("serverTimestamp")}function fp(...n){return new Oc("arrayUnion",n)}function mp(...n){return new Lc("arrayRemove",n)}function gp(n){return new qc("increment",n)}(function(t,e=!0){(function(i){dr=i})(uh),ah(new Wi("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new J(new Ya(r.getProvider("auth-internal")),new tu(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new y(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Me(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:e},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Xo(Qd,"4.6.0",t),Xo(Qd,"4.6.0","esm2017")})();var Aw="@firebase/firestore-compat",Sw="0.3.29";function Ml(n,t){if(t===void 0)return{merge:!1};if(t.mergeFields!==void 0&&t.merge!==void 0)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return t}function pp(){if(typeof Uint8Array>"u")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function yp(){if(!am())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}var qo=class n{constructor(t){this._delegate=t}static fromBase64String(t){return yp(),new n(le.fromBase64String(t))}static fromUint8Array(t){return pp(),new n(le.fromUint8Array(t))}toBase64(){return yp(),this._delegate.toBase64()}toUint8Array(){return pp(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Dl(n){return Pw(n,["next","error","complete"])}function Pw(n,t){if(typeof n!="object"||n===null)return!1;let e=n;for(let r of t)if(r in e&&typeof e[r]=="function")return!0;return!1}var Vl=class{enableIndexedDbPersistence(t,e){return Rg(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return xg(t._delegate)}clearIndexedDbPersistence(t){return Dg(t._delegate)}},Bo=class{constructor(t,e,r){this._delegate=e,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},t instanceof Me||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){let e=this._delegate._getSettings();!t.merge&&e.host!==t.host&&Ut("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&(t=Object.assign(Object.assign({},e),t),delete t.merge),this._delegate._setSettings(t)}useEmulator(t,e,r={}){Ag(this._delegate,t,e,r)}enableNetwork(){return Ng(this._delegate)}disableNetwork(){return kg(this._delegate)}enablePersistence(t){let e=!1,r=!1;return t&&(e=!!t.synchronizeTabs,r=!!t.experimentalForceOwningTab,_l("synchronizeTabs",e,"experimentalForceOwningTab",r)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Vg(this._delegate)}onSnapshotsInSync(t){return cp(this._delegate,t)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new Ir(this,wl(this._delegate,t))}catch(e){throw Ct(e,"collection()","Firestore.collection()")}}doc(t){try{return new he(this,Oi(this._delegate,t))}catch(e){throw Ct(e,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new Sn(this,Sg(this._delegate,t))}catch(e){throw Ct(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return lp(this._delegate,e=>t(new Uo(this,e)))}batch(){return gt(this._delegate),new jo(new Co(this._delegate,t=>_r(this._delegate,t)))}loadBundle(t){return Fg(this._delegate,t)}namedQuery(t){return Mg(this._delegate,t).then(e=>e?new Sn(this,e):null)}},wr=class extends hr{constructor(t){super(),this.firestore=t}convertBytes(t){return new qo(new le(t))}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return he.forKey(e,this.firestore,null)}};function bw(n){Wf(n)}var Uo=class{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new wr(t)}get(t){let e=En(t);return this._delegate.get(e).then(r=>new Tn(this._firestore,new Gt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,e.converter)))}set(t,e,r){let i=En(t);return r?(Ml("Transaction.set",r),this._delegate.set(i,e,r)):this._delegate.set(i,e),this}update(t,e,r,...i){let s=En(t);return arguments.length===2?this._delegate.update(s,e):this._delegate.update(s,e,r,...i),this}delete(t){let e=En(t);return this._delegate.delete(e),this}},jo=class{constructor(t){this._delegate=t}set(t,e,r){let i=En(t);return r?(Ml("WriteBatch.set",r),this._delegate.set(i,e,r)):this._delegate.set(i,e),this}update(t,e,r,...i){let s=En(t);return arguments.length===2?this._delegate.update(s,e):this._delegate.update(s,e,r,...i),this}delete(t){let e=En(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}},vr=class n{constructor(t,e,r){this._firestore=t,this._userDataWriter=e,this._delegate=r}fromFirestore(t,e){let r=new Ne(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new An(this._firestore,r),e??{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){let r=n.INSTANCES,i=r.get(t);i||(i=new WeakMap,r.set(t,i));let s=i.get(e);return s||(s=new n(t,new wr(t),e),i.set(e,s)),s}};vr.INSTANCES=new WeakMap;var he=class n{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new wr(t)}static forPath(t,e,r){if(t.length%2!==0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${t.canonicalString()} has ${t.length}`);return new n(e,new Q(e._delegate,r,new I(t)))}static forKey(t,e,r){return new n(e,new Q(e._delegate,r,t))}get id(){return this._delegate.id}get parent(){return new Ir(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new Ir(this.firestore,wl(this._delegate,t))}catch(e){throw Ct(e,"collection()","DocumentReference.collection()")}}isEqual(t){return t=tt(t),t instanceof Q?vl(this._delegate,t):!1}set(t,e){e=Ml("DocumentReference.set",e);try{return e?bl(this._delegate,t,e):bl(this._delegate,t)}catch(r){throw Ct(r,"setDoc()","DocumentReference.set()")}}update(t,e,...r){try{return arguments.length===1?Rl(this._delegate,t):Rl(this._delegate,t,e,...r)}catch(i){throw Ct(i,"updateDoc()","DocumentReference.update()")}}delete(){return ap(this._delegate)}onSnapshot(...t){let e=_p(t),r=wp(t,i=>new Tn(this.firestore,new Gt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return xl(this._delegate,e,r)}get(t){let e;return t?.source==="cache"?e=np(this._delegate):t?.source==="server"?e=rp(this._delegate):e=ep(this._delegate),e.then(r=>new Tn(this.firestore,new Gt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(t){return new n(this.firestore,t?this._delegate.withConverter(vr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function Ct(n,t,e){return n.message=n.message.replace(t,e),n}function _p(n){for(let t of n)if(typeof t=="object"&&!Dl(t))return t;return{}}function wp(n,t){var e,r;let i;return Dl(n[0])?i=n[0]:Dl(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(t(s))},error:(e=i.error)===null||e===void 0?void 0:e.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Tn=class{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new he(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return Pl(this._delegate,t._delegate)}},An=class extends Tn{data(t){let e=this._delegate.data(t);return this._delegate._converter||Hf(e!==void 0,"Document in a QueryDocumentSnapshot should exist"),e}},Sn=class n{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new wr(t)}where(t,e,r){try{return new n(this.firestore,Se(this._delegate,Kg(t,e,r)))}catch(i){throw Ct(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new n(this.firestore,Se(this._delegate,$g(t,e)))}catch(r){throw Ct(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new n(this.firestore,Se(this._delegate,Qg(t)))}catch(e){throw Ct(e,"limit()","Query.limit()")}}limitToLast(t){try{return new n(this.firestore,Se(this._delegate,Wg(t)))}catch(e){throw Ct(e,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new n(this.firestore,Se(this._delegate,Hg(...t)))}catch(e){throw Ct(e,"startAt()","Query.startAt()")}}startAfter(...t){try{return new n(this.firestore,Se(this._delegate,Yg(...t)))}catch(e){throw Ct(e,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new n(this.firestore,Se(this._delegate,Jg(...t)))}catch(e){throw Ct(e,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new n(this.firestore,Se(this._delegate,Xg(...t)))}catch(e){throw Ct(e,"endAt()","Query.endAt()")}}isEqual(t){return Il(this._delegate,t._delegate)}get(t){let e;return t?.source==="cache"?e=sp(this._delegate):t?.source==="server"?e=op(this._delegate):e=ip(this._delegate),e.then(r=>new Li(this.firestore,new Ht(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...t){let e=_p(t),r=wp(t,i=>new Li(this.firestore,new Ht(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return xl(this._delegate,e,r)}withConverter(t){return new n(this.firestore,t?this._delegate.withConverter(vr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}},Nl=class{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new An(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Li=class{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new Sn(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(t=>new An(this._firestore,t))}docChanges(t){return this._delegate.docChanges(t).map(e=>new Nl(this._firestore,e))}forEach(t,e){this._delegate.forEach(r=>{t.call(e,new An(this._firestore,r))})}isEqual(t){return Pl(this._delegate,t._delegate)}},Ir=class n extends Sn{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let t=this._delegate.parent;return t?new he(this.firestore,t):null}doc(t){try{return t===void 0?new he(this.firestore,Oi(this._delegate)):new he(this.firestore,Oi(this._delegate,t))}catch(e){throw Ct(e,"doc()","CollectionReference.doc()")}}add(t){return up(this._delegate,t).then(e=>new he(this.firestore,e))}isEqual(t){return vl(this._delegate,t._delegate)}withConverter(t){return new n(this.firestore,t?this._delegate.withConverter(vr.getInstance(this.firestore,t)):this._delegate.withConverter(null))}};function En(n){return q(n,Q)}var kl=class n{constructor(...t){this._delegate=new Wt(...t)}static documentId(){return new n(st.keyField().canonicalString())}isEqual(t){return t=tt(t),t instanceof Wt?this._delegate._internalPath.isEqual(t._internalPath):!1}};var Fl=class n{constructor(t){this._delegate=t}static serverTimestamp(){let t=dp();return t._methodName="FieldValue.serverTimestamp",new n(t)}static delete(){let t=hp();return t._methodName="FieldValue.delete",new n(t)}static arrayUnion(...t){let e=fp(...t);return e._methodName="FieldValue.arrayUnion",new n(e)}static arrayRemove(...t){let e=mp(...t);return e._methodName="FieldValue.arrayRemove",new n(e)}static increment(t){let e=gp(t);return e._methodName="FieldValue.increment",new n(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}};var Rw={Firestore:Bo,GeoPoint:pn,Timestamp:Z,Blob:qo,Transaction:Uo,WriteBatch:jo,DocumentReference:he,DocumentSnapshot:Tn,Query:Sn,QueryDocumentSnapshot:An,QuerySnapshot:Li,CollectionReference:Ir,FieldPath:kl,FieldValue:Fl,setLogLevel:bw,CACHE_SIZE_UNLIMITED:Pg};function xw(n,t){n.INTERNAL.registerComponent(new Wi("firestore-compat",e=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("firestore").getImmediate();return t(r,i)},"PUBLIC").setServiceProps(Object.assign({},Rw)))}function Cw(n){xw(n,(t,e)=>new Bo(t,e,new Vl)),n.registerVersion(Aw,Sw)}Cw(Zo);function Dw(n,t=jl){return new Ul(e=>{let r;return t!=null?t.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},e)}):r=n.onSnapshot({includeMetadataChanges:!0},e),()=>{r?.()}})}function vp(n,t){return Dw(n,t)}function Vw(n,t){return vp(n,t).pipe(ji(void 0),Bi(),Nt(e=>{let[r,i]=e;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function ql(n,t){return vp(n,t).pipe(Nt(e=>({payload:e,type:"query"})))}var Go=class{ref;afs;constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){let r=this.ref.collection(t),{ref:i,query:s}=Tp(r,e);return new Ko(i,s,this.afs)}snapshotChanges(){return Vw(this.ref,this.afs.schedulers.outsideAngular).pipe(Ot)}valueChanges(t={}){return this.snapshotChanges().pipe(Nt(({payload:e})=>t.idField?Er(Pn({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return de(this.ref.get(t)).pipe(Ot)}};function zo(n,t){return ql(n,t).pipe(ji(void 0),Bi(),Nt(e=>{let[r,i]=e,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{let c=s.find(h=>h.doc.ref.isEqual(a.ref)),l=r?.payload.docs.find(h=>h.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&l&&JSON.stringify(l.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function Ip(n,t,e){return zo(n,e).pipe(Ui((r,i)=>Nw(r,i.map(s=>s.payload),t),[]),Gl(),Nt(r=>r.map(i=>({type:i.type,payload:i}))))}function Nw(n,t,e){return t.forEach(r=>{e.indexOf(r.type)>-1&&(n=kw(n,r))}),n}function Ol(n,t,e,...r){let i=n.slice();return i.splice(t,e,...r),i}function kw(n,t){switch(t.type){case"added":if(!(n[t.newIndex]&&n[t.newIndex].doc.ref.isEqual(t.doc.ref)))return Ol(n,t.newIndex,0,t);break;case"modified":if(n[t.oldIndex]==null||n[t.oldIndex].doc.ref.isEqual(t.doc.ref))if(t.oldIndex!==t.newIndex){let e=n.slice();return e.splice(t.oldIndex,1),e.splice(t.newIndex,0,t),e}else return Ol(n,t.newIndex,1,t);break;case"removed":if(n[t.oldIndex]&&n[t.oldIndex].doc.ref.isEqual(t.doc.ref))return Ol(n,t.oldIndex,1);break}return n}function Ep(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Ko=class{ref;query;afs;constructor(t,e,r){this.ref=t,this.query=e,this.afs=r}stateChanges(t){let e=zo(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Nt(r=>r.filter(i=>t.indexOf(i.type)>-1)))),e.pipe(ji(void 0),Bi(),Wo(([r,i])=>i.length>0||!r),Nt(([,r])=>r),Ot)}auditTrail(t){return this.stateChanges(t).pipe(Ui((e,r)=>[...e,...r],[]))}snapshotChanges(t){let e=Ep(t);return Ip(this.query,e,this.afs.schedulers.outsideAngular).pipe(Ot)}valueChanges(t={}){return ql(this.query,this.afs.schedulers.outsideAngular).pipe(Nt(e=>e.payload.docs.map(r=>t.idField?Er(Pn({},r.data()),{[t.idField]:r.id}):r.data())),Ot)}get(t){return de(this.query.get(t)).pipe(Ot)}add(t){return this.ref.add(t)}doc(t){return new Go(this.ref.doc(t),this.afs)}},Ll=class{query;afs;constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return!t||t.length===0?zo(this.query,this.afs.schedulers.outsideAngular).pipe(Ot):zo(this.query,this.afs.schedulers.outsideAngular).pipe(Nt(e=>e.filter(r=>t.indexOf(r.type)>-1)),Wo(e=>e.length>0),Ot)}auditTrail(t){return this.stateChanges(t).pipe(Ui((e,r)=>[...e,...r],[]))}snapshotChanges(t){let e=Ep(t);return Ip(this.query,e,this.afs.schedulers.outsideAngular).pipe(Ot)}valueChanges(t={}){return ql(this.query,this.afs.schedulers.outsideAngular).pipe(Nt(r=>r.payload.docs.map(i=>t.idField?Pn({[t.idField]:i.id},i.data()):i.data())),Ot)}get(t){return de(this.query.get(t)).pipe(Ot)}},Fw=new Pr("angularfire2.enableFirestorePersistence"),Mw=new Pr("angularfire2.firestore.persistenceSettings"),Ow=new Pr("angularfire2.firestore.settings"),Lw=new Pr("angularfire2.firestore.use-emulator");function Tp(n,t=e=>e){return{query:t(n),ref:n}}var Ap=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(e,r,i,s,o,a,u,c,l,h,d,m,A,w,v,R,F){this.schedulers=u;let x=fh(e,a,r),U=l;h&&Ih(x,a,d,A,w,v,m,R),[this.firestore,this.persistenceEnabled$]=mh(`${x.name}.firestore`,"AngularFirestore",x.name,()=>{let j=a.runOutsideAngular(()=>x.firestore());if(s&&j.settings(s),U&&j.useEmulator(...U),i&&!Yl(o)){let B=()=>{try{return de(j.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(at){return typeof console<"u"&&console.warn(at),bn(!1)}};return[j,a.runOutsideAngular(B)]}else return[j,bn(!1)]},[s,U,i])}collection(e,r){let i;typeof e=="string"?i=this.firestore.collection(e):i=e;let{ref:s,query:o}=Tp(i,r),a=this.schedulers.ngZone.run(()=>s);return new Ko(a,o,this)}collectionGroup(e,r){let i=r||(o=>o),s=this.firestore.collectionGroup(e);return new Ll(i(s),this)}doc(e){let r;typeof e=="string"?r=this.firestore.doc(e):r=e;let i=this.schedulers.ngZone.run(()=>r);return new Go(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(ut(hh),ut(dh,8),ut(Fw,8),ut(Ow,8),ut(zl),ut(Kl),ut(lh),ut(Mw,8),ut(Lw,8),ut(Eh,8),ut(gh,8),ut(ph,8),ut(yh,8),ut(_h,8),ut(wh,8),ut(vh,8),ut(ch,8))};static \u0275prov=Gi({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var $o=(()=>{let t=class t{constructor(r){this.firestore=r,this.collection=this.firestore.collection("projects")}getProjects(){return this.collection.snapshotChanges().pipe(Nt(r=>r.map(i=>{let s=i.payload.doc.data(),o=i.payload.doc.id;return Er(Pn({},s),{id:o})})),Tr(r=>{throw console.error("Error obteniendo datos de Firestore:",r),r}))}addProject(r){return de(this.collection.add(r)).pipe(Ar(i=>(console.log("Proyecto agregado correctamente."),this.collection.doc(i.id).valueChanges())))}updateProject(r,i){return de(this.collection.doc(r).update(i)).pipe(Tr(s=>{throw console.error("Error actualizando proyecto en Firestore:",s),s}))}deleteProject(r){return de(this.collection.doc(r).delete()).pipe(Tr(i=>{throw console.error("Error eliminando proyecto de Firestore:",i),i}))}getProjectById(r){return this.collection.doc(r).get().pipe(Ar(i=>{if(i.exists){let s=i.data();return bn(s)}else return console.error("No existe ning\xFAn proyecto con el ID proporcionado:",r),bn(void 0)}),Tr(i=>{throw console.error("Error obteniendo proyecto por ID:",i),i}))}};t.\u0275fac=function(i){return new(i||t)(ut(Ap))},t.\u0275prov=Gi({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})();var Bw=n=>["/portfolio/project/",n];function Uw(n,t){if(n&1&&(k(0,"div",4),X(1,"img",5),k(2,"div",6)(3,"h3",7),G(4),N(),k(5,"p",8),G(6),N(),k(7,"a",9),G(8,"Ver m\xE1s"),N()()()),n&2){let e=t.$implicit;W(),ct("src",e.imageUrl,zi)("alt",e.title),W(3),fe(e.title.toUpperCase()),W(2),fe(e.description),W(),ct("routerLink",Wl(5,Bw,e.id))}}var bp=(()=>{let t=class t{constructor(r){this.projectService=r,this.title="proyectos",this.projects=[]}ngOnInit(){this.projectService.getProjects().subscribe(r=>{this.projects=r})}};t.\u0275fac=function(i){return new(i||t)(Rn($o))},t.\u0275cmp=Dt({type:t,selectors:[["portfolio-projects-page"]],decls:4,vars:2,consts:[[3,"title"],[1,"m-3"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-2","xl:grid-cols-3","gap-4"],["class","bg-blue-950 rounded-lg shadow-md overflow-hidden",4,"ngFor","ngForOf"],[1,"bg-blue-950","rounded-lg","shadow-md","overflow-hidden"],[1,"w-full","h-40","object-cover","object-center",3,"src","alt"],[1,"p-3"],[1,"text-lg","font-semibold","mb-1"],[1,"mb-2","text-gray-400"],[1,"text-blue-500","font-semibold","hover:text-blue-700",3,"routerLink"]],template:function(i,s){i&1&&(X(0,"shared-head",0),k(1,"div",1)(2,"div",2),$e(3,Uw,9,7,"div",3),N()()),i&2&&(ct("title",s.title),W(3),ct("ngForOf",s.projects))},dependencies:[xn,Qi,Lt]});let n=t;return n})();var jw=()=>["/portfolio/projects/"];function Gw(n,t){if(n&1&&(k(0,"span",11),X(1,"i"),G(2),N()),n&2){let e=t.$implicit,r=$i();W(),Ki("",r.getIconForTechnology(e)," text-1xl mr-2"),W(),Qe(" ",e," ")}}var Rp=(()=>{let t=class t{constructor(r,i,s){this.activatedRoute=r,this.projectService=i,this.router=s,this.title="Proyect",this.id=0}ngOnInit(){this.activatedRoute.params.pipe(Ar(({id:r})=>this.projectService.getProjectById(r))).subscribe(r=>{this.project=r,console.log(r)})}getIconForTechnology(r){switch(r){case"Spring Boot":return"fab fa-java";case"Microservicios":case"REST API":case"Node.js":case"Nest.js":return"fab fa-node-js";case"React":case"Angular":case"Vue.js":return"fab fa-js";case"MongoDB":case"Firestore":return"fas fa-database";case"Bootstrap":case"Tailwind CSS":case"Material UI":case"Ant Design":return"fab fa-css3-alt";case"Storybook":case"Angular Material":case"PrimeNG":return"fas fa-book-open";case"SQL MySQL":case"SQLServer":case"PostgreSQL":return"fas fa-database";case"Patrones de dise\xF1o":return"fas fa-paint-brush";case"Sistema de dise\xF1o":return"fas fa-layer-group";case"Docker":return"fab fa-docker";case"Git":case"Github":case"Gitlab":return"fab fa-git-alt";case"Git flow":case"Trunk base":return"fas fa-code-branch";case"Google Cloud Platform (GCP)":case"Azure":return"fab fa-cloud";default:return"fas fa-code"}}};t.\u0275fac=function(i){return new(i||t)(Rn(Jl),Rn($o),Rn(Zl))},t.\u0275cmp=Dt({type:t,selectors:[["portfolio-project-page"]],decls:29,vars:10,consts:[[3,"title"],[1,"m-3"],[1,"max-w-md","mx-auto","bg-blue-950","rounded-xl","shadow-md","overflow-hidden","md:max-w-2xl"],["alt","Project Image",1,"md:h-64","md:w-full","object-cover","object-center",3,"src"],[1,"p-6"],[1,"text-xl","font-bold","text-white"],[1,"mt-2","text-gray-400"],[1,"mt-4"],[1,"flex","flex-wrap"],["class","flex items-center font-semibold text-sm text-blue-600 bg-blue-100 rounded-full p-2 m-2",4,"ngFor","ngForOf"],[1,"mt-4","inline-block","bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded",3,"routerLink"],[1,"flex","items-center","font-semibold","text-sm","text-blue-600","bg-blue-100","rounded-full","p-2","m-2"]],template:function(i,s){i&1&&(X(0,"shared-head",0),k(1,"div",1)(2,"div",2),X(3,"img",3),k(4,"div",4)(5,"h2",5),G(6),N(),k(7,"p",6),G(8),N(),k(9,"div",7)(10,"p")(11,"strong"),G(12,"Empresa:"),N(),G(13),N(),k(14,"p")(15,"strong"),G(16,"Cargo:"),N(),G(17),N(),k(18,"p")(19,"strong"),G(20,"Cliente:"),N(),G(21),N(),k(22,"p")(23,"strong"),G(24,"Tecnolog\xEDas:"),N()(),k(25,"div",8),$e(26,Gw,3,4,"span",9),N()(),k(27,"a",10),G(28,"atras"),N()()()()),i&2&&(ct("title","T\xEDtulo del Trabajo 2"),W(3),ct("src",s.project.imageUrl,zi),W(3),fe(s.project.title),W(2),fe(s.project.description),W(5),Qe(" ",s.project.companyName,""),W(4),Qe(" ",s.project.position,""),W(4),Qe(" ",s.project.client,""),W(5),ct("ngForOf",s.project.technologies),W(),ct("routerLink",Ql(9,jw)))},dependencies:[xn,Qi,Lt]});let n=t;return n})();function zw(n,t){if(n&1&&(k(0,"span",11),X(1,"i"),G(2),N()),n&2){let e=t.$implicit,r=$i(2);W(),Ki("",r.getIconForTechnology(e)," mr-1"),W(),Qe(" ",e," ")}}function Kw(n,t){if(n&1&&(k(0,"div",4)(1,"div",5)(2,"div",6),X(3,"i"),N(),k(4,"div")(5,"h3",7),G(6),N(),k(7,"p",8),G(8),N(),k(9,"div",9),$e(10,zw,3,4,"span",10),N()()()()),n&2){let e=t.$implicit;W(3),$l(e.icon),W(3),fe(e.title.toUpperCase()),W(2),fe(e.description),W(2),ct("ngForOf",e.technologies)}}var xp=(()=>{let t=class t{constructor(){this.title="Habilidades",this.skills=[{icon:"fas fa-cogs",title:"Spring Boot / Microservicios / REST API",description:"Experiencia en el desarrollo de aplicaciones utilizando Spring Boot para la creaci\xF3n de microservicios y REST APIs.",technologies:["Spring Boot","Microservicios","REST API"]},{icon:"fab fa-react",title:"Ts / React / Angular / Node / Nest",description:"Conocimientos avanzados en TypeScript, React, Angular, Node.js y Nest.js para el desarrollo de aplicaciones web.",technologies:["TypeScript","React","Angular","Node.js","Nest.js"]},{icon:"fas fa-database",title:"MongoDB / Firestore",description:"Experiencia en bases de datos NoSQL como MongoDB y Firestore para almacenamiento de datos.",technologies:["MongoDB","Firestore"]},{icon:"fab fa-bootstrap",title:"Bootstrap / Tailwind / MUI / Storybook",description:"Habilidad en el uso de herramientas como Bootstrap, Tailwind CSS, Material UI y Storybook para el desarrollo de interfaces de usuario.",technologies:["Bootstrap","Tailwind CSS","Material UI","Storybook"]},{icon:"fas fa-database",title:"SQL MySQL / SQLServer / PostgreSQL",description:"Experiencia en el manejo de bases de datos relacionales como MySQL, SQLServer y PostgreSQL.",technologies:["SQL MySQL","SQLServer","PostgreSQL"]},{icon:"fas fa-object-group",title:"Patrones de dise\xF1o / Sistema de dise\xF1o",description:"Conocimientos en patrones de dise\xF1o y desarrollo de sistemas de dise\xF1o para crear interfaces coherentes y escalables.",technologies:["Patrones de dise\xF1o","Sistema de dise\xF1o"]},{icon:"fab fa-docker",title:"Docker",description:"Experiencia en el uso de Docker para la creaci\xF3n, implementaci\xF3n y gesti\xF3n de contenedores de aplicaciones.",technologies:["Docker"]},{icon:"fab fa-git-alt",title:"Git / Github / Gitlab / Git flow / trunk base",description:"Habilidad en el uso de sistemas de control de versiones como Git y plataformas como Github y Gitlab, junto con metodolog\xEDas de flujo de trabajo como Git flow y trunk based development.",technologies:["Git","Github","Gitlab","Git flow","Trunk base"]},{icon:"fab fa-google",title:"Cloud GCP / Azure",description:"Experiencia en el uso de plataformas en la nube como Google Cloud Platform (GCP) y Microsoft Azure para el desarrollo y despliegue de aplicaciones en la nube.",technologies:["Google Cloud Platform (GCP)","Azure"]}]}getIconForTechnology(r){switch(r){case"Spring Boot":return"fab fa-java";case"Microservicios":case"REST API":case"Node.js":case"Nest.js":return"fab fa-node-js";case"React":case"Angular":case"Vue.js":return"fab fa-js";case"MongoDB":case"Firestore":return"fas fa-database";case"Bootstrap":case"Tailwind CSS":case"Material UI":case"Ant Design":return"fab fa-css3-alt";case"Storybook":case"Angular Material":case"PrimeNG":return"fas fa-book-open";case"SQL MySQL":case"SQLServer":case"PostgreSQL":return"fas fa-database";case"Patrones de dise\xF1o":return"fas fa-paint-brush";case"Sistema de dise\xF1o":return"fas fa-layer-group";case"Docker":return"fab fa-docker";case"Git":case"Github":case"Gitlab":return"fab fa-git-alt";case"Git flow":case"Trunk base":return"fas fa-code-branch";case"Google Cloud Platform (GCP)":case"Azure":return"fab fa-cloud";default:return"fas fa-code"}}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=Dt({type:t,selectors:[["portfolio-skills-page"]],decls:4,vars:2,consts:[[3,"title"],[1,"m-3"],[1,"grid","grid-cols-1","sm:grid-cols-1","md:grid-cols-1","lg:grid-cols-2","xl:grid-cols-3","gap-4"],["class","bg-blue-950 rounded-lg shadow-md overflow-hidden",4,"ngFor","ngForOf"],[1,"bg-blue-950","rounded-lg","shadow-md","overflow-hidden"],[1,"p-2","flex","items-center"],[1,"p-2","text-blue-500","text-4xl"],[1,"text-md","font-semibold","mb-2"],[1,"text-sm","text-gray-400","mb-2"],[1,"flex","flex-wrap"],["class","flex items-center font-semibold text-sm text-blue-600 bg-blue-100 rounded-full p-1 m-1",4,"ngFor","ngForOf"],[1,"flex","items-center","font-semibold","text-sm","text-blue-600","bg-blue-100","rounded-full","p-1","m-1"]],template:function(i,s){i&1&&(X(0,"shared-head",0),k(1,"div",1)(2,"div",2),$e(3,Kw,11,6,"div",3),N()()),i&2&&(ct("title",s.title),W(3),ct("ngForOf",s.skills))},dependencies:[xn,Lt]});let n=t;return n})();var Cp=(()=>{let t=class t{constructor(){this.title="contacto"}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=Dt({type:t,selectors:[["portfolio-contact-page"]],decls:20,vars:1,consts:[[3,"title"],[1,"m-3"],[1,"w-8/12","mx-auto","bg-blue-950","rounded-lg","shadow-md"],[1,"p-6"],[1,"text-2xl","mb-4"],["action","#","method","POST",1,"space-y-4"],[1,"flex","items-center"],[1,"fas","fa-user","text-white-700","mr-2"],["type","text","id","name","name","name",1,"mt-1","focus:border-transparent","block","w-full","shadow-sm","md:text-lg","rounded-md","text-black","h-10"],[1,"fas","fa-envelope","text-white-700","mr-2"],["type","email","id","email","name","email",1,"mt-1","focus:border-transparent","block","w-full","shadow-sm","md:text-lg","rounded-md","text-black","h-10"],[1,"fas","fa-comment","text-white-700","mr-2"],["id","message","name","message","rows","4",1,"mt-1","focus:border-transparent","block","w-full","shadow-sm","md:text-lg","rounded-md","text-black"],[1,"mt-4"],["type","submit",1,"inline-flex","items-center","px-4","py-2","border","border-transparent","text-base","font-medium","rounded-md","text-white","bg-blue-600","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500"]],template:function(i,s){i&1&&(X(0,"shared-head",0),k(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),G(5,"Formulario de Contacto"),N(),k(6,"form",5)(7,"div",6),X(8,"i",7)(9,"input",8),N(),k(10,"div",6),X(11,"i",9)(12,"input",10),N(),k(13,"div",6),X(14,"i",11),k(15,"textarea",12),G(16,"          "),N()(),k(17,"div",13)(18,"button",14),G(19," Enviar "),N()()()()()()),i&2&&ct("title",s.title)},dependencies:[Lt]});let n=t;return n})();var Dp=(()=>{let t=class t{constructor(){this.title="experiencia"}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=Dt({type:t,selectors:[["portfolio-experience-page"]],decls:4,vars:1,consts:[[3,"title"],[1,"m-3"]],template:function(i,s){i&1&&(X(0,"shared-head",0),k(1,"div",1)(2,"p"),G(3,"experiencePage works!"),N()()),i&2&&ct("title",s.title)},dependencies:[Lt]});let n=t;return n})();var Vp=(()=>{let t=class t{constructor(){this.title="educacion"}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=Dt({type:t,selectors:[["portfolio-education-page"]],decls:4,vars:1,consts:[[3,"title"],[1,"m-3"]],template:function(i,s){i&1&&(X(0,"shared-head",0),k(1,"div",1)(2,"p"),G(3,"educationPage works!"),N()()),i&2&&ct("title",s.title)},dependencies:[Lt]});let n=t;return n})();var $w=[{path:"",component:Sh,children:[{path:"projects",component:bp},{path:"skills",component:xp},{path:"experience",component:Dp},{path:"education",component:Vp},{path:"contact",component:Cp},{path:"project/:id",component:Rp},{path:"**",redirectTo:"projects"}]}],Np=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=br({type:t}),t.\u0275inj=Sr({imports:[Ho.forChild($w),Ho]});let n=t;return n})();var TI=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=br({type:t}),t.\u0275inj=Sr({imports:[Hl,Np,Th]});let n=t;return n})();export{TI as PortfolioModule};
